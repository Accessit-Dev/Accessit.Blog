/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/*! nanoScrollerJS - v0.8.7 - 2015
* http://jamesflorentino.github.com/nanoScrollerJS/
* Copyright (c) 2015 James Florentino; Licensed MIT */
(function(factory) {
  if (typeof define === 'function' && define.amd) {
    return define(['jquery'], function($) {
      return factory($, window, document);
    });
  } else if (typeof exports === 'object') {
    return module.exports = factory(require('jquery'), window, document);
  } else {
    return factory(jQuery, window, document);
  }
})(function($, window, document) {
  "use strict";
  var BROWSER_IS_IE7, BROWSER_SCROLLBAR_WIDTH, DOMSCROLL, DOWN, DRAG, ENTER, KEYDOWN, KEYUP, MOUSEDOWN, MOUSEENTER, MOUSEMOVE, MOUSEUP, MOUSEWHEEL, NanoScroll, PANEDOWN, RESIZE, SCROLL, SCROLLBAR, TOUCHMOVE, UP, WHEEL, cAF, defaults, getBrowserScrollbarWidth, hasTransform, isFFWithBuggyScrollbar, rAF, transform, _elementStyle, _prefixStyle, _vendor;
  defaults = {

    /**
      a classname for the pane element.
      @property paneClass
      @type String
      @default 'nano-pane'
     */
    paneClass: 'nano-pane',

    /**
      a classname for the slider element.
      @property sliderClass
      @type String
      @default 'nano-slider'
     */
    sliderClass: 'nano-slider',

    /**
      a classname for the content element.
      @property contentClass
      @type String
      @default 'nano-content'
     */
    contentClass: 'nano-content',

    /**
      a setting to enable native scrolling in iOS devices.
      @property iOSNativeScrolling
      @type Boolean
      @default false
     */
    iOSNativeScrolling: false,

    /**
      a setting to prevent the rest of the page being
      scrolled when user scrolls the `.content` element.
      @property preventPageScrolling
      @type Boolean
      @default false
     */
    preventPageScrolling: false,

    /**
      a setting to disable binding to the resize event.
      @property disableResize
      @type Boolean
      @default false
     */
    disableResize: false,

    /**
      a setting to make the scrollbar always visible.
      @property alwaysVisible
      @type Boolean
      @default false
     */
    alwaysVisible: false,

    /**
      a default timeout for the `flash()` method.
      @property flashDelay
      @type Number
      @default 1500
     */
    flashDelay: 1500,

    /**
      a minimum height for the `.slider` element.
      @property sliderMinHeight
      @type Number
      @default 20
     */
    sliderMinHeight: 20,

    /**
      a maximum height for the `.slider` element.
      @property sliderMaxHeight
      @type Number
      @default null
     */
    sliderMaxHeight: null,

    /**
      an alternate document context.
      @property documentContext
      @type Document
      @default null
     */
    documentContext: null,

    /**
      an alternate window context.
      @property windowContext
      @type Window
      @default null
     */
    windowContext: null
  };

  /**
    @property SCROLLBAR
    @type String
    @static
    @final
    @private
   */
  SCROLLBAR = 'scrollbar';

  /**
    @property SCROLL
    @type String
    @static
    @final
    @private
   */
  SCROLL = 'scroll';

  /**
    @property MOUSEDOWN
    @type String
    @final
    @private
   */
  MOUSEDOWN = 'mousedown';

  /**
    @property MOUSEENTER
    @type String
    @final
    @private
   */
  MOUSEENTER = 'mouseenter';

  /**
    @property MOUSEMOVE
    @type String
    @static
    @final
    @private
   */
  MOUSEMOVE = 'mousemove';

  /**
    @property MOUSEWHEEL
    @type String
    @final
    @private
   */
  MOUSEWHEEL = 'mousewheel';

  /**
    @property MOUSEUP
    @type String
    @static
    @final
    @private
   */
  MOUSEUP = 'mouseup';

  /**
    @property RESIZE
    @type String
    @final
    @private
   */
  RESIZE = 'resize';

  /**
    @property DRAG
    @type String
    @static
    @final
    @private
   */
  DRAG = 'drag';

  /**
    @property ENTER
    @type String
    @static
    @final
    @private
   */
  ENTER = 'enter';

  /**
    @property UP
    @type String
    @static
    @final
    @private
   */
  UP = 'up';

  /**
    @property PANEDOWN
    @type String
    @static
    @final
    @private
   */
  PANEDOWN = 'panedown';

  /**
    @property DOMSCROLL
    @type String
    @static
    @final
    @private
   */
  DOMSCROLL = 'DOMMouseScroll';

  /**
    @property DOWN
    @type String
    @static
    @final
    @private
   */
  DOWN = 'down';

  /**
    @property WHEEL
    @type String
    @static
    @final
    @private
   */
  WHEEL = 'wheel';

  /**
    @property KEYDOWN
    @type String
    @static
    @final
    @private
   */
  KEYDOWN = 'keydown';

  /**
    @property KEYUP
    @type String
    @static
    @final
    @private
   */
  KEYUP = 'keyup';

  /**
    @property TOUCHMOVE
    @type String
    @static
    @final
    @private
   */
  TOUCHMOVE = 'touchmove';

  /**
    @property BROWSER_IS_IE7
    @type Boolean
    @static
    @final
    @private
   */
  BROWSER_IS_IE7 = window.navigator.appName === 'Microsoft Internet Explorer' && /msie 7./i.test(window.navigator.appVersion) && window.ActiveXObject;

  /**
    @property BROWSER_SCROLLBAR_WIDTH
    @type Number
    @static
    @default null
    @private
   */
  BROWSER_SCROLLBAR_WIDTH = null;
  rAF = window.requestAnimationFrame;
  cAF = window.cancelAnimationFrame;
  _elementStyle = document.createElement('div').style;
  _vendor = (function() {
    var i, transform, vendor, vendors, _i, _len;
    vendors = ['t', 'webkitT', 'MozT', 'msT', 'OT'];
    for (i = _i = 0, _len = vendors.length; _i < _len; i = ++_i) {
      vendor = vendors[i];
      transform = vendors[i] + 'ransform';
      if (transform in _elementStyle) {
        return vendors[i].substr(0, vendors[i].length - 1);
      }
    }
    return false;
  })();
  _prefixStyle = function(style) {
    if (_vendor === false) {
      return false;
    }
    if (_vendor === '') {
      return style;
    }
    return _vendor + style.charAt(0).toUpperCase() + style.substr(1);
  };
  transform = _prefixStyle('transform');
  hasTransform = transform !== false;

  /**
    Returns browser's native scrollbar width
    @method getBrowserScrollbarWidth
    @return {Number} the scrollbar width in pixels
    @static
    @private
   */
  getBrowserScrollbarWidth = function() {
    var outer, outerStyle, scrollbarWidth;
    outer = document.createElement('div');
    outerStyle = outer.style;
    outerStyle.position = 'absolute';
    outerStyle.width = '100px';
    outerStyle.height = '100px';
    outerStyle.overflow = SCROLL;
    outerStyle.top = '-9999px';
    document.body.appendChild(outer);
    scrollbarWidth = outer.offsetWidth - outer.clientWidth;
    document.body.removeChild(outer);
    return scrollbarWidth;
  };
  isFFWithBuggyScrollbar = function() {
    var isOSXFF, ua, version;
    ua = window.navigator.userAgent;
    isOSXFF = /(?=.+Mac OS X)(?=.+Firefox)/.test(ua);
    if (!isOSXFF) {
      return false;
    }
    version = /Firefox\/\d{2}\./.exec(ua);
    if (version) {
      version = version[0].replace(/\D+/g, '');
    }
    return isOSXFF && +version > 23;
  };

  /**
    @class NanoScroll
    @param element {HTMLElement|Node} the main element
    @param options {Object} nanoScroller's options
    @constructor
   */
  NanoScroll = (function() {
    function NanoScroll(el, options) {
      this.el = el;
      this.options = options;
      BROWSER_SCROLLBAR_WIDTH || (BROWSER_SCROLLBAR_WIDTH = getBrowserScrollbarWidth());
      this.$el = $(this.el);
      this.doc = $(this.options.documentContext || document);
      this.win = $(this.options.windowContext || window);
      this.body = this.doc.find('body');
      this.$content = this.$el.children("." + this.options.contentClass);
      this.$content.attr('tabindex', this.options.tabIndex || 0);
      this.content = this.$content[0];
      this.previousPosition = 0;
      if (this.options.iOSNativeScrolling && (this.el.style.WebkitOverflowScrolling != null)) {
        this.nativeScrolling();
      } else {
        this.generate();
      }
      this.createEvents();
      this.addEvents();
      this.reset();
    }


    /**
      Prevents the rest of the page being scrolled
      when user scrolls the `.nano-content` element.
      @method preventScrolling
      @param event {Event}
      @param direction {String} Scroll direction (up or down)
      @private
     */

    NanoScroll.prototype.preventScrolling = function(e, direction) {
      if (!this.isActive) {
        return;
      }
      if (e.type === DOMSCROLL) {
        if (direction === DOWN && e.originalEvent.detail > 0 || direction === UP && e.originalEvent.detail < 0) {
          e.preventDefault();
        }
      } else if (e.type === MOUSEWHEEL) {
        if (!e.originalEvent || !e.originalEvent.wheelDelta) {
          return;
        }
        if (direction === DOWN && e.originalEvent.wheelDelta < 0 || direction === UP && e.originalEvent.wheelDelta > 0) {
          e.preventDefault();
        }
      }
    };


    /**
      Enable iOS native scrolling
      @method nativeScrolling
      @private
     */

    NanoScroll.prototype.nativeScrolling = function() {
      this.$content.css({
        WebkitOverflowScrolling: 'touch'
      });
      this.iOSNativeScrolling = true;
      this.isActive = true;
    };


    /**
      Updates those nanoScroller properties that
      are related to current scrollbar position.
      @method updateScrollValues
      @private
     */

    NanoScroll.prototype.updateScrollValues = function() {
      var content, direction;
      content = this.content;
      this.maxScrollTop = content.scrollHeight - content.clientHeight;
      this.prevScrollTop = this.contentScrollTop || 0;
      this.contentScrollTop = content.scrollTop;
      direction = this.contentScrollTop > this.previousPosition ? "down" : this.contentScrollTop < this.previousPosition ? "up" : "same";
      this.previousPosition = this.contentScrollTop;
      if (direction !== "same") {
        this.$el.trigger('update', {
          position: this.contentScrollTop,
          maximum: this.maxScrollTop,
          direction: direction
        });
      }
      if (!this.iOSNativeScrolling) {
        this.maxSliderTop = this.paneHeight - this.sliderHeight;
        this.sliderTop = this.maxScrollTop === 0 ? 0 : this.contentScrollTop * this.maxSliderTop / this.maxScrollTop;
      }
    };


    /**
      Updates CSS styles for current scroll position.
      Uses CSS 2d transfroms and `window.requestAnimationFrame` if available.
      @method setOnScrollStyles
      @private
     */

    NanoScroll.prototype.setOnScrollStyles = function() {
      var cssValue;
      if (hasTransform) {
        cssValue = {};
        cssValue[transform] = "translate(0, " + this.sliderTop + "px)";
      } else {
        cssValue = {
          top: this.sliderTop
        };
      }
      if (rAF) {
        if (cAF && this.scrollRAF) {
          cAF(this.scrollRAF);
        }
        this.scrollRAF = rAF((function(_this) {
          return function() {
            _this.scrollRAF = null;
            return _this.slider.css(cssValue);
          };
        })(this));
      } else {
        this.slider.css(cssValue);
      }
    };


    /**
      Creates event related methods
      @method createEvents
      @private
     */

    NanoScroll.prototype.createEvents = function() {
      this.events = {
        down: (function(_this) {
          return function(e) {
            _this.isBeingDragged = true;
            _this.offsetY = e.pageY - _this.slider.offset().top;
            if (!_this.slider.is(e.target)) {
              _this.offsetY = 0;
            }
            _this.pane.addClass('active');
            _this.doc.bind(MOUSEMOVE, _this.events[DRAG]).bind(MOUSEUP, _this.events[UP]);
            _this.body.bind(MOUSEENTER, _this.events[ENTER]);
            return false;
          };
        })(this),
        drag: (function(_this) {
          return function(e) {
            _this.sliderY = e.pageY - _this.$el.offset().top - _this.paneTop - (_this.offsetY || _this.sliderHeight * 0.5);
            _this.scroll();
            if (_this.contentScrollTop >= _this.maxScrollTop && _this.prevScrollTop !== _this.maxScrollTop) {
              _this.$el.trigger('scrollend');
            } else if (_this.contentScrollTop === 0 && _this.prevScrollTop !== 0) {
              _this.$el.trigger('scrolltop');
            }
            return false;
          };
        })(this),
        up: (function(_this) {
          return function(e) {
            _this.isBeingDragged = false;
            _this.pane.removeClass('active');
            _this.doc.unbind(MOUSEMOVE, _this.events[DRAG]).unbind(MOUSEUP, _this.events[UP]);
            _this.body.unbind(MOUSEENTER, _this.events[ENTER]);
            return false;
          };
        })(this),
        resize: (function(_this) {
          return function(e) {
            _this.reset();
          };
        })(this),
        panedown: (function(_this) {
          return function(e) {
            _this.sliderY = (e.offsetY || e.originalEvent.layerY) - (_this.sliderHeight * 0.5);
            _this.scroll();
            _this.events.down(e);
            return false;
          };
        })(this),
        scroll: (function(_this) {
          return function(e) {
            _this.updateScrollValues();
            if (_this.isBeingDragged) {
              return;
            }
            if (!_this.iOSNativeScrolling) {
              _this.sliderY = _this.sliderTop;
              _this.setOnScrollStyles();
            }
            if (e == null) {
              return;
            }
            if (_this.contentScrollTop >= _this.maxScrollTop) {
              if (_this.options.preventPageScrolling) {
                _this.preventScrolling(e, DOWN);
              }
              if (_this.prevScrollTop !== _this.maxScrollTop) {
                _this.$el.trigger('scrollend');
              }
            } else if (_this.contentScrollTop === 0) {
              if (_this.options.preventPageScrolling) {
                _this.preventScrolling(e, UP);
              }
              if (_this.prevScrollTop !== 0) {
                _this.$el.trigger('scrolltop');
              }
            }
          };
        })(this),
        wheel: (function(_this) {
          return function(e) {
            var delta;
            if (e == null) {
              return;
            }
            delta = e.delta || e.wheelDelta || (e.originalEvent && e.originalEvent.wheelDelta) || -e.detail || (e.originalEvent && -e.originalEvent.detail);
            if (delta) {
              _this.sliderY += -delta / 3;
            }
            _this.scroll();
            return false;
          };
        })(this),
        enter: (function(_this) {
          return function(e) {
            var _ref;
            if (!_this.isBeingDragged) {
              return;
            }
            if ((e.buttons || e.which) !== 1) {
              return (_ref = _this.events)[UP].apply(_ref, arguments);
            }
          };
        })(this)
      };
    };


    /**
      Adds event listeners with jQuery.
      @method addEvents
      @private
     */

    NanoScroll.prototype.addEvents = function() {
      var events;
      this.removeEvents();
      events = this.events;
      if (!this.options.disableResize) {
        this.win.bind(RESIZE, events[RESIZE]);
      }
      if (!this.iOSNativeScrolling) {
        this.slider.bind(MOUSEDOWN, events[DOWN]);
        this.pane.bind(MOUSEDOWN, events[PANEDOWN]).bind("" + MOUSEWHEEL + " " + DOMSCROLL, events[WHEEL]);
      }
      this.$content.bind("" + SCROLL + " " + MOUSEWHEEL + " " + DOMSCROLL + " " + TOUCHMOVE, events[SCROLL]);
    };


    /**
      Removes event listeners with jQuery.
      @method removeEvents
      @private
     */

    NanoScroll.prototype.removeEvents = function() {
      var events;
      events = this.events;
      this.win.unbind(RESIZE, events[RESIZE]);
      if (!this.iOSNativeScrolling) {
        this.slider.unbind();
        this.pane.unbind();
      }
      this.$content.unbind("" + SCROLL + " " + MOUSEWHEEL + " " + DOMSCROLL + " " + TOUCHMOVE, events[SCROLL]);
    };


    /**
      Generates nanoScroller's scrollbar and elements for it.
      @method generate
      @chainable
      @private
     */

    NanoScroll.prototype.generate = function() {
      var contentClass, cssRule, currentPadding, options, pane, paneClass, sliderClass;
      options = this.options;
      paneClass = options.paneClass, sliderClass = options.sliderClass, contentClass = options.contentClass;
      if (!(pane = this.$el.children("." + paneClass)).length && !pane.children("." + sliderClass).length) {
        this.$el.append("<div class=\"" + paneClass + "\"><div class=\"" + sliderClass + "\" /></div>");
      }
      this.pane = this.$el.children("." + paneClass);
      this.slider = this.pane.find("." + sliderClass);
      if (BROWSER_SCROLLBAR_WIDTH === 0 && isFFWithBuggyScrollbar()) {
        currentPadding = window.getComputedStyle(this.content, null).getPropertyValue('padding-right').replace(/[^0-9.]+/g, '');
        cssRule = {
          right: -14,
          paddingRight: +currentPadding + 14
        };
      } else if (BROWSER_SCROLLBAR_WIDTH) {
        cssRule = {
          right: -BROWSER_SCROLLBAR_WIDTH
        };
        this.$el.addClass('has-scrollbar');
      }
      if (cssRule != null) {
        this.$content.css(cssRule);
      }
      return this;
    };


    /**
      @method restore
      @private
     */

    NanoScroll.prototype.restore = function() {
      this.stopped = false;
      if (!this.iOSNativeScrolling) {
        this.pane.show();
      }
      this.addEvents();
    };


    /**
      Resets nanoScroller's scrollbar.
      @method reset
      @chainable
      @example
          $(".nano").nanoScroller();
     */

    NanoScroll.prototype.reset = function() {
      var content, contentHeight, contentPosition, contentStyle, contentStyleOverflowY, paneBottom, paneHeight, paneOuterHeight, paneTop, parentMaxHeight, right, sliderHeight;
      if (this.iOSNativeScrolling) {
        this.contentHeight = this.content.scrollHeight;
        return;
      }
      if (!this.$el.find("." + this.options.paneClass).length) {
        this.generate().stop();
      }
      if (this.stopped) {
        this.restore();
      }
      content = this.content;
      contentStyle = content.style;
      contentStyleOverflowY = contentStyle.overflowY;
      if (BROWSER_IS_IE7) {
        this.$content.css({
          height: this.$content.height()
        });
      }
      contentHeight = content.scrollHeight + BROWSER_SCROLLBAR_WIDTH;
      parentMaxHeight = parseInt(this.$el.css("max-height"), 10);
      if (parentMaxHeight > 0) {
        this.$el.height("");
        this.$el.height(content.scrollHeight > parentMaxHeight ? parentMaxHeight : content.scrollHeight);
      }
      paneHeight = this.pane.outerHeight(false);
      paneTop = parseInt(this.pane.css('top'), 10);
      paneBottom = parseInt(this.pane.css('bottom'), 10);
      paneOuterHeight = paneHeight + paneTop + paneBottom;
      sliderHeight = Math.round(paneOuterHeight / contentHeight * paneHeight);
      if (sliderHeight < this.options.sliderMinHeight) {
        sliderHeight = this.options.sliderMinHeight;
      } else if ((this.options.sliderMaxHeight != null) && sliderHeight > this.options.sliderMaxHeight) {
        sliderHeight = this.options.sliderMaxHeight;
      }
      if (contentStyleOverflowY === SCROLL && contentStyle.overflowX !== SCROLL) {
        sliderHeight += BROWSER_SCROLLBAR_WIDTH;
      }
      this.maxSliderTop = paneOuterHeight - sliderHeight;
      this.contentHeight = contentHeight;
      this.paneHeight = paneHeight;
      this.paneOuterHeight = paneOuterHeight;
      this.sliderHeight = sliderHeight;
      this.paneTop = paneTop;
      this.slider.height(sliderHeight);
      this.events.scroll();
      this.pane.show();
      this.isActive = true;
      if ((content.scrollHeight === content.clientHeight) || (this.pane.outerHeight(true) >= content.scrollHeight && contentStyleOverflowY !== SCROLL)) {
        this.pane.hide();
        this.isActive = false;
      } else if (this.el.clientHeight === content.scrollHeight && contentStyleOverflowY === SCROLL) {
        this.slider.hide();
      } else {
        this.slider.show();
      }
      this.pane.css({
        opacity: (this.options.alwaysVisible ? 1 : ''),
        visibility: (this.options.alwaysVisible ? 'visible' : '')
      });
      contentPosition = this.$content.css('position');
      if (contentPosition === 'static' || contentPosition === 'relative') {
        right = parseInt(this.$content.css('right'), 10);
        if (right) {
          this.$content.css({
            right: '',
            marginRight: right
          });
        }
      }
      return this;
    };


    /**
      @method scroll
      @private
      @example
          $(".nano").nanoScroller({ scroll: 'top' });
     */

    NanoScroll.prototype.scroll = function() {
      if (!this.isActive) {
        return;
      }
      this.sliderY = Math.max(0, this.sliderY);
      this.sliderY = Math.min(this.maxSliderTop, this.sliderY);
      this.$content.scrollTop(this.maxScrollTop * this.sliderY / this.maxSliderTop);
      if (!this.iOSNativeScrolling) {
        this.updateScrollValues();
        this.setOnScrollStyles();
      }
      return this;
    };


    /**
      Scroll at the bottom with an offset value
      @method scrollBottom
      @param offsetY {Number}
      @chainable
      @example
          $(".nano").nanoScroller({ scrollBottom: value });
     */

    NanoScroll.prototype.scrollBottom = function(offsetY) {
      if (!this.isActive) {
        return;
      }
      this.$content.scrollTop(this.contentHeight - this.$content.height() - offsetY).trigger(MOUSEWHEEL);
      this.stop().restore();
      return this;
    };


    /**
      Scroll at the top with an offset value
      @method scrollTop
      @param offsetY {Number}
      @chainable
      @example
          $(".nano").nanoScroller({ scrollTop: value });
     */

    NanoScroll.prototype.scrollTop = function(offsetY) {
      if (!this.isActive) {
        return;
      }
      this.$content.scrollTop(+offsetY).trigger(MOUSEWHEEL);
      this.stop().restore();
      return this;
    };


    /**
      Scroll to an element
      @method scrollTo
      @param node {Node} A node to scroll to.
      @chainable
      @example
          $(".nano").nanoScroller({ scrollTo: $('#a_node') });
     */

    NanoScroll.prototype.scrollTo = function(node) {
      if (!this.isActive) {
        return;
      }
      this.scrollTop(this.$el.find(node).get(0).offsetTop);
      return this;
    };


    /**
      To stop the operation.
      This option will tell the plugin to disable all event bindings and hide the gadget scrollbar from the UI.
      @method stop
      @chainable
      @example
          $(".nano").nanoScroller({ stop: true });
     */

    NanoScroll.prototype.stop = function() {
      if (cAF && this.scrollRAF) {
        cAF(this.scrollRAF);
        this.scrollRAF = null;
      }
      this.stopped = true;
      this.removeEvents();
      if (!this.iOSNativeScrolling) {
        this.pane.hide();
      }
      return this;
    };


    /**
      Destroys nanoScroller and restores browser's native scrollbar.
      @method destroy
      @chainable
      @example
          $(".nano").nanoScroller({ destroy: true });
     */

    NanoScroll.prototype.destroy = function() {
      if (!this.stopped) {
        this.stop();
      }
      if (!this.iOSNativeScrolling && this.pane.length) {
        this.pane.remove();
      }
      if (BROWSER_IS_IE7) {
        this.$content.height('');
      }
      this.$content.removeAttr('tabindex');
      if (this.$el.hasClass('has-scrollbar')) {
        this.$el.removeClass('has-scrollbar');
        this.$content.css({
          right: ''
        });
      }
      return this;
    };


    /**
      To flash the scrollbar gadget for an amount of time defined in plugin settings (defaults to 1,5s).
      Useful if you want to show the user (e.g. on pageload) that there is more content waiting for him.
      @method flash
      @chainable
      @example
          $(".nano").nanoScroller({ flash: true });
     */

    NanoScroll.prototype.flash = function() {
      if (this.iOSNativeScrolling) {
        return;
      }
      if (!this.isActive) {
        return;
      }
      this.reset();
      this.pane.addClass('flashed');
      setTimeout((function(_this) {
        return function() {
          _this.pane.removeClass('flashed');
        };
      })(this), this.options.flashDelay);
      return this;
    };

    return NanoScroll;

  })();
  $.fn.nanoScroller = function(settings) {
    return this.each(function() {
      var options, scrollbar;
      if (!(scrollbar = this.nanoscroller)) {
        options = $.extend({}, defaults, settings);
        this.nanoscroller = scrollbar = new NanoScroll(this, options);
      }
      if (settings && typeof settings === "object") {
        $.extend(scrollbar.options, settings);
        if (settings.scrollBottom != null) {
          return scrollbar.scrollBottom(settings.scrollBottom);
        }
        if (settings.scrollTop != null) {
          return scrollbar.scrollTop(settings.scrollTop);
        }
        if (settings.scrollTo) {
          return scrollbar.scrollTo(settings.scrollTo);
        }
        if (settings.scroll === 'bottom') {
          return scrollbar.scrollBottom(0);
        }
        if (settings.scroll === 'top') {
          return scrollbar.scrollTop(0);
        }
        if (settings.scroll && settings.scroll instanceof $) {
          return scrollbar.scrollTo(settings.scroll);
        }
        if (settings.stop) {
          return scrollbar.stop();
        }
        if (settings.destroy) {
          return scrollbar.destroy();
        }
        if (settings.flash) {
          return scrollbar.flash();
        }
      }
      return scrollbar.reset();
    });
  };
  $.fn.nanoScroller.Constructor = NanoScroll;
});

//# sourceMappingURL=jquery.nanoscroller.js.map

/**
*
* jquery.sparkline.js
*
* v@VERSION@
* (c) Splunk, Inc
* Contact: Gareth Watts (gareth@splunk.com)
* http://omnipotent.net/jquery.sparkline/
*
* Generates inline sparkline charts from data supplied either to the method
* or inline in HTML
*
* Compatible with Internet Explorer 6.0+ and modern browsers equipped with the canvas tag
* (Firefox 2.0+, Safari, Opera, etc)
*
* License: New BSD License
*
* Copyright (c) 2012, Splunk Inc.
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without modification,
* are permitted provided that the following conditions are met:
*
*     * Redistributions of source code must retain the above copyright notice,
*       this list of conditions and the following disclaimer.
*     * Redistributions in binary form must reproduce the above copyright notice,
*       this list of conditions and the following disclaimer in the documentation
*       and/or other materials provided with the distribution.
*     * Neither the name of Splunk Inc nor the names of its contributors may
*       be used to endorse or promote products derived from this software without
*       specific prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
* EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
* OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
* SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
* SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT
* OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
* HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
* OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
*
* Usage:
*  $(selector).sparkline(values, options)
*
* If values is undefined or set to 'html' then the data values are read from the specified tag:
*   <p>Sparkline: <span class="sparkline">1,4,6,6,8,5,3,5</span></p>
*   $('.sparkline').sparkline();
* There must be no spaces in the enclosed data set
*
* Otherwise values must be an array of numbers or null values
*    <p>Sparkline: <span id="sparkline1">This text replaced if the browser is compatible</span></p>
*    $('#sparkline1').sparkline([1,4,6,6,8,5,3,5])
*    $('#sparkline2').sparkline([1,4,6,null,null,5,3,5])
*
* Values can also be specified in an HTML comment, or as a values attribute:
*    <p>Sparkline: <span class="sparkline"><!--1,4,6,6,8,5,3,5 --></span></p>
*    <p>Sparkline: <span class="sparkline" values="1,4,6,6,8,5,3,5"></span></p>
*    $('.sparkline').sparkline();
*
* For line charts, x values can also be specified:
*   <p>Sparkline: <span class="sparkline">1:1,2.7:4,3.4:6,5:6,6:8,8.7:5,9:3,10:5</span></p>
*    $('#sparkline1').sparkline([ [1,1], [2.7,4], [3.4,6], [5,6], [6,8], [8.7,5], [9,3], [10,5] ])
*
* By default, options should be passed in as the second argument to the sparkline function:
*   $('.sparkline').sparkline([1,2,3,4], {type: 'bar'})
*
* Options can also be set by passing them on the tag itself.  This feature is disabled by default though
* as there's a slight performance overhead:
*   $('.sparkline').sparkline([1,2,3,4], {enableTagOptions: true})
*   <p>Sparkline: <span class="sparkline" sparkType="bar" sparkBarColor="red">loading</span></p>
* Prefix all options supplied as tag attribute with "spark" (configurable by setting tagOptionsPrefix)
*
* Supported options:
*   lineColor - Color of the line used for the chart
*   fillColor - Color used to fill in the chart - Set to '' or false for a transparent chart
*   width - Width of the chart - Defaults to 3 times the number of values in pixels
*   height - Height of the chart - Defaults to the height of the containing element
*   chartRangeMin - Specify the minimum value to use for the Y range of the chart - Defaults to the minimum value supplied
*   chartRangeMax - Specify the maximum value to use for the Y range of the chart - Defaults to the maximum value supplied
*   chartRangeClip - Clip out of range values to the max/min specified by chartRangeMin and chartRangeMax
*   chartRangeMinX - Specify the minimum value to use for the X range of the chart - Defaults to the minimum value supplied
*   chartRangeMaxX - Specify the maximum value to use for the X range of the chart - Defaults to the maximum value supplied
*   composite - If true then don't erase any existing chart attached to the tag, but draw
*           another chart over the top - Note that width and height are ignored if an
*           existing chart is detected.
*   tagValuesAttribute - Name of tag attribute to check for data values - Defaults to 'values'
*   enableTagOptions - Whether to check tags for sparkline options
*   tagOptionsPrefix - Prefix used for options supplied as tag attributes - Defaults to 'spark'
*   disableHiddenCheck - If set to true, then the plugin will assume that charts will never be drawn into a
*           hidden dom element, avoding a browser reflow
*   disableInteraction - If set to true then all mouseover/click interaction behaviour will be disabled,
*       making the plugin perform much like it did in 1.x
*   disableTooltips - If set to true then tooltips will be disabled - Defaults to false (tooltips enabled)
*   disableHighlight - If set to true then highlighting of selected chart elements on mouseover will be disabled
*       defaults to false (highlights enabled)
*   highlightLighten - Factor to lighten/darken highlighted chart values by - Defaults to 1.4 for a 40% increase
*   tooltipContainer - Specify which DOM element the tooltip should be rendered into - defaults to document.body
*   tooltipClassname - Optional CSS classname to apply to tooltips - If not specified then a default style will be applied
*   tooltipOffsetX - How many pixels away from the mouse pointer to render the tooltip on the X axis
*   tooltipOffsetY - How many pixels away from the mouse pointer to render the tooltip on the r axis
*   tooltipFormatter  - Optional callback that allows you to override the HTML displayed in the tooltip
*       callback is given arguments of (sparkline, options, fields)
*   tooltipChartTitle - If specified then the tooltip uses the string specified by this setting as a title
*   tooltipFormat - A format string or SPFormat object  (or an array thereof for multiple entries)
*       to control the format of the tooltip
*   tooltipPrefix - A string to prepend to each field displayed in a tooltip
*   tooltipSuffix - A string to append to each field displayed in a tooltip
*   tooltipSkipNull - If true then null values will not have a tooltip displayed (defaults to true)
*   tooltipValueLookups - An object or range map to map field values to tooltip strings
*       (eg. to map -1 to "Lost", 0 to "Draw", and 1 to "Win")
*   numberFormatter - Optional callback for formatting numbers in tooltips
*   numberDigitGroupSep - Character to use for group separator in numbers "1,234" - Defaults to ","
*   numberDecimalMark - Character to use for the decimal point when formatting numbers - Defaults to "."
*   numberDigitGroupCount - Number of digits between group separator - Defaults to 3
*
* There are 7 types of sparkline, selected by supplying a "type" option of 'line' (default),
* 'bar', 'tristate', 'bullet', 'discrete', 'pie' or 'box'
*    line - Line chart.  Options:
*       spotColor - Set to '' to not end each line in a circular spot
*       minSpotColor - If set, color of spot at minimum value
*       maxSpotColor - If set, color of spot at maximum value
*       spotRadius - Radius in pixels
*       lineWidth - Width of line in pixels
*       normalRangeMin
*       normalRangeMax - If set draws a filled horizontal bar between these two values marking the "normal"
*                      or expected range of values
*       normalRangeColor - Color to use for the above bar
*       drawNormalOnTop - Draw the normal range above the chart fill color if true
*       defaultPixelsPerValue - Defaults to 3 pixels of width for each value in the chart
*       highlightSpotColor - The color to use for drawing a highlight spot on mouseover - Set to null to disable
*       highlightLineColor - The color to use for drawing a highlight line on mouseover - Set to null to disable
*       valueSpots - Specify which points to draw spots on, and in which color.  Accepts a range map
*
*   bar - Bar chart.  Options:
*       barColor - Color of bars for postive values
*       negBarColor - Color of bars for negative values
*       zeroColor - Color of bars with zero values
*       nullColor - Color of bars with null values - Defaults to omitting the bar entirely
*       barWidth - Width of bars in pixels
*       colorMap - Optional mappnig of values to colors to override the *BarColor values above
*                  can be an Array of values to control the color of individual bars or a range map
*                  to specify colors for individual ranges of values
*       barSpacing - Gap between bars in pixels
*       zeroAxis - Centers the y-axis around zero if true
*
*   tristate - Charts values of win (>0), lose (<0) or draw (=0)
*       posBarColor - Color of win values
*       negBarColor - Color of lose values
*       zeroBarColor - Color of draw values
*       barWidth - Width of bars in pixels
*       barSpacing - Gap between bars in pixels
*       colorMap - Optional mappnig of values to colors to override the *BarColor values above
*                  can be an Array of values to control the color of individual bars or a range map
*                  to specify colors for individual ranges of values
*
*   discrete - Options:
*       lineHeight - Height of each line in pixels - Defaults to 30% of the graph height
*       thesholdValue - Values less than this value will be drawn using thresholdColor instead of lineColor
*       thresholdColor
*
*   bullet - Values for bullet graphs msut be in the order: target, performance, range1, range2, range3, ...
*       options:
*       targetColor - The color of the vertical target marker
*       targetWidth - The width of the target marker in pixels
*       performanceColor - The color of the performance measure horizontal bar
*       rangeColors - Colors to use for each qualitative range background color
*
*   pie - Pie chart. Options:
*       sliceColors - An array of colors to use for pie slices
*       offset - Angle in degrees to offset the first slice - Try -90 or +90
*       borderWidth - Width of border to draw around the pie chart, in pixels - Defaults to 0 (no border)
*       borderColor - Color to use for the pie chart border - Defaults to #000
*
*   box - Box plot. Options:
*       raw - Set to true to supply pre-computed plot points as values
*             values should be: low_outlier, low_whisker, q1, median, q3, high_whisker, high_outlier
*             When set to false you can supply any number of values and the box plot will
*             be computed for you.  Default is false.
*       showOutliers - Set to true (default) to display outliers as circles
*       outlierIQR - Interquartile range used to determine outliers.  Default 1.5
*       boxLineColor - Outline color of the box
*       boxFillColor - Fill color for the box
*       whiskerColor - Line color used for whiskers
*       outlierLineColor - Outline color of outlier circles
*       outlierFillColor - Fill color of the outlier circles
*       spotRadius - Radius of outlier circles
*       medianColor - Line color of the median line
*       target - Draw a target cross hair at the supplied value (default undefined)
*
*
*
*   Examples:
*   $('#sparkline1').sparkline(myvalues, { lineColor: '#f00', fillColor: false });
*   $('.barsparks').sparkline('html', { type:'bar', height:'40px', barWidth:5 });
*   $('#tristate').sparkline([1,1,-1,1,0,0,-1], { type:'tristate' }):
*   $('#discrete').sparkline([1,3,4,5,5,3,4,5], { type:'discrete' });
*   $('#bullet').sparkline([10,12,12,9,7], { type:'bullet' });
*   $('#pie').sparkline([1,1,2], { type:'pie' });
*/

/*jslint regexp: true, browser: true, jquery: true, white: true, nomen: false, plusplus: false, maxerr: 500, indent: 4 */

(function(document, Math, undefined) { // performance/minified-size optimization
(function(factory) {
    if(typeof define === 'function' && define.amd) {
        define(['jquery'], factory);
    } else if (jQuery && !jQuery.fn.sparkline) {
        factory(jQuery);
    }
}
(function($) {
    'use strict';

    var UNSET_OPTION = {},
        getDefaults, createClass, SPFormat, clipval, quartile, normalizeValue, normalizeValues,
        remove, isNumber, all, sum, addCSS, ensureArray, formatNumber, RangeMap,
        MouseHandler, Tooltip, barHighlightMixin,
        line, bar, tristate, discrete, bullet, pie, box, defaultStyles, initStyles,
        VShape, VCanvas_base, VCanvas_canvas, VCanvas_vml, pending, shapeCount = 0;


    /**
     * Default configuration settings
     */
    getDefaults = function () {
        return {
            // Settings common to most/all chart types
            common: {
                type: 'line',
                lineColor: '#00f',
                fillColor: '#cdf',
                defaultPixelsPerValue: 3,
                width: 'auto',
                height: 'auto',
                composite: false,
                tagValuesAttribute: 'values',
                tagOptionsPrefix: 'spark',
                enableTagOptions: false,
                enableHighlight: true,
                highlightLighten: 1.4,
                tooltipSkipNull: true,
                tooltipPrefix: '',
                tooltipSuffix: '',
                disableHiddenCheck: false,
                numberFormatter: false,
                numberDigitGroupCount: 3,
                numberDigitGroupSep: ',',
                numberDecimalMark: '.',
                disableTooltips: false,
                disableInteraction: false
            },
            // Defaults for line charts
            line: {
                spotColor: '#f80',
                highlightSpotColor: '#5f5',
                highlightLineColor: '#f22',
                spotRadius: 1.5,
                minSpotColor: '#f80',
                maxSpotColor: '#f80',
                lineWidth: 1,
                normalRangeMin: undefined,
                normalRangeMax: undefined,
                normalRangeColor: '#ccc',
                drawNormalOnTop: false,
                chartRangeMin: undefined,
                chartRangeMax: undefined,
                chartRangeMinX: undefined,
                chartRangeMaxX: undefined,
                tooltipFormat: new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')
            },
            // Defaults for bar charts
            bar: {
                barColor: '#3366cc',
                negBarColor: '#f44',
                stackedBarColor: ['#3366cc', '#dc3912', '#ff9900', '#109618', '#66aa00',
                    '#dd4477', '#0099c6', '#990099'],
                zeroColor: undefined,
                nullColor: undefined,
                zeroAxis: true,
                barWidth: 4,
                barSpacing: 1,
                chartRangeMax: undefined,
                chartRangeMin: undefined,
                chartRangeClip: false,
                colorMap: undefined,
                tooltipFormat: new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')
            },
            // Defaults for tristate charts
            tristate: {
                barWidth: 4,
                barSpacing: 1,
                posBarColor: '#6f6',
                negBarColor: '#f44',
                zeroBarColor: '#999',
                colorMap: {},
                tooltipFormat: new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),
                tooltipValueLookups: { map: { '-1': 'Loss', '0': 'Draw', '1': 'Win' } }
            },
            // Defaults for discrete charts
            discrete: {
                lineHeight: 'auto',
                thresholdColor: undefined,
                thresholdValue: 0,
                chartRangeMax: undefined,
                chartRangeMin: undefined,
                chartRangeClip: false,
                tooltipFormat: new SPFormat('{{prefix}}{{value}}{{suffix}}')
            },
            // Defaults for bullet charts
            bullet: {
                targetColor: '#f33',
                targetWidth: 3, // width of the target bar in pixels
                performanceColor: '#33f',
                rangeColors: ['#d3dafe', '#a8b6ff', '#7f94ff'],
                base: undefined, // set this to a number to change the base start number
                tooltipFormat: new SPFormat('{{fieldkey:fields}} - {{value}}'),
                tooltipValueLookups: { fields: {r: 'Range', p: 'Performance', t: 'Target'} }
            },
            // Defaults for pie charts
            pie: {
                offset: 0,
                sliceColors: ['#3366cc', '#dc3912', '#ff9900', '#109618', '#66aa00',
                    '#dd4477', '#0099c6', '#990099'],
                borderWidth: 0,
                borderColor: '#000',
                tooltipFormat: new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')
            },
            // Defaults for box plots
            box: {
                raw: false,
                boxLineColor: '#000',
                boxFillColor: '#cdf',
                whiskerColor: '#000',
                outlierLineColor: '#333',
                outlierFillColor: '#fff',
                medianColor: '#f00',
                showOutliers: true,
                outlierIQR: 1.5,
                spotRadius: 1.5,
                target: undefined,
                targetColor: '#4a2',
                chartRangeMax: undefined,
                chartRangeMin: undefined,
                tooltipFormat: new SPFormat('{{field:fields}}: {{value}}'),
                tooltipFormatFieldlistKey: 'field',
                tooltipValueLookups: { fields: { lq: 'Lower Quartile', med: 'Median',
                    uq: 'Upper Quartile', lo: 'Left Outlier', ro: 'Right Outlier',
                    lw: 'Left Whisker', rw: 'Right Whisker'} }
            }
        };
    };

    // You can have tooltips use a css class other than jqstooltip by specifying tooltipClassname
    defaultStyles = '.jqstooltip { ' +
            'position: absolute;' +
            'left: 0px;' +
            'top: 0px;' +
            'visibility: hidden;' +
            'background: rgb(0, 0, 0) transparent;' +
            'background-color: rgba(0,0,0,0.6);' +
            'filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);' +
            '-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";' +
            'color: white;' +
            'font: 10px arial, san serif;' +
            'text-align: left;' +
            'white-space: nowrap;' +
            'padding: 5px;' +
            'border: 1px solid white;' +
            'box-sizing: content-box;' +
            'z-index: 10000;' +
            '}' +
            '.jqsfield { ' +
            'color: white;' +
            'font: 10px arial, san serif;' +
            'text-align: left;' +
            '}';


    /**
     * Utilities
     */

    createClass = function (/* [baseclass, [mixin, ...]], definition */) {
        var Class, args;
        Class = function () {
            this.init.apply(this, arguments);
        };
        if (arguments.length > 1) {
            if (arguments[0]) {
                Class.prototype = $.extend(new arguments[0](), arguments[arguments.length - 1]);
                Class._super = arguments[0].prototype;
            } else {
                Class.prototype = arguments[arguments.length - 1];
            }
            if (arguments.length > 2) {
                args = Array.prototype.slice.call(arguments, 1, -1);
                args.unshift(Class.prototype);
                $.extend.apply($, args);
            }
        } else {
            Class.prototype = arguments[0];
        }
        Class.prototype.cls = Class;
        return Class;
    };

    /**
     * Wraps a format string for tooltips
     * {{x}}
     * {{x.2}
     * {{x:months}}
     */
    $.SPFormatClass = SPFormat = createClass({
        fre: /\{\{([\w.]+?)(:(.+?))?\}\}/g,
        precre: /(\w+)\.(\d+)/,

        init: function (format, fclass) {
            this.format = format;
            this.fclass = fclass;
        },

        render: function (fieldset, lookups, options) {
            var self = this,
                fields = fieldset,
                match, token, lookupkey, fieldvalue, prec;
            return this.format.replace(this.fre, function () {
                var lookup;
                token = arguments[1];
                lookupkey = arguments[3];
                match = self.precre.exec(token);
                if (match) {
                    prec = match[2];
                    token = match[1];
                } else {
                    prec = false;
                }
                fieldvalue = fields[token];
                if (fieldvalue === undefined) {
                    return '';
                }
                if (lookupkey && lookups && lookups[lookupkey]) {
                    lookup = lookups[lookupkey];
                    if (lookup.get) { // RangeMap
                        return lookups[lookupkey].get(fieldvalue) || fieldvalue;
                    } else {
                        return lookups[lookupkey][fieldvalue] || fieldvalue;
                    }
                }
                if (isNumber(fieldvalue)) {
                    if (options.get('numberFormatter')) {
                        fieldvalue = options.get('numberFormatter')(fieldvalue);
                    } else {
                        fieldvalue = formatNumber(fieldvalue, prec,
                            options.get('numberDigitGroupCount'),
                            options.get('numberDigitGroupSep'),
                            options.get('numberDecimalMark'));
                    }
                }
                return fieldvalue;
            });
        }
    });

    // convience method to avoid needing the new operator
    $.spformat = function(format, fclass) {
        return new SPFormat(format, fclass);
    };

    clipval = function (val, min, max) {
        if (val < min) {
            return min;
        }
        if (val > max) {
            return max;
        }
        return val;
    };

    quartile = function (values, q) {
        var vl;
        if (q === 2) {
            vl = Math.floor(values.length / 2);
            return values.length % 2 ? values[vl] : (values[vl-1] + values[vl]) / 2;
        } else {
            if (values.length % 2 ) { // odd
                vl = (values.length * q + q) / 4;
                return vl % 1 ? (values[Math.floor(vl)] + values[Math.floor(vl) - 1]) / 2 : values[vl-1];
            } else { //even
                vl = (values.length * q + 2) / 4;
                return vl % 1 ? (values[Math.floor(vl)] + values[Math.floor(vl) - 1]) / 2 :  values[vl-1];

            }
        }
    };

    normalizeValue = function (val) {
        var nf;
        switch (val) {
            case 'undefined':
                val = undefined;
                break;
            case 'null':
                val = null;
                break;
            case 'true':
                val = true;
                break;
            case 'false':
                val = false;
                break;
            default:
                nf = parseFloat(val);
                if (val == nf) {
                    val = nf;
                }
        }
        return val;
    };

    normalizeValues = function (vals) {
        var i, result = [];
        for (i = vals.length; i--;) {
            result[i] = normalizeValue(vals[i]);
        }
        return result;
    };

    remove = function (vals, filter) {
        var i, vl, result = [];
        for (i = 0, vl = vals.length; i < vl; i++) {
            if (vals[i] !== filter) {
                result.push(vals[i]);
            }
        }
        return result;
    };

    isNumber = function (num) {
        return !isNaN(parseFloat(num)) && isFinite(num);
    };

    formatNumber = function (num, prec, groupsize, groupsep, decsep) {
        var p, i;
        num = (prec === false ? parseFloat(num).toString() : num.toFixed(prec)).split('');
        p = (p = $.inArray('.', num)) < 0 ? num.length : p;
        if (p < num.length) {
            num[p] = decsep;
        }
        for (i = p - groupsize; i > 0; i -= groupsize) {
            num.splice(i, 0, groupsep);
        }
        return num.join('');
    };

    // determine if all values of an array match a value
    // returns true if the array is empty
    all = function (val, arr, ignoreNull) {
        var i;
        for (i = arr.length; i--; ) {
            if (ignoreNull && arr[i] === null) continue;
            if (arr[i] !== val) {
                return false;
            }
        }
        return true;
    };

    // sums the numeric values in an array, ignoring other values
    sum = function (vals) {
        var total = 0, i;
        for (i = vals.length; i--;) {
            total += typeof vals[i] === 'number' ? vals[i] : 0;
        }
        return total;
    };

    ensureArray = function (val) {
        return $.isArray(val) ? val : [val];
    };

    // http://paulirish.com/2008/bookmarklet-inject-new-css-rules/
    addCSS = function(css) {
        var tag, iefail;
        if (document.createStyleSheet) {
            try {
                document.createStyleSheet().cssText = css;
                return;
            } catch (e) {
                // IE <= 9 maxes out at 31 stylesheets; inject into page instead.
                iefail = true;
            }
        }
        tag = document.createElement('style');
        tag.type = 'text/css';
        document.getElementsByTagName('head')[0].appendChild(tag);
        if (iefail) {
            document.styleSheets[document.styleSheets.length - 1].cssText = css;
        } else {
            tag[(typeof document.body.style.WebkitAppearance == 'string') /* webkit only */ ? 'innerText' : 'innerHTML'] = css;
        }
    };


    // Provide a cross-browser interface to a few simple drawing primitives
    $.fn.simpledraw = function (width, height, useExisting, interact) {
        var target, mhandler;
        if (useExisting && (target = this.data('_jqs_vcanvas'))) {
            return target;
        }

        if ($.fn.sparkline.canvas === false) {
            // We've already determined that neither Canvas nor VML are available
            return false;

        } else if ($.fn.sparkline.canvas === undefined) {
            // No function defined yet -- need to see if we support Canvas or VML
            var el = document.createElement('canvas');
            if (!!(el.getContext && el.getContext('2d'))) {
                // Canvas is available
                $.fn.sparkline.canvas = function(width, height, target, interact) {
                    return new VCanvas_canvas(width, height, target, interact);
                };
            } else if (document.namespaces && !document.namespaces.v) {
                // VML is available
                document.namespaces.add('v', 'urn:schemas-microsoft-com:vml', '#default#VML');
                $.fn.sparkline.canvas = function(width, height, target, interact) {
                    return new VCanvas_vml(width, height, target);
                };
            } else {
                // Neither Canvas nor VML are available
                $.fn.sparkline.canvas = false;
                return false;
            }
        }

        if (width === undefined) {
            width = $(this).innerWidth();
        }
        if (height === undefined) {
            height = $(this).innerHeight();
        }

        target = $.fn.sparkline.canvas(width, height, this, interact);

        mhandler = $(this).data('_jqs_mhandler');
        if (mhandler) {
            mhandler.registerCanvas(target);
        }
        return target;
    };

    $.fn.cleardraw = function () {
        var target = this.data('_jqs_vcanvas');
        if (target) {
            target.reset();
        }
    };


    $.RangeMapClass = RangeMap = createClass({
        init: function (map) {
            var key, range, rangelist = [];
            for (key in map) {
                if (map.hasOwnProperty(key) && typeof key === 'string' && key.indexOf(':') > -1) {
                    range = key.split(':');
                    range[0] = range[0].length === 0 ? -Infinity : parseFloat(range[0]);
                    range[1] = range[1].length === 0 ? Infinity : parseFloat(range[1]);
                    range[2] = map[key];
                    rangelist.push(range);
                }
            }
            this.map = map;
            this.rangelist = rangelist || false;
        },

        get: function (value) {
            var rangelist = this.rangelist,
                i, range, result;
            if ((result = this.map[value]) !== undefined) {
                return result;
            }
            if (rangelist) {
                for (i = rangelist.length; i--;) {
                    range = rangelist[i];
                    if (range[0] <= value && range[1] >= value) {
                        return range[2];
                    }
                }
            }
            return undefined;
        }
    });

    // Convenience function
    $.range_map = function(map) {
        return new RangeMap(map);
    };


    MouseHandler = createClass({
        init: function (el, options) {
            var $el = $(el);
            this.$el = $el;
            this.options = options;
            this.currentPageX = 0;
            this.currentPageY = 0;
            this.el = el;
            this.splist = [];
            this.tooltip = null;
            this.over = false;
            this.displayTooltips = !options.get('disableTooltips');
            this.highlightEnabled = !options.get('disableHighlight');
        },

        registerSparkline: function (sp) {
            this.splist.push(sp);
            if (this.over) {
                this.updateDisplay();
            }
        },

        registerCanvas: function (canvas) {
            var $canvas = $(canvas.canvas);
            this.canvas = canvas;
            this.$canvas = $canvas;
            $canvas.mouseenter($.proxy(this.mouseenter, this));
            $canvas.mouseleave($.proxy(this.mouseleave, this));
            $canvas.click($.proxy(this.mouseclick, this));
        },

        reset: function (removeTooltip) {
            this.splist = [];
            if (this.tooltip && removeTooltip) {
                this.tooltip.remove();
                this.tooltip = undefined;
            }
        },

        mouseclick: function (e) {
            var clickEvent = $.Event('sparklineClick');
            clickEvent.originalEvent = e;
            clickEvent.sparklines = this.splist;
            this.$el.trigger(clickEvent);
        },

        mouseenter: function (e) {
            $(document.body).unbind('mousemove.jqs');
            $(document.body).bind('mousemove.jqs', $.proxy(this.mousemove, this));
            this.over = true;
            this.currentPageX = e.pageX;
            this.currentPageY = e.pageY;
            this.currentEl = e.target;
            if (!this.tooltip && this.displayTooltips) {
                this.tooltip = new Tooltip(this.options);
                this.tooltip.updatePosition(e.pageX, e.pageY);
            }
            this.updateDisplay();
        },

        mouseleave: function () {
            $(document.body).unbind('mousemove.jqs');
            var splist = this.splist,
                 spcount = splist.length,
                 needsRefresh = false,
                 sp, i;
            this.over = false;
            this.currentEl = null;

            if (this.tooltip) {
                this.tooltip.remove();
                this.tooltip = null;
            }

            for (i = 0; i < spcount; i++) {
                sp = splist[i];
                if (sp.clearRegionHighlight()) {
                    needsRefresh = true;
                }
            }

            if (needsRefresh) {
                this.canvas.render();
            }
        },

        mousemove: function (e) {
            this.currentPageX = e.pageX;
            this.currentPageY = e.pageY;
            this.currentEl = e.target;
            if (this.tooltip) {
                this.tooltip.updatePosition(e.pageX, e.pageY);
            }
            this.updateDisplay();
        },

        updateDisplay: function () {
            var splist = this.splist,
                 spcount = splist.length,
                 needsRefresh = false,
                 offset = this.$canvas.offset(),
                 localX = this.currentPageX - offset.left,
                 localY = this.currentPageY - offset.top,
                 tooltiphtml, sp, i, result, changeEvent;
            if (!this.over) {
                return;
            }
            for (i = 0; i < spcount; i++) {
                sp = splist[i];
                result = sp.setRegionHighlight(this.currentEl, localX, localY);
                if (result) {
                    needsRefresh = true;
                }
            }
            if (needsRefresh) {
                changeEvent = $.Event('sparklineRegionChange');
                changeEvent.sparklines = this.splist;
                this.$el.trigger(changeEvent);
                if (this.tooltip) {
                    tooltiphtml = '';
                    for (i = 0; i < spcount; i++) {
                        sp = splist[i];
                        tooltiphtml += sp.getCurrentRegionTooltip();
                    }
                    this.tooltip.setContent(tooltiphtml);
                }
                if (!this.disableHighlight) {
                    this.canvas.render();
                }
            }
            if (result === null) {
                this.mouseleave();
            }
        }
    });


    Tooltip = createClass({
        sizeStyle: 'position: static !important;' +
            'display: block !important;' +
            'visibility: hidden !important;' +
            'float: left !important;',

        init: function (options) {
            var tooltipClassname = options.get('tooltipClassname', 'jqstooltip'),
                sizetipStyle = this.sizeStyle,
                offset;
            this.container = options.get('tooltipContainer') || document.body;
            this.tooltipOffsetX = options.get('tooltipOffsetX', 10);
            this.tooltipOffsetY = options.get('tooltipOffsetY', 12);
            // remove any previous lingering tooltip
            $('#jqssizetip').remove();
            $('#jqstooltip').remove();
            this.sizetip = $('<div/>', {
                id: 'jqssizetip',
                style: sizetipStyle,
                'class': tooltipClassname
            });
            this.tooltip = $('<div/>', {
                id: 'jqstooltip',
                'class': tooltipClassname
            }).appendTo(this.container);
            // account for the container's location
            offset = this.tooltip.offset();
            this.offsetLeft = offset.left;
            this.offsetTop = offset.top;
            this.hidden = true;
            $(window).unbind('resize.jqs scroll.jqs');
            $(window).bind('resize.jqs scroll.jqs', $.proxy(this.updateWindowDims, this));
            this.updateWindowDims();
        },

        updateWindowDims: function () {
            this.scrollTop = $(window).scrollTop();
            this.scrollLeft = $(window).scrollLeft();
            this.scrollRight = this.scrollLeft + $(window).width();
            this.updatePosition();
        },

        getSize: function (content) {
            this.sizetip.html(content).appendTo(this.container);
            this.width = this.sizetip.width() + 1;
            this.height = this.sizetip.height();
            this.sizetip.remove();
        },

        setContent: function (content) {
            if (!content) {
                this.tooltip.css('visibility', 'hidden');
                this.hidden = true;
                return;
            }
            this.getSize(content);
            this.tooltip.html(content)
                .css({
                    'width': this.width,
                    'height': this.height,
                    'visibility': 'visible'
                });
            if (this.hidden) {
                this.hidden = false;
                this.updatePosition();
            }
        },

        updatePosition: function (x, y) {
            if (x === undefined) {
                if (this.mousex === undefined) {
                    return;
                }
                x = this.mousex - this.offsetLeft;
                y = this.mousey - this.offsetTop;

            } else {
                this.mousex = x = x - this.offsetLeft;
                this.mousey = y = y - this.offsetTop;
            }
            if (!this.height || !this.width || this.hidden) {
                return;
            }

            y -= this.height + this.tooltipOffsetY;
            x += this.tooltipOffsetX;

            if (y < this.scrollTop) {
                y = this.scrollTop;
            }
            if (x < this.scrollLeft) {
                x = this.scrollLeft;
            } else if (x + this.width > this.scrollRight) {
                x = this.scrollRight - this.width;
            }

            this.tooltip.css({
                'left': x,
                'top': y
            });
        },

        remove: function () {
            this.tooltip.remove();
            this.sizetip.remove();
            this.sizetip = this.tooltip = undefined;
            $(window).unbind('resize.jqs scroll.jqs');
        }
    });


    initStyles = function() {
        addCSS(defaultStyles);
    };

    $(initStyles);

    pending = [];
    $.fn.sparkline = function (userValues, userOptions) {
        return this.each(function () {
            var options = new $.fn.sparkline.options(this, userOptions),
                 $this = $(this),
                 render, i;
            render = function () {
                var values, width, height, tmp, mhandler, sp, vals;
                if (userValues === 'html' || userValues === undefined) {
                    vals = this.getAttribute(options.get('tagValuesAttribute'));
                    if (vals === undefined || vals === null) {
                        vals = $this.html();
                    }
                    values = vals.replace(/(^\s*<!--)|(-->\s*$)|\s+/g, '').split(',');
                } else {
                    values = userValues;
                }

                width = options.get('width') === 'auto' ? values.length * options.get('defaultPixelsPerValue') : options.get('width');
                if (options.get('height') === 'auto') {
                    if (!options.get('composite') || !$.data(this, '_jqs_vcanvas')) {
                        // must be a better way to get the line height
                        tmp = document.createElement('span');
                        tmp.innerHTML = 'a';
                        $this.html(tmp);
                        height = $(tmp).innerHeight() || $(tmp).height();
                        $(tmp).remove();
                        tmp = null;
                    }
                } else {
                    height = options.get('height');
                }

                if (!options.get('disableInteraction')) {
                    mhandler = $.data(this, '_jqs_mhandler');
                    if (!mhandler) {
                        mhandler = new MouseHandler(this, options);
                        $.data(this, '_jqs_mhandler', mhandler);
                    } else if (!options.get('composite')) {
                        mhandler.reset();
                    }
                } else {
                    mhandler = false;
                }

                if (options.get('composite') && !$.data(this, '_jqs_vcanvas')) {
                    if (!$.data(this, '_jqs_errnotify')) {
                        alert('Attempted to attach a composite sparkline to an element with no existing sparkline');
                        $.data(this, '_jqs_errnotify', true);
                    }
                    return;
                }

                sp = new $.fn.sparkline[options.get('type')](this, values, options, width, height);

                sp.render();

                if (mhandler) {
                    mhandler.registerSparkline(sp);
                }
            };
            if (($(this).html() && !options.get('disableHiddenCheck') && $(this).is(':hidden')) || !$(this).parents('body').length) {
                if (!options.get('composite') && $.data(this, '_jqs_pending')) {
                    // remove any existing references to the element
                    for (i = pending.length; i; i--) {
                        if (pending[i - 1][0] == this) {
                            pending.splice(i - 1, 1);
                        }
                    }
                }
                pending.push([this, render]);
                $.data(this, '_jqs_pending', true);
            } else {
                render.call(this);
            }
        });
    };

    $.fn.sparkline.defaults = getDefaults();


    $.sparkline_display_visible = function () {
        var el, i, pl;
        var done = [];
        for (i = 0, pl = pending.length; i < pl; i++) {
            el = pending[i][0];
            if ($(el).is(':visible') && !$(el).parents().is(':hidden')) {
                pending[i][1].call(el);
                $.data(pending[i][0], '_jqs_pending', false);
                done.push(i);
            } else if (!$(el).closest('html').length && !$.data(el, '_jqs_pending')) {
                // element has been inserted and removed from the DOM
                // If it was not yet inserted into the dom then the .data request
                // will return true.
                // removing from the dom causes the data to be removed.
                $.data(pending[i][0], '_jqs_pending', false);
                done.push(i);
            }
        }
        for (i = done.length; i; i--) {
            pending.splice(done[i - 1], 1);
        }
    };


    /**
     * User option handler
     */
    $.fn.sparkline.options = createClass({
        init: function (tag, userOptions) {
            var extendedOptions, defaults, base, tagOptionType;
            this.userOptions = userOptions = userOptions || {};
            this.tag = tag;
            this.tagValCache = {};
            defaults = $.fn.sparkline.defaults;
            base = defaults.common;
            this.tagOptionsPrefix = userOptions.enableTagOptions && (userOptions.tagOptionsPrefix || base.tagOptionsPrefix);

            tagOptionType = this.getTagSetting('type');
            if (tagOptionType === UNSET_OPTION) {
                extendedOptions = defaults[userOptions.type || base.type];
            } else {
                extendedOptions = defaults[tagOptionType];
            }
            this.mergedOptions = $.extend({}, base, extendedOptions, userOptions);
        },


        getTagSetting: function (key) {
            var prefix = this.tagOptionsPrefix,
                val, i, pairs, keyval;
            if (prefix === false || prefix === undefined) {
                return UNSET_OPTION;
            }
            if (this.tagValCache.hasOwnProperty(key)) {
                val = this.tagValCache.key;
            } else {
                val = this.tag.getAttribute(prefix + key);
                if (val === undefined || val === null) {
                    val = UNSET_OPTION;
                } else if (val.substr(0, 1) === '[') {
                    val = val.substr(1, val.length - 2).split(',');
                    for (i = val.length; i--;) {
                        val[i] = normalizeValue(val[i].replace(/(^\s*)|(\s*$)/g, ''));
                    }
                } else if (val.substr(0, 1) === '{') {
                    pairs = val.substr(1, val.length - 2).split(',');
                    val = {};
                    for (i = pairs.length; i--;) {
                        keyval = pairs[i].split(':', 2);
                        val[keyval[0].replace(/(^\s*)|(\s*$)/g, '')] = normalizeValue(keyval[1].replace(/(^\s*)|(\s*$)/g, ''));
                    }
                } else {
                    val = normalizeValue(val);
                }
                this.tagValCache.key = val;
            }
            return val;
        },

        get: function (key, defaultval) {
            var tagOption = this.getTagSetting(key),
                result;
            if (tagOption !== UNSET_OPTION) {
                return tagOption;
            }
            return (result = this.mergedOptions[key]) === undefined ? defaultval : result;
        }
    });


    $.fn.sparkline._base = createClass({
        disabled: false,

        init: function (el, values, options, width, height) {
            this.el = el;
            this.$el = $(el);
            this.values = values;
            this.options = options;
            this.width = width;
            this.height = height;
            this.currentRegion = undefined;
        },

        /**
         * Setup the canvas
         */
        initTarget: function () {
            var interactive = !this.options.get('disableInteraction');
            if (!(this.target = this.$el.simpledraw(this.width, this.height, this.options.get('composite'), interactive))) {
                this.disabled = true;
            } else {
                this.canvasWidth = this.target.pixelWidth;
                this.canvasHeight = this.target.pixelHeight;
            }
        },

        /**
         * Actually render the chart to the canvas
         */
        render: function () {
            if (this.disabled) {
                this.el.innerHTML = '';
                return false;
            }
            return true;
        },

        /**
         * Return a region id for a given x/y co-ordinate
         */
        getRegion: function (x, y) {
        },

        /**
         * Highlight an item based on the moused-over x,y co-ordinate
         */
        setRegionHighlight: function (el, x, y) {
            var currentRegion = this.currentRegion,
                highlightEnabled = !this.options.get('disableHighlight'),
                newRegion;
            if (x > this.canvasWidth || y > this.canvasHeight || x < 0 || y < 0) {
                return null;
            }
            newRegion = this.getRegion(el, x, y);
            if (currentRegion !== newRegion) {
                if (currentRegion !== undefined && highlightEnabled) {
                    this.removeHighlight();
                }
                this.currentRegion = newRegion;
                if (newRegion !== undefined && highlightEnabled) {
                    this.renderHighlight();
                }
                return true;
            }
            return false;
        },

        /**
         * Reset any currently highlighted item
         */
        clearRegionHighlight: function () {
            if (this.currentRegion !== undefined) {
                this.removeHighlight();
                this.currentRegion = undefined;
                return true;
            }
            return false;
        },

        renderHighlight: function () {
            this.changeHighlight(true);
        },

        removeHighlight: function () {
            this.changeHighlight(false);
        },

        changeHighlight: function (highlight)  {},

        /**
         * Fetch the HTML to display as a tooltip
         */
        getCurrentRegionTooltip: function () {
            var options = this.options,
                header = '',
                entries = [],
                fields, formats, formatlen, fclass, text, i,
                showFields, showFieldsKey, newFields, fv,
                formatter, format, fieldlen, j;
            if (this.currentRegion === undefined) {
                return '';
            }
            fields = this.getCurrentRegionFields();
            formatter = options.get('tooltipFormatter');
            if (formatter) {
                return formatter(this, options, fields);
            }
            if (options.get('tooltipChartTitle')) {
                header += '<div class="jqs jqstitle">' + options.get('tooltipChartTitle') + '</div>\n';
            }
            formats = this.options.get('tooltipFormat');
            if (!formats) {
                return '';
            }
            if (!$.isArray(formats)) {
                formats = [formats];
            }
            if (!$.isArray(fields)) {
                fields = [fields];
            }
            showFields = this.options.get('tooltipFormatFieldlist');
            showFieldsKey = this.options.get('tooltipFormatFieldlistKey');
            if (showFields && showFieldsKey) {
                // user-selected ordering of fields
                newFields = [];
                for (i = fields.length; i--;) {
                    fv = fields[i][showFieldsKey];
                    if ((j = $.inArray(fv, showFields)) != -1) {
                        newFields[j] = fields[i];
                    }
                }
                fields = newFields;
            }
            formatlen = formats.length;
            fieldlen = fields.length;
            for (i = 0; i < formatlen; i++) {
                format = formats[i];
                if (typeof format === 'string') {
                    format = new SPFormat(format);
                }
                fclass = format.fclass || 'jqsfield';
                for (j = 0; j < fieldlen; j++) {
                    if (!fields[j].isNull || !options.get('tooltipSkipNull')) {
                        $.extend(fields[j], {
                            prefix: options.get('tooltipPrefix'),
                            suffix: options.get('tooltipSuffix')
                        });
                        text = format.render(fields[j], options.get('tooltipValueLookups'), options);
                        entries.push('<div class="' + fclass + '">' + text + '</div>');
                    }
                }
            }
            if (entries.length) {
                return header + entries.join('\n');
            }
            return '';
        },

        getCurrentRegionFields: function () {},

        calcHighlightColor: function (color, options) {
            var highlightColor = options.get('highlightColor'),
                lighten = options.get('highlightLighten'),
                parse, mult, rgbnew, i;
            if (highlightColor) {
                return highlightColor;
            }
            if (lighten) {
                // extract RGB values
                parse = /^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(color) || /^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(color);
                if (parse) {
                    rgbnew = [];
                    mult = color.length === 4 ? 16 : 1;
                    for (i = 0; i < 3; i++) {
                        rgbnew[i] = clipval(Math.round(parseInt(parse[i + 1], 16) * mult * lighten), 0, 255);
                    }
                    return 'rgb(' + rgbnew.join(',') + ')';
                }

            }
            return color;
        }

    });

    barHighlightMixin = {
        changeHighlight: function (highlight) {
            var currentRegion = this.currentRegion,
                target = this.target,
                shapeids = this.regionShapes[currentRegion],
                newShapes;
            // will be null if the region value was null
            if (shapeids) {
                newShapes = this.renderRegion(currentRegion, highlight);
                if ($.isArray(newShapes) || $.isArray(shapeids)) {
                    target.replaceWithShapes(shapeids, newShapes);
                    this.regionShapes[currentRegion] = $.map(newShapes, function (newShape) {
                        return newShape.id;
                    });
                } else {
                    target.replaceWithShape(shapeids, newShapes);
                    this.regionShapes[currentRegion] = newShapes.id;
                }
            }
        },

        render: function () {
            var values = this.values,
                target = this.target,
                regionShapes = this.regionShapes,
                shapes, ids, i, j;

            if (!this.cls._super.render.call(this)) {
                return;
            }
            for (i = values.length; i--;) {
                shapes = this.renderRegion(i);
                if (shapes) {
                    if ($.isArray(shapes)) {
                        ids = [];
                        for (j = shapes.length; j--;) {
                            shapes[j].append();
                            ids.push(shapes[j].id);
                        }
                        regionShapes[i] = ids;
                    } else {
                        shapes.append();
                        regionShapes[i] = shapes.id; // store just the shapeid
                    }
                } else {
                    // null value
                    regionShapes[i] = null;
                }
            }
            target.render();
        }
    };


    /**
     * Line charts
     */
    $.fn.sparkline.line = line = createClass($.fn.sparkline._base, {
        type: 'line',

        init: function (el, values, options, width, height) {
            line._super.init.call(this, el, values, options, width, height);
            this.vertices = [];
            this.regionMap = [];
            this.xvalues = [];
            this.yvalues = [];
            this.yminmax = [];
            this.hightlightSpotId = null;
            this.lastShapeId = null;
            this.initTarget();
        },

        getRegion: function (el, x, y) {
            var i,
                regionMap = this.regionMap; // maps regions to value positions
            for (i = regionMap.length; i--;) {
                if (regionMap[i] !== null && x >= regionMap[i][0] && x <= regionMap[i][1]) {
                    return regionMap[i][2];
                }
            }
            return undefined;
        },

        getCurrentRegionFields: function () {
            var currentRegion = this.currentRegion;
            return {
                isNull: this.yvalues[currentRegion] === null,
                x: this.xvalues[currentRegion],
                y: this.yvalues[currentRegion],
                color: this.options.get('lineColor'),
                fillColor: this.options.get('fillColor'),
                offset: currentRegion
            };
        },

        renderHighlight: function () {
            var currentRegion = this.currentRegion,
                target = this.target,
                vertex = this.vertices[currentRegion],
                options = this.options,
                spotRadius = options.get('spotRadius'),
                highlightSpotColor = options.get('highlightSpotColor'),
                highlightLineColor = options.get('highlightLineColor'),
                highlightSpot, highlightLine;

            if (!vertex) {
                return;
            }
            if (spotRadius && highlightSpotColor) {
                highlightSpot = target.drawCircle(vertex[0], vertex[1],
                    spotRadius, undefined, highlightSpotColor);
                this.highlightSpotId = highlightSpot.id;
                target.insertAfterShape(this.lastShapeId, highlightSpot);
            }
            if (highlightLineColor) {
                highlightLine = target.drawLine(vertex[0], this.canvasTop, vertex[0],
                    this.canvasTop + this.canvasHeight, highlightLineColor);
                this.highlightLineId = highlightLine.id;
                target.insertAfterShape(this.lastShapeId, highlightLine);
            }
        },

        removeHighlight: function () {
            var target = this.target;
            if (this.highlightSpotId) {
                target.removeShapeId(this.highlightSpotId);
                this.highlightSpotId = null;
            }
            if (this.highlightLineId) {
                target.removeShapeId(this.highlightLineId);
                this.highlightLineId = null;
            }
        },

        scanValues: function () {
            var values = this.values,
                valcount = values.length,
                xvalues = this.xvalues,
                yvalues = this.yvalues,
                yminmax = this.yminmax,
                i, val, isStr, isArray, sp;
            for (i = 0; i < valcount; i++) {
                val = values[i];
                isStr = typeof(values[i]) === 'string';
                isArray = typeof(values[i]) === 'object' && values[i] instanceof Array;
                sp = isStr && values[i].split(':');
                if (isStr && sp.length === 2) { // x:y
                    xvalues.push(Number(sp[0]));
                    yvalues.push(Number(sp[1]));
                    yminmax.push(Number(sp[1]));
                } else if (isArray) {
                    xvalues.push(val[0]);
                    yvalues.push(val[1]);
                    yminmax.push(val[1]);
                } else {
                    xvalues.push(i);
                    if (values[i] === null || values[i] === 'null') {
                        yvalues.push(null);
                    } else {
                        yvalues.push(Number(val));
                        yminmax.push(Number(val));
                    }
                }
            }
            if (this.options.get('xvalues')) {
                xvalues = this.options.get('xvalues');
            }

            this.maxy = this.maxyorg = Math.max.apply(Math, yminmax);
            this.miny = this.minyorg = Math.min.apply(Math, yminmax);

            this.maxx = Math.max.apply(Math, xvalues);
            this.minx = Math.min.apply(Math, xvalues);

            this.xvalues = xvalues;
            this.yvalues = yvalues;
            this.yminmax = yminmax;

        },

        processRangeOptions: function () {
            var options = this.options,
                normalRangeMin = options.get('normalRangeMin'),
                normalRangeMax = options.get('normalRangeMax');

            if (normalRangeMin !== undefined) {
                if (normalRangeMin < this.miny) {
                    this.miny = normalRangeMin;
                }
                if (normalRangeMax > this.maxy) {
                    this.maxy = normalRangeMax;
                }
            }
            if (options.get('chartRangeMin') !== undefined && (options.get('chartRangeClip') || options.get('chartRangeMin') < this.miny)) {
                this.miny = options.get('chartRangeMin');
            }
            if (options.get('chartRangeMax') !== undefined && (options.get('chartRangeClip') || options.get('chartRangeMax') > this.maxy)) {
                this.maxy = options.get('chartRangeMax');
            }
            if (options.get('chartRangeMinX') !== undefined && (options.get('chartRangeClipX') || options.get('chartRangeMinX') < this.minx)) {
                this.minx = options.get('chartRangeMinX');
            }
            if (options.get('chartRangeMaxX') !== undefined && (options.get('chartRangeClipX') || options.get('chartRangeMaxX') > this.maxx)) {
                this.maxx = options.get('chartRangeMaxX');
            }

        },

        drawNormalRange: function (canvasLeft, canvasTop, canvasHeight, canvasWidth, rangey) {
            var normalRangeMin = this.options.get('normalRangeMin'),
                normalRangeMax = this.options.get('normalRangeMax'),
                ytop = canvasTop + Math.round(canvasHeight - (canvasHeight * ((normalRangeMax - this.miny) / rangey))),
                height = Math.round((canvasHeight * (normalRangeMax - normalRangeMin)) / rangey);
            this.target.drawRect(canvasLeft, ytop, canvasWidth, height, undefined, this.options.get('normalRangeColor')).append();
        },

        render: function () {
            var options = this.options,
                target = this.target,
                canvasWidth = this.canvasWidth,
                canvasHeight = this.canvasHeight,
                vertices = this.vertices,
                spotRadius = options.get('spotRadius'),
                regionMap = this.regionMap,
                rangex, rangey, yvallast,
                canvasTop, canvasLeft,
                vertex, path, paths, x, y, xnext, xpos, xposnext,
                last, next, yvalcount, lineShapes, fillShapes, plen,
                valueSpots, hlSpotsEnabled, color, xvalues, yvalues, i;

            if (!line._super.render.call(this)) {
                return;
            }

            this.scanValues();
            this.processRangeOptions();

            xvalues = this.xvalues;
            yvalues = this.yvalues;

            if (!this.yminmax.length || this.yvalues.length < 2) {
                // empty or all null valuess
                return;
            }

            canvasTop = canvasLeft = 0;

            rangex = this.maxx - this.minx === 0 ? 1 : this.maxx - this.minx;
            rangey = this.maxy - this.miny === 0 ? 1 : this.maxy - this.miny;
            yvallast = this.yvalues.length - 1;

            if (spotRadius && (canvasWidth < (spotRadius * 4) || canvasHeight < (spotRadius * 4))) {
                spotRadius = 0;
            }
            if (spotRadius) {
                // adjust the canvas size as required so that spots will fit
                hlSpotsEnabled = options.get('highlightSpotColor') &&  !options.get('disableInteraction');
                if (hlSpotsEnabled || options.get('minSpotColor') || (options.get('spotColor') && yvalues[yvallast] === this.miny)) {
                    canvasHeight -= Math.ceil(spotRadius);
                }
                if (hlSpotsEnabled || options.get('maxSpotColor') || (options.get('spotColor') && yvalues[yvallast] === this.maxy)) {
                    canvasHeight -= Math.ceil(spotRadius);
                    canvasTop += Math.ceil(spotRadius);
                }
                if (hlSpotsEnabled ||
                     ((options.get('minSpotColor') || options.get('maxSpotColor')) && (yvalues[0] === this.miny || yvalues[0] === this.maxy))) {
                    canvasLeft += Math.ceil(spotRadius);
                    canvasWidth -= Math.ceil(spotRadius);
                }
                if (hlSpotsEnabled || options.get('spotColor') ||
                    (options.get('minSpotColor') || options.get('maxSpotColor') &&
                        (yvalues[yvallast] === this.miny || yvalues[yvallast] === this.maxy))) {
                    canvasWidth -= Math.ceil(spotRadius);
                }
            }


            canvasHeight--;

            if (options.get('normalRangeMin') !== undefined && !options.get('drawNormalOnTop')) {
                this.drawNormalRange(canvasLeft, canvasTop, canvasHeight, canvasWidth, rangey);
            }

            path = [];
            paths = [path];
            last = next = null;
            yvalcount = yvalues.length;
            for (i = 0; i < yvalcount; i++) {
                x = xvalues[i];
                xnext = xvalues[i + 1];
                y = yvalues[i];
                xpos = canvasLeft + Math.round((x - this.minx) * (canvasWidth / rangex));
                xposnext = i < yvalcount - 1 ? canvasLeft + Math.round((xnext - this.minx) * (canvasWidth / rangex)) : canvasWidth;
                next = xpos + ((xposnext - xpos) / 2);
                regionMap[i] = [last || 0, next, i];
                last = next;
                if (y === null) {
                    if (i) {
                        if (yvalues[i - 1] !== null) {
                            path = [];
                            paths.push(path);
                        }
                        vertices.push(null);
                    }
                } else {
                    if (y < this.miny) {
                        y = this.miny;
                    }
                    if (y > this.maxy) {
                        y = this.maxy;
                    }
                    if (!path.length) {
                        // previous value was null
                        path.push([xpos, canvasTop + canvasHeight]);
                    }
                    vertex = [xpos, canvasTop + Math.round(canvasHeight - (canvasHeight * ((y - this.miny) / rangey)))];
                    path.push(vertex);
                    vertices.push(vertex);
                }
            }

            lineShapes = [];
            fillShapes = [];
            plen = paths.length;
            for (i = 0; i < plen; i++) {
                path = paths[i];
                if (path.length) {
                    if (options.get('fillColor')) {
                        path.push([path[path.length - 1][0], (canvasTop + canvasHeight)]);
                        fillShapes.push(path.slice(0));
                        path.pop();
                    }
                    // if there's only a single point in this path, then we want to display it
                    // as a vertical line which means we keep path[0]  as is
                    if (path.length > 2) {
                        // else we want the first value
                        path[0] = [path[0][0], path[1][1]];
                    }
                    lineShapes.push(path);
                }
            }

            // draw the fill first, then optionally the normal range, then the line on top of that
            plen = fillShapes.length;
            for (i = 0; i < plen; i++) {
                target.drawShape(fillShapes[i],
                    options.get('fillColor'), options.get('fillColor')).append();
            }

            if (options.get('normalRangeMin') !== undefined && options.get('drawNormalOnTop')) {
                this.drawNormalRange(canvasLeft, canvasTop, canvasHeight, canvasWidth, rangey);
            }

            plen = lineShapes.length;
            for (i = 0; i < plen; i++) {
                target.drawShape(lineShapes[i], options.get('lineColor'), undefined,
                    options.get('lineWidth')).append();
            }

            if (spotRadius && options.get('valueSpots')) {
                valueSpots = options.get('valueSpots');
                if (valueSpots.get === undefined) {
                    valueSpots = new RangeMap(valueSpots);
                }
                for (i = 0; i < yvalcount; i++) {
                    color = valueSpots.get(yvalues[i]);
                    if (color) {
                        target.drawCircle(canvasLeft + Math.round((xvalues[i] - this.minx) * (canvasWidth / rangex)),
                            canvasTop + Math.round(canvasHeight - (canvasHeight * ((yvalues[i] - this.miny) / rangey))),
                            spotRadius, undefined,
                            color).append();
                    }
                }

            }
            if (spotRadius && options.get('spotColor') && yvalues[yvallast] !== null) {
                target.drawCircle(canvasLeft + Math.round((xvalues[xvalues.length - 1] - this.minx) * (canvasWidth / rangex)),
                    canvasTop + Math.round(canvasHeight - (canvasHeight * ((yvalues[yvallast] - this.miny) / rangey))),
                    spotRadius, undefined,
                    options.get('spotColor')).append();
            }
            if (this.maxy !== this.minyorg) {
                if (spotRadius && options.get('minSpotColor')) {
                    x = xvalues[$.inArray(this.minyorg, yvalues)];
                    target.drawCircle(canvasLeft + Math.round((x - this.minx) * (canvasWidth / rangex)),
                        canvasTop + Math.round(canvasHeight - (canvasHeight * ((this.minyorg - this.miny) / rangey))),
                        spotRadius, undefined,
                        options.get('minSpotColor')).append();
                }
                if (spotRadius && options.get('maxSpotColor')) {
                    x = xvalues[$.inArray(this.maxyorg, yvalues)];
                    target.drawCircle(canvasLeft + Math.round((x - this.minx) * (canvasWidth / rangex)),
                        canvasTop + Math.round(canvasHeight - (canvasHeight * ((this.maxyorg - this.miny) / rangey))),
                        spotRadius, undefined,
                        options.get('maxSpotColor')).append();
                }
            }

            this.lastShapeId = target.getLastShapeId();
            this.canvasTop = canvasTop;
            target.render();
        }
    });


    /**
     * Bar charts
     */
    $.fn.sparkline.bar = bar = createClass($.fn.sparkline._base, barHighlightMixin, {
        type: 'bar',

        init: function (el, values, options, width, height) {
            var barWidth = parseInt(options.get('barWidth'), 10),
                barSpacing = parseInt(options.get('barSpacing'), 10),
                chartRangeMin = options.get('chartRangeMin'),
                chartRangeMax = options.get('chartRangeMax'),
                chartRangeClip = options.get('chartRangeClip'),
                stackMin = Infinity,
                stackMax = -Infinity,
                isStackString, groupMin, groupMax, stackRanges,
                numValues, i, vlen, range, zeroAxis, xaxisOffset, min, max, clipMin, clipMax,
                stacked, vlist, j, slen, svals, val, yoffset, yMaxCalc, canvasHeightEf;
            bar._super.init.call(this, el, values, options, width, height);

            // scan values to determine whether to stack bars
            for (i = 0, vlen = values.length; i < vlen; i++) {
                val = values[i];
                isStackString = typeof(val) === 'string' && val.indexOf(':') > -1;
                if (isStackString || $.isArray(val)) {
                    stacked = true;
                    if (isStackString) {
                        val = values[i] = normalizeValues(val.split(':'));
                    }
                    val = remove(val, null); // min/max will treat null as zero
                    groupMin = Math.min.apply(Math, val);
                    groupMax = Math.max.apply(Math, val);
                    if (groupMin < stackMin) {
                        stackMin = groupMin;
                    }
                    if (groupMax > stackMax) {
                        stackMax = groupMax;
                    }
                }
            }

            this.stacked = stacked;
            this.regionShapes = {};
            this.barWidth = barWidth;
            this.barSpacing = barSpacing;
            this.totalBarWidth = barWidth + barSpacing;
            this.width = width = (values.length * barWidth) + ((values.length - 1) * barSpacing);

            this.initTarget();

            if (chartRangeClip) {
                clipMin = chartRangeMin === undefined ? -Infinity : chartRangeMin;
                clipMax = chartRangeMax === undefined ? Infinity : chartRangeMax;
            }

            numValues = [];
            stackRanges = stacked ? [] : numValues;
            var stackTotals = [];
            var stackRangesNeg = [];
            for (i = 0, vlen = values.length; i < vlen; i++) {
                if (stacked) {
                    vlist = values[i];
                    values[i] = svals = [];
                    stackTotals[i] = 0;
                    stackRanges[i] = stackRangesNeg[i] = 0;
                    for (j = 0, slen = vlist.length; j < slen; j++) {
                        val = svals[j] = chartRangeClip ? clipval(vlist[j], clipMin, clipMax) : vlist[j];
                        if (val !== null) {
                            if (val > 0) {
                                stackTotals[i] += val;
                            }
                            if (stackMin < 0 && stackMax > 0) {
                                if (val < 0) {
                                    stackRangesNeg[i] += Math.abs(val);
                                } else {
                                    stackRanges[i] += val;
                                }
                            } else {
                                stackRanges[i] += Math.abs(val - (val < 0 ? stackMax : stackMin));
                            }
                            numValues.push(val);
                        }
                    }
                } else {
                    val = chartRangeClip ? clipval(values[i], clipMin, clipMax) : values[i];
                    val = values[i] = normalizeValue(val);
                    if (val !== null) {
                        numValues.push(val);
                    }
                }
            }
            this.max = max = Math.max.apply(Math, numValues);
            this.min = min = Math.min.apply(Math, numValues);
            this.stackMax = stackMax = stacked ? Math.max.apply(Math, stackTotals) : max;
            this.stackMin = stackMin = stacked ? Math.min.apply(Math, numValues) : min;

            if (options.get('chartRangeMin') !== undefined && (options.get('chartRangeClip') || options.get('chartRangeMin') < min)) {
                min = options.get('chartRangeMin');
            }
            if (options.get('chartRangeMax') !== undefined && (options.get('chartRangeClip') || options.get('chartRangeMax') > max)) {
                max = options.get('chartRangeMax');
            }

            this.zeroAxis = zeroAxis = options.get('zeroAxis', true);
            if (min <= 0 && max >= 0 && zeroAxis) {
                xaxisOffset = 0;
            } else if (zeroAxis == false) {
                xaxisOffset = min;
            } else if (min > 0) {
                xaxisOffset = min;
            } else {
                xaxisOffset = max;
            }
            this.xaxisOffset = xaxisOffset;

            range = stacked ? (Math.max.apply(Math, stackRanges) + Math.max.apply(Math, stackRangesNeg)) : max - min;

            // as we plot zero/min values a single pixel line, we add a pixel to all other
            // values - Reduce the effective canvas size to suit
            this.canvasHeightEf = (zeroAxis && min < 0) ? this.canvasHeight - 2 : this.canvasHeight - 1;

            if (min < xaxisOffset) {
                yMaxCalc = (stacked && max >= 0) ? stackMax : max;
                yoffset = (yMaxCalc - xaxisOffset) / range * this.canvasHeight;
                if (yoffset !== Math.ceil(yoffset)) {
                    this.canvasHeightEf -= 2;
                    yoffset = Math.ceil(yoffset);
                }
            } else {
                yoffset = this.canvasHeight;
            }
            this.yoffset = yoffset;

            if ($.isArray(options.get('colorMap'))) {
                this.colorMapByIndex = options.get('colorMap');
                this.colorMapByValue = null;
            } else {
                this.colorMapByIndex = null;
                this.colorMapByValue = options.get('colorMap');
                if (this.colorMapByValue && this.colorMapByValue.get === undefined) {
                    this.colorMapByValue = new RangeMap(this.colorMapByValue);
                }
            }

            this.range = range;
        },

        getRegion: function (el, x, y) {
            var result = Math.floor(x / this.totalBarWidth);
            return (result < 0 || result >= this.values.length) ? undefined : result;
        },

        getCurrentRegionFields: function () {
            var currentRegion = this.currentRegion,
                values = ensureArray(this.values[currentRegion]),
                result = [],
                value, i;
            for (i = values.length; i--;) {
                value = values[i];
                result.push({
                    isNull: value === null,
                    value: value,
                    color: this.calcColor(i, value, currentRegion),
                    offset: currentRegion
                });
            }
            return result;
        },

        calcColor: function (stacknum, value, valuenum) {
            var colorMapByIndex = this.colorMapByIndex,
                colorMapByValue = this.colorMapByValue,
                options = this.options,
                color, newColor;
            if (this.stacked) {
                color = options.get('stackedBarColor');
            } else {
                color = (value < 0) ? options.get('negBarColor') : options.get('barColor');
            }
            if (value === 0 && options.get('zeroColor') !== undefined) {
                color = options.get('zeroColor');
            }
            if (colorMapByValue && (newColor = colorMapByValue.get(value))) {
                color = newColor;
            } else if (colorMapByIndex && colorMapByIndex.length > valuenum) {
                color = colorMapByIndex[valuenum];
            }
            return $.isArray(color) ? color[stacknum % color.length] : color;
        },

        /**
         * Render bar(s) for a region
         */
        renderRegion: function (valuenum, highlight) {
            var vals = this.values[valuenum],
                options = this.options,
                xaxisOffset = this.xaxisOffset,
                result = [],
                range = this.range,
                stacked = this.stacked,
                target = this.target,
                x = valuenum * this.totalBarWidth,
                canvasHeightEf = this.canvasHeightEf,
                yoffset = this.yoffset,
                y, height, color, isNull, yoffsetNeg, i, valcount, val, minPlotted, allMin;

            vals = $.isArray(vals) ? vals : [vals];
            valcount = vals.length;
            val = vals[0];
            isNull = all(null, vals);
            allMin = all(xaxisOffset, vals, true);

            if (isNull) {
                if (options.get('nullColor')) {
                    color = highlight ? options.get('nullColor') : this.calcHighlightColor(options.get('nullColor'), options);
                    y = (yoffset > 0) ? yoffset - 1 : yoffset;
                    return target.drawRect(x, y, this.barWidth - 1, 0, color, color);
                } else {
                    return undefined;
                }
            }
            yoffsetNeg = yoffset;
            for (i = 0; i < valcount; i++) {
                val = vals[i];

                if (stacked && val === xaxisOffset) {
                    if (!allMin || minPlotted) {
                        continue;
                    }
                    minPlotted = true;
                }

                if (range > 0) {
                    height = Math.floor(canvasHeightEf * ((Math.abs(val - xaxisOffset) / range))) + 1;
                } else {
                    height = 1;
                }
                if (val < xaxisOffset || (val === xaxisOffset && yoffset === 0)) {
                    y = yoffsetNeg;
                    yoffsetNeg += height;
                } else {
                    y = yoffset - height;
                    yoffset -= height;
                }
                color = this.calcColor(i, val, valuenum);
                if (highlight) {
                    color = this.calcHighlightColor(color, options);
                }
                result.push(target.drawRect(x, y, this.barWidth - 1, height - 1, color, color));
            }
            if (result.length === 1) {
                return result[0];
            }
            return result;
        }
    });


    /**
     * Tristate charts
     */
    $.fn.sparkline.tristate = tristate = createClass($.fn.sparkline._base, barHighlightMixin, {
        type: 'tristate',

        init: function (el, values, options, width, height) {
            var barWidth = parseInt(options.get('barWidth'), 10),
                barSpacing = parseInt(options.get('barSpacing'), 10);
            tristate._super.init.call(this, el, values, options, width, height);

            this.regionShapes = {};
            this.barWidth = barWidth;
            this.barSpacing = barSpacing;
            this.totalBarWidth = barWidth + barSpacing;
            this.values = $.map(values, Number);
            this.width = width = (values.length * barWidth) + ((values.length - 1) * barSpacing);

            if ($.isArray(options.get('colorMap'))) {
                this.colorMapByIndex = options.get('colorMap');
                this.colorMapByValue = null;
            } else {
                this.colorMapByIndex = null;
                this.colorMapByValue = options.get('colorMap');
                if (this.colorMapByValue && this.colorMapByValue.get === undefined) {
                    this.colorMapByValue = new RangeMap(this.colorMapByValue);
                }
            }
            this.initTarget();
        },

        getRegion: function (el, x, y) {
            return Math.floor(x / this.totalBarWidth);
        },

        getCurrentRegionFields: function () {
            var currentRegion = this.currentRegion;
            return {
                isNull: this.values[currentRegion] === undefined,
                value: this.values[currentRegion],
                color: this.calcColor(this.values[currentRegion], currentRegion),
                offset: currentRegion
            };
        },

        calcColor: function (value, valuenum) {
            var values = this.values,
                options = this.options,
                colorMapByIndex = this.colorMapByIndex,
                colorMapByValue = this.colorMapByValue,
                color, newColor;

            if (colorMapByValue && (newColor = colorMapByValue.get(value))) {
                color = newColor;
            } else if (colorMapByIndex && colorMapByIndex.length > valuenum) {
                color = colorMapByIndex[valuenum];
            } else if (values[valuenum] < 0) {
                color = options.get('negBarColor');
            } else if (values[valuenum] > 0) {
                color = options.get('posBarColor');
            } else {
                color = options.get('zeroBarColor');
            }
            return color;
        },

        renderRegion: function (valuenum, highlight) {
            var values = this.values,
                options = this.options,
                target = this.target,
                canvasHeight, height, halfHeight,
                x, y, color;

            canvasHeight = target.pixelHeight;
            halfHeight = Math.round(canvasHeight / 2);

            x = valuenum * this.totalBarWidth;
            if (values[valuenum] < 0) {
                y = halfHeight;
                height = halfHeight - 1;
            } else if (values[valuenum] > 0) {
                y = 0;
                height = halfHeight - 1;
            } else {
                y = halfHeight - 1;
                height = 2;
            }
            color = this.calcColor(values[valuenum], valuenum);
            if (color === null) {
                return;
            }
            if (highlight) {
                color = this.calcHighlightColor(color, options);
            }
            return target.drawRect(x, y, this.barWidth - 1, height - 1, color, color);
        }
    });


    /**
     * Discrete charts
     */
    $.fn.sparkline.discrete = discrete = createClass($.fn.sparkline._base, barHighlightMixin, {
        type: 'discrete',

        init: function (el, values, options, width, height) {
            discrete._super.init.call(this, el, values, options, width, height);

            this.regionShapes = {};
            this.values = values = $.map(values, Number);
            this.min = Math.min.apply(Math, values);
            this.max = Math.max.apply(Math, values);
            this.range = this.max - this.min;
            this.width = width = options.get('width') === 'auto' ? values.length * 2 : this.width;
            this.interval = Math.floor(width / values.length);
            this.itemWidth = width / values.length;
            if (options.get('chartRangeMin') !== undefined && (options.get('chartRangeClip') || options.get('chartRangeMin') < this.min)) {
                this.min = options.get('chartRangeMin');
            }
            if (options.get('chartRangeMax') !== undefined && (options.get('chartRangeClip') || options.get('chartRangeMax') > this.max)) {
                this.max = options.get('chartRangeMax');
            }
            this.initTarget();
            if (this.target) {
                this.lineHeight = options.get('lineHeight') === 'auto' ? Math.round(this.canvasHeight * 0.3) : options.get('lineHeight');
            }
        },

        getRegion: function (el, x, y) {
            return Math.floor(x / this.itemWidth);
        },

        getCurrentRegionFields: function () {
            var currentRegion = this.currentRegion;
            return {
                isNull: this.values[currentRegion] === undefined,
                value: this.values[currentRegion],
                offset: currentRegion
            };
        },

        renderRegion: function (valuenum, highlight) {
            var values = this.values,
                options = this.options,
                min = this.min,
                max = this.max,
                range = this.range,
                interval = this.interval,
                target = this.target,
                canvasHeight = this.canvasHeight,
                lineHeight = this.lineHeight,
                pheight = canvasHeight - lineHeight,
                ytop, val, color, x;

            val = clipval(values[valuenum], min, max);
            x = valuenum * interval;
            ytop = Math.round(pheight - pheight * ((val - min) / range));
            color = (options.get('thresholdColor') && val < options.get('thresholdValue')) ? options.get('thresholdColor') : options.get('lineColor');
            if (highlight) {
                color = this.calcHighlightColor(color, options);
            }
            return target.drawLine(x, ytop, x, ytop + lineHeight, color);
        }
    });


    /**
     * Bullet charts
     */
    $.fn.sparkline.bullet = bullet = createClass($.fn.sparkline._base, {
        type: 'bullet',

        init: function (el, values, options, width, height) {
            var min, max, vals;
            bullet._super.init.call(this, el, values, options, width, height);

            // values: target, performance, range1, range2, range3
            this.values = values = normalizeValues(values);
            // target or performance could be null
            vals = values.slice();
            vals[0] = vals[0] === null ? vals[2] : vals[0];
            vals[1] = values[1] === null ? vals[2] : vals[1];
            min = Math.min.apply(Math, values);
            max = Math.max.apply(Math, values);
            if (options.get('base') === undefined) {
                min = min < 0 ? min : 0;
            } else {
                min = options.get('base');
            }
            this.min = min;
            this.max = max;
            this.range = max - min;
            this.shapes = {};
            this.valueShapes = {};
            this.regiondata = {};
            this.width = width = options.get('width') === 'auto' ? '4.0em' : width;
            this.target = this.$el.simpledraw(width, height, options.get('composite'));
            if (!values.length) {
                this.disabled = true;
            }
            this.initTarget();
        },

        getRegion: function (el, x, y) {
            var shapeid = this.target.getShapeAt(el, x, y);
            return (shapeid !== undefined && this.shapes[shapeid] !== undefined) ? this.shapes[shapeid] : undefined;
        },

        getCurrentRegionFields: function () {
            var currentRegion = this.currentRegion;
            return {
                fieldkey: currentRegion.substr(0, 1),
                value: this.values[currentRegion.substr(1)],
                region: currentRegion
            };
        },

        changeHighlight: function (highlight) {
            var currentRegion = this.currentRegion,
                shapeid = this.valueShapes[currentRegion],
                shape;
            delete this.shapes[shapeid];
            switch (currentRegion.substr(0, 1)) {
                case 'r':
                    shape = this.renderRange(currentRegion.substr(1), highlight);
                    break;
                case 'p':
                    shape = this.renderPerformance(highlight);
                    break;
                case 't':
                    shape = this.renderTarget(highlight);
                    break;
            }
            this.valueShapes[currentRegion] = shape.id;
            this.shapes[shape.id] = currentRegion;
            this.target.replaceWithShape(shapeid, shape);
        },

        renderRange: function (rn, highlight) {
            var rangeval = this.values[rn],
                rangewidth = Math.round(this.canvasWidth * ((rangeval - this.min) / this.range)),
                color = this.options.get('rangeColors')[rn - 2];
            if (highlight) {
                color = this.calcHighlightColor(color, this.options);
            }
            return this.target.drawRect(0, 0, rangewidth - 1, this.canvasHeight - 1, color, color);
        },

        renderPerformance: function (highlight) {
            var perfval = this.values[1],
                perfwidth = Math.round(this.canvasWidth * ((perfval - this.min) / this.range)),
                color = this.options.get('performanceColor');
            if (highlight) {
                color = this.calcHighlightColor(color, this.options);
            }
            return this.target.drawRect(0, Math.round(this.canvasHeight * 0.3), perfwidth - 1,
                Math.round(this.canvasHeight * 0.4) - 1, color, color);
        },

        renderTarget: function (highlight) {
            var targetval = this.values[0],
                x = Math.round(this.canvasWidth * ((targetval - this.min) / this.range) - (this.options.get('targetWidth') / 2)),
                targettop = Math.round(this.canvasHeight * 0.10),
                targetheight = this.canvasHeight - (targettop * 2),
                color = this.options.get('targetColor');
            if (highlight) {
                color = this.calcHighlightColor(color, this.options);
            }
            return this.target.drawRect(x, targettop, this.options.get('targetWidth') - 1, targetheight - 1, color, color);
        },

        render: function () {
            var vlen = this.values.length,
                target = this.target,
                i, shape;
            if (!bullet._super.render.call(this)) {
                return;
            }
            for (i = 2; i < vlen; i++) {
                shape = this.renderRange(i).append();
                this.shapes[shape.id] = 'r' + i;
                this.valueShapes['r' + i] = shape.id;
            }
            if (this.values[1] !== null) {
                shape = this.renderPerformance().append();
                this.shapes[shape.id] = 'p1';
                this.valueShapes.p1 = shape.id;
            }
            if (this.values[0] !== null) {
                shape = this.renderTarget().append();
                this.shapes[shape.id] = 't0';
                this.valueShapes.t0 = shape.id;
            }
            target.render();
        }
    });


    /**
     * Pie charts
     */
    $.fn.sparkline.pie = pie = createClass($.fn.sparkline._base, {
        type: 'pie',

        init: function (el, values, options, width, height) {
            var total = 0, i;

            pie._super.init.call(this, el, values, options, width, height);

            this.shapes = {}; // map shape ids to value offsets
            this.valueShapes = {}; // maps value offsets to shape ids
            this.values = values = $.map(values, Number);

            if (options.get('width') === 'auto') {
                this.width = this.height;
            }

            if (values.length > 0) {
                for (i = values.length; i--;) {
                    total += values[i];
                }
            }
            this.total = total;
            this.initTarget();
            this.radius = Math.floor(Math.min(this.canvasWidth, this.canvasHeight) / 2);
        },

        getRegion: function (el, x, y) {
            var shapeid = this.target.getShapeAt(el, x, y);
            return (shapeid !== undefined && this.shapes[shapeid] !== undefined) ? this.shapes[shapeid] : undefined;
        },

        getCurrentRegionFields: function () {
            var currentRegion = this.currentRegion;
            return {
                isNull: this.values[currentRegion] === undefined,
                value: this.values[currentRegion],
                percent: this.values[currentRegion] / this.total * 100,
                color: this.options.get('sliceColors')[currentRegion % this.options.get('sliceColors').length],
                offset: currentRegion
            };
        },

        changeHighlight: function (highlight) {
            var currentRegion = this.currentRegion,
                 newslice = this.renderSlice(currentRegion, highlight),
                 shapeid = this.valueShapes[currentRegion];
            delete this.shapes[shapeid];
            this.target.replaceWithShape(shapeid, newslice);
            this.valueShapes[currentRegion] = newslice.id;
            this.shapes[newslice.id] = currentRegion;
        },

        renderSlice: function (valuenum, highlight) {
            var target = this.target,
                options = this.options,
                radius = this.radius,
                borderWidth = options.get('borderWidth'),
                offset = options.get('offset'),
                circle = 2 * Math.PI,
                values = this.values,
                total = this.total,
                next = offset ? (2*Math.PI)*(offset/360) : 0,
                start, end, i, vlen, color;

            vlen = values.length;
            for (i = 0; i < vlen; i++) {
                start = next;
                end = next;
                if (total > 0) {  // avoid divide by zero
                    end = next + (circle * (values[i] / total));
                }
                if (valuenum === i) {
                    color = options.get('sliceColors')[i % options.get('sliceColors').length];
                    if (highlight) {
                        color = this.calcHighlightColor(color, options);
                    }

                    return target.drawPieSlice(radius, radius, radius - borderWidth, start, end, undefined, color);
                }
                next = end;
            }
        },

        render: function () {
            var target = this.target,
                values = this.values,
                options = this.options,
                radius = this.radius,
                borderWidth = options.get('borderWidth'),
                shape, i;

            if (!pie._super.render.call(this)) {
                return;
            }
            if (borderWidth) {
                target.drawCircle(radius, radius, Math.floor(radius - (borderWidth / 2)),
                    options.get('borderColor'), undefined, borderWidth).append();
            }
            for (i = values.length; i--;) {
                if (values[i]) { // don't render zero values
                    shape = this.renderSlice(i).append();
                    this.valueShapes[i] = shape.id; // store just the shapeid
                    this.shapes[shape.id] = i;
                }
            }
            target.render();
        }
    });


    /**
     * Box plots
     */
    $.fn.sparkline.box = box = createClass($.fn.sparkline._base, {
        type: 'box',

        init: function (el, values, options, width, height) {
            box._super.init.call(this, el, values, options, width, height);
            this.values = $.map(values, Number);
            this.width = options.get('width') === 'auto' ? '4.0em' : width;
            this.initTarget();
            if (!this.values.length) {
                this.disabled = 1;
            }
        },

        /**
         * Simulate a single region
         */
        getRegion: function () {
            return 1;
        },

        getCurrentRegionFields: function () {
            var result = [
                { field: 'lq', value: this.quartiles[0] },
                { field: 'med', value: this.quartiles[1] },
                { field: 'uq', value: this.quartiles[2] }
            ];
            if (this.loutlier !== undefined) {
                result.push({ field: 'lo', value: this.loutlier});
            }
            if (this.routlier !== undefined) {
                result.push({ field: 'ro', value: this.routlier});
            }
            if (this.lwhisker !== undefined) {
                result.push({ field: 'lw', value: this.lwhisker});
            }
            if (this.rwhisker !== undefined) {
                result.push({ field: 'rw', value: this.rwhisker});
            }
            return result;
        },

        render: function () {
            var target = this.target,
                values = this.values,
                vlen = values.length,
                options = this.options,
                canvasWidth = this.canvasWidth,
                canvasHeight = this.canvasHeight,
                minValue = options.get('chartRangeMin') === undefined ? Math.min.apply(Math, values) : options.get('chartRangeMin'),
                maxValue = options.get('chartRangeMax') === undefined ? Math.max.apply(Math, values) : options.get('chartRangeMax'),
                canvasLeft = 0,
                lwhisker, loutlier, iqr, q1, q2, q3, rwhisker, routlier, i,
                size, unitSize;

            if (!box._super.render.call(this)) {
                return;
            }

            if (options.get('raw')) {
                if (options.get('showOutliers') && values.length > 5) {
                    loutlier = values[0];
                    lwhisker = values[1];
                    q1 = values[2];
                    q2 = values[3];
                    q3 = values[4];
                    rwhisker = values[5];
                    routlier = values[6];
                } else {
                    lwhisker = values[0];
                    q1 = values[1];
                    q2 = values[2];
                    q3 = values[3];
                    rwhisker = values[4];
                }
            } else {
                values.sort(function (a, b) { return a - b; });
                q1 = quartile(values, 1);
                q2 = quartile(values, 2);
                q3 = quartile(values, 3);
                iqr = q3 - q1;
                if (options.get('showOutliers')) {
                    lwhisker = rwhisker = undefined;
                    for (i = 0; i < vlen; i++) {
                        if (lwhisker === undefined && values[i] > q1 - (iqr * options.get('outlierIQR'))) {
                            lwhisker = values[i];
                        }
                        if (values[i] < q3 + (iqr * options.get('outlierIQR'))) {
                            rwhisker = values[i];
                        }
                    }
                    loutlier = values[0];
                    routlier = values[vlen - 1];
                } else {
                    lwhisker = values[0];
                    rwhisker = values[vlen - 1];
                }
            }
            this.quartiles = [q1, q2, q3];
            this.lwhisker = lwhisker;
            this.rwhisker = rwhisker;
            this.loutlier = loutlier;
            this.routlier = routlier;

            unitSize = canvasWidth / (maxValue - minValue + 1);
            if (options.get('showOutliers')) {
                canvasLeft = Math.ceil(options.get('spotRadius'));
                canvasWidth -= 2 * Math.ceil(options.get('spotRadius'));
                unitSize = canvasWidth / (maxValue - minValue + 1);
                if (loutlier < lwhisker) {
                    target.drawCircle((loutlier - minValue) * unitSize + canvasLeft,
                        canvasHeight / 2,
                        options.get('spotRadius'),
                        options.get('outlierLineColor'),
                        options.get('outlierFillColor')).append();
                }
                if (routlier > rwhisker) {
                    target.drawCircle((routlier - minValue) * unitSize + canvasLeft,
                        canvasHeight / 2,
                        options.get('spotRadius'),
                        options.get('outlierLineColor'),
                        options.get('outlierFillColor')).append();
                }
            }

            // box
            target.drawRect(
                Math.round((q1 - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight * 0.1),
                Math.round((q3 - q1) * unitSize),
                Math.round(canvasHeight * 0.8),
                options.get('boxLineColor'),
                options.get('boxFillColor')).append();
            // left whisker
            target.drawLine(
                Math.round((lwhisker - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight / 2),
                Math.round((q1 - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight / 2),
                options.get('lineColor')).append();
            target.drawLine(
                Math.round((lwhisker - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight / 4),
                Math.round((lwhisker - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight - canvasHeight / 4),
                options.get('whiskerColor')).append();
            // right whisker
            target.drawLine(Math.round((rwhisker - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight / 2),
                Math.round((q3 - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight / 2),
                options.get('lineColor')).append();
            target.drawLine(
                Math.round((rwhisker - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight / 4),
                Math.round((rwhisker - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight - canvasHeight / 4),
                options.get('whiskerColor')).append();
            // median line
            target.drawLine(
                Math.round((q2 - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight * 0.1),
                Math.round((q2 - minValue) * unitSize + canvasLeft),
                Math.round(canvasHeight * 0.9),
                options.get('medianColor')).append();
            if (options.get('target')) {
                size = Math.ceil(options.get('spotRadius'));
                target.drawLine(
                    Math.round((options.get('target') - minValue) * unitSize + canvasLeft),
                    Math.round((canvasHeight / 2) - size),
                    Math.round((options.get('target') - minValue) * unitSize + canvasLeft),
                    Math.round((canvasHeight / 2) + size),
                    options.get('targetColor')).append();
                target.drawLine(
                    Math.round((options.get('target') - minValue) * unitSize + canvasLeft - size),
                    Math.round(canvasHeight / 2),
                    Math.round((options.get('target') - minValue) * unitSize + canvasLeft + size),
                    Math.round(canvasHeight / 2),
                    options.get('targetColor')).append();
            }
            target.render();
        }
    });


    // Setup a very simple "virtual canvas" to make drawing the few shapes we need easier
    // This is accessible as $(foo).simpledraw()

    VShape = createClass({
        init: function (target, id, type, args) {
            this.target = target;
            this.id = id;
            this.type = type;
            this.args = args;
        },
        append: function () {
            this.target.appendShape(this);
            return this;
        }
    });

    VCanvas_base = createClass({
        _pxregex: /(\d+)(px)?\s*$/i,

        init: function (width, height, target) {
            if (!width) {
                return;
            }
            this.width = width;
            this.height = height;
            this.target = target;
            this.lastShapeId = null;
            if (target[0]) {
                target = target[0];
            }
            $.data(target, '_jqs_vcanvas', this);
        },

        drawLine: function (x1, y1, x2, y2, lineColor, lineWidth) {
            return this.drawShape([[x1, y1], [x2, y2]], lineColor, lineWidth);
        },

        drawShape: function (path, lineColor, fillColor, lineWidth) {
            return this._genShape('Shape', [path, lineColor, fillColor, lineWidth]);
        },

        drawCircle: function (x, y, radius, lineColor, fillColor, lineWidth) {
            return this._genShape('Circle', [x, y, radius, lineColor, fillColor, lineWidth]);
        },

        drawPieSlice: function (x, y, radius, startAngle, endAngle, lineColor, fillColor) {
            return this._genShape('PieSlice', [x, y, radius, startAngle, endAngle, lineColor, fillColor]);
        },

        drawRect: function (x, y, width, height, lineColor, fillColor) {
            return this._genShape('Rect', [x, y, width, height, lineColor, fillColor]);
        },

        getElement: function () {
            return this.canvas;
        },

        /**
         * Return the most recently inserted shape id
         */
        getLastShapeId: function () {
            return this.lastShapeId;
        },

        /**
         * Clear and reset the canvas
         */
        reset: function () {
            alert('reset not implemented');
        },

        _insert: function (el, target) {
            $(target).html(el);
        },

        /**
         * Calculate the pixel dimensions of the canvas
         */
        _calculatePixelDims: function (width, height, canvas) {
            // XXX This should probably be a configurable option
            var match;
            match = this._pxregex.exec(height);
            if (match) {
                this.pixelHeight = match[1];
            } else {
                this.pixelHeight = $(canvas).height();
            }
            match = this._pxregex.exec(width);
            if (match) {
                this.pixelWidth = match[1];
            } else {
                this.pixelWidth = $(canvas).width();
            }
        },

        /**
         * Generate a shape object and id for later rendering
         */
        _genShape: function (shapetype, shapeargs) {
            var id = shapeCount++;
            shapeargs.unshift(id);
            return new VShape(this, id, shapetype, shapeargs);
        },

        /**
         * Add a shape to the end of the render queue
         */
        appendShape: function (shape) {
            alert('appendShape not implemented');
        },

        /**
         * Replace one shape with another
         */
        replaceWithShape: function (shapeid, shape) {
            alert('replaceWithShape not implemented');
        },

        /**
         * Insert one shape after another in the render queue
         */
        insertAfterShape: function (shapeid, shape) {
            alert('insertAfterShape not implemented');
        },

        /**
         * Remove a shape from the queue
         */
        removeShapeId: function (shapeid) {
            alert('removeShapeId not implemented');
        },

        /**
         * Find a shape at the specified x/y co-ordinates
         */
        getShapeAt: function (el, x, y) {
            alert('getShapeAt not implemented');
        },

        /**
         * Render all queued shapes onto the canvas
         */
        render: function () {
            alert('render not implemented');
        }
    });


    VCanvas_canvas = createClass(VCanvas_base, {
        init: function (width, height, target, interact) {
            VCanvas_canvas._super.init.call(this, width, height, target);
            this.canvas = document.createElement('canvas');
            if (target[0]) {
                target = target[0];
            }
            $.data(target, '_jqs_vcanvas', this);
            $(this.canvas).css({ display: 'inline-block', width: width, height: height, verticalAlign: 'top' });
            this._insert(this.canvas, target);
            this._calculatePixelDims(width, height, this.canvas);
            this.canvas.width = this.pixelWidth;
            this.canvas.height = this.pixelHeight;
            this.interact = interact;
            this.shapes = {};
            this.shapeseq = [];
            this.currentTargetShapeId = undefined;
            $(this.canvas).css({width: this.pixelWidth, height: this.pixelHeight});
        },

        _getContext: function (lineColor, fillColor, lineWidth) {
            var context = this.canvas.getContext('2d');
            if (lineColor !== undefined) {
                context.strokeStyle = lineColor;
            }
            context.lineWidth = lineWidth === undefined ? 1 : lineWidth;
            if (fillColor !== undefined) {
                context.fillStyle = fillColor;
            }
            return context;
        },

        reset: function () {
            var context = this._getContext();
            context.clearRect(0, 0, this.pixelWidth, this.pixelHeight);
            this.shapes = {};
            this.shapeseq = [];
            this.currentTargetShapeId = undefined;
        },

        _drawShape: function (shapeid, path, lineColor, fillColor, lineWidth) {
            var context = this._getContext(lineColor, fillColor, lineWidth),
                i, plen;
            context.beginPath();
            context.moveTo(path[0][0] + 0.5, path[0][1] + 0.5);
            for (i = 1, plen = path.length; i < plen; i++) {
                context.lineTo(path[i][0] + 0.5, path[i][1] + 0.5); // the 0.5 offset gives us crisp pixel-width lines
            }
            if (lineColor !== undefined) {
                context.stroke();
            }
            if (fillColor !== undefined) {
                context.fill();
            }
            if (this.targetX !== undefined && this.targetY !== undefined &&
                context.isPointInPath(this.targetX, this.targetY)) {
                this.currentTargetShapeId = shapeid;
            }
        },

        _drawCircle: function (shapeid, x, y, radius, lineColor, fillColor, lineWidth) {
            var context = this._getContext(lineColor, fillColor, lineWidth);
            context.beginPath();
            context.arc(x, y, radius, 0, 2 * Math.PI, false);
            if (this.targetX !== undefined && this.targetY !== undefined &&
                context.isPointInPath(this.targetX, this.targetY)) {
                this.currentTargetShapeId = shapeid;
            }
            if (lineColor !== undefined) {
                context.stroke();
            }
            if (fillColor !== undefined) {
                context.fill();
            }
        },

        _drawPieSlice: function (shapeid, x, y, radius, startAngle, endAngle, lineColor, fillColor) {
            var context = this._getContext(lineColor, fillColor);
            context.beginPath();
            context.moveTo(x, y);
            context.arc(x, y, radius, startAngle, endAngle, false);
            context.lineTo(x, y);
            context.closePath();
            if (lineColor !== undefined) {
                context.stroke();
            }
            if (fillColor) {
                context.fill();
            }
            if (this.targetX !== undefined && this.targetY !== undefined &&
                context.isPointInPath(this.targetX, this.targetY)) {
                this.currentTargetShapeId = shapeid;
            }
        },

        _drawRect: function (shapeid, x, y, width, height, lineColor, fillColor) {
            return this._drawShape(shapeid, [[x, y], [x + width, y], [x + width, y + height], [x, y + height], [x, y]], lineColor, fillColor);
        },

        appendShape: function (shape) {
            this.shapes[shape.id] = shape;
            this.shapeseq.push(shape.id);
            this.lastShapeId = shape.id;
            return shape.id;
        },

        replaceWithShape: function (shapeid, shape) {
            var shapeseq = this.shapeseq,
                i;
            this.shapes[shape.id] = shape;
            for (i = shapeseq.length; i--;) {
                if (shapeseq[i] == shapeid) {
                    shapeseq[i] = shape.id;
                }
            }
            delete this.shapes[shapeid];
        },

        replaceWithShapes: function (shapeids, shapes) {
            var shapeseq = this.shapeseq,
                shapemap = {},
                sid, i, first;

            for (i = shapeids.length; i--;) {
                shapemap[shapeids[i]] = true;
            }
            for (i = shapeseq.length; i--;) {
                sid = shapeseq[i];
                if (shapemap[sid]) {
                    shapeseq.splice(i, 1);
                    delete this.shapes[sid];
                    first = i;
                }
            }
            for (i = shapes.length; i--;) {
                shapeseq.splice(first, 0, shapes[i].id);
                this.shapes[shapes[i].id] = shapes[i];
            }

        },

        insertAfterShape: function (shapeid, shape) {
            var shapeseq = this.shapeseq,
                i;
            for (i = shapeseq.length; i--;) {
                if (shapeseq[i] === shapeid) {
                    shapeseq.splice(i + 1, 0, shape.id);
                    this.shapes[shape.id] = shape;
                    return;
                }
            }
        },

        removeShapeId: function (shapeid) {
            var shapeseq = this.shapeseq,
                i;
            for (i = shapeseq.length; i--;) {
                if (shapeseq[i] === shapeid) {
                    shapeseq.splice(i, 1);
                    break;
                }
            }
            delete this.shapes[shapeid];
        },

        getShapeAt: function (el, x, y) {
            this.targetX = x;
            this.targetY = y;
            this.render();
            return this.currentTargetShapeId;
        },

        render: function () {
            var shapeseq = this.shapeseq,
                shapes = this.shapes,
                shapeCount = shapeseq.length,
                context = this._getContext(),
                shapeid, shape, i;
            context.clearRect(0, 0, this.pixelWidth, this.pixelHeight);
            for (i = 0; i < shapeCount; i++) {
                shapeid = shapeseq[i];
                shape = shapes[shapeid];
                this['_draw' + shape.type].apply(this, shape.args);
            }
            if (!this.interact) {
                // not interactive so no need to keep the shapes array
                this.shapes = {};
                this.shapeseq = [];
            }
        }

    });


    VCanvas_vml = createClass(VCanvas_base, {
        init: function (width, height, target) {
            var groupel;
            VCanvas_vml._super.init.call(this, width, height, target);
            if (target[0]) {
                target = target[0];
            }
            $.data(target, '_jqs_vcanvas', this);
            this.canvas = document.createElement('span');
            $(this.canvas).css({ display: 'inline-block', position: 'relative', overflow: 'hidden', width: width, height: height, margin: '0px', padding: '0px', verticalAlign: 'top'});
            this._insert(this.canvas, target);
            this._calculatePixelDims(width, height, this.canvas);
            this.canvas.width = this.pixelWidth;
            this.canvas.height = this.pixelHeight;
            groupel = '<v:group coordorigin="0 0" coordsize="' + this.pixelWidth + ' ' + this.pixelHeight + '"' +
                    ' style="position:absolute;top:0;left:0;width:' + this.pixelWidth + 'px;height=' + this.pixelHeight + 'px;"></v:group>';
            this.canvas.insertAdjacentHTML('beforeEnd', groupel);
            this.group = $(this.canvas).children()[0];
            this.rendered = false;
            this.prerender = '';
        },

        _drawShape: function (shapeid, path, lineColor, fillColor, lineWidth) {
            var vpath = [],
                initial, stroke, fill, closed, vel, plen, i;
            for (i = 0, plen = path.length; i < plen; i++) {
                vpath[i] = '' + (path[i][0]) + ',' + (path[i][1]);
            }
            initial = vpath.splice(0, 1);
            lineWidth = lineWidth === undefined ? 1 : lineWidth;
            stroke = lineColor === undefined ? ' stroked="false" ' : ' strokeWeight="' + lineWidth + 'px" strokeColor="' + lineColor + '" ';
            fill = fillColor === undefined ? ' filled="false"' : ' fillColor="' + fillColor + '" filled="true" ';
            closed = vpath[0] === vpath[vpath.length - 1] ? 'x ' : '';
            vel = '<v:shape coordorigin="0 0" coordsize="' + this.pixelWidth + ' ' + this.pixelHeight + '" ' +
                 ' id="jqsshape' + shapeid + '" ' +
                 stroke +
                 fill +
                ' style="position:absolute;left:0px;top:0px;height:' + this.pixelHeight + 'px;width:' + this.pixelWidth + 'px;padding:0px;margin:0px;" ' +
                ' path="m ' + initial + ' l ' + vpath.join(', ') + ' ' + closed + 'e">' +
                ' </v:shape>';
            return vel;
        },

        _drawCircle: function (shapeid, x, y, radius, lineColor, fillColor, lineWidth) {
            var stroke, fill, vel;
            x -= radius;
            y -= radius;
            stroke = lineColor === undefined ? ' stroked="false" ' : ' strokeWeight="' + lineWidth + 'px" strokeColor="' + lineColor + '" ';
            fill = fillColor === undefined ? ' filled="false"' : ' fillColor="' + fillColor + '" filled="true" ';
            vel = '<v:oval ' +
                 ' id="jqsshape' + shapeid + '" ' +
                stroke +
                fill +
                ' style="position:absolute;top:' + y + 'px; left:' + x + 'px; width:' + (radius * 2) + 'px; height:' + (radius * 2) + 'px"></v:oval>';
            return vel;

        },

        _drawPieSlice: function (shapeid, x, y, radius, startAngle, endAngle, lineColor, fillColor) {
            var vpath, startx, starty, endx, endy, stroke, fill, vel;
            if (startAngle === endAngle) {
                return '';  // VML seems to have problem when start angle equals end angle.
            }
            if ((endAngle - startAngle) === (2 * Math.PI)) {
                startAngle = 0.0;  // VML seems to have a problem when drawing a full circle that doesn't start 0
                endAngle = (2 * Math.PI);
            }

            startx = x + Math.round(Math.cos(startAngle) * radius);
            starty = y + Math.round(Math.sin(startAngle) * radius);
            endx = x + Math.round(Math.cos(endAngle) * radius);
            endy = y + Math.round(Math.sin(endAngle) * radius);

            if (startx === endx && starty === endy) {
                if ((endAngle - startAngle) < Math.PI) {
                    // Prevent very small slices from being mistaken as a whole pie
                    return '';
                }
                // essentially going to be the entire circle, so ignore startAngle
                startx = endx = x + radius;
                starty = endy = y;
            }

            if (startx === endx && starty === endy && (endAngle - startAngle) < Math.PI) {
                return '';
            }

            vpath = [x - radius, y - radius, x + radius, y + radius, startx, starty, endx, endy];
            stroke = lineColor === undefined ? ' stroked="false" ' : ' strokeWeight="1px" strokeColor="' + lineColor + '" ';
            fill = fillColor === undefined ? ' filled="false"' : ' fillColor="' + fillColor + '" filled="true" ';
            vel = '<v:shape coordorigin="0 0" coordsize="' + this.pixelWidth + ' ' + this.pixelHeight + '" ' +
                 ' id="jqsshape' + shapeid + '" ' +
                 stroke +
                 fill +
                ' style="position:absolute;left:0px;top:0px;height:' + this.pixelHeight + 'px;width:' + this.pixelWidth + 'px;padding:0px;margin:0px;" ' +
                ' path="m ' + x + ',' + y + ' wa ' + vpath.join(', ') + ' x e">' +
                ' </v:shape>';
            return vel;
        },

        _drawRect: function (shapeid, x, y, width, height, lineColor, fillColor) {
            return this._drawShape(shapeid, [[x, y], [x, y + height], [x + width, y + height], [x + width, y], [x, y]], lineColor, fillColor);
        },

        reset: function () {
            this.group.innerHTML = '';
        },

        appendShape: function (shape) {
            var vel = this['_draw' + shape.type].apply(this, shape.args);
            if (this.rendered) {
                this.group.insertAdjacentHTML('beforeEnd', vel);
            } else {
                this.prerender += vel;
            }
            this.lastShapeId = shape.id;
            return shape.id;
        },

        replaceWithShape: function (shapeid, shape) {
            var existing = $('#jqsshape' + shapeid),
                vel = this['_draw' + shape.type].apply(this, shape.args);
            existing[0].outerHTML = vel;
        },

        replaceWithShapes: function (shapeids, shapes) {
            // replace the first shapeid with all the new shapes then toast the remaining old shapes
            var existing = $('#jqsshape' + shapeids[0]),
                replace = '',
                slen = shapes.length,
                i;
            for (i = 0; i < slen; i++) {
                replace += this['_draw' + shapes[i].type].apply(this, shapes[i].args);
            }
            existing[0].outerHTML = replace;
            for (i = 1; i < shapeids.length; i++) {
                $('#jqsshape' + shapeids[i]).remove();
            }
        },

        insertAfterShape: function (shapeid, shape) {
            var existing = $('#jqsshape' + shapeid),
                 vel = this['_draw' + shape.type].apply(this, shape.args);
            existing[0].insertAdjacentHTML('afterEnd', vel);
        },

        removeShapeId: function (shapeid) {
            var existing = $('#jqsshape' + shapeid);
            this.group.removeChild(existing[0]);
        },

        getShapeAt: function (el, x, y) {
            var shapeid = el.id.substr(8);
            return shapeid;
        },

        render: function () {
            if (!this.rendered) {
                // batch the intial render into a single repaint
                this.group.innerHTML = this.prerender;
                this.rendered = true;
            }
        }
    });


}))}(document, Math));

/*!
 * amaretti v0.0.1 (http://foxythemes.net/themes/amaretti)
 * Copyright 2014-2015 Foxy Themes all rights reserved 
 */
var App = (function () {
  'use strict';

  //Basic Config
  var config = {
    assetsPath: 'assets',
    imgPath: 'img',
    jsPath: 'js',
    libsPath: 'lib',
    leftSidebarSlideSpeed: 200,
    swipeTreshold: 100,
    scrollTop: true,
    openLeftSidebarClass: 'open-left-sidebar',
    openRightSidebarClass: 'open-right-sidebar',
    removeLeftSidebarClass: 'am-nosidebar-left',
    transitionClass: 'am-animate',
    openSidebarDelay: 400,
    syncSubMenuOnHover: false
  };

  var colors = {};
  var body = $("body");
  var wrapper = $(".am-wrapper");
  var leftSidebar = $(".am-left-sidebar");
  var rightSidebar = $(".am-right-sidebar");
  var openSidebar = false;

  //Get the template css colors into js vars
  function getColor( c ){
    var tmp = $("<div>", { class: c }).appendTo("body");
    var color = tmp.css("background-color");
    tmp.remove();

    return color;
  }

  //Core private functions
  function leftSidebarInit(){

    function oSidebar(){
      body.addClass( config.openLeftSidebarClass + " " + config.transitionClass );
      openSidebar = true;
    }

    function cSidebar(){
      body.removeClass( config.openLeftSidebarClass ).addClass( config.transitionClass );
      sidebarDelay();
    }

    function syncSubMenu( item ){
      var elements = $(".sidebar-elements > li", leftSidebar);

      if( typeof item !== "undefined" ) {
        elements = item;
      }

      $.each( elements, function(i, v){

        var title = $(this).find("> a span").html();
        var ul = $(this).find("> ul");
        var subEls = $("> li", ul);
        var title = $('<li class="title">' + title + '</li>');
        var subContainer = $('<li class="nav-items"><div class="am-scroller nano"><div class="content nano-content"><ul></ul></div></div></li>');

        if( !ul.find("> li.title").length > 0 ){
         ul.prepend( title );
          subEls.appendTo( subContainer.find(".content ul") );
          subContainer.appendTo( ul );
        }
      });
    }

    /*Open-Sidebar when click on topbar button*/
      $('.am-toggle-left-sidebar').on("click", function(e){
        if( openSidebar && body.hasClass( config.openLeftSidebarClass ) ){
          cSidebar();
        }else if( !openSidebar ){
          oSidebar();
        }
        e.stopPropagation();
        e.preventDefault();
      });

    /*Close sidebar on click outside*/
      $(document).on("touchstart mousedown",function(e){
        if ( !$(e.target).closest(leftSidebar).length && body.hasClass( config.openLeftSidebarClass ) ) {
          cSidebar();
        }
      });

    var firstAnchor = $(".sidebar-elements > li > a", leftSidebar);

    /*Sub-menu title func*/
      firstAnchor.on('mouseover',function(){
        var amScroller = $(this).parent().find(".am-scroller");
        var li = $(this).parent();
        var subMenu = li.find("> ul");

        //Delay after mouse leave
        if( !$.isXs() ){
          subMenu.addClass("visible");
        }

        amScroller.nanoScroller({ destroy: true });
        amScroller.nanoScroller();

        //Create sub-menu elements
        if( config.syncSubMenuOnHover ){
          syncSubMenu( li );
        }
        
      });

    /*Sub-menu delay on mouse leave*/
      firstAnchor.on('mouseleave',function(){
        var subMenu = $(this).parent().find("> ul");
        
        if( !$.isXs() ){
          setTimeout(function(){
            subMenu.removeClass("visible");
          }, 300);
        }
      });

    /*Open sub-menu on small devices*/
      $(".sidebar-elements li a", leftSidebar).on("click",function( e ){
        if( $.isXs() ){
          var $el = $(this), $open, $speed = config.leftSidebarSlideSpeed;

          $open = $el.parent().siblings(".open");

          if( $open ){
            $open.toggleClass('open').find('> ul:visible').slideUp({ duration: $speed });
          }

          if( $el.parent().hasClass('open') ){
            $el.next().slideUp({ duration: $speed, complete: function(){
              $el.parent().toggleClass('open');
            }});
          }else{
            $el.next().slideDown({ duration: $speed, complete: function(){
              $el.parent().toggleClass('open');
            }});
          }

          if( $el.next().is('ul') ){
            e.preventDefault();
          }
        }else{//Close sub-menu on anchor click
          var subMenu = $(".sidebar-elements > li > ul:visible", leftSidebar);
          subMenu.addClass('hide');
          setTimeout(function(){
            subMenu.removeClass('hide');
          }, 50);
        }
      });

    /*Calculate sidebar tree active & open classes*/
      $("li.active", leftSidebar).parents(".parent").addClass("active open");

    /*Create sub menu elements*/
      syncSubMenu();

    /*Nanoscroller when left sidebar is fixed*/
      if( wrapper.hasClass("am-fixed-sidebar") ){
        var lsc = $(".am-left-sidebar > .content");
        lsc.wrap('<div class="am-scroller nano"></div>');
        lsc.addClass("nano-content");
        lsc.parent().nanoScroller();
      }

    /*On window resize check for small resolution classes to remove them*/
      $(window).resize(function () {
        waitForFinalEvent(function(){
          if( !$.isXs() ){
            var scroller = $(".am-scroller");
            scroller.nanoScroller({ destroy: true });
            scroller.nanoScroller();
          }
        }, 500, "am_check_phone_classes");
      });
  }

  function rightSidebarInit(){

    function oSidebar(){
      body.addClass( config.openRightSidebarClass  + " " + config.transitionClass );
    }

    function cSidebar(){
      body.removeClass( config.openRightSidebarClass ).addClass( config.transitionClass );
      sidebarDelay();
    }

    if( rightSidebar.length > 0 ){
      /*Open-Sidebar when click on topbar button*/
      $('.am-toggle-right-sidebar').on("click", function(e){
        if( openSidebar && body.hasClass( config.openRightSidebarClass ) ){
          cSidebar();
        }else if( !openSidebar ){
          oSidebar();
        }
        
        e.stopPropagation();
        e.preventDefault();
      });

      /*Close sidebar on click outside*/
      $( document ).on("mousedown touchstart",function( e ){
        if ( !$( e.target ).closest( rightSidebar ).length && body.hasClass( config.openRightSidebarClass ) ) {
          cSidebar();
        }
      });
    }
  }

  function sidebarDelay(){
    openSidebar = true;
    setTimeout(function(){
      openSidebar = false;
    }, config.openSidebarDelay );
  }

  function sidebarSwipe(){
    /*Open sidedar on swipe*/
    wrapper.swipe( {
      allowPageScroll: "vertical",
      preventDefaultEvents: false,
      fallbackToMouseEvents: false,
      swipeRight: function(e) {
        if( !openSidebar && !wrapper.hasClass( config.removeLeftSidebarClass ) ){
          body.addClass( config.openLeftSidebarClass + " " + config.transitionClass );
          openSidebar = true;
        }
      },
      swipeLeft: function(e){
        if( !openSidebar && rightSidebar.length > 0 ){
          body.addClass( config.openRightSidebarClass + " " + config.transitionClass );
          openSidebar = true;
        }
      },
      threshold: config.swipeTreshold
    });
  }

  function chatWidget(){
    var chat = $(".am-right-sidebar .tab-pane.chat");
    var contactsEl = $(".chat-contacts", chat);
    var conversationEl = $(".chat-window", chat);
    var messagesContainer = $(".chat-messages", conversationEl);
    var messagesList = $(".content > ul", messagesContainer);
    var messagesScrollContent = $(".nano-content", messagesContainer);
    var chatInputContainer = $(".chat-input", conversationEl);
    var chatInput = $("input", chatInputContainer);
    var chatInputSendButton = $(".send-msg", chatInputContainer);

    function openChatWindow(){
      if( !chat.hasClass("chat-opened") ){
        chat.addClass("chat-opened");
        $(".am-scroller", messagesContainer).nanoScroller();
      }
    }

    function closeChatWindow(){
      if( chat.hasClass("chat-opened") ){
        chat.removeClass("chat-opened");
      }
    }

    /*Open Conversation Window when click on chat user*/
    $(".user a", contactsEl).on('click',function( e ){
      $(".am-scroller", contactsEl).nanoScroller({ stop: true });
      openChatWindow();
      e.preventDefault();
    });

    /*Close chat conv window*/
    $(".title .return", conversationEl).on('click',function( e ){
      closeChatWindow();
      scrollerInit();
    });

    /*Send message*/
    function sendMsg(msg, self){
      var $message = $('<li class="' + ((self)?'self':'friend') + '"></li>');

      if( msg != '' ){
        $('<div class="msg">' + msg + '</div>').appendTo($message);
        $message.appendTo(messagesList);

        messagesScrollContent.stop().animate({
          'scrollTop': messagesScrollContent.prop("scrollHeight")
        }, 900, 'swing');

        scrollerInit();
      }
    }

    /*Send msg when click on 'send' button or press 'Enter'*/
      chatInput.keypress(function(event){
        var keycode = (event.keyCode ? event.keyCode : event.which);
        var msg = $(this).val();

        if(keycode == '13'){
          sendMsg(msg, true);
          $(this).val("");
        }
        event.stopPropagation();
      });

      chatInputSendButton.on('click',function(){
        var msg = chatInput.val();
        sendMsg(msg, true);
        chatInput.val("");
      });
  }

  function scrollerInit(){
    $(".am-scroller").nanoScroller();
  }

  function scrollTopButton(){
    var offset = 220;
    var duration = 500;
    var button = $('<div class="am-scroll-top"></div>');
    button.appendTo("body");
    
    $(window).on('scroll',function() {
      if ( $(this).scrollTop() > offset ) {
        button.fadeIn(duration);
      } else {
        button.fadeOut(duration);
      }
    });
  
    button.on('touchstart mouseup',function( e ) {
      $( 'html, body' ).animate({ scrollTop: 0 }, duration);
      e.preventDefault();
    });
  }

  //Wait for final event on window resize
  var waitForFinalEvent = (function () {
    var timers = {};
    return function (callback, ms, uniqueId) {
      if (!uniqueId) {
        uniqueId = "x1x2x3x4";
      }
      if (timers[uniqueId]) {
        clearTimeout (timers[uniqueId]);
      }
      timers[uniqueId] = setTimeout(callback, ms);
    };
  })();

  return {
    //General data
    conf: config,
    color: colors,

    //Init function
    init: function (options) {
      
      //Extends basic config with options
        $.extend( config, options );

      /*FastClick on mobile*/
        FastClick.attach(document.body);

      /*Left Sidebar*/
        leftSidebarInit();
      
      /*Right Sidebar*/
        rightSidebarInit();
        chatWidget();

      /*Sidebars Swipe*/
        sidebarSwipe();

      /*Body transition effect*/
        leftSidebar.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd", function() {
          body.removeClass( config.transitionClass );
        });

      /*Scroll Top button*/
        if( config.scrollTop ){
          scrollTopButton();
        }

      /*Get colors*/
        colors.primary = getColor('clr-primary');
        colors.success = getColor('clr-success');
        colors.info    = getColor('clr-info');
        colors.warning = getColor('clr-warning');
        colors.danger  = getColor('clr-danger');
        colors.alt1    = getColor('clr-alt1');
        colors.alt2    = getColor('clr-alt2');
        colors.alt3    = getColor('clr-alt3');
        colors.alt4    = getColor('clr-alt4');

      //Prevent Connections Dropdown closes on click
        $(".am-connections").on("click",function( e ){
          e.stopPropagation();
        });

      //Nanoscroller init function
        scrollerInit();

      /*Bind plugins on hidden elements*/
      /*Dropdown shown event*/
        $('.dropdown').on('shown.bs.dropdown', function () {
          $(".am-scroller").nanoScroller();
        });
        
      /*Tabs refresh hidden elements*/
        $('.nav-tabs').on('shown.bs.tab', function (e) {
          $(".am-scroller").nanoScroller();
        });

      /*Tooltips*/
        $('[data-toggle="tooltip"]').tooltip();
      
      /*Popover*/
        $('[data-toggle="popover"]').popover();

      /*Bootstrap modal scroll top fix*/
        $('.modal').on('show.bs.modal', function(){
          $("html").addClass('am-modal-open');
        });

        $('.modal').on('hidden.bs.modal', function(){
          $("html").removeClass('am-modal-open');
        });
    },

    //Methods
    closeSubMenu: function(){
      var subMenu = $(".sidebar-elements > li > ul:visible", leftSidebar);
      subMenu.addClass('hide');
      setTimeout(function(){
        subMenu.removeClass('hide');
      }, 50);
    }
  };
 
})();
//FastClick
!function(){"use strict";function a(b,d){function e(a,b){return function(){return a.apply(b,arguments)}}var f;if(d=d||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=d.touchBoundary||10,this.layer=b,this.tapDelay=d.tapDelay||200,this.tapTimeout=d.tapTimeout||700,!a.notNeeded(b)){for(var g=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],h=this,i=0,j=g.length;j>i;i++)h[g[i]]=e(h[g[i]],h);c&&(b.addEventListener("mouseover",this.onMouse,!0),b.addEventListener("mousedown",this.onMouse,!0),b.addEventListener("mouseup",this.onMouse,!0)),b.addEventListener("click",this.onClick,!0),b.addEventListener("touchstart",this.onTouchStart,!1),b.addEventListener("touchmove",this.onTouchMove,!1),b.addEventListener("touchend",this.onTouchEnd,!1),b.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(b.removeEventListener=function(a,c,d){var e=Node.prototype.removeEventListener;"click"===a?e.call(b,a,c.hijacked||c,d):e.call(b,a,c,d)},b.addEventListener=function(a,c,d){var e=Node.prototype.addEventListener;"click"===a?e.call(b,a,c.hijacked||(c.hijacked=function(a){a.propagationStopped||c(a)}),d):e.call(b,a,c,d)}),"function"==typeof b.onclick&&(f=b.onclick,b.addEventListener("click",function(a){f(a)},!1),b.onclick=null)}}var b=navigator.userAgent.indexOf("Windows Phone")>=0,c=navigator.userAgent.indexOf("Android")>0&&!b,d=/iP(ad|hone|od)/.test(navigator.userAgent)&&!b,e=d&&/OS 4_\d(_\d)?/.test(navigator.userAgent),f=d&&/OS [6-7]_\d/.test(navigator.userAgent),g=navigator.userAgent.indexOf("BB10")>0;a.prototype.needsClick=function(a){switch(a.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(a.disabled)return!0;break;case"input":if(d&&"file"===a.type||a.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(a.className)},a.prototype.needsFocus=function(a){switch(a.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!c;case"input":switch(a.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!a.disabled&&!a.readOnly;default:return/\bneedsfocus\b/.test(a.className)}},a.prototype.sendClick=function(a,b){var c,d;document.activeElement&&document.activeElement!==a&&document.activeElement.blur(),d=b.changedTouches[0],c=document.createEvent("MouseEvents"),c.initMouseEvent(this.determineEventType(a),!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),c.forwardedTouchEvent=!0,a.dispatchEvent(c)},a.prototype.determineEventType=function(a){return c&&"select"===a.tagName.toLowerCase()?"mousedown":"click"},a.prototype.focus=function(a){var b;d&&a.setSelectionRange&&0!==a.type.indexOf("date")&&"time"!==a.type&&"month"!==a.type?(b=a.value.length,a.setSelectionRange(b,b)):a.focus()},a.prototype.updateScrollParent=function(a){var b,c;if(b=a.fastClickScrollParent,!b||!b.contains(a)){c=a;do{if(c.scrollHeight>c.offsetHeight){b=c,a.fastClickScrollParent=c;break}c=c.parentElement}while(c)}b&&(b.fastClickLastScrollTop=b.scrollTop)},a.prototype.getTargetElementFromEventTarget=function(a){return a.nodeType===Node.TEXT_NODE?a.parentNode:a},a.prototype.onTouchStart=function(a){var b,c,f;if(a.targetTouches.length>1)return!0;if(b=this.getTargetElementFromEventTarget(a.target),c=a.targetTouches[0],d){if(f=window.getSelection(),f.rangeCount&&!f.isCollapsed)return!0;if(!e){if(c.identifier&&c.identifier===this.lastTouchIdentifier)return a.preventDefault(),!1;this.lastTouchIdentifier=c.identifier,this.updateScrollParent(b)}}return this.trackingClick=!0,this.trackingClickStart=a.timeStamp,this.targetElement=b,this.touchStartX=c.pageX,this.touchStartY=c.pageY,a.timeStamp-this.lastClickTime<this.tapDelay&&a.preventDefault(),!0},a.prototype.touchHasMoved=function(a){var b=a.changedTouches[0],c=this.touchBoundary;return Math.abs(b.pageX-this.touchStartX)>c||Math.abs(b.pageY-this.touchStartY)>c?!0:!1},a.prototype.onTouchMove=function(a){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(a.target)||this.touchHasMoved(a))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},a.prototype.findControl=function(a){return void 0!==a.control?a.control:a.htmlFor?document.getElementById(a.htmlFor):a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},a.prototype.onTouchEnd=function(a){var b,g,h,i,j,k=this.targetElement;if(!this.trackingClick)return!0;if(a.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(a.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=a.timeStamp,g=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,f&&(j=a.changedTouches[0],k=document.elementFromPoint(j.pageX-window.pageXOffset,j.pageY-window.pageYOffset)||k,k.fastClickScrollParent=this.targetElement.fastClickScrollParent),h=k.tagName.toLowerCase(),"label"===h){if(b=this.findControl(k)){if(this.focus(k),c)return!1;k=b}}else if(this.needsFocus(k))return a.timeStamp-g>100||d&&window.top!==window&&"input"===h?(this.targetElement=null,!1):(this.focus(k),this.sendClick(k,a),d&&"select"===h||(this.targetElement=null,a.preventDefault()),!1);return d&&!e&&(i=k.fastClickScrollParent,i&&i.fastClickLastScrollTop!==i.scrollTop)?!0:(this.needsClick(k)||(a.preventDefault(),this.sendClick(k,a)),!1)},a.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},a.prototype.onMouse=function(a){return this.targetElement?a.forwardedTouchEvent?!0:a.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(a.stopImmediatePropagation?a.stopImmediatePropagation():a.propagationStopped=!0,a.stopPropagation(),a.preventDefault(),!1):!0:!0},a.prototype.onClick=function(a){var b;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===a.target.type&&0===a.detail?!0:(b=this.onMouse(a),b||(this.targetElement=null),b)},a.prototype.destroy=function(){var a=this.layer;c&&(a.removeEventListener("mouseover",this.onMouse,!0),a.removeEventListener("mousedown",this.onMouse,!0),a.removeEventListener("mouseup",this.onMouse,!0)),a.removeEventListener("click",this.onClick,!0),a.removeEventListener("touchstart",this.onTouchStart,!1),a.removeEventListener("touchmove",this.onTouchMove,!1),a.removeEventListener("touchend",this.onTouchEnd,!1),a.removeEventListener("touchcancel",this.onTouchCancel,!1)},a.notNeeded=function(a){var b,d,e,f;if("undefined"==typeof window.ontouchstart)return!0;if(d=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!c)return!0;if(b=document.querySelector("meta[name=viewport]")){if(-1!==b.content.indexOf("user-scalable=no"))return!0;if(d>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(g&&(e=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),e[1]>=10&&e[2]>=3&&(b=document.querySelector("meta[name=viewport]")))){if(-1!==b.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===a.style.msTouchAction||"manipulation"===a.style.touchAction?!0:(f=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],f>=27&&(b=document.querySelector("meta[name=viewport]"),b&&(-1!==b.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===a.style.touchAction||"manipulation"===a.style.touchAction?!0:!1)},a.attach=function(b,c){return new a(b,c)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return a}):"undefined"!=typeof module&&module.exports?(module.exports=a.attach,module.exports.FastClick=a):window.FastClick=a}();
// TinyColor v1.2.1
// https://github.com/bgrins/TinyColor
// 2015-08-13, Brian Grinstead, MIT License
!function(){function tinycolor(color,opts){if(color=color?color:"",opts=opts||{},color instanceof tinycolor)return color;if(!(this instanceof tinycolor))return new tinycolor(color,opts);var rgb=inputToRGB(color);this._originalInput=color,this._r=rgb.r,this._g=rgb.g,this._b=rgb.b,this._a=rgb.a,this._roundA=mathRound(100*this._a)/100,this._format=opts.format||rgb.format,this._gradientType=opts.gradientType,this._r<1&&(this._r=mathRound(this._r)),this._g<1&&(this._g=mathRound(this._g)),this._b<1&&(this._b=mathRound(this._b)),this._ok=rgb.ok,this._tc_id=tinyCounter++}function inputToRGB(color){var rgb={r:0,g:0,b:0},a=1,ok=!1,format=!1;return"string"==typeof color&&(color=stringInputToObject(color)),"object"==typeof color&&(color.hasOwnProperty("r")&&color.hasOwnProperty("g")&&color.hasOwnProperty("b")?(rgb=rgbToRgb(color.r,color.g,color.b),ok=!0,format="%"===String(color.r).substr(-1)?"prgb":"rgb"):color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("v")?(color.s=convertToPercentage(color.s),color.v=convertToPercentage(color.v),rgb=hsvToRgb(color.h,color.s,color.v),ok=!0,format="hsv"):color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("l")&&(color.s=convertToPercentage(color.s),color.l=convertToPercentage(color.l),rgb=hslToRgb(color.h,color.s,color.l),ok=!0,format="hsl"),color.hasOwnProperty("a")&&(a=color.a)),a=boundAlpha(a),{ok:ok,format:color.format||format,r:mathMin(255,mathMax(rgb.r,0)),g:mathMin(255,mathMax(rgb.g,0)),b:mathMin(255,mathMax(rgb.b,0)),a:a}}function rgbToRgb(r,g,b){return{r:255*bound01(r,255),g:255*bound01(g,255),b:255*bound01(b,255)}}function rgbToHsl(r,g,b){r=bound01(r,255),g=bound01(g,255),b=bound01(b,255);var h,s,max=mathMax(r,g,b),min=mathMin(r,g,b),l=(max+min)/2;if(max==min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(b>g?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,l:l}}function hslToRgb(h,s,l){function hue2rgb(p,q,t){return 0>t&&(t+=1),t>1&&(t-=1),1/6>t?p+6*(q-p)*t:.5>t?q:2/3>t?p+6*(q-p)*(2/3-t):p}var r,g,b;if(h=bound01(h,360),s=bound01(s,100),l=bound01(l,100),0===s)r=g=b=l;else{var q=.5>l?l*(1+s):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)}return{r:255*r,g:255*g,b:255*b}}function rgbToHsv(r,g,b){r=bound01(r,255),g=bound01(g,255),b=bound01(b,255);var h,s,max=mathMax(r,g,b),min=mathMin(r,g,b),v=max,d=max-min;if(s=0===max?0:d/max,max==min)h=0;else{switch(max){case r:h=(g-b)/d+(b>g?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,v:v}}function hsvToRgb(h,s,v){h=6*bound01(h,360),s=bound01(s,100),v=bound01(v,100);var i=math.floor(h),f=h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),mod=i%6,r=[v,q,p,p,t,v][mod],g=[t,v,v,q,p,p][mod],b=[p,p,t,v,v,q][mod];return{r:255*r,g:255*g,b:255*b}}function rgbToHex(r,g,b,allow3Char){var hex=[pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];return allow3Char&&hex[0].charAt(0)==hex[0].charAt(1)&&hex[1].charAt(0)==hex[1].charAt(1)&&hex[2].charAt(0)==hex[2].charAt(1)?hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0):hex.join("")}function rgbaToHex(r,g,b,a){var hex=[pad2(convertDecimalToHex(a)),pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];return hex.join("")}function desaturate(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.s-=amount/100,hsl.s=clamp01(hsl.s),tinycolor(hsl)}function saturate(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.s+=amount/100,hsl.s=clamp01(hsl.s),tinycolor(hsl)}function greyscale(color){return tinycolor(color).desaturate(100)}function lighten(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.l+=amount/100,hsl.l=clamp01(hsl.l),tinycolor(hsl)}function brighten(color,amount){amount=0===amount?0:amount||10;var rgb=tinycolor(color).toRgb();return rgb.r=mathMax(0,mathMin(255,rgb.r-mathRound(255*-(amount/100)))),rgb.g=mathMax(0,mathMin(255,rgb.g-mathRound(255*-(amount/100)))),rgb.b=mathMax(0,mathMin(255,rgb.b-mathRound(255*-(amount/100)))),tinycolor(rgb)}function darken(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.l-=amount/100,hsl.l=clamp01(hsl.l),tinycolor(hsl)}function spin(color,amount){var hsl=tinycolor(color).toHsl(),hue=(mathRound(hsl.h)+amount)%360;return hsl.h=0>hue?360+hue:hue,tinycolor(hsl)}function complement(color){var hsl=tinycolor(color).toHsl();return hsl.h=(hsl.h+180)%360,tinycolor(hsl)}function triad(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+120)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+240)%360,s:hsl.s,l:hsl.l})]}function tetrad(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+90)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+180)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+270)%360,s:hsl.s,l:hsl.l})]}function splitcomplement(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+72)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+216)%360,s:hsl.s,l:hsl.l})]}function analogous(color,results,slices){results=results||6,slices=slices||30;var hsl=tinycolor(color).toHsl(),part=360/slices,ret=[tinycolor(color)];for(hsl.h=(hsl.h-(part*results>>1)+720)%360;--results;)hsl.h=(hsl.h+part)%360,ret.push(tinycolor(hsl));return ret}function monochromatic(color,results){results=results||6;for(var hsv=tinycolor(color).toHsv(),h=hsv.h,s=hsv.s,v=hsv.v,ret=[],modification=1/results;results--;)ret.push(tinycolor({h:h,s:s,v:v})),v=(v+modification)%1;return ret}function flip(o){var flipped={};for(var i in o)o.hasOwnProperty(i)&&(flipped[o[i]]=i);return flipped}function boundAlpha(a){return a=parseFloat(a),(isNaN(a)||0>a||a>1)&&(a=1),a}function bound01(n,max){isOnePointZero(n)&&(n="100%");var processPercent=isPercentage(n);return n=mathMin(max,mathMax(0,parseFloat(n))),processPercent&&(n=parseInt(n*max,10)/100),math.abs(n-max)<1e-6?1:n%max/parseFloat(max)}function clamp01(val){return mathMin(1,mathMax(0,val))}function parseIntFromHex(val){return parseInt(val,16)}function isOnePointZero(n){return"string"==typeof n&&-1!=n.indexOf(".")&&1===parseFloat(n)}function isPercentage(n){return"string"==typeof n&&-1!=n.indexOf("%")}function pad2(c){return 1==c.length?"0"+c:""+c}function convertToPercentage(n){return 1>=n&&(n=100*n+"%"),n}function convertDecimalToHex(d){return Math.round(255*parseFloat(d)).toString(16)}function convertHexToDecimal(h){return parseIntFromHex(h)/255}function stringInputToObject(color){color=color.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var named=!1;if(names[color])color=names[color],named=!0;else if("transparent"==color)return{r:0,g:0,b:0,a:0,format:"name"};var match;return(match=matchers.rgb.exec(color))?{r:match[1],g:match[2],b:match[3]}:(match=matchers.rgba.exec(color))?{r:match[1],g:match[2],b:match[3],a:match[4]}:(match=matchers.hsl.exec(color))?{h:match[1],s:match[2],l:match[3]}:(match=matchers.hsla.exec(color))?{h:match[1],s:match[2],l:match[3],a:match[4]}:(match=matchers.hsv.exec(color))?{h:match[1],s:match[2],v:match[3]}:(match=matchers.hsva.exec(color))?{h:match[1],s:match[2],v:match[3],a:match[4]}:(match=matchers.hex8.exec(color))?{a:convertHexToDecimal(match[1]),r:parseIntFromHex(match[2]),g:parseIntFromHex(match[3]),b:parseIntFromHex(match[4]),format:named?"name":"hex8"}:(match=matchers.hex6.exec(color))?{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),format:named?"name":"hex"}:(match=matchers.hex3.exec(color))?{r:parseIntFromHex(match[1]+""+match[1]),g:parseIntFromHex(match[2]+""+match[2]),b:parseIntFromHex(match[3]+""+match[3]),format:named?"name":"hex"}:!1}function validateWCAG2Parms(parms){var level,size;return parms=parms||{level:"AA",size:"small"},level=(parms.level||"AA").toUpperCase(),size=(parms.size||"small").toLowerCase(),"AA"!==level&&"AAA"!==level&&(level="AA"),"small"!==size&&"large"!==size&&(size="small"),{level:level,size:size}}var trimLeft=/^[\s,#]+/,trimRight=/\s+$/,tinyCounter=0,math=Math,mathRound=math.round,mathMin=math.min,mathMax=math.max,mathRandom=math.random;tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var rgb=this.toRgb();return(299*rgb.r+587*rgb.g+114*rgb.b)/1e3},getLuminance:function(){var RsRGB,GsRGB,BsRGB,R,G,B,rgb=this.toRgb();return RsRGB=rgb.r/255,GsRGB=rgb.g/255,BsRGB=rgb.b/255,R=.03928>=RsRGB?RsRGB/12.92:Math.pow((RsRGB+.055)/1.055,2.4),G=.03928>=GsRGB?GsRGB/12.92:Math.pow((GsRGB+.055)/1.055,2.4),B=.03928>=BsRGB?BsRGB/12.92:Math.pow((BsRGB+.055)/1.055,2.4),.2126*R+.7152*G+.0722*B},setAlpha:function(value){return this._a=boundAlpha(value),this._roundA=mathRound(100*this._a)/100,this},toHsv:function(){var hsv=rgbToHsv(this._r,this._g,this._b);return{h:360*hsv.h,s:hsv.s,v:hsv.v,a:this._a}},toHsvString:function(){var hsv=rgbToHsv(this._r,this._g,this._b),h=mathRound(360*hsv.h),s=mathRound(100*hsv.s),v=mathRound(100*hsv.v);return 1==this._a?"hsv("+h+", "+s+"%, "+v+"%)":"hsva("+h+", "+s+"%, "+v+"%, "+this._roundA+")"},toHsl:function(){var hsl=rgbToHsl(this._r,this._g,this._b);return{h:360*hsl.h,s:hsl.s,l:hsl.l,a:this._a}},toHslString:function(){var hsl=rgbToHsl(this._r,this._g,this._b),h=mathRound(360*hsl.h),s=mathRound(100*hsl.s),l=mathRound(100*hsl.l);return 1==this._a?"hsl("+h+", "+s+"%, "+l+"%)":"hsla("+h+", "+s+"%, "+l+"%, "+this._roundA+")"},toHex:function(allow3Char){return rgbToHex(this._r,this._g,this._b,allow3Char)},toHexString:function(allow3Char){return"#"+this.toHex(allow3Char)},toHex8:function(){return rgbaToHex(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:mathRound(this._r),g:mathRound(this._g),b:mathRound(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+")":"rgba("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:mathRound(100*bound01(this._r,255))+"%",g:mathRound(100*bound01(this._g,255))+"%",b:mathRound(100*bound01(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+mathRound(100*bound01(this._r,255))+"%, "+mathRound(100*bound01(this._g,255))+"%, "+mathRound(100*bound01(this._b,255))+"%)":"rgba("+mathRound(100*bound01(this._r,255))+"%, "+mathRound(100*bound01(this._g,255))+"%, "+mathRound(100*bound01(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1},toFilter:function(secondColor){var hex8String="#"+rgbaToHex(this._r,this._g,this._b,this._a),secondHex8String=hex8String,gradientType=this._gradientType?"GradientType = 1, ":"";if(secondColor){var s=tinycolor(secondColor);secondHex8String=s.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr="+hex8String+",endColorstr="+secondHex8String+")"},toString:function(format){var formatSet=!!format;format=format||this._format;var formattedString=!1,hasAlpha=this._a<1&&this._a>=0,needsAlphaFormat=!formatSet&&hasAlpha&&("hex"===format||"hex6"===format||"hex3"===format||"name"===format);return needsAlphaFormat?"name"===format&&0===this._a?this.toName():this.toRgbString():("rgb"===format&&(formattedString=this.toRgbString()),"prgb"===format&&(formattedString=this.toPercentageRgbString()),("hex"===format||"hex6"===format)&&(formattedString=this.toHexString()),"hex3"===format&&(formattedString=this.toHexString(!0)),"hex8"===format&&(formattedString=this.toHex8String()),"name"===format&&(formattedString=this.toName()),"hsl"===format&&(formattedString=this.toHslString()),"hsv"===format&&(formattedString=this.toHsvString()),formattedString||this.toHexString())},_applyModification:function(fn,args){var color=fn.apply(null,[this].concat([].slice.call(args)));return this._r=color._r,this._g=color._g,this._b=color._b,this.setAlpha(color._a),this},lighten:function(){return this._applyModification(lighten,arguments)},brighten:function(){return this._applyModification(brighten,arguments)},darken:function(){return this._applyModification(darken,arguments)},desaturate:function(){return this._applyModification(desaturate,arguments)},saturate:function(){return this._applyModification(saturate,arguments)},greyscale:function(){return this._applyModification(greyscale,arguments)},spin:function(){return this._applyModification(spin,arguments)},_applyCombination:function(fn,args){return fn.apply(null,[this].concat([].slice.call(args)))},analogous:function(){return this._applyCombination(analogous,arguments)},complement:function(){return this._applyCombination(complement,arguments)},monochromatic:function(){return this._applyCombination(monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(splitcomplement,arguments)},triad:function(){return this._applyCombination(triad,arguments)},tetrad:function(){return this._applyCombination(tetrad,arguments)}},tinycolor.fromRatio=function(color,opts){if("object"==typeof color){var newColor={};for(var i in color)color.hasOwnProperty(i)&&(newColor[i]="a"===i?color[i]:convertToPercentage(color[i]));color=newColor}return tinycolor(color,opts)},tinycolor.equals=function(color1,color2){return color1&&color2?tinycolor(color1).toRgbString()==tinycolor(color2).toRgbString():!1},tinycolor.random=function(){return tinycolor.fromRatio({r:mathRandom(),g:mathRandom(),b:mathRandom()})},tinycolor.mix=function(color1,color2,amount){amount=0===amount?0:amount||50;var w1,rgb1=tinycolor(color1).toRgb(),rgb2=tinycolor(color2).toRgb(),p=amount/100,w=2*p-1,a=rgb2.a-rgb1.a;w1=-1==w*a?w:(w+a)/(1+w*a),w1=(w1+1)/2;var w2=1-w1,rgba={r:rgb2.r*w1+rgb1.r*w2,g:rgb2.g*w1+rgb1.g*w2,b:rgb2.b*w1+rgb1.b*w2,a:rgb2.a*p+rgb1.a*(1-p)};return tinycolor(rgba)},tinycolor.readability=function(color1,color2){var c1=tinycolor(color1),c2=tinycolor(color2);return(Math.max(c1.getLuminance(),c2.getLuminance())+.05)/(Math.min(c1.getLuminance(),c2.getLuminance())+.05)},tinycolor.isReadable=function(color1,color2,wcag2){var wcag2Parms,out,readability=tinycolor.readability(color1,color2);switch(out=!1,wcag2Parms=validateWCAG2Parms(wcag2),wcag2Parms.level+wcag2Parms.size){case"AAsmall":case"AAAlarge":out=readability>=4.5;break;case"AAlarge":out=readability>=3;break;case"AAAsmall":out=readability>=7}return out},tinycolor.mostReadable=function(baseColor,colorList,args){var readability,includeFallbackColors,level,size,bestColor=null,bestScore=0;args=args||{},includeFallbackColors=args.includeFallbackColors,level=args.level,size=args.size;for(var i=0;i<colorList.length;i++)readability=tinycolor.readability(baseColor,colorList[i]),readability>bestScore&&(bestScore=readability,bestColor=tinycolor(colorList[i]));return tinycolor.isReadable(baseColor,bestColor,{level:level,size:size})||!includeFallbackColors?bestColor:(args.includeFallbackColors=!1,tinycolor.mostReadable(baseColor,["#fff","#000"],args))};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names),matchers=function(){var CSS_INTEGER="[-\\+]?\\d+%?",CSS_NUMBER="[-\\+]?\\d*\\.\\d+%?",CSS_UNIT="(?:"+CSS_NUMBER+")|(?:"+CSS_INTEGER+")",PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";return{rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();"undefined"!=typeof module&&module.exports?module.exports=tinycolor:"function"==typeof define&&define.amd?define(function(){return tinycolor}):window.tinycolor=tinycolor}();
(function(a){if(typeof define==="function"&&define.amd&&define.amd.jQuery){define(["jquery"],a)}else{a(jQuery)}}(function(f){var y="1.6.12",p="left",o="right",e="up",x="down",c="in",A="out",m="none",s="auto",l="swipe",t="pinch",B="tap",j="doubletap",b="longtap",z="hold",E="horizontal",u="vertical",i="all",r=10,g="start",k="move",h="end",q="cancel",a="ontouchstart" in window,v=window.navigator.msPointerEnabled&&!window.navigator.pointerEnabled,d=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,C="TouchSwipe";var n={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,hold:null,triggerOnTouchEnd:true,triggerOnTouchLeave:false,allowPageScroll:"auto",fallbackToMouseEvents:true,excludedElements:"label, button, input, select, textarea, a, .noSwipe",preventDefaultEvents:true};f.fn.swipe=function(H){var G=f(this),F=G.data(C);if(F&&typeof H==="string"){if(F[H]){return F[H].apply(this,Array.prototype.slice.call(arguments,1))}else{f.error("Method "+H+" does not exist on jQuery.swipe")}}else{if(F&&typeof H==="object"){F.option.apply(this,arguments)}else{if(!F&&(typeof H==="object"||!H)){return w.apply(this,arguments)}}}return G};f.fn.swipe.version=y;f.fn.swipe.defaults=n;f.fn.swipe.phases={PHASE_START:g,PHASE_MOVE:k,PHASE_END:h,PHASE_CANCEL:q};f.fn.swipe.directions={LEFT:p,RIGHT:o,UP:e,DOWN:x,IN:c,OUT:A};f.fn.swipe.pageScroll={NONE:m,HORIZONTAL:E,VERTICAL:u,AUTO:s};f.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,ALL:i};function w(F){if(F&&(F.allowPageScroll===undefined&&(F.swipe!==undefined||F.swipeStatus!==undefined))){F.allowPageScroll=m}if(F.click!==undefined&&F.tap===undefined){F.tap=F.click}if(!F){F={}}F=f.extend({},f.fn.swipe.defaults,F);return this.each(function(){var H=f(this);var G=H.data(C);if(!G){G=new D(this,F);H.data(C,G)}})}function D(a4,au){var au=f.extend({},au);var az=(a||d||!au.fallbackToMouseEvents),K=az?(d?(v?"MSPointerDown":"pointerdown"):"touchstart"):"mousedown",ax=az?(d?(v?"MSPointerMove":"pointermove"):"touchmove"):"mousemove",V=az?(d?(v?"MSPointerUp":"pointerup"):"touchend"):"mouseup",T=az?null:"mouseleave",aD=(d?(v?"MSPointerCancel":"pointercancel"):"touchcancel");var ag=0,aP=null,ac=0,a1=0,aZ=0,H=1,ap=0,aJ=0,N=null;var aR=f(a4);var aa="start";var X=0;var aQ={};var U=0,a2=0,a5=0,ay=0,O=0;var aW=null,af=null;try{aR.bind(K,aN);aR.bind(aD,a9)}catch(aj){f.error("events not supported "+K+","+aD+" on jQuery.swipe")}this.enable=function(){aR.bind(K,aN);aR.bind(aD,a9);return aR};this.disable=function(){aK();return aR};this.destroy=function(){aK();aR.data(C,null);aR=null};this.option=function(bc,bb){if(typeof bc==="object"){au=f.extend(au,bc)}else{if(au[bc]!==undefined){if(bb===undefined){return au[bc]}else{au[bc]=bb}}else{if(!bc){return au}else{f.error("Option "+bc+" does not exist on jQuery.swipe.options")}}}return null};function aN(bd){if(aB()){return}if(f(bd.target).closest(au.excludedElements,aR).length>0){return}var be=bd.originalEvent?bd.originalEvent:bd;var bc,bf=be.touches,bb=bf?bf[0]:be;aa=g;if(bf){X=bf.length}else{if(au.preventDefaultEvents!==false){bd.preventDefault()}}ag=0;aP=null;aJ=null;ac=0;a1=0;aZ=0;H=1;ap=0;N=ab();S();ai(0,bb);if(!bf||(X===au.fingers||au.fingers===i)||aX()){U=ar();if(X==2){ai(1,bf[1]);a1=aZ=at(aQ[0].start,aQ[1].start)}if(au.swipeStatus||au.pinchStatus){bc=P(be,aa)}}else{bc=false}if(bc===false){aa=q;P(be,aa);return bc}else{if(au.hold){af=setTimeout(f.proxy(function(){aR.trigger("hold",[be.target]);if(au.hold){bc=au.hold.call(aR,be,be.target)}},this),au.longTapThreshold)}an(true)}return null}function a3(be){var bh=be.originalEvent?be.originalEvent:be;if(aa===h||aa===q||al()){return}var bd,bi=bh.touches,bc=bi?bi[0]:bh;var bf=aH(bc);a2=ar();if(bi){X=bi.length}if(au.hold){clearTimeout(af)}aa=k;if(X==2){if(a1==0){ai(1,bi[1]);a1=aZ=at(aQ[0].start,aQ[1].start)}else{aH(bi[1]);aZ=at(aQ[0].end,aQ[1].end);aJ=aq(aQ[0].end,aQ[1].end)}H=a7(a1,aZ);ap=Math.abs(a1-aZ)}if((X===au.fingers||au.fingers===i)||!bi||aX()){aP=aL(bf.start,bf.end);ak(be,aP);ag=aS(bf.start,bf.end);ac=aM();aI(aP,ag);if(au.swipeStatus||au.pinchStatus){bd=P(bh,aa)}if(!au.triggerOnTouchEnd||au.triggerOnTouchLeave){var bb=true;if(au.triggerOnTouchLeave){var bg=aY(this);bb=F(bf.end,bg)}if(!au.triggerOnTouchEnd&&bb){aa=aC(k)}else{if(au.triggerOnTouchLeave&&!bb){aa=aC(h)}}if(aa==q||aa==h){P(bh,aa)}}}else{aa=q;P(bh,aa)}if(bd===false){aa=q;P(bh,aa)}}function M(bb){var bc=bb.originalEvent?bb.originalEvent:bb,bd=bc.touches;if(bd){if(bd.length&&!al()){G();return true}else{if(bd.length&&al()){return true}}}if(al()){X=ay}a2=ar();ac=aM();if(ba()||!am()){aa=q;P(bc,aa)}else{if(au.triggerOnTouchEnd||(au.triggerOnTouchEnd==false&&aa===k)){if(au.preventDefaultEvents!==false){bb.preventDefault()}aa=h;P(bc,aa)}else{if(!au.triggerOnTouchEnd&&a6()){aa=h;aF(bc,aa,B)}else{if(aa===k){aa=q;P(bc,aa)}}}}an(false);return null}function a9(){X=0;a2=0;U=0;a1=0;aZ=0;H=1;S();an(false)}function L(bb){var bc=bb.originalEvent?bb.originalEvent:bb;if(au.triggerOnTouchLeave){aa=aC(h);P(bc,aa)}}function aK(){aR.unbind(K,aN);aR.unbind(aD,a9);aR.unbind(ax,a3);aR.unbind(V,M);if(T){aR.unbind(T,L)}an(false)}function aC(bf){var be=bf;var bd=aA();var bc=am();var bb=ba();if(!bd||bb){be=q}else{if(bc&&bf==k&&(!au.triggerOnTouchEnd||au.triggerOnTouchLeave)){be=h}else{if(!bc&&bf==h&&au.triggerOnTouchLeave){be=q}}}return be}function P(bd,bb){var bc,be=bd.touches;if((J()&&W())||(Q()&&aX())){if(J()&&W()){bc=aF(bd,bb,l)}if((Q()&&aX())&&bc!==false){bc=aF(bd,bb,t)}}else{if(aG()&&bc!==false){bc=aF(bd,bb,j)}else{if(ao()&&bc!==false){bc=aF(bd,bb,b)}else{if(ah()&&bc!==false){bc=aF(bd,bb,B)}}}}if(bb===q){if(W()){bc=aF(bd,bb,l)}if(aX()){bc=aF(bd,bb,t)}a9(bd)}if(bb===h){if(be){if(!be.length){a9(bd)}}else{a9(bd)}}return bc}function aF(be,bb,bd){var bc;if(bd==l){aR.trigger("swipeStatus",[bb,aP||null,ag||0,ac||0,X,aQ]);if(au.swipeStatus){bc=au.swipeStatus.call(aR,be,bb,aP||null,ag||0,ac||0,X,aQ);if(bc===false){return false}}if(bb==h&&aV()){aR.trigger("swipe",[aP,ag,ac,X,aQ]);if(au.swipe){bc=au.swipe.call(aR,be,aP,ag,ac,X,aQ);if(bc===false){return false}}switch(aP){case p:aR.trigger("swipeLeft",[aP,ag,ac,X,aQ]);if(au.swipeLeft){bc=au.swipeLeft.call(aR,be,aP,ag,ac,X,aQ)}break;case o:aR.trigger("swipeRight",[aP,ag,ac,X,aQ]);if(au.swipeRight){bc=au.swipeRight.call(aR,be,aP,ag,ac,X,aQ)}break;case e:aR.trigger("swipeUp",[aP,ag,ac,X,aQ]);if(au.swipeUp){bc=au.swipeUp.call(aR,be,aP,ag,ac,X,aQ)}break;case x:aR.trigger("swipeDown",[aP,ag,ac,X,aQ]);if(au.swipeDown){bc=au.swipeDown.call(aR,be,aP,ag,ac,X,aQ)}break}}}if(bd==t){aR.trigger("pinchStatus",[bb,aJ||null,ap||0,ac||0,X,H,aQ]);if(au.pinchStatus){bc=au.pinchStatus.call(aR,be,bb,aJ||null,ap||0,ac||0,X,H,aQ);if(bc===false){return false}}if(bb==h&&a8()){switch(aJ){case c:aR.trigger("pinchIn",[aJ||null,ap||0,ac||0,X,H,aQ]);if(au.pinchIn){bc=au.pinchIn.call(aR,be,aJ||null,ap||0,ac||0,X,H,aQ)}break;case A:aR.trigger("pinchOut",[aJ||null,ap||0,ac||0,X,H,aQ]);if(au.pinchOut){bc=au.pinchOut.call(aR,be,aJ||null,ap||0,ac||0,X,H,aQ)}break}}}if(bd==B){if(bb===q||bb===h){clearTimeout(aW);clearTimeout(af);if(Z()&&!I()){O=ar();aW=setTimeout(f.proxy(function(){O=null;aR.trigger("tap",[be.target]);if(au.tap){bc=au.tap.call(aR,be,be.target)}},this),au.doubleTapThreshold)}else{O=null;aR.trigger("tap",[be.target]);if(au.tap){bc=au.tap.call(aR,be,be.target)}}}}else{if(bd==j){if(bb===q||bb===h){clearTimeout(aW);O=null;aR.trigger("doubletap",[be.target]);if(au.doubleTap){bc=au.doubleTap.call(aR,be,be.target)}}}else{if(bd==b){if(bb===q||bb===h){clearTimeout(aW);O=null;aR.trigger("longtap",[be.target]);if(au.longTap){bc=au.longTap.call(aR,be,be.target)}}}}}return bc}function am(){var bb=true;if(au.threshold!==null){bb=ag>=au.threshold}return bb}function ba(){var bb=false;if(au.cancelThreshold!==null&&aP!==null){bb=(aT(aP)-ag)>=au.cancelThreshold}return bb}function ae(){if(au.pinchThreshold!==null){return ap>=au.pinchThreshold}return true}function aA(){var bb;if(au.maxTimeThreshold){if(ac>=au.maxTimeThreshold){bb=false}else{bb=true}}else{bb=true}return bb}function ak(bb,bc){if(au.preventDefaultEvents===false){return}if(au.allowPageScroll===m){bb.preventDefault()}else{var bd=au.allowPageScroll===s;switch(bc){case p:if((au.swipeLeft&&bd)||(!bd&&au.allowPageScroll!=E)){bb.preventDefault()}break;case o:if((au.swipeRight&&bd)||(!bd&&au.allowPageScroll!=E)){bb.preventDefault()}break;case e:if((au.swipeUp&&bd)||(!bd&&au.allowPageScroll!=u)){bb.preventDefault()}break;case x:if((au.swipeDown&&bd)||(!bd&&au.allowPageScroll!=u)){bb.preventDefault()}break}}}function a8(){var bc=aO();var bb=Y();var bd=ae();return bc&&bb&&bd}function aX(){return !!(au.pinchStatus||au.pinchIn||au.pinchOut)}function Q(){return !!(a8()&&aX())}function aV(){var be=aA();var bg=am();var bd=aO();var bb=Y();var bc=ba();var bf=!bc&&bb&&bd&&bg&&be;return bf}function W(){return !!(au.swipe||au.swipeStatus||au.swipeLeft||au.swipeRight||au.swipeUp||au.swipeDown)}function J(){return !!(aV()&&W())}function aO(){return((X===au.fingers||au.fingers===i)||!a)}function Y(){return aQ[0].end.x!==0}function a6(){return !!(au.tap)}function Z(){return !!(au.doubleTap)}function aU(){return !!(au.longTap)}function R(){if(O==null){return false}var bb=ar();return(Z()&&((bb-O)<=au.doubleTapThreshold))}function I(){return R()}function aw(){return((X===1||!a)&&(isNaN(ag)||ag<au.threshold))}function a0(){return((ac>au.longTapThreshold)&&(ag<r))}function ah(){return !!(aw()&&a6())}function aG(){return !!(R()&&Z())}function ao(){return !!(a0()&&aU())}function G(){a5=ar();ay=event.touches.length+1}function S(){a5=0;ay=0}function al(){var bb=false;if(a5){var bc=ar()-a5;if(bc<=au.fingerReleaseThreshold){bb=true}}return bb}function aB(){return !!(aR.data(C+"_intouch")===true)}function an(bb){if(bb===true){aR.bind(ax,a3);aR.bind(V,M);if(T){aR.bind(T,L)}}else{aR.unbind(ax,a3,false);aR.unbind(V,M,false);if(T){aR.unbind(T,L,false)}}aR.data(C+"_intouch",bb===true)}function ai(bd,bb){var bc={start:{x:0,y:0},end:{x:0,y:0}};bc.start.x=bc.end.x=bb.pageX||bb.clientX;bc.start.y=bc.end.y=bb.pageY||bb.clientY;aQ[bd]=bc;return bc}function aH(bb){var bd=bb.identifier!==undefined?bb.identifier:0;var bc=ad(bd);if(bc===null){bc=ai(bd,bb)}bc.end.x=bb.pageX||bb.clientX;bc.end.y=bb.pageY||bb.clientY;return bc}function ad(bb){return aQ[bb]||null}function aI(bb,bc){bc=Math.max(bc,aT(bb));N[bb].distance=bc}function aT(bb){if(N[bb]){return N[bb].distance}return undefined}function ab(){var bb={};bb[p]=av(p);bb[o]=av(o);bb[e]=av(e);bb[x]=av(x);return bb}function av(bb){return{direction:bb,distance:0}}function aM(){return a2-U}function at(be,bd){var bc=Math.abs(be.x-bd.x);var bb=Math.abs(be.y-bd.y);return Math.round(Math.sqrt(bc*bc+bb*bb))}function a7(bb,bc){var bd=(bc/bb)*1;return bd.toFixed(2)}function aq(){if(H<1){return A}else{return c}}function aS(bc,bb){return Math.round(Math.sqrt(Math.pow(bb.x-bc.x,2)+Math.pow(bb.y-bc.y,2)))}function aE(be,bc){var bb=be.x-bc.x;var bg=bc.y-be.y;var bd=Math.atan2(bg,bb);var bf=Math.round(bd*180/Math.PI);if(bf<0){bf=360-Math.abs(bf)}return bf}function aL(bc,bb){var bd=aE(bc,bb);if((bd<=45)&&(bd>=0)){return p}else{if((bd<=360)&&(bd>=315)){return p}else{if((bd>=135)&&(bd<=225)){return o}else{if((bd>45)&&(bd<135)){return x}else{return e}}}}}function ar(){var bb=new Date();return bb.getTime()}function aY(bb){bb=f(bb);var bd=bb.offset();var bc={left:bd.left,right:bd.left+bb.outerWidth(),top:bd.top,bottom:bd.top+bb.outerHeight()};return bc}function F(bb,bc){return(bb.x>bc.left&&bb.x<bc.right&&bb.y>bc.top&&bb.y<bc.bottom)}}}));
/*!
 * jQuery bootstrap 3 breakpoint check
 * Check the current visibility of bootstrap 3 breakpoints
 *
 * @example `$.isXs()` function alias for `$.isBreakpoint("xs")`
 * @example `$.isSm()` function alias for `$.isBreakpoint("sm")`
 * @example `$.isMd()` function alias for `$.isBreakpoint("md")`
 * @example `$.isLg()` function alias for `$.isBreakpoint("lg")`
 * @version 1.0.0
 * @copyright Jens A. (cakebake) and other contributors
 * @license Released under the MIT license
 */
!function(a){a.isBreakpoint=function(b){var c,d;return c=a("<div/>",{"class":"visible-"+b}).appendTo("body"),d=c.is(":visible"),c.remove(),d},a.extend(a,{isXs:function(){return a.isBreakpoint("xs")},isSm:function(){return a.isBreakpoint("sm")},isMd:function(){return a.isBreakpoint("md")},isLg:function(){return a.isBreakpoint("lg")}})}(jQuery);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRoZUFkbWluLmpzIiwianF1ZXJ5Lm5hbm9zY3JvbGxlci5qcyIsImpxdWVyeS5zcGFya2xpbmUuanMiLCJtYWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hnR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJUaGVBZG1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbbnVsbCwiLyohIG5hbm9TY3JvbGxlckpTIC0gdjAuOC43IC0gMjAxNVxuKiBodHRwOi8vamFtZXNmbG9yZW50aW5vLmdpdGh1Yi5jb20vbmFub1Njcm9sbGVySlMvXG4qIENvcHlyaWdodCAoYykgMjAxNSBKYW1lcyBGbG9yZW50aW5vOyBMaWNlbnNlZCBNSVQgKi9cbihmdW5jdGlvbihmYWN0b3J5KSB7XG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICByZXR1cm4gZGVmaW5lKFsnanF1ZXJ5J10sIGZ1bmN0aW9uKCQpIHtcbiAgICAgIHJldHVybiBmYWN0b3J5KCQsIHdpbmRvdywgZG9jdW1lbnQpO1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnanF1ZXJ5JyksIHdpbmRvdywgZG9jdW1lbnQpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBmYWN0b3J5KGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCk7XG4gIH1cbn0pKGZ1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG4gIHZhciBCUk9XU0VSX0lTX0lFNywgQlJPV1NFUl9TQ1JPTExCQVJfV0lEVEgsIERPTVNDUk9MTCwgRE9XTiwgRFJBRywgRU5URVIsIEtFWURPV04sIEtFWVVQLCBNT1VTRURPV04sIE1PVVNFRU5URVIsIE1PVVNFTU9WRSwgTU9VU0VVUCwgTU9VU0VXSEVFTCwgTmFub1Njcm9sbCwgUEFORURPV04sIFJFU0laRSwgU0NST0xMLCBTQ1JPTExCQVIsIFRPVUNITU9WRSwgVVAsIFdIRUVMLCBjQUYsIGRlZmF1bHRzLCBnZXRCcm93c2VyU2Nyb2xsYmFyV2lkdGgsIGhhc1RyYW5zZm9ybSwgaXNGRldpdGhCdWdneVNjcm9sbGJhciwgckFGLCB0cmFuc2Zvcm0sIF9lbGVtZW50U3R5bGUsIF9wcmVmaXhTdHlsZSwgX3ZlbmRvcjtcbiAgZGVmYXVsdHMgPSB7XG5cbiAgICAvKipcbiAgICAgIGEgY2xhc3NuYW1lIGZvciB0aGUgcGFuZSBlbGVtZW50LlxuICAgICAgQHByb3BlcnR5IHBhbmVDbGFzc1xuICAgICAgQHR5cGUgU3RyaW5nXG4gICAgICBAZGVmYXVsdCAnbmFuby1wYW5lJ1xuICAgICAqL1xuICAgIHBhbmVDbGFzczogJ25hbm8tcGFuZScsXG5cbiAgICAvKipcbiAgICAgIGEgY2xhc3NuYW1lIGZvciB0aGUgc2xpZGVyIGVsZW1lbnQuXG4gICAgICBAcHJvcGVydHkgc2xpZGVyQ2xhc3NcbiAgICAgIEB0eXBlIFN0cmluZ1xuICAgICAgQGRlZmF1bHQgJ25hbm8tc2xpZGVyJ1xuICAgICAqL1xuICAgIHNsaWRlckNsYXNzOiAnbmFuby1zbGlkZXInLFxuXG4gICAgLyoqXG4gICAgICBhIGNsYXNzbmFtZSBmb3IgdGhlIGNvbnRlbnQgZWxlbWVudC5cbiAgICAgIEBwcm9wZXJ0eSBjb250ZW50Q2xhc3NcbiAgICAgIEB0eXBlIFN0cmluZ1xuICAgICAgQGRlZmF1bHQgJ25hbm8tY29udGVudCdcbiAgICAgKi9cbiAgICBjb250ZW50Q2xhc3M6ICduYW5vLWNvbnRlbnQnLFxuXG4gICAgLyoqXG4gICAgICBhIHNldHRpbmcgdG8gZW5hYmxlIG5hdGl2ZSBzY3JvbGxpbmcgaW4gaU9TIGRldmljZXMuXG4gICAgICBAcHJvcGVydHkgaU9TTmF0aXZlU2Nyb2xsaW5nXG4gICAgICBAdHlwZSBCb29sZWFuXG4gICAgICBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIGlPU05hdGl2ZVNjcm9sbGluZzogZmFsc2UsXG5cbiAgICAvKipcbiAgICAgIGEgc2V0dGluZyB0byBwcmV2ZW50IHRoZSByZXN0IG9mIHRoZSBwYWdlIGJlaW5nXG4gICAgICBzY3JvbGxlZCB3aGVuIHVzZXIgc2Nyb2xscyB0aGUgYC5jb250ZW50YCBlbGVtZW50LlxuICAgICAgQHByb3BlcnR5IHByZXZlbnRQYWdlU2Nyb2xsaW5nXG4gICAgICBAdHlwZSBCb29sZWFuXG4gICAgICBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIHByZXZlbnRQYWdlU2Nyb2xsaW5nOiBmYWxzZSxcblxuICAgIC8qKlxuICAgICAgYSBzZXR0aW5nIHRvIGRpc2FibGUgYmluZGluZyB0byB0aGUgcmVzaXplIGV2ZW50LlxuICAgICAgQHByb3BlcnR5IGRpc2FibGVSZXNpemVcbiAgICAgIEB0eXBlIEJvb2xlYW5cbiAgICAgIEBkZWZhdWx0IGZhbHNlXG4gICAgICovXG4gICAgZGlzYWJsZVJlc2l6ZTogZmFsc2UsXG5cbiAgICAvKipcbiAgICAgIGEgc2V0dGluZyB0byBtYWtlIHRoZSBzY3JvbGxiYXIgYWx3YXlzIHZpc2libGUuXG4gICAgICBAcHJvcGVydHkgYWx3YXlzVmlzaWJsZVxuICAgICAgQHR5cGUgQm9vbGVhblxuICAgICAgQGRlZmF1bHQgZmFsc2VcbiAgICAgKi9cbiAgICBhbHdheXNWaXNpYmxlOiBmYWxzZSxcblxuICAgIC8qKlxuICAgICAgYSBkZWZhdWx0IHRpbWVvdXQgZm9yIHRoZSBgZmxhc2goKWAgbWV0aG9kLlxuICAgICAgQHByb3BlcnR5IGZsYXNoRGVsYXlcbiAgICAgIEB0eXBlIE51bWJlclxuICAgICAgQGRlZmF1bHQgMTUwMFxuICAgICAqL1xuICAgIGZsYXNoRGVsYXk6IDE1MDAsXG5cbiAgICAvKipcbiAgICAgIGEgbWluaW11bSBoZWlnaHQgZm9yIHRoZSBgLnNsaWRlcmAgZWxlbWVudC5cbiAgICAgIEBwcm9wZXJ0eSBzbGlkZXJNaW5IZWlnaHRcbiAgICAgIEB0eXBlIE51bWJlclxuICAgICAgQGRlZmF1bHQgMjBcbiAgICAgKi9cbiAgICBzbGlkZXJNaW5IZWlnaHQ6IDIwLFxuXG4gICAgLyoqXG4gICAgICBhIG1heGltdW0gaGVpZ2h0IGZvciB0aGUgYC5zbGlkZXJgIGVsZW1lbnQuXG4gICAgICBAcHJvcGVydHkgc2xpZGVyTWF4SGVpZ2h0XG4gICAgICBAdHlwZSBOdW1iZXJcbiAgICAgIEBkZWZhdWx0IG51bGxcbiAgICAgKi9cbiAgICBzbGlkZXJNYXhIZWlnaHQ6IG51bGwsXG5cbiAgICAvKipcbiAgICAgIGFuIGFsdGVybmF0ZSBkb2N1bWVudCBjb250ZXh0LlxuICAgICAgQHByb3BlcnR5IGRvY3VtZW50Q29udGV4dFxuICAgICAgQHR5cGUgRG9jdW1lbnRcbiAgICAgIEBkZWZhdWx0IG51bGxcbiAgICAgKi9cbiAgICBkb2N1bWVudENvbnRleHQ6IG51bGwsXG5cbiAgICAvKipcbiAgICAgIGFuIGFsdGVybmF0ZSB3aW5kb3cgY29udGV4dC5cbiAgICAgIEBwcm9wZXJ0eSB3aW5kb3dDb250ZXh0XG4gICAgICBAdHlwZSBXaW5kb3dcbiAgICAgIEBkZWZhdWx0IG51bGxcbiAgICAgKi9cbiAgICB3aW5kb3dDb250ZXh0OiBudWxsXG4gIH07XG5cbiAgLyoqXG4gICAgQHByb3BlcnR5IFNDUk9MTEJBUlxuICAgIEB0eXBlIFN0cmluZ1xuICAgIEBzdGF0aWNcbiAgICBAZmluYWxcbiAgICBAcHJpdmF0ZVxuICAgKi9cbiAgU0NST0xMQkFSID0gJ3Njcm9sbGJhcic7XG5cbiAgLyoqXG4gICAgQHByb3BlcnR5IFNDUk9MTFxuICAgIEB0eXBlIFN0cmluZ1xuICAgIEBzdGF0aWNcbiAgICBAZmluYWxcbiAgICBAcHJpdmF0ZVxuICAgKi9cbiAgU0NST0xMID0gJ3Njcm9sbCc7XG5cbiAgLyoqXG4gICAgQHByb3BlcnR5IE1PVVNFRE9XTlxuICAgIEB0eXBlIFN0cmluZ1xuICAgIEBmaW5hbFxuICAgIEBwcml2YXRlXG4gICAqL1xuICBNT1VTRURPV04gPSAnbW91c2Vkb3duJztcblxuICAvKipcbiAgICBAcHJvcGVydHkgTU9VU0VFTlRFUlxuICAgIEB0eXBlIFN0cmluZ1xuICAgIEBmaW5hbFxuICAgIEBwcml2YXRlXG4gICAqL1xuICBNT1VTRUVOVEVSID0gJ21vdXNlZW50ZXInO1xuXG4gIC8qKlxuICAgIEBwcm9wZXJ0eSBNT1VTRU1PVkVcbiAgICBAdHlwZSBTdHJpbmdcbiAgICBAc3RhdGljXG4gICAgQGZpbmFsXG4gICAgQHByaXZhdGVcbiAgICovXG4gIE1PVVNFTU9WRSA9ICdtb3VzZW1vdmUnO1xuXG4gIC8qKlxuICAgIEBwcm9wZXJ0eSBNT1VTRVdIRUVMXG4gICAgQHR5cGUgU3RyaW5nXG4gICAgQGZpbmFsXG4gICAgQHByaXZhdGVcbiAgICovXG4gIE1PVVNFV0hFRUwgPSAnbW91c2V3aGVlbCc7XG5cbiAgLyoqXG4gICAgQHByb3BlcnR5IE1PVVNFVVBcbiAgICBAdHlwZSBTdHJpbmdcbiAgICBAc3RhdGljXG4gICAgQGZpbmFsXG4gICAgQHByaXZhdGVcbiAgICovXG4gIE1PVVNFVVAgPSAnbW91c2V1cCc7XG5cbiAgLyoqXG4gICAgQHByb3BlcnR5IFJFU0laRVxuICAgIEB0eXBlIFN0cmluZ1xuICAgIEBmaW5hbFxuICAgIEBwcml2YXRlXG4gICAqL1xuICBSRVNJWkUgPSAncmVzaXplJztcblxuICAvKipcbiAgICBAcHJvcGVydHkgRFJBR1xuICAgIEB0eXBlIFN0cmluZ1xuICAgIEBzdGF0aWNcbiAgICBAZmluYWxcbiAgICBAcHJpdmF0ZVxuICAgKi9cbiAgRFJBRyA9ICdkcmFnJztcblxuICAvKipcbiAgICBAcHJvcGVydHkgRU5URVJcbiAgICBAdHlwZSBTdHJpbmdcbiAgICBAc3RhdGljXG4gICAgQGZpbmFsXG4gICAgQHByaXZhdGVcbiAgICovXG4gIEVOVEVSID0gJ2VudGVyJztcblxuICAvKipcbiAgICBAcHJvcGVydHkgVVBcbiAgICBAdHlwZSBTdHJpbmdcbiAgICBAc3RhdGljXG4gICAgQGZpbmFsXG4gICAgQHByaXZhdGVcbiAgICovXG4gIFVQID0gJ3VwJztcblxuICAvKipcbiAgICBAcHJvcGVydHkgUEFORURPV05cbiAgICBAdHlwZSBTdHJpbmdcbiAgICBAc3RhdGljXG4gICAgQGZpbmFsXG4gICAgQHByaXZhdGVcbiAgICovXG4gIFBBTkVET1dOID0gJ3BhbmVkb3duJztcblxuICAvKipcbiAgICBAcHJvcGVydHkgRE9NU0NST0xMXG4gICAgQHR5cGUgU3RyaW5nXG4gICAgQHN0YXRpY1xuICAgIEBmaW5hbFxuICAgIEBwcml2YXRlXG4gICAqL1xuICBET01TQ1JPTEwgPSAnRE9NTW91c2VTY3JvbGwnO1xuXG4gIC8qKlxuICAgIEBwcm9wZXJ0eSBET1dOXG4gICAgQHR5cGUgU3RyaW5nXG4gICAgQHN0YXRpY1xuICAgIEBmaW5hbFxuICAgIEBwcml2YXRlXG4gICAqL1xuICBET1dOID0gJ2Rvd24nO1xuXG4gIC8qKlxuICAgIEBwcm9wZXJ0eSBXSEVFTFxuICAgIEB0eXBlIFN0cmluZ1xuICAgIEBzdGF0aWNcbiAgICBAZmluYWxcbiAgICBAcHJpdmF0ZVxuICAgKi9cbiAgV0hFRUwgPSAnd2hlZWwnO1xuXG4gIC8qKlxuICAgIEBwcm9wZXJ0eSBLRVlET1dOXG4gICAgQHR5cGUgU3RyaW5nXG4gICAgQHN0YXRpY1xuICAgIEBmaW5hbFxuICAgIEBwcml2YXRlXG4gICAqL1xuICBLRVlET1dOID0gJ2tleWRvd24nO1xuXG4gIC8qKlxuICAgIEBwcm9wZXJ0eSBLRVlVUFxuICAgIEB0eXBlIFN0cmluZ1xuICAgIEBzdGF0aWNcbiAgICBAZmluYWxcbiAgICBAcHJpdmF0ZVxuICAgKi9cbiAgS0VZVVAgPSAna2V5dXAnO1xuXG4gIC8qKlxuICAgIEBwcm9wZXJ0eSBUT1VDSE1PVkVcbiAgICBAdHlwZSBTdHJpbmdcbiAgICBAc3RhdGljXG4gICAgQGZpbmFsXG4gICAgQHByaXZhdGVcbiAgICovXG4gIFRPVUNITU9WRSA9ICd0b3VjaG1vdmUnO1xuXG4gIC8qKlxuICAgIEBwcm9wZXJ0eSBCUk9XU0VSX0lTX0lFN1xuICAgIEB0eXBlIEJvb2xlYW5cbiAgICBAc3RhdGljXG4gICAgQGZpbmFsXG4gICAgQHByaXZhdGVcbiAgICovXG4gIEJST1dTRVJfSVNfSUU3ID0gd2luZG93Lm5hdmlnYXRvci5hcHBOYW1lID09PSAnTWljcm9zb2Z0IEludGVybmV0IEV4cGxvcmVyJyAmJiAvbXNpZSA3Li9pLnRlc3Qod2luZG93Lm5hdmlnYXRvci5hcHBWZXJzaW9uKSAmJiB3aW5kb3cuQWN0aXZlWE9iamVjdDtcblxuICAvKipcbiAgICBAcHJvcGVydHkgQlJPV1NFUl9TQ1JPTExCQVJfV0lEVEhcbiAgICBAdHlwZSBOdW1iZXJcbiAgICBAc3RhdGljXG4gICAgQGRlZmF1bHQgbnVsbFxuICAgIEBwcml2YXRlXG4gICAqL1xuICBCUk9XU0VSX1NDUk9MTEJBUl9XSURUSCA9IG51bGw7XG4gIHJBRiA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7XG4gIGNBRiA9IHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZTtcbiAgX2VsZW1lbnRTdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLnN0eWxlO1xuICBfdmVuZG9yID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciBpLCB0cmFuc2Zvcm0sIHZlbmRvciwgdmVuZG9ycywgX2ksIF9sZW47XG4gICAgdmVuZG9ycyA9IFsndCcsICd3ZWJraXRUJywgJ01velQnLCAnbXNUJywgJ09UJ107XG4gICAgZm9yIChpID0gX2kgPSAwLCBfbGVuID0gdmVuZG9ycy5sZW5ndGg7IF9pIDwgX2xlbjsgaSA9ICsrX2kpIHtcbiAgICAgIHZlbmRvciA9IHZlbmRvcnNbaV07XG4gICAgICB0cmFuc2Zvcm0gPSB2ZW5kb3JzW2ldICsgJ3JhbnNmb3JtJztcbiAgICAgIGlmICh0cmFuc2Zvcm0gaW4gX2VsZW1lbnRTdHlsZSkge1xuICAgICAgICByZXR1cm4gdmVuZG9yc1tpXS5zdWJzdHIoMCwgdmVuZG9yc1tpXS5sZW5ndGggLSAxKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9KSgpO1xuICBfcHJlZml4U3R5bGUgPSBmdW5jdGlvbihzdHlsZSkge1xuICAgIGlmIChfdmVuZG9yID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoX3ZlbmRvciA9PT0gJycpIHtcbiAgICAgIHJldHVybiBzdHlsZTtcbiAgICB9XG4gICAgcmV0dXJuIF92ZW5kb3IgKyBzdHlsZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0eWxlLnN1YnN0cigxKTtcbiAgfTtcbiAgdHJhbnNmb3JtID0gX3ByZWZpeFN0eWxlKCd0cmFuc2Zvcm0nKTtcbiAgaGFzVHJhbnNmb3JtID0gdHJhbnNmb3JtICE9PSBmYWxzZTtcblxuICAvKipcbiAgICBSZXR1cm5zIGJyb3dzZXIncyBuYXRpdmUgc2Nyb2xsYmFyIHdpZHRoXG4gICAgQG1ldGhvZCBnZXRCcm93c2VyU2Nyb2xsYmFyV2lkdGhcbiAgICBAcmV0dXJuIHtOdW1iZXJ9IHRoZSBzY3JvbGxiYXIgd2lkdGggaW4gcGl4ZWxzXG4gICAgQHN0YXRpY1xuICAgIEBwcml2YXRlXG4gICAqL1xuICBnZXRCcm93c2VyU2Nyb2xsYmFyV2lkdGggPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgb3V0ZXIsIG91dGVyU3R5bGUsIHNjcm9sbGJhcldpZHRoO1xuICAgIG91dGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgb3V0ZXJTdHlsZSA9IG91dGVyLnN0eWxlO1xuICAgIG91dGVyU3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgIG91dGVyU3R5bGUud2lkdGggPSAnMTAwcHgnO1xuICAgIG91dGVyU3R5bGUuaGVpZ2h0ID0gJzEwMHB4JztcbiAgICBvdXRlclN0eWxlLm92ZXJmbG93ID0gU0NST0xMO1xuICAgIG91dGVyU3R5bGUudG9wID0gJy05OTk5cHgnO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3V0ZXIpO1xuICAgIHNjcm9sbGJhcldpZHRoID0gb3V0ZXIub2Zmc2V0V2lkdGggLSBvdXRlci5jbGllbnRXaWR0aDtcbiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG91dGVyKTtcbiAgICByZXR1cm4gc2Nyb2xsYmFyV2lkdGg7XG4gIH07XG4gIGlzRkZXaXRoQnVnZ3lTY3JvbGxiYXIgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXNPU1hGRiwgdWEsIHZlcnNpb247XG4gICAgdWEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgICBpc09TWEZGID0gLyg/PS4rTWFjIE9TIFgpKD89LitGaXJlZm94KS8udGVzdCh1YSk7XG4gICAgaWYgKCFpc09TWEZGKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHZlcnNpb24gPSAvRmlyZWZveFxcL1xcZHsyfVxcLi8uZXhlYyh1YSk7XG4gICAgaWYgKHZlcnNpb24pIHtcbiAgICAgIHZlcnNpb24gPSB2ZXJzaW9uWzBdLnJlcGxhY2UoL1xcRCsvZywgJycpO1xuICAgIH1cbiAgICByZXR1cm4gaXNPU1hGRiAmJiArdmVyc2lvbiA+IDIzO1xuICB9O1xuXG4gIC8qKlxuICAgIEBjbGFzcyBOYW5vU2Nyb2xsXG4gICAgQHBhcmFtIGVsZW1lbnQge0hUTUxFbGVtZW50fE5vZGV9IHRoZSBtYWluIGVsZW1lbnRcbiAgICBAcGFyYW0gb3B0aW9ucyB7T2JqZWN0fSBuYW5vU2Nyb2xsZXIncyBvcHRpb25zXG4gICAgQGNvbnN0cnVjdG9yXG4gICAqL1xuICBOYW5vU2Nyb2xsID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIE5hbm9TY3JvbGwoZWwsIG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICBCUk9XU0VSX1NDUk9MTEJBUl9XSURUSCB8fCAoQlJPV1NFUl9TQ1JPTExCQVJfV0lEVEggPSBnZXRCcm93c2VyU2Nyb2xsYmFyV2lkdGgoKSk7XG4gICAgICB0aGlzLiRlbCA9ICQodGhpcy5lbCk7XG4gICAgICB0aGlzLmRvYyA9ICQodGhpcy5vcHRpb25zLmRvY3VtZW50Q29udGV4dCB8fCBkb2N1bWVudCk7XG4gICAgICB0aGlzLndpbiA9ICQodGhpcy5vcHRpb25zLndpbmRvd0NvbnRleHQgfHwgd2luZG93KTtcbiAgICAgIHRoaXMuYm9keSA9IHRoaXMuZG9jLmZpbmQoJ2JvZHknKTtcbiAgICAgIHRoaXMuJGNvbnRlbnQgPSB0aGlzLiRlbC5jaGlsZHJlbihcIi5cIiArIHRoaXMub3B0aW9ucy5jb250ZW50Q2xhc3MpO1xuICAgICAgdGhpcy4kY29udGVudC5hdHRyKCd0YWJpbmRleCcsIHRoaXMub3B0aW9ucy50YWJJbmRleCB8fCAwKTtcbiAgICAgIHRoaXMuY29udGVudCA9IHRoaXMuJGNvbnRlbnRbMF07XG4gICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSAwO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5pT1NOYXRpdmVTY3JvbGxpbmcgJiYgKHRoaXMuZWwuc3R5bGUuV2Via2l0T3ZlcmZsb3dTY3JvbGxpbmcgIT0gbnVsbCkpIHtcbiAgICAgICAgdGhpcy5uYXRpdmVTY3JvbGxpbmcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZ2VuZXJhdGUoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY3JlYXRlRXZlbnRzKCk7XG4gICAgICB0aGlzLmFkZEV2ZW50cygpO1xuICAgICAgdGhpcy5yZXNldCgpO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICBQcmV2ZW50cyB0aGUgcmVzdCBvZiB0aGUgcGFnZSBiZWluZyBzY3JvbGxlZFxuICAgICAgd2hlbiB1c2VyIHNjcm9sbHMgdGhlIGAubmFuby1jb250ZW50YCBlbGVtZW50LlxuICAgICAgQG1ldGhvZCBwcmV2ZW50U2Nyb2xsaW5nXG4gICAgICBAcGFyYW0gZXZlbnQge0V2ZW50fVxuICAgICAgQHBhcmFtIGRpcmVjdGlvbiB7U3RyaW5nfSBTY3JvbGwgZGlyZWN0aW9uICh1cCBvciBkb3duKVxuICAgICAgQHByaXZhdGVcbiAgICAgKi9cblxuICAgIE5hbm9TY3JvbGwucHJvdG90eXBlLnByZXZlbnRTY3JvbGxpbmcgPSBmdW5jdGlvbihlLCBkaXJlY3Rpb24pIHtcbiAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZS50eXBlID09PSBET01TQ1JPTEwpIHtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gRE9XTiAmJiBlLm9yaWdpbmFsRXZlbnQuZGV0YWlsID4gMCB8fCBkaXJlY3Rpb24gPT09IFVQICYmIGUub3JpZ2luYWxFdmVudC5kZXRhaWwgPCAwKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGUudHlwZSA9PT0gTU9VU0VXSEVFTCkge1xuICAgICAgICBpZiAoIWUub3JpZ2luYWxFdmVudCB8fCAhZS5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGEpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gRE9XTiAmJiBlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSA8IDAgfHwgZGlyZWN0aW9uID09PSBVUCAmJiBlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSA+IDApIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgIEVuYWJsZSBpT1MgbmF0aXZlIHNjcm9sbGluZ1xuICAgICAgQG1ldGhvZCBuYXRpdmVTY3JvbGxpbmdcbiAgICAgIEBwcml2YXRlXG4gICAgICovXG5cbiAgICBOYW5vU2Nyb2xsLnByb3RvdHlwZS5uYXRpdmVTY3JvbGxpbmcgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJGNvbnRlbnQuY3NzKHtcbiAgICAgICAgV2Via2l0T3ZlcmZsb3dTY3JvbGxpbmc6ICd0b3VjaCdcbiAgICAgIH0pO1xuICAgICAgdGhpcy5pT1NOYXRpdmVTY3JvbGxpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICBVcGRhdGVzIHRob3NlIG5hbm9TY3JvbGxlciBwcm9wZXJ0aWVzIHRoYXRcbiAgICAgIGFyZSByZWxhdGVkIHRvIGN1cnJlbnQgc2Nyb2xsYmFyIHBvc2l0aW9uLlxuICAgICAgQG1ldGhvZCB1cGRhdGVTY3JvbGxWYWx1ZXNcbiAgICAgIEBwcml2YXRlXG4gICAgICovXG5cbiAgICBOYW5vU2Nyb2xsLnByb3RvdHlwZS51cGRhdGVTY3JvbGxWYWx1ZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjb250ZW50LCBkaXJlY3Rpb247XG4gICAgICBjb250ZW50ID0gdGhpcy5jb250ZW50O1xuICAgICAgdGhpcy5tYXhTY3JvbGxUb3AgPSBjb250ZW50LnNjcm9sbEhlaWdodCAtIGNvbnRlbnQuY2xpZW50SGVpZ2h0O1xuICAgICAgdGhpcy5wcmV2U2Nyb2xsVG9wID0gdGhpcy5jb250ZW50U2Nyb2xsVG9wIHx8IDA7XG4gICAgICB0aGlzLmNvbnRlbnRTY3JvbGxUb3AgPSBjb250ZW50LnNjcm9sbFRvcDtcbiAgICAgIGRpcmVjdGlvbiA9IHRoaXMuY29udGVudFNjcm9sbFRvcCA+IHRoaXMucHJldmlvdXNQb3NpdGlvbiA/IFwiZG93blwiIDogdGhpcy5jb250ZW50U2Nyb2xsVG9wIDwgdGhpcy5wcmV2aW91c1Bvc2l0aW9uID8gXCJ1cFwiIDogXCJzYW1lXCI7XG4gICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSB0aGlzLmNvbnRlbnRTY3JvbGxUb3A7XG4gICAgICBpZiAoZGlyZWN0aW9uICE9PSBcInNhbWVcIikge1xuICAgICAgICB0aGlzLiRlbC50cmlnZ2VyKCd1cGRhdGUnLCB7XG4gICAgICAgICAgcG9zaXRpb246IHRoaXMuY29udGVudFNjcm9sbFRvcCxcbiAgICAgICAgICBtYXhpbXVtOiB0aGlzLm1heFNjcm9sbFRvcCxcbiAgICAgICAgICBkaXJlY3Rpb246IGRpcmVjdGlvblxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5pT1NOYXRpdmVTY3JvbGxpbmcpIHtcbiAgICAgICAgdGhpcy5tYXhTbGlkZXJUb3AgPSB0aGlzLnBhbmVIZWlnaHQgLSB0aGlzLnNsaWRlckhlaWdodDtcbiAgICAgICAgdGhpcy5zbGlkZXJUb3AgPSB0aGlzLm1heFNjcm9sbFRvcCA9PT0gMCA/IDAgOiB0aGlzLmNvbnRlbnRTY3JvbGxUb3AgKiB0aGlzLm1heFNsaWRlclRvcCAvIHRoaXMubWF4U2Nyb2xsVG9wO1xuICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAgVXBkYXRlcyBDU1Mgc3R5bGVzIGZvciBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbi5cbiAgICAgIFVzZXMgQ1NTIDJkIHRyYW5zZnJvbXMgYW5kIGB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lYCBpZiBhdmFpbGFibGUuXG4gICAgICBAbWV0aG9kIHNldE9uU2Nyb2xsU3R5bGVzXG4gICAgICBAcHJpdmF0ZVxuICAgICAqL1xuXG4gICAgTmFub1Njcm9sbC5wcm90b3R5cGUuc2V0T25TY3JvbGxTdHlsZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjc3NWYWx1ZTtcbiAgICAgIGlmIChoYXNUcmFuc2Zvcm0pIHtcbiAgICAgICAgY3NzVmFsdWUgPSB7fTtcbiAgICAgICAgY3NzVmFsdWVbdHJhbnNmb3JtXSA9IFwidHJhbnNsYXRlKDAsIFwiICsgdGhpcy5zbGlkZXJUb3AgKyBcInB4KVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3NzVmFsdWUgPSB7XG4gICAgICAgICAgdG9wOiB0aGlzLnNsaWRlclRvcFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKHJBRikge1xuICAgICAgICBpZiAoY0FGICYmIHRoaXMuc2Nyb2xsUkFGKSB7XG4gICAgICAgICAgY0FGKHRoaXMuc2Nyb2xsUkFGKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNjcm9sbFJBRiA9IHJBRigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfdGhpcy5zY3JvbGxSQUYgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLnNsaWRlci5jc3MoY3NzVmFsdWUpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2xpZGVyLmNzcyhjc3NWYWx1ZSk7XG4gICAgICB9XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICBDcmVhdGVzIGV2ZW50IHJlbGF0ZWQgbWV0aG9kc1xuICAgICAgQG1ldGhvZCBjcmVhdGVFdmVudHNcbiAgICAgIEBwcml2YXRlXG4gICAgICovXG5cbiAgICBOYW5vU2Nyb2xsLnByb3RvdHlwZS5jcmVhdGVFdmVudHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuZXZlbnRzID0ge1xuICAgICAgICBkb3duOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgX3RoaXMuaXNCZWluZ0RyYWdnZWQgPSB0cnVlO1xuICAgICAgICAgICAgX3RoaXMub2Zmc2V0WSA9IGUucGFnZVkgLSBfdGhpcy5zbGlkZXIub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgaWYgKCFfdGhpcy5zbGlkZXIuaXMoZS50YXJnZXQpKSB7XG4gICAgICAgICAgICAgIF90aGlzLm9mZnNldFkgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMucGFuZS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICBfdGhpcy5kb2MuYmluZChNT1VTRU1PVkUsIF90aGlzLmV2ZW50c1tEUkFHXSkuYmluZChNT1VTRVVQLCBfdGhpcy5ldmVudHNbVVBdKTtcbiAgICAgICAgICAgIF90aGlzLmJvZHkuYmluZChNT1VTRUVOVEVSLCBfdGhpcy5ldmVudHNbRU5URVJdKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKSxcbiAgICAgICAgZHJhZzogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIF90aGlzLnNsaWRlclkgPSBlLnBhZ2VZIC0gX3RoaXMuJGVsLm9mZnNldCgpLnRvcCAtIF90aGlzLnBhbmVUb3AgLSAoX3RoaXMub2Zmc2V0WSB8fCBfdGhpcy5zbGlkZXJIZWlnaHQgKiAwLjUpO1xuICAgICAgICAgICAgX3RoaXMuc2Nyb2xsKCk7XG4gICAgICAgICAgICBpZiAoX3RoaXMuY29udGVudFNjcm9sbFRvcCA+PSBfdGhpcy5tYXhTY3JvbGxUb3AgJiYgX3RoaXMucHJldlNjcm9sbFRvcCAhPT0gX3RoaXMubWF4U2Nyb2xsVG9wKSB7XG4gICAgICAgICAgICAgIF90aGlzLiRlbC50cmlnZ2VyKCdzY3JvbGxlbmQnKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMuY29udGVudFNjcm9sbFRvcCA9PT0gMCAmJiBfdGhpcy5wcmV2U2Nyb2xsVG9wICE9PSAwKSB7XG4gICAgICAgICAgICAgIF90aGlzLiRlbC50cmlnZ2VyKCdzY3JvbGx0b3AnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKSxcbiAgICAgICAgdXA6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBfdGhpcy5pc0JlaW5nRHJhZ2dlZCA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMucGFuZS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICBfdGhpcy5kb2MudW5iaW5kKE1PVVNFTU9WRSwgX3RoaXMuZXZlbnRzW0RSQUddKS51bmJpbmQoTU9VU0VVUCwgX3RoaXMuZXZlbnRzW1VQXSk7XG4gICAgICAgICAgICBfdGhpcy5ib2R5LnVuYmluZChNT1VTRUVOVEVSLCBfdGhpcy5ldmVudHNbRU5URVJdKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKSxcbiAgICAgICAgcmVzaXplOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgX3RoaXMucmVzZXQoKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKSxcbiAgICAgICAgcGFuZWRvd246IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBfdGhpcy5zbGlkZXJZID0gKGUub2Zmc2V0WSB8fCBlLm9yaWdpbmFsRXZlbnQubGF5ZXJZKSAtIChfdGhpcy5zbGlkZXJIZWlnaHQgKiAwLjUpO1xuICAgICAgICAgICAgX3RoaXMuc2Nyb2xsKCk7XG4gICAgICAgICAgICBfdGhpcy5ldmVudHMuZG93bihlKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKSxcbiAgICAgICAgc2Nyb2xsOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgX3RoaXMudXBkYXRlU2Nyb2xsVmFsdWVzKCk7XG4gICAgICAgICAgICBpZiAoX3RoaXMuaXNCZWluZ0RyYWdnZWQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFfdGhpcy5pT1NOYXRpdmVTY3JvbGxpbmcpIHtcbiAgICAgICAgICAgICAgX3RoaXMuc2xpZGVyWSA9IF90aGlzLnNsaWRlclRvcDtcbiAgICAgICAgICAgICAgX3RoaXMuc2V0T25TY3JvbGxTdHlsZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKF90aGlzLmNvbnRlbnRTY3JvbGxUb3AgPj0gX3RoaXMubWF4U2Nyb2xsVG9wKSB7XG4gICAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLnByZXZlbnRQYWdlU2Nyb2xsaW5nKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMucHJldmVudFNjcm9sbGluZyhlLCBET1dOKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoX3RoaXMucHJldlNjcm9sbFRvcCAhPT0gX3RoaXMubWF4U2Nyb2xsVG9wKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuJGVsLnRyaWdnZXIoJ3Njcm9sbGVuZCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzLmNvbnRlbnRTY3JvbGxUb3AgPT09IDApIHtcbiAgICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMucHJldmVudFBhZ2VTY3JvbGxpbmcpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5wcmV2ZW50U2Nyb2xsaW5nKGUsIFVQKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoX3RoaXMucHJldlNjcm9sbFRvcCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIF90aGlzLiRlbC50cmlnZ2VyKCdzY3JvbGx0b3AnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpLFxuICAgICAgICB3aGVlbDogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBkZWx0YTtcbiAgICAgICAgICAgIGlmIChlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVsdGEgPSBlLmRlbHRhIHx8IGUud2hlZWxEZWx0YSB8fCAoZS5vcmlnaW5hbEV2ZW50ICYmIGUub3JpZ2luYWxFdmVudC53aGVlbERlbHRhKSB8fCAtZS5kZXRhaWwgfHwgKGUub3JpZ2luYWxFdmVudCAmJiAtZS5vcmlnaW5hbEV2ZW50LmRldGFpbCk7XG4gICAgICAgICAgICBpZiAoZGVsdGEpIHtcbiAgICAgICAgICAgICAgX3RoaXMuc2xpZGVyWSArPSAtZGVsdGEgLyAzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuc2Nyb2xsKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcyksXG4gICAgICAgIGVudGVyOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyIF9yZWY7XG4gICAgICAgICAgICBpZiAoIV90aGlzLmlzQmVpbmdEcmFnZ2VkKSB7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgoZS5idXR0b25zIHx8IGUud2hpY2gpICE9PSAxKSB7XG4gICAgICAgICAgICAgIHJldHVybiAoX3JlZiA9IF90aGlzLmV2ZW50cylbVVBdLmFwcGx5KF9yZWYsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcylcbiAgICAgIH07XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICBBZGRzIGV2ZW50IGxpc3RlbmVycyB3aXRoIGpRdWVyeS5cbiAgICAgIEBtZXRob2QgYWRkRXZlbnRzXG4gICAgICBAcHJpdmF0ZVxuICAgICAqL1xuXG4gICAgTmFub1Njcm9sbC5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZXZlbnRzO1xuICAgICAgdGhpcy5yZW1vdmVFdmVudHMoKTtcbiAgICAgIGV2ZW50cyA9IHRoaXMuZXZlbnRzO1xuICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuZGlzYWJsZVJlc2l6ZSkge1xuICAgICAgICB0aGlzLndpbi5iaW5kKFJFU0laRSwgZXZlbnRzW1JFU0laRV0pO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLmlPU05hdGl2ZVNjcm9sbGluZykge1xuICAgICAgICB0aGlzLnNsaWRlci5iaW5kKE1PVVNFRE9XTiwgZXZlbnRzW0RPV05dKTtcbiAgICAgICAgdGhpcy5wYW5lLmJpbmQoTU9VU0VET1dOLCBldmVudHNbUEFORURPV05dKS5iaW5kKFwiXCIgKyBNT1VTRVdIRUVMICsgXCIgXCIgKyBET01TQ1JPTEwsIGV2ZW50c1tXSEVFTF0pO1xuICAgICAgfVxuICAgICAgdGhpcy4kY29udGVudC5iaW5kKFwiXCIgKyBTQ1JPTEwgKyBcIiBcIiArIE1PVVNFV0hFRUwgKyBcIiBcIiArIERPTVNDUk9MTCArIFwiIFwiICsgVE9VQ0hNT1ZFLCBldmVudHNbU0NST0xMXSk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICBSZW1vdmVzIGV2ZW50IGxpc3RlbmVycyB3aXRoIGpRdWVyeS5cbiAgICAgIEBtZXRob2QgcmVtb3ZlRXZlbnRzXG4gICAgICBAcHJpdmF0ZVxuICAgICAqL1xuXG4gICAgTmFub1Njcm9sbC5wcm90b3R5cGUucmVtb3ZlRXZlbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZXZlbnRzO1xuICAgICAgZXZlbnRzID0gdGhpcy5ldmVudHM7XG4gICAgICB0aGlzLndpbi51bmJpbmQoUkVTSVpFLCBldmVudHNbUkVTSVpFXSk7XG4gICAgICBpZiAoIXRoaXMuaU9TTmF0aXZlU2Nyb2xsaW5nKSB7XG4gICAgICAgIHRoaXMuc2xpZGVyLnVuYmluZCgpO1xuICAgICAgICB0aGlzLnBhbmUudW5iaW5kKCk7XG4gICAgICB9XG4gICAgICB0aGlzLiRjb250ZW50LnVuYmluZChcIlwiICsgU0NST0xMICsgXCIgXCIgKyBNT1VTRVdIRUVMICsgXCIgXCIgKyBET01TQ1JPTEwgKyBcIiBcIiArIFRPVUNITU9WRSwgZXZlbnRzW1NDUk9MTF0pO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAgR2VuZXJhdGVzIG5hbm9TY3JvbGxlcidzIHNjcm9sbGJhciBhbmQgZWxlbWVudHMgZm9yIGl0LlxuICAgICAgQG1ldGhvZCBnZW5lcmF0ZVxuICAgICAgQGNoYWluYWJsZVxuICAgICAgQHByaXZhdGVcbiAgICAgKi9cblxuICAgIE5hbm9TY3JvbGwucHJvdG90eXBlLmdlbmVyYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY29udGVudENsYXNzLCBjc3NSdWxlLCBjdXJyZW50UGFkZGluZywgb3B0aW9ucywgcGFuZSwgcGFuZUNsYXNzLCBzbGlkZXJDbGFzcztcbiAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICBwYW5lQ2xhc3MgPSBvcHRpb25zLnBhbmVDbGFzcywgc2xpZGVyQ2xhc3MgPSBvcHRpb25zLnNsaWRlckNsYXNzLCBjb250ZW50Q2xhc3MgPSBvcHRpb25zLmNvbnRlbnRDbGFzcztcbiAgICAgIGlmICghKHBhbmUgPSB0aGlzLiRlbC5jaGlsZHJlbihcIi5cIiArIHBhbmVDbGFzcykpLmxlbmd0aCAmJiAhcGFuZS5jaGlsZHJlbihcIi5cIiArIHNsaWRlckNsYXNzKS5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKFwiPGRpdiBjbGFzcz1cXFwiXCIgKyBwYW5lQ2xhc3MgKyBcIlxcXCI+PGRpdiBjbGFzcz1cXFwiXCIgKyBzbGlkZXJDbGFzcyArIFwiXFxcIiAvPjwvZGl2PlwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucGFuZSA9IHRoaXMuJGVsLmNoaWxkcmVuKFwiLlwiICsgcGFuZUNsYXNzKTtcbiAgICAgIHRoaXMuc2xpZGVyID0gdGhpcy5wYW5lLmZpbmQoXCIuXCIgKyBzbGlkZXJDbGFzcyk7XG4gICAgICBpZiAoQlJPV1NFUl9TQ1JPTExCQVJfV0lEVEggPT09IDAgJiYgaXNGRldpdGhCdWdneVNjcm9sbGJhcigpKSB7XG4gICAgICAgIGN1cnJlbnRQYWRkaW5nID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5jb250ZW50LCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKCdwYWRkaW5nLXJpZ2h0JykucmVwbGFjZSgvW14wLTkuXSsvZywgJycpO1xuICAgICAgICBjc3NSdWxlID0ge1xuICAgICAgICAgIHJpZ2h0OiAtMTQsXG4gICAgICAgICAgcGFkZGluZ1JpZ2h0OiArY3VycmVudFBhZGRpbmcgKyAxNFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIGlmIChCUk9XU0VSX1NDUk9MTEJBUl9XSURUSCkge1xuICAgICAgICBjc3NSdWxlID0ge1xuICAgICAgICAgIHJpZ2h0OiAtQlJPV1NFUl9TQ1JPTExCQVJfV0lEVEhcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ2hhcy1zY3JvbGxiYXInKTtcbiAgICAgIH1cbiAgICAgIGlmIChjc3NSdWxlICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy4kY29udGVudC5jc3MoY3NzUnVsZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgIEBtZXRob2QgcmVzdG9yZVxuICAgICAgQHByaXZhdGVcbiAgICAgKi9cblxuICAgIE5hbm9TY3JvbGwucHJvdG90eXBlLnJlc3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc3RvcHBlZCA9IGZhbHNlO1xuICAgICAgaWYgKCF0aGlzLmlPU05hdGl2ZVNjcm9sbGluZykge1xuICAgICAgICB0aGlzLnBhbmUuc2hvdygpO1xuICAgICAgfVxuICAgICAgdGhpcy5hZGRFdmVudHMoKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgIFJlc2V0cyBuYW5vU2Nyb2xsZXIncyBzY3JvbGxiYXIuXG4gICAgICBAbWV0aG9kIHJlc2V0XG4gICAgICBAY2hhaW5hYmxlXG4gICAgICBAZXhhbXBsZVxuICAgICAgICAgICQoXCIubmFub1wiKS5uYW5vU2Nyb2xsZXIoKTtcbiAgICAgKi9cblxuICAgIE5hbm9TY3JvbGwucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY29udGVudCwgY29udGVudEhlaWdodCwgY29udGVudFBvc2l0aW9uLCBjb250ZW50U3R5bGUsIGNvbnRlbnRTdHlsZU92ZXJmbG93WSwgcGFuZUJvdHRvbSwgcGFuZUhlaWdodCwgcGFuZU91dGVySGVpZ2h0LCBwYW5lVG9wLCBwYXJlbnRNYXhIZWlnaHQsIHJpZ2h0LCBzbGlkZXJIZWlnaHQ7XG4gICAgICBpZiAodGhpcy5pT1NOYXRpdmVTY3JvbGxpbmcpIHtcbiAgICAgICAgdGhpcy5jb250ZW50SGVpZ2h0ID0gdGhpcy5jb250ZW50LnNjcm9sbEhlaWdodDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLiRlbC5maW5kKFwiLlwiICsgdGhpcy5vcHRpb25zLnBhbmVDbGFzcykubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuZ2VuZXJhdGUoKS5zdG9wKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5zdG9wcGVkKSB7XG4gICAgICAgIHRoaXMucmVzdG9yZSgpO1xuICAgICAgfVxuICAgICAgY29udGVudCA9IHRoaXMuY29udGVudDtcbiAgICAgIGNvbnRlbnRTdHlsZSA9IGNvbnRlbnQuc3R5bGU7XG4gICAgICBjb250ZW50U3R5bGVPdmVyZmxvd1kgPSBjb250ZW50U3R5bGUub3ZlcmZsb3dZO1xuICAgICAgaWYgKEJST1dTRVJfSVNfSUU3KSB7XG4gICAgICAgIHRoaXMuJGNvbnRlbnQuY3NzKHtcbiAgICAgICAgICBoZWlnaHQ6IHRoaXMuJGNvbnRlbnQuaGVpZ2h0KClcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb250ZW50SGVpZ2h0ID0gY29udGVudC5zY3JvbGxIZWlnaHQgKyBCUk9XU0VSX1NDUk9MTEJBUl9XSURUSDtcbiAgICAgIHBhcmVudE1heEhlaWdodCA9IHBhcnNlSW50KHRoaXMuJGVsLmNzcyhcIm1heC1oZWlnaHRcIiksIDEwKTtcbiAgICAgIGlmIChwYXJlbnRNYXhIZWlnaHQgPiAwKSB7XG4gICAgICAgIHRoaXMuJGVsLmhlaWdodChcIlwiKTtcbiAgICAgICAgdGhpcy4kZWwuaGVpZ2h0KGNvbnRlbnQuc2Nyb2xsSGVpZ2h0ID4gcGFyZW50TWF4SGVpZ2h0ID8gcGFyZW50TWF4SGVpZ2h0IDogY29udGVudC5zY3JvbGxIZWlnaHQpO1xuICAgICAgfVxuICAgICAgcGFuZUhlaWdodCA9IHRoaXMucGFuZS5vdXRlckhlaWdodChmYWxzZSk7XG4gICAgICBwYW5lVG9wID0gcGFyc2VJbnQodGhpcy5wYW5lLmNzcygndG9wJyksIDEwKTtcbiAgICAgIHBhbmVCb3R0b20gPSBwYXJzZUludCh0aGlzLnBhbmUuY3NzKCdib3R0b20nKSwgMTApO1xuICAgICAgcGFuZU91dGVySGVpZ2h0ID0gcGFuZUhlaWdodCArIHBhbmVUb3AgKyBwYW5lQm90dG9tO1xuICAgICAgc2xpZGVySGVpZ2h0ID0gTWF0aC5yb3VuZChwYW5lT3V0ZXJIZWlnaHQgLyBjb250ZW50SGVpZ2h0ICogcGFuZUhlaWdodCk7XG4gICAgICBpZiAoc2xpZGVySGVpZ2h0IDwgdGhpcy5vcHRpb25zLnNsaWRlck1pbkhlaWdodCkge1xuICAgICAgICBzbGlkZXJIZWlnaHQgPSB0aGlzLm9wdGlvbnMuc2xpZGVyTWluSGVpZ2h0O1xuICAgICAgfSBlbHNlIGlmICgodGhpcy5vcHRpb25zLnNsaWRlck1heEhlaWdodCAhPSBudWxsKSAmJiBzbGlkZXJIZWlnaHQgPiB0aGlzLm9wdGlvbnMuc2xpZGVyTWF4SGVpZ2h0KSB7XG4gICAgICAgIHNsaWRlckhlaWdodCA9IHRoaXMub3B0aW9ucy5zbGlkZXJNYXhIZWlnaHQ7XG4gICAgICB9XG4gICAgICBpZiAoY29udGVudFN0eWxlT3ZlcmZsb3dZID09PSBTQ1JPTEwgJiYgY29udGVudFN0eWxlLm92ZXJmbG93WCAhPT0gU0NST0xMKSB7XG4gICAgICAgIHNsaWRlckhlaWdodCArPSBCUk9XU0VSX1NDUk9MTEJBUl9XSURUSDtcbiAgICAgIH1cbiAgICAgIHRoaXMubWF4U2xpZGVyVG9wID0gcGFuZU91dGVySGVpZ2h0IC0gc2xpZGVySGVpZ2h0O1xuICAgICAgdGhpcy5jb250ZW50SGVpZ2h0ID0gY29udGVudEhlaWdodDtcbiAgICAgIHRoaXMucGFuZUhlaWdodCA9IHBhbmVIZWlnaHQ7XG4gICAgICB0aGlzLnBhbmVPdXRlckhlaWdodCA9IHBhbmVPdXRlckhlaWdodDtcbiAgICAgIHRoaXMuc2xpZGVySGVpZ2h0ID0gc2xpZGVySGVpZ2h0O1xuICAgICAgdGhpcy5wYW5lVG9wID0gcGFuZVRvcDtcbiAgICAgIHRoaXMuc2xpZGVyLmhlaWdodChzbGlkZXJIZWlnaHQpO1xuICAgICAgdGhpcy5ldmVudHMuc2Nyb2xsKCk7XG4gICAgICB0aGlzLnBhbmUuc2hvdygpO1xuICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICBpZiAoKGNvbnRlbnQuc2Nyb2xsSGVpZ2h0ID09PSBjb250ZW50LmNsaWVudEhlaWdodCkgfHwgKHRoaXMucGFuZS5vdXRlckhlaWdodCh0cnVlKSA+PSBjb250ZW50LnNjcm9sbEhlaWdodCAmJiBjb250ZW50U3R5bGVPdmVyZmxvd1kgIT09IFNDUk9MTCkpIHtcbiAgICAgICAgdGhpcy5wYW5lLmhpZGUoKTtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmVsLmNsaWVudEhlaWdodCA9PT0gY29udGVudC5zY3JvbGxIZWlnaHQgJiYgY29udGVudFN0eWxlT3ZlcmZsb3dZID09PSBTQ1JPTEwpIHtcbiAgICAgICAgdGhpcy5zbGlkZXIuaGlkZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zbGlkZXIuc2hvdygpO1xuICAgICAgfVxuICAgICAgdGhpcy5wYW5lLmNzcyh7XG4gICAgICAgIG9wYWNpdHk6ICh0aGlzLm9wdGlvbnMuYWx3YXlzVmlzaWJsZSA/IDEgOiAnJyksXG4gICAgICAgIHZpc2liaWxpdHk6ICh0aGlzLm9wdGlvbnMuYWx3YXlzVmlzaWJsZSA/ICd2aXNpYmxlJyA6ICcnKVxuICAgICAgfSk7XG4gICAgICBjb250ZW50UG9zaXRpb24gPSB0aGlzLiRjb250ZW50LmNzcygncG9zaXRpb24nKTtcbiAgICAgIGlmIChjb250ZW50UG9zaXRpb24gPT09ICdzdGF0aWMnIHx8IGNvbnRlbnRQb3NpdGlvbiA9PT0gJ3JlbGF0aXZlJykge1xuICAgICAgICByaWdodCA9IHBhcnNlSW50KHRoaXMuJGNvbnRlbnQuY3NzKCdyaWdodCcpLCAxMCk7XG4gICAgICAgIGlmIChyaWdodCkge1xuICAgICAgICAgIHRoaXMuJGNvbnRlbnQuY3NzKHtcbiAgICAgICAgICAgIHJpZ2h0OiAnJyxcbiAgICAgICAgICAgIG1hcmdpblJpZ2h0OiByaWdodFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgIEBtZXRob2Qgc2Nyb2xsXG4gICAgICBAcHJpdmF0ZVxuICAgICAgQGV4YW1wbGVcbiAgICAgICAgICAkKFwiLm5hbm9cIikubmFub1Njcm9sbGVyKHsgc2Nyb2xsOiAndG9wJyB9KTtcbiAgICAgKi9cblxuICAgIE5hbm9TY3JvbGwucHJvdG90eXBlLnNjcm9sbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLmlzQWN0aXZlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2xpZGVyWSA9IE1hdGgubWF4KDAsIHRoaXMuc2xpZGVyWSk7XG4gICAgICB0aGlzLnNsaWRlclkgPSBNYXRoLm1pbih0aGlzLm1heFNsaWRlclRvcCwgdGhpcy5zbGlkZXJZKTtcbiAgICAgIHRoaXMuJGNvbnRlbnQuc2Nyb2xsVG9wKHRoaXMubWF4U2Nyb2xsVG9wICogdGhpcy5zbGlkZXJZIC8gdGhpcy5tYXhTbGlkZXJUb3ApO1xuICAgICAgaWYgKCF0aGlzLmlPU05hdGl2ZVNjcm9sbGluZykge1xuICAgICAgICB0aGlzLnVwZGF0ZVNjcm9sbFZhbHVlcygpO1xuICAgICAgICB0aGlzLnNldE9uU2Nyb2xsU3R5bGVzKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgIFNjcm9sbCBhdCB0aGUgYm90dG9tIHdpdGggYW4gb2Zmc2V0IHZhbHVlXG4gICAgICBAbWV0aG9kIHNjcm9sbEJvdHRvbVxuICAgICAgQHBhcmFtIG9mZnNldFkge051bWJlcn1cbiAgICAgIEBjaGFpbmFibGVcbiAgICAgIEBleGFtcGxlXG4gICAgICAgICAgJChcIi5uYW5vXCIpLm5hbm9TY3JvbGxlcih7IHNjcm9sbEJvdHRvbTogdmFsdWUgfSk7XG4gICAgICovXG5cbiAgICBOYW5vU2Nyb2xsLnByb3RvdHlwZS5zY3JvbGxCb3R0b20gPSBmdW5jdGlvbihvZmZzZXRZKSB7XG4gICAgICBpZiAoIXRoaXMuaXNBY3RpdmUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy4kY29udGVudC5zY3JvbGxUb3AodGhpcy5jb250ZW50SGVpZ2h0IC0gdGhpcy4kY29udGVudC5oZWlnaHQoKSAtIG9mZnNldFkpLnRyaWdnZXIoTU9VU0VXSEVFTCk7XG4gICAgICB0aGlzLnN0b3AoKS5yZXN0b3JlKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgIFNjcm9sbCBhdCB0aGUgdG9wIHdpdGggYW4gb2Zmc2V0IHZhbHVlXG4gICAgICBAbWV0aG9kIHNjcm9sbFRvcFxuICAgICAgQHBhcmFtIG9mZnNldFkge051bWJlcn1cbiAgICAgIEBjaGFpbmFibGVcbiAgICAgIEBleGFtcGxlXG4gICAgICAgICAgJChcIi5uYW5vXCIpLm5hbm9TY3JvbGxlcih7IHNjcm9sbFRvcDogdmFsdWUgfSk7XG4gICAgICovXG5cbiAgICBOYW5vU2Nyb2xsLnByb3RvdHlwZS5zY3JvbGxUb3AgPSBmdW5jdGlvbihvZmZzZXRZKSB7XG4gICAgICBpZiAoIXRoaXMuaXNBY3RpdmUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy4kY29udGVudC5zY3JvbGxUb3AoK29mZnNldFkpLnRyaWdnZXIoTU9VU0VXSEVFTCk7XG4gICAgICB0aGlzLnN0b3AoKS5yZXN0b3JlKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgIFNjcm9sbCB0byBhbiBlbGVtZW50XG4gICAgICBAbWV0aG9kIHNjcm9sbFRvXG4gICAgICBAcGFyYW0gbm9kZSB7Tm9kZX0gQSBub2RlIHRvIHNjcm9sbCB0by5cbiAgICAgIEBjaGFpbmFibGVcbiAgICAgIEBleGFtcGxlXG4gICAgICAgICAgJChcIi5uYW5vXCIpLm5hbm9TY3JvbGxlcih7IHNjcm9sbFRvOiAkKCcjYV9ub2RlJykgfSk7XG4gICAgICovXG5cbiAgICBOYW5vU2Nyb2xsLnByb3RvdHlwZS5zY3JvbGxUbyA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnNjcm9sbFRvcCh0aGlzLiRlbC5maW5kKG5vZGUpLmdldCgwKS5vZmZzZXRUb3ApO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICBUbyBzdG9wIHRoZSBvcGVyYXRpb24uXG4gICAgICBUaGlzIG9wdGlvbiB3aWxsIHRlbGwgdGhlIHBsdWdpbiB0byBkaXNhYmxlIGFsbCBldmVudCBiaW5kaW5ncyBhbmQgaGlkZSB0aGUgZ2FkZ2V0IHNjcm9sbGJhciBmcm9tIHRoZSBVSS5cbiAgICAgIEBtZXRob2Qgc3RvcFxuICAgICAgQGNoYWluYWJsZVxuICAgICAgQGV4YW1wbGVcbiAgICAgICAgICAkKFwiLm5hbm9cIikubmFub1Njcm9sbGVyKHsgc3RvcDogdHJ1ZSB9KTtcbiAgICAgKi9cblxuICAgIE5hbm9TY3JvbGwucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChjQUYgJiYgdGhpcy5zY3JvbGxSQUYpIHtcbiAgICAgICAgY0FGKHRoaXMuc2Nyb2xsUkFGKTtcbiAgICAgICAgdGhpcy5zY3JvbGxSQUYgPSBudWxsO1xuICAgICAgfVxuICAgICAgdGhpcy5zdG9wcGVkID0gdHJ1ZTtcbiAgICAgIHRoaXMucmVtb3ZlRXZlbnRzKCk7XG4gICAgICBpZiAoIXRoaXMuaU9TTmF0aXZlU2Nyb2xsaW5nKSB7XG4gICAgICAgIHRoaXMucGFuZS5oaWRlKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgIERlc3Ryb3lzIG5hbm9TY3JvbGxlciBhbmQgcmVzdG9yZXMgYnJvd3NlcidzIG5hdGl2ZSBzY3JvbGxiYXIuXG4gICAgICBAbWV0aG9kIGRlc3Ryb3lcbiAgICAgIEBjaGFpbmFibGVcbiAgICAgIEBleGFtcGxlXG4gICAgICAgICAgJChcIi5uYW5vXCIpLm5hbm9TY3JvbGxlcih7IGRlc3Ryb3k6IHRydWUgfSk7XG4gICAgICovXG5cbiAgICBOYW5vU2Nyb2xsLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMuc3RvcHBlZCkge1xuICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5pT1NOYXRpdmVTY3JvbGxpbmcgJiYgdGhpcy5wYW5lLmxlbmd0aCkge1xuICAgICAgICB0aGlzLnBhbmUucmVtb3ZlKCk7XG4gICAgICB9XG4gICAgICBpZiAoQlJPV1NFUl9JU19JRTcpIHtcbiAgICAgICAgdGhpcy4kY29udGVudC5oZWlnaHQoJycpO1xuICAgICAgfVxuICAgICAgdGhpcy4kY29udGVudC5yZW1vdmVBdHRyKCd0YWJpbmRleCcpO1xuICAgICAgaWYgKHRoaXMuJGVsLmhhc0NsYXNzKCdoYXMtc2Nyb2xsYmFyJykpIHtcbiAgICAgICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2hhcy1zY3JvbGxiYXInKTtcbiAgICAgICAgdGhpcy4kY29udGVudC5jc3Moe1xuICAgICAgICAgIHJpZ2h0OiAnJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAgVG8gZmxhc2ggdGhlIHNjcm9sbGJhciBnYWRnZXQgZm9yIGFuIGFtb3VudCBvZiB0aW1lIGRlZmluZWQgaW4gcGx1Z2luIHNldHRpbmdzIChkZWZhdWx0cyB0byAxLDVzKS5cbiAgICAgIFVzZWZ1bCBpZiB5b3Ugd2FudCB0byBzaG93IHRoZSB1c2VyIChlLmcuIG9uIHBhZ2Vsb2FkKSB0aGF0IHRoZXJlIGlzIG1vcmUgY29udGVudCB3YWl0aW5nIGZvciBoaW0uXG4gICAgICBAbWV0aG9kIGZsYXNoXG4gICAgICBAY2hhaW5hYmxlXG4gICAgICBAZXhhbXBsZVxuICAgICAgICAgICQoXCIubmFub1wiKS5uYW5vU2Nyb2xsZXIoeyBmbGFzaDogdHJ1ZSB9KTtcbiAgICAgKi9cblxuICAgIE5hbm9TY3JvbGwucHJvdG90eXBlLmZsYXNoID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5pT1NOYXRpdmVTY3JvbGxpbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLmlzQWN0aXZlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgIHRoaXMucGFuZS5hZGRDbGFzcygnZmxhc2hlZCcpO1xuICAgICAgc2V0VGltZW91dCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIF90aGlzLnBhbmUucmVtb3ZlQ2xhc3MoJ2ZsYXNoZWQnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpLCB0aGlzLm9wdGlvbnMuZmxhc2hEZWxheSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIE5hbm9TY3JvbGw7XG5cbiAgfSkoKTtcbiAgJC5mbi5uYW5vU2Nyb2xsZXIgPSBmdW5jdGlvbihzZXR0aW5ncykge1xuICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgb3B0aW9ucywgc2Nyb2xsYmFyO1xuICAgICAgaWYgKCEoc2Nyb2xsYmFyID0gdGhpcy5uYW5vc2Nyb2xsZXIpKSB7XG4gICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIHNldHRpbmdzKTtcbiAgICAgICAgdGhpcy5uYW5vc2Nyb2xsZXIgPSBzY3JvbGxiYXIgPSBuZXcgTmFub1Njcm9sbCh0aGlzLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIGlmIChzZXR0aW5ncyAmJiB0eXBlb2Ygc2V0dGluZ3MgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgJC5leHRlbmQoc2Nyb2xsYmFyLm9wdGlvbnMsIHNldHRpbmdzKTtcbiAgICAgICAgaWYgKHNldHRpbmdzLnNjcm9sbEJvdHRvbSAhPSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIHNjcm9sbGJhci5zY3JvbGxCb3R0b20oc2V0dGluZ3Muc2Nyb2xsQm90dG9tKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2V0dGluZ3Muc2Nyb2xsVG9wICE9IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gc2Nyb2xsYmFyLnNjcm9sbFRvcChzZXR0aW5ncy5zY3JvbGxUb3ApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZXR0aW5ncy5zY3JvbGxUbykge1xuICAgICAgICAgIHJldHVybiBzY3JvbGxiYXIuc2Nyb2xsVG8oc2V0dGluZ3Muc2Nyb2xsVG8pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZXR0aW5ncy5zY3JvbGwgPT09ICdib3R0b20nKSB7XG4gICAgICAgICAgcmV0dXJuIHNjcm9sbGJhci5zY3JvbGxCb3R0b20oMCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNldHRpbmdzLnNjcm9sbCA9PT0gJ3RvcCcpIHtcbiAgICAgICAgICByZXR1cm4gc2Nyb2xsYmFyLnNjcm9sbFRvcCgwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2V0dGluZ3Muc2Nyb2xsICYmIHNldHRpbmdzLnNjcm9sbCBpbnN0YW5jZW9mICQpIHtcbiAgICAgICAgICByZXR1cm4gc2Nyb2xsYmFyLnNjcm9sbFRvKHNldHRpbmdzLnNjcm9sbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNldHRpbmdzLnN0b3ApIHtcbiAgICAgICAgICByZXR1cm4gc2Nyb2xsYmFyLnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2V0dGluZ3MuZGVzdHJveSkge1xuICAgICAgICAgIHJldHVybiBzY3JvbGxiYXIuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZXR0aW5ncy5mbGFzaCkge1xuICAgICAgICAgIHJldHVybiBzY3JvbGxiYXIuZmxhc2goKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHNjcm9sbGJhci5yZXNldCgpO1xuICAgIH0pO1xuICB9O1xuICAkLmZuLm5hbm9TY3JvbGxlci5Db25zdHJ1Y3RvciA9IE5hbm9TY3JvbGw7XG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9anF1ZXJ5Lm5hbm9zY3JvbGxlci5qcy5tYXBcbiIsIi8qKlxuKlxuKiBqcXVlcnkuc3BhcmtsaW5lLmpzXG4qXG4qIHZAVkVSU0lPTkBcbiogKGMpIFNwbHVuaywgSW5jXG4qIENvbnRhY3Q6IEdhcmV0aCBXYXR0cyAoZ2FyZXRoQHNwbHVuay5jb20pXG4qIGh0dHA6Ly9vbW5pcG90ZW50Lm5ldC9qcXVlcnkuc3BhcmtsaW5lL1xuKlxuKiBHZW5lcmF0ZXMgaW5saW5lIHNwYXJrbGluZSBjaGFydHMgZnJvbSBkYXRhIHN1cHBsaWVkIGVpdGhlciB0byB0aGUgbWV0aG9kXG4qIG9yIGlubGluZSBpbiBIVE1MXG4qXG4qIENvbXBhdGlibGUgd2l0aCBJbnRlcm5ldCBFeHBsb3JlciA2LjArIGFuZCBtb2Rlcm4gYnJvd3NlcnMgZXF1aXBwZWQgd2l0aCB0aGUgY2FudmFzIHRhZ1xuKiAoRmlyZWZveCAyLjArLCBTYWZhcmksIE9wZXJhLCBldGMpXG4qXG4qIExpY2Vuc2U6IE5ldyBCU0QgTGljZW5zZVxuKlxuKiBDb3B5cmlnaHQgKGMpIDIwMTIsIFNwbHVuayBJbmMuXG4qIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4qXG4qIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sXG4qIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbipcbiogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLFxuKiAgICAgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsXG4qICAgICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb25cbiogICAgICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4qICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgU3BsdW5rIEluYyBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5XG4qICAgICAgIGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXRcbiogICAgICAgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLlxuKlxuKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkQgQU5ZXG4qIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFU1xuKiBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVFxuKiBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLFxuKiBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UXG4qIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pXG4qIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSxcbiogT1IgVE9SVCAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuKiBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbipcbipcbiogVXNhZ2U6XG4qICAkKHNlbGVjdG9yKS5zcGFya2xpbmUodmFsdWVzLCBvcHRpb25zKVxuKlxuKiBJZiB2YWx1ZXMgaXMgdW5kZWZpbmVkIG9yIHNldCB0byAnaHRtbCcgdGhlbiB0aGUgZGF0YSB2YWx1ZXMgYXJlIHJlYWQgZnJvbSB0aGUgc3BlY2lmaWVkIHRhZzpcbiogICA8cD5TcGFya2xpbmU6IDxzcGFuIGNsYXNzPVwic3BhcmtsaW5lXCI+MSw0LDYsNiw4LDUsMyw1PC9zcGFuPjwvcD5cbiogICAkKCcuc3BhcmtsaW5lJykuc3BhcmtsaW5lKCk7XG4qIFRoZXJlIG11c3QgYmUgbm8gc3BhY2VzIGluIHRoZSBlbmNsb3NlZCBkYXRhIHNldFxuKlxuKiBPdGhlcndpc2UgdmFsdWVzIG11c3QgYmUgYW4gYXJyYXkgb2YgbnVtYmVycyBvciBudWxsIHZhbHVlc1xuKiAgICA8cD5TcGFya2xpbmU6IDxzcGFuIGlkPVwic3BhcmtsaW5lMVwiPlRoaXMgdGV4dCByZXBsYWNlZCBpZiB0aGUgYnJvd3NlciBpcyBjb21wYXRpYmxlPC9zcGFuPjwvcD5cbiogICAgJCgnI3NwYXJrbGluZTEnKS5zcGFya2xpbmUoWzEsNCw2LDYsOCw1LDMsNV0pXG4qICAgICQoJyNzcGFya2xpbmUyJykuc3BhcmtsaW5lKFsxLDQsNixudWxsLG51bGwsNSwzLDVdKVxuKlxuKiBWYWx1ZXMgY2FuIGFsc28gYmUgc3BlY2lmaWVkIGluIGFuIEhUTUwgY29tbWVudCwgb3IgYXMgYSB2YWx1ZXMgYXR0cmlidXRlOlxuKiAgICA8cD5TcGFya2xpbmU6IDxzcGFuIGNsYXNzPVwic3BhcmtsaW5lXCI+PCEtLTEsNCw2LDYsOCw1LDMsNSAtLT48L3NwYW4+PC9wPlxuKiAgICA8cD5TcGFya2xpbmU6IDxzcGFuIGNsYXNzPVwic3BhcmtsaW5lXCIgdmFsdWVzPVwiMSw0LDYsNiw4LDUsMyw1XCI+PC9zcGFuPjwvcD5cbiogICAgJCgnLnNwYXJrbGluZScpLnNwYXJrbGluZSgpO1xuKlxuKiBGb3IgbGluZSBjaGFydHMsIHggdmFsdWVzIGNhbiBhbHNvIGJlIHNwZWNpZmllZDpcbiogICA8cD5TcGFya2xpbmU6IDxzcGFuIGNsYXNzPVwic3BhcmtsaW5lXCI+MToxLDIuNzo0LDMuNDo2LDU6Niw2OjgsOC43OjUsOTozLDEwOjU8L3NwYW4+PC9wPlxuKiAgICAkKCcjc3BhcmtsaW5lMScpLnNwYXJrbGluZShbIFsxLDFdLCBbMi43LDRdLCBbMy40LDZdLCBbNSw2XSwgWzYsOF0sIFs4LjcsNV0sIFs5LDNdLCBbMTAsNV0gXSlcbipcbiogQnkgZGVmYXVsdCwgb3B0aW9ucyBzaG91bGQgYmUgcGFzc2VkIGluIGFzIHRoZSBzZWNvbmQgYXJndW1lbnQgdG8gdGhlIHNwYXJrbGluZSBmdW5jdGlvbjpcbiogICAkKCcuc3BhcmtsaW5lJykuc3BhcmtsaW5lKFsxLDIsMyw0XSwge3R5cGU6ICdiYXInfSlcbipcbiogT3B0aW9ucyBjYW4gYWxzbyBiZSBzZXQgYnkgcGFzc2luZyB0aGVtIG9uIHRoZSB0YWcgaXRzZWxmLiAgVGhpcyBmZWF0dXJlIGlzIGRpc2FibGVkIGJ5IGRlZmF1bHQgdGhvdWdoXG4qIGFzIHRoZXJlJ3MgYSBzbGlnaHQgcGVyZm9ybWFuY2Ugb3ZlcmhlYWQ6XG4qICAgJCgnLnNwYXJrbGluZScpLnNwYXJrbGluZShbMSwyLDMsNF0sIHtlbmFibGVUYWdPcHRpb25zOiB0cnVlfSlcbiogICA8cD5TcGFya2xpbmU6IDxzcGFuIGNsYXNzPVwic3BhcmtsaW5lXCIgc3BhcmtUeXBlPVwiYmFyXCIgc3BhcmtCYXJDb2xvcj1cInJlZFwiPmxvYWRpbmc8L3NwYW4+PC9wPlxuKiBQcmVmaXggYWxsIG9wdGlvbnMgc3VwcGxpZWQgYXMgdGFnIGF0dHJpYnV0ZSB3aXRoIFwic3BhcmtcIiAoY29uZmlndXJhYmxlIGJ5IHNldHRpbmcgdGFnT3B0aW9uc1ByZWZpeClcbipcbiogU3VwcG9ydGVkIG9wdGlvbnM6XG4qICAgbGluZUNvbG9yIC0gQ29sb3Igb2YgdGhlIGxpbmUgdXNlZCBmb3IgdGhlIGNoYXJ0XG4qICAgZmlsbENvbG9yIC0gQ29sb3IgdXNlZCB0byBmaWxsIGluIHRoZSBjaGFydCAtIFNldCB0byAnJyBvciBmYWxzZSBmb3IgYSB0cmFuc3BhcmVudCBjaGFydFxuKiAgIHdpZHRoIC0gV2lkdGggb2YgdGhlIGNoYXJ0IC0gRGVmYXVsdHMgdG8gMyB0aW1lcyB0aGUgbnVtYmVyIG9mIHZhbHVlcyBpbiBwaXhlbHNcbiogICBoZWlnaHQgLSBIZWlnaHQgb2YgdGhlIGNoYXJ0IC0gRGVmYXVsdHMgdG8gdGhlIGhlaWdodCBvZiB0aGUgY29udGFpbmluZyBlbGVtZW50XG4qICAgY2hhcnRSYW5nZU1pbiAtIFNwZWNpZnkgdGhlIG1pbmltdW0gdmFsdWUgdG8gdXNlIGZvciB0aGUgWSByYW5nZSBvZiB0aGUgY2hhcnQgLSBEZWZhdWx0cyB0byB0aGUgbWluaW11bSB2YWx1ZSBzdXBwbGllZFxuKiAgIGNoYXJ0UmFuZ2VNYXggLSBTcGVjaWZ5IHRoZSBtYXhpbXVtIHZhbHVlIHRvIHVzZSBmb3IgdGhlIFkgcmFuZ2Ugb2YgdGhlIGNoYXJ0IC0gRGVmYXVsdHMgdG8gdGhlIG1heGltdW0gdmFsdWUgc3VwcGxpZWRcbiogICBjaGFydFJhbmdlQ2xpcCAtIENsaXAgb3V0IG9mIHJhbmdlIHZhbHVlcyB0byB0aGUgbWF4L21pbiBzcGVjaWZpZWQgYnkgY2hhcnRSYW5nZU1pbiBhbmQgY2hhcnRSYW5nZU1heFxuKiAgIGNoYXJ0UmFuZ2VNaW5YIC0gU3BlY2lmeSB0aGUgbWluaW11bSB2YWx1ZSB0byB1c2UgZm9yIHRoZSBYIHJhbmdlIG9mIHRoZSBjaGFydCAtIERlZmF1bHRzIHRvIHRoZSBtaW5pbXVtIHZhbHVlIHN1cHBsaWVkXG4qICAgY2hhcnRSYW5nZU1heFggLSBTcGVjaWZ5IHRoZSBtYXhpbXVtIHZhbHVlIHRvIHVzZSBmb3IgdGhlIFggcmFuZ2Ugb2YgdGhlIGNoYXJ0IC0gRGVmYXVsdHMgdG8gdGhlIG1heGltdW0gdmFsdWUgc3VwcGxpZWRcbiogICBjb21wb3NpdGUgLSBJZiB0cnVlIHRoZW4gZG9uJ3QgZXJhc2UgYW55IGV4aXN0aW5nIGNoYXJ0IGF0dGFjaGVkIHRvIHRoZSB0YWcsIGJ1dCBkcmF3XG4qICAgICAgICAgICBhbm90aGVyIGNoYXJ0IG92ZXIgdGhlIHRvcCAtIE5vdGUgdGhhdCB3aWR0aCBhbmQgaGVpZ2h0IGFyZSBpZ25vcmVkIGlmIGFuXG4qICAgICAgICAgICBleGlzdGluZyBjaGFydCBpcyBkZXRlY3RlZC5cbiogICB0YWdWYWx1ZXNBdHRyaWJ1dGUgLSBOYW1lIG9mIHRhZyBhdHRyaWJ1dGUgdG8gY2hlY2sgZm9yIGRhdGEgdmFsdWVzIC0gRGVmYXVsdHMgdG8gJ3ZhbHVlcydcbiogICBlbmFibGVUYWdPcHRpb25zIC0gV2hldGhlciB0byBjaGVjayB0YWdzIGZvciBzcGFya2xpbmUgb3B0aW9uc1xuKiAgIHRhZ09wdGlvbnNQcmVmaXggLSBQcmVmaXggdXNlZCBmb3Igb3B0aW9ucyBzdXBwbGllZCBhcyB0YWcgYXR0cmlidXRlcyAtIERlZmF1bHRzIHRvICdzcGFyaydcbiogICBkaXNhYmxlSGlkZGVuQ2hlY2sgLSBJZiBzZXQgdG8gdHJ1ZSwgdGhlbiB0aGUgcGx1Z2luIHdpbGwgYXNzdW1lIHRoYXQgY2hhcnRzIHdpbGwgbmV2ZXIgYmUgZHJhd24gaW50byBhXG4qICAgICAgICAgICBoaWRkZW4gZG9tIGVsZW1lbnQsIGF2b2RpbmcgYSBicm93c2VyIHJlZmxvd1xuKiAgIGRpc2FibGVJbnRlcmFjdGlvbiAtIElmIHNldCB0byB0cnVlIHRoZW4gYWxsIG1vdXNlb3Zlci9jbGljayBpbnRlcmFjdGlvbiBiZWhhdmlvdXIgd2lsbCBiZSBkaXNhYmxlZCxcbiogICAgICAgbWFraW5nIHRoZSBwbHVnaW4gcGVyZm9ybSBtdWNoIGxpa2UgaXQgZGlkIGluIDEueFxuKiAgIGRpc2FibGVUb29sdGlwcyAtIElmIHNldCB0byB0cnVlIHRoZW4gdG9vbHRpcHMgd2lsbCBiZSBkaXNhYmxlZCAtIERlZmF1bHRzIHRvIGZhbHNlICh0b29sdGlwcyBlbmFibGVkKVxuKiAgIGRpc2FibGVIaWdobGlnaHQgLSBJZiBzZXQgdG8gdHJ1ZSB0aGVuIGhpZ2hsaWdodGluZyBvZiBzZWxlY3RlZCBjaGFydCBlbGVtZW50cyBvbiBtb3VzZW92ZXIgd2lsbCBiZSBkaXNhYmxlZFxuKiAgICAgICBkZWZhdWx0cyB0byBmYWxzZSAoaGlnaGxpZ2h0cyBlbmFibGVkKVxuKiAgIGhpZ2hsaWdodExpZ2h0ZW4gLSBGYWN0b3IgdG8gbGlnaHRlbi9kYXJrZW4gaGlnaGxpZ2h0ZWQgY2hhcnQgdmFsdWVzIGJ5IC0gRGVmYXVsdHMgdG8gMS40IGZvciBhIDQwJSBpbmNyZWFzZVxuKiAgIHRvb2x0aXBDb250YWluZXIgLSBTcGVjaWZ5IHdoaWNoIERPTSBlbGVtZW50IHRoZSB0b29sdGlwIHNob3VsZCBiZSByZW5kZXJlZCBpbnRvIC0gZGVmYXVsdHMgdG8gZG9jdW1lbnQuYm9keVxuKiAgIHRvb2x0aXBDbGFzc25hbWUgLSBPcHRpb25hbCBDU1MgY2xhc3NuYW1lIHRvIGFwcGx5IHRvIHRvb2x0aXBzIC0gSWYgbm90IHNwZWNpZmllZCB0aGVuIGEgZGVmYXVsdCBzdHlsZSB3aWxsIGJlIGFwcGxpZWRcbiogICB0b29sdGlwT2Zmc2V0WCAtIEhvdyBtYW55IHBpeGVscyBhd2F5IGZyb20gdGhlIG1vdXNlIHBvaW50ZXIgdG8gcmVuZGVyIHRoZSB0b29sdGlwIG9uIHRoZSBYIGF4aXNcbiogICB0b29sdGlwT2Zmc2V0WSAtIEhvdyBtYW55IHBpeGVscyBhd2F5IGZyb20gdGhlIG1vdXNlIHBvaW50ZXIgdG8gcmVuZGVyIHRoZSB0b29sdGlwIG9uIHRoZSByIGF4aXNcbiogICB0b29sdGlwRm9ybWF0dGVyICAtIE9wdGlvbmFsIGNhbGxiYWNrIHRoYXQgYWxsb3dzIHlvdSB0byBvdmVycmlkZSB0aGUgSFRNTCBkaXNwbGF5ZWQgaW4gdGhlIHRvb2x0aXBcbiogICAgICAgY2FsbGJhY2sgaXMgZ2l2ZW4gYXJndW1lbnRzIG9mIChzcGFya2xpbmUsIG9wdGlvbnMsIGZpZWxkcylcbiogICB0b29sdGlwQ2hhcnRUaXRsZSAtIElmIHNwZWNpZmllZCB0aGVuIHRoZSB0b29sdGlwIHVzZXMgdGhlIHN0cmluZyBzcGVjaWZpZWQgYnkgdGhpcyBzZXR0aW5nIGFzIGEgdGl0bGVcbiogICB0b29sdGlwRm9ybWF0IC0gQSBmb3JtYXQgc3RyaW5nIG9yIFNQRm9ybWF0IG9iamVjdCAgKG9yIGFuIGFycmF5IHRoZXJlb2YgZm9yIG11bHRpcGxlIGVudHJpZXMpXG4qICAgICAgIHRvIGNvbnRyb2wgdGhlIGZvcm1hdCBvZiB0aGUgdG9vbHRpcFxuKiAgIHRvb2x0aXBQcmVmaXggLSBBIHN0cmluZyB0byBwcmVwZW5kIHRvIGVhY2ggZmllbGQgZGlzcGxheWVkIGluIGEgdG9vbHRpcFxuKiAgIHRvb2x0aXBTdWZmaXggLSBBIHN0cmluZyB0byBhcHBlbmQgdG8gZWFjaCBmaWVsZCBkaXNwbGF5ZWQgaW4gYSB0b29sdGlwXG4qICAgdG9vbHRpcFNraXBOdWxsIC0gSWYgdHJ1ZSB0aGVuIG51bGwgdmFsdWVzIHdpbGwgbm90IGhhdmUgYSB0b29sdGlwIGRpc3BsYXllZCAoZGVmYXVsdHMgdG8gdHJ1ZSlcbiogICB0b29sdGlwVmFsdWVMb29rdXBzIC0gQW4gb2JqZWN0IG9yIHJhbmdlIG1hcCB0byBtYXAgZmllbGQgdmFsdWVzIHRvIHRvb2x0aXAgc3RyaW5nc1xuKiAgICAgICAoZWcuIHRvIG1hcCAtMSB0byBcIkxvc3RcIiwgMCB0byBcIkRyYXdcIiwgYW5kIDEgdG8gXCJXaW5cIilcbiogICBudW1iZXJGb3JtYXR0ZXIgLSBPcHRpb25hbCBjYWxsYmFjayBmb3IgZm9ybWF0dGluZyBudW1iZXJzIGluIHRvb2x0aXBzXG4qICAgbnVtYmVyRGlnaXRHcm91cFNlcCAtIENoYXJhY3RlciB0byB1c2UgZm9yIGdyb3VwIHNlcGFyYXRvciBpbiBudW1iZXJzIFwiMSwyMzRcIiAtIERlZmF1bHRzIHRvIFwiLFwiXG4qICAgbnVtYmVyRGVjaW1hbE1hcmsgLSBDaGFyYWN0ZXIgdG8gdXNlIGZvciB0aGUgZGVjaW1hbCBwb2ludCB3aGVuIGZvcm1hdHRpbmcgbnVtYmVycyAtIERlZmF1bHRzIHRvIFwiLlwiXG4qICAgbnVtYmVyRGlnaXRHcm91cENvdW50IC0gTnVtYmVyIG9mIGRpZ2l0cyBiZXR3ZWVuIGdyb3VwIHNlcGFyYXRvciAtIERlZmF1bHRzIHRvIDNcbipcbiogVGhlcmUgYXJlIDcgdHlwZXMgb2Ygc3BhcmtsaW5lLCBzZWxlY3RlZCBieSBzdXBwbHlpbmcgYSBcInR5cGVcIiBvcHRpb24gb2YgJ2xpbmUnIChkZWZhdWx0KSxcbiogJ2JhcicsICd0cmlzdGF0ZScsICdidWxsZXQnLCAnZGlzY3JldGUnLCAncGllJyBvciAnYm94J1xuKiAgICBsaW5lIC0gTGluZSBjaGFydC4gIE9wdGlvbnM6XG4qICAgICAgIHNwb3RDb2xvciAtIFNldCB0byAnJyB0byBub3QgZW5kIGVhY2ggbGluZSBpbiBhIGNpcmN1bGFyIHNwb3RcbiogICAgICAgbWluU3BvdENvbG9yIC0gSWYgc2V0LCBjb2xvciBvZiBzcG90IGF0IG1pbmltdW0gdmFsdWVcbiogICAgICAgbWF4U3BvdENvbG9yIC0gSWYgc2V0LCBjb2xvciBvZiBzcG90IGF0IG1heGltdW0gdmFsdWVcbiogICAgICAgc3BvdFJhZGl1cyAtIFJhZGl1cyBpbiBwaXhlbHNcbiogICAgICAgbGluZVdpZHRoIC0gV2lkdGggb2YgbGluZSBpbiBwaXhlbHNcbiogICAgICAgbm9ybWFsUmFuZ2VNaW5cbiogICAgICAgbm9ybWFsUmFuZ2VNYXggLSBJZiBzZXQgZHJhd3MgYSBmaWxsZWQgaG9yaXpvbnRhbCBiYXIgYmV0d2VlbiB0aGVzZSB0d28gdmFsdWVzIG1hcmtpbmcgdGhlIFwibm9ybWFsXCJcbiogICAgICAgICAgICAgICAgICAgICAgb3IgZXhwZWN0ZWQgcmFuZ2Ugb2YgdmFsdWVzXG4qICAgICAgIG5vcm1hbFJhbmdlQ29sb3IgLSBDb2xvciB0byB1c2UgZm9yIHRoZSBhYm92ZSBiYXJcbiogICAgICAgZHJhd05vcm1hbE9uVG9wIC0gRHJhdyB0aGUgbm9ybWFsIHJhbmdlIGFib3ZlIHRoZSBjaGFydCBmaWxsIGNvbG9yIGlmIHRydWVcbiogICAgICAgZGVmYXVsdFBpeGVsc1BlclZhbHVlIC0gRGVmYXVsdHMgdG8gMyBwaXhlbHMgb2Ygd2lkdGggZm9yIGVhY2ggdmFsdWUgaW4gdGhlIGNoYXJ0XG4qICAgICAgIGhpZ2hsaWdodFNwb3RDb2xvciAtIFRoZSBjb2xvciB0byB1c2UgZm9yIGRyYXdpbmcgYSBoaWdobGlnaHQgc3BvdCBvbiBtb3VzZW92ZXIgLSBTZXQgdG8gbnVsbCB0byBkaXNhYmxlXG4qICAgICAgIGhpZ2hsaWdodExpbmVDb2xvciAtIFRoZSBjb2xvciB0byB1c2UgZm9yIGRyYXdpbmcgYSBoaWdobGlnaHQgbGluZSBvbiBtb3VzZW92ZXIgLSBTZXQgdG8gbnVsbCB0byBkaXNhYmxlXG4qICAgICAgIHZhbHVlU3BvdHMgLSBTcGVjaWZ5IHdoaWNoIHBvaW50cyB0byBkcmF3IHNwb3RzIG9uLCBhbmQgaW4gd2hpY2ggY29sb3IuICBBY2NlcHRzIGEgcmFuZ2UgbWFwXG4qXG4qICAgYmFyIC0gQmFyIGNoYXJ0LiAgT3B0aW9uczpcbiogICAgICAgYmFyQ29sb3IgLSBDb2xvciBvZiBiYXJzIGZvciBwb3N0aXZlIHZhbHVlc1xuKiAgICAgICBuZWdCYXJDb2xvciAtIENvbG9yIG9mIGJhcnMgZm9yIG5lZ2F0aXZlIHZhbHVlc1xuKiAgICAgICB6ZXJvQ29sb3IgLSBDb2xvciBvZiBiYXJzIHdpdGggemVybyB2YWx1ZXNcbiogICAgICAgbnVsbENvbG9yIC0gQ29sb3Igb2YgYmFycyB3aXRoIG51bGwgdmFsdWVzIC0gRGVmYXVsdHMgdG8gb21pdHRpbmcgdGhlIGJhciBlbnRpcmVseVxuKiAgICAgICBiYXJXaWR0aCAtIFdpZHRoIG9mIGJhcnMgaW4gcGl4ZWxzXG4qICAgICAgIGNvbG9yTWFwIC0gT3B0aW9uYWwgbWFwcG5pZyBvZiB2YWx1ZXMgdG8gY29sb3JzIHRvIG92ZXJyaWRlIHRoZSAqQmFyQ29sb3IgdmFsdWVzIGFib3ZlXG4qICAgICAgICAgICAgICAgICAgY2FuIGJlIGFuIEFycmF5IG9mIHZhbHVlcyB0byBjb250cm9sIHRoZSBjb2xvciBvZiBpbmRpdmlkdWFsIGJhcnMgb3IgYSByYW5nZSBtYXBcbiogICAgICAgICAgICAgICAgICB0byBzcGVjaWZ5IGNvbG9ycyBmb3IgaW5kaXZpZHVhbCByYW5nZXMgb2YgdmFsdWVzXG4qICAgICAgIGJhclNwYWNpbmcgLSBHYXAgYmV0d2VlbiBiYXJzIGluIHBpeGVsc1xuKiAgICAgICB6ZXJvQXhpcyAtIENlbnRlcnMgdGhlIHktYXhpcyBhcm91bmQgemVybyBpZiB0cnVlXG4qXG4qICAgdHJpc3RhdGUgLSBDaGFydHMgdmFsdWVzIG9mIHdpbiAoPjApLCBsb3NlICg8MCkgb3IgZHJhdyAoPTApXG4qICAgICAgIHBvc0JhckNvbG9yIC0gQ29sb3Igb2Ygd2luIHZhbHVlc1xuKiAgICAgICBuZWdCYXJDb2xvciAtIENvbG9yIG9mIGxvc2UgdmFsdWVzXG4qICAgICAgIHplcm9CYXJDb2xvciAtIENvbG9yIG9mIGRyYXcgdmFsdWVzXG4qICAgICAgIGJhcldpZHRoIC0gV2lkdGggb2YgYmFycyBpbiBwaXhlbHNcbiogICAgICAgYmFyU3BhY2luZyAtIEdhcCBiZXR3ZWVuIGJhcnMgaW4gcGl4ZWxzXG4qICAgICAgIGNvbG9yTWFwIC0gT3B0aW9uYWwgbWFwcG5pZyBvZiB2YWx1ZXMgdG8gY29sb3JzIHRvIG92ZXJyaWRlIHRoZSAqQmFyQ29sb3IgdmFsdWVzIGFib3ZlXG4qICAgICAgICAgICAgICAgICAgY2FuIGJlIGFuIEFycmF5IG9mIHZhbHVlcyB0byBjb250cm9sIHRoZSBjb2xvciBvZiBpbmRpdmlkdWFsIGJhcnMgb3IgYSByYW5nZSBtYXBcbiogICAgICAgICAgICAgICAgICB0byBzcGVjaWZ5IGNvbG9ycyBmb3IgaW5kaXZpZHVhbCByYW5nZXMgb2YgdmFsdWVzXG4qXG4qICAgZGlzY3JldGUgLSBPcHRpb25zOlxuKiAgICAgICBsaW5lSGVpZ2h0IC0gSGVpZ2h0IG9mIGVhY2ggbGluZSBpbiBwaXhlbHMgLSBEZWZhdWx0cyB0byAzMCUgb2YgdGhlIGdyYXBoIGhlaWdodFxuKiAgICAgICB0aGVzaG9sZFZhbHVlIC0gVmFsdWVzIGxlc3MgdGhhbiB0aGlzIHZhbHVlIHdpbGwgYmUgZHJhd24gdXNpbmcgdGhyZXNob2xkQ29sb3IgaW5zdGVhZCBvZiBsaW5lQ29sb3JcbiogICAgICAgdGhyZXNob2xkQ29sb3JcbipcbiogICBidWxsZXQgLSBWYWx1ZXMgZm9yIGJ1bGxldCBncmFwaHMgbXN1dCBiZSBpbiB0aGUgb3JkZXI6IHRhcmdldCwgcGVyZm9ybWFuY2UsIHJhbmdlMSwgcmFuZ2UyLCByYW5nZTMsIC4uLlxuKiAgICAgICBvcHRpb25zOlxuKiAgICAgICB0YXJnZXRDb2xvciAtIFRoZSBjb2xvciBvZiB0aGUgdmVydGljYWwgdGFyZ2V0IG1hcmtlclxuKiAgICAgICB0YXJnZXRXaWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgdGFyZ2V0IG1hcmtlciBpbiBwaXhlbHNcbiogICAgICAgcGVyZm9ybWFuY2VDb2xvciAtIFRoZSBjb2xvciBvZiB0aGUgcGVyZm9ybWFuY2UgbWVhc3VyZSBob3Jpem9udGFsIGJhclxuKiAgICAgICByYW5nZUNvbG9ycyAtIENvbG9ycyB0byB1c2UgZm9yIGVhY2ggcXVhbGl0YXRpdmUgcmFuZ2UgYmFja2dyb3VuZCBjb2xvclxuKlxuKiAgIHBpZSAtIFBpZSBjaGFydC4gT3B0aW9uczpcbiogICAgICAgc2xpY2VDb2xvcnMgLSBBbiBhcnJheSBvZiBjb2xvcnMgdG8gdXNlIGZvciBwaWUgc2xpY2VzXG4qICAgICAgIG9mZnNldCAtIEFuZ2xlIGluIGRlZ3JlZXMgdG8gb2Zmc2V0IHRoZSBmaXJzdCBzbGljZSAtIFRyeSAtOTAgb3IgKzkwXG4qICAgICAgIGJvcmRlcldpZHRoIC0gV2lkdGggb2YgYm9yZGVyIHRvIGRyYXcgYXJvdW5kIHRoZSBwaWUgY2hhcnQsIGluIHBpeGVscyAtIERlZmF1bHRzIHRvIDAgKG5vIGJvcmRlcilcbiogICAgICAgYm9yZGVyQ29sb3IgLSBDb2xvciB0byB1c2UgZm9yIHRoZSBwaWUgY2hhcnQgYm9yZGVyIC0gRGVmYXVsdHMgdG8gIzAwMFxuKlxuKiAgIGJveCAtIEJveCBwbG90LiBPcHRpb25zOlxuKiAgICAgICByYXcgLSBTZXQgdG8gdHJ1ZSB0byBzdXBwbHkgcHJlLWNvbXB1dGVkIHBsb3QgcG9pbnRzIGFzIHZhbHVlc1xuKiAgICAgICAgICAgICB2YWx1ZXMgc2hvdWxkIGJlOiBsb3dfb3V0bGllciwgbG93X3doaXNrZXIsIHExLCBtZWRpYW4sIHEzLCBoaWdoX3doaXNrZXIsIGhpZ2hfb3V0bGllclxuKiAgICAgICAgICAgICBXaGVuIHNldCB0byBmYWxzZSB5b3UgY2FuIHN1cHBseSBhbnkgbnVtYmVyIG9mIHZhbHVlcyBhbmQgdGhlIGJveCBwbG90IHdpbGxcbiogICAgICAgICAgICAgYmUgY29tcHV0ZWQgZm9yIHlvdS4gIERlZmF1bHQgaXMgZmFsc2UuXG4qICAgICAgIHNob3dPdXRsaWVycyAtIFNldCB0byB0cnVlIChkZWZhdWx0KSB0byBkaXNwbGF5IG91dGxpZXJzIGFzIGNpcmNsZXNcbiogICAgICAgb3V0bGllcklRUiAtIEludGVycXVhcnRpbGUgcmFuZ2UgdXNlZCB0byBkZXRlcm1pbmUgb3V0bGllcnMuICBEZWZhdWx0IDEuNVxuKiAgICAgICBib3hMaW5lQ29sb3IgLSBPdXRsaW5lIGNvbG9yIG9mIHRoZSBib3hcbiogICAgICAgYm94RmlsbENvbG9yIC0gRmlsbCBjb2xvciBmb3IgdGhlIGJveFxuKiAgICAgICB3aGlza2VyQ29sb3IgLSBMaW5lIGNvbG9yIHVzZWQgZm9yIHdoaXNrZXJzXG4qICAgICAgIG91dGxpZXJMaW5lQ29sb3IgLSBPdXRsaW5lIGNvbG9yIG9mIG91dGxpZXIgY2lyY2xlc1xuKiAgICAgICBvdXRsaWVyRmlsbENvbG9yIC0gRmlsbCBjb2xvciBvZiB0aGUgb3V0bGllciBjaXJjbGVzXG4qICAgICAgIHNwb3RSYWRpdXMgLSBSYWRpdXMgb2Ygb3V0bGllciBjaXJjbGVzXG4qICAgICAgIG1lZGlhbkNvbG9yIC0gTGluZSBjb2xvciBvZiB0aGUgbWVkaWFuIGxpbmVcbiogICAgICAgdGFyZ2V0IC0gRHJhdyBhIHRhcmdldCBjcm9zcyBoYWlyIGF0IHRoZSBzdXBwbGllZCB2YWx1ZSAoZGVmYXVsdCB1bmRlZmluZWQpXG4qXG4qXG4qXG4qICAgRXhhbXBsZXM6XG4qICAgJCgnI3NwYXJrbGluZTEnKS5zcGFya2xpbmUobXl2YWx1ZXMsIHsgbGluZUNvbG9yOiAnI2YwMCcsIGZpbGxDb2xvcjogZmFsc2UgfSk7XG4qICAgJCgnLmJhcnNwYXJrcycpLnNwYXJrbGluZSgnaHRtbCcsIHsgdHlwZTonYmFyJywgaGVpZ2h0Oic0MHB4JywgYmFyV2lkdGg6NSB9KTtcbiogICAkKCcjdHJpc3RhdGUnKS5zcGFya2xpbmUoWzEsMSwtMSwxLDAsMCwtMV0sIHsgdHlwZTondHJpc3RhdGUnIH0pOlxuKiAgICQoJyNkaXNjcmV0ZScpLnNwYXJrbGluZShbMSwzLDQsNSw1LDMsNCw1XSwgeyB0eXBlOidkaXNjcmV0ZScgfSk7XG4qICAgJCgnI2J1bGxldCcpLnNwYXJrbGluZShbMTAsMTIsMTIsOSw3XSwgeyB0eXBlOididWxsZXQnIH0pO1xuKiAgICQoJyNwaWUnKS5zcGFya2xpbmUoWzEsMSwyXSwgeyB0eXBlOidwaWUnIH0pO1xuKi9cblxuLypqc2xpbnQgcmVnZXhwOiB0cnVlLCBicm93c2VyOiB0cnVlLCBqcXVlcnk6IHRydWUsIHdoaXRlOiB0cnVlLCBub21lbjogZmFsc2UsIHBsdXNwbHVzOiBmYWxzZSwgbWF4ZXJyOiA1MDAsIGluZGVudDogNCAqL1xuXG4oZnVuY3Rpb24oZG9jdW1lbnQsIE1hdGgsIHVuZGVmaW5lZCkgeyAvLyBwZXJmb3JtYW5jZS9taW5pZmllZC1zaXplIG9wdGltaXphdGlvblxuKGZ1bmN0aW9uKGZhY3RvcnkpIHtcbiAgICBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpO1xuICAgIH0gZWxzZSBpZiAoalF1ZXJ5ICYmICFqUXVlcnkuZm4uc3BhcmtsaW5lKSB7XG4gICAgICAgIGZhY3RvcnkoalF1ZXJ5KTtcbiAgICB9XG59XG4oZnVuY3Rpb24oJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBVTlNFVF9PUFRJT04gPSB7fSxcbiAgICAgICAgZ2V0RGVmYXVsdHMsIGNyZWF0ZUNsYXNzLCBTUEZvcm1hdCwgY2xpcHZhbCwgcXVhcnRpbGUsIG5vcm1hbGl6ZVZhbHVlLCBub3JtYWxpemVWYWx1ZXMsXG4gICAgICAgIHJlbW92ZSwgaXNOdW1iZXIsIGFsbCwgc3VtLCBhZGRDU1MsIGVuc3VyZUFycmF5LCBmb3JtYXROdW1iZXIsIFJhbmdlTWFwLFxuICAgICAgICBNb3VzZUhhbmRsZXIsIFRvb2x0aXAsIGJhckhpZ2hsaWdodE1peGluLFxuICAgICAgICBsaW5lLCBiYXIsIHRyaXN0YXRlLCBkaXNjcmV0ZSwgYnVsbGV0LCBwaWUsIGJveCwgZGVmYXVsdFN0eWxlcywgaW5pdFN0eWxlcyxcbiAgICAgICAgVlNoYXBlLCBWQ2FudmFzX2Jhc2UsIFZDYW52YXNfY2FudmFzLCBWQ2FudmFzX3ZtbCwgcGVuZGluZywgc2hhcGVDb3VudCA9IDA7XG5cblxuICAgIC8qKlxuICAgICAqIERlZmF1bHQgY29uZmlndXJhdGlvbiBzZXR0aW5nc1xuICAgICAqL1xuICAgIGdldERlZmF1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLy8gU2V0dGluZ3MgY29tbW9uIHRvIG1vc3QvYWxsIGNoYXJ0IHR5cGVzXG4gICAgICAgICAgICBjb21tb246IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnbGluZScsXG4gICAgICAgICAgICAgICAgbGluZUNvbG9yOiAnIzAwZicsXG4gICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnI2NkZicsXG4gICAgICAgICAgICAgICAgZGVmYXVsdFBpeGVsc1BlclZhbHVlOiAzLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAnYXV0bycsXG4gICAgICAgICAgICAgICAgY29tcG9zaXRlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0YWdWYWx1ZXNBdHRyaWJ1dGU6ICd2YWx1ZXMnLFxuICAgICAgICAgICAgICAgIHRhZ09wdGlvbnNQcmVmaXg6ICdzcGFyaycsXG4gICAgICAgICAgICAgICAgZW5hYmxlVGFnT3B0aW9uczogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlSGlnaGxpZ2h0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGhpZ2hsaWdodExpZ2h0ZW46IDEuNCxcbiAgICAgICAgICAgICAgICB0b29sdGlwU2tpcE51bGw6IHRydWUsXG4gICAgICAgICAgICAgICAgdG9vbHRpcFByZWZpeDogJycsXG4gICAgICAgICAgICAgICAgdG9vbHRpcFN1ZmZpeDogJycsXG4gICAgICAgICAgICAgICAgZGlzYWJsZUhpZGRlbkNoZWNrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBudW1iZXJGb3JtYXR0ZXI6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG51bWJlckRpZ2l0R3JvdXBDb3VudDogMyxcbiAgICAgICAgICAgICAgICBudW1iZXJEaWdpdEdyb3VwU2VwOiAnLCcsXG4gICAgICAgICAgICAgICAgbnVtYmVyRGVjaW1hbE1hcms6ICcuJyxcbiAgICAgICAgICAgICAgICBkaXNhYmxlVG9vbHRpcHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRpc2FibGVJbnRlcmFjdGlvbjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBEZWZhdWx0cyBmb3IgbGluZSBjaGFydHNcbiAgICAgICAgICAgIGxpbmU6IHtcbiAgICAgICAgICAgICAgICBzcG90Q29sb3I6ICcjZjgwJyxcbiAgICAgICAgICAgICAgICBoaWdobGlnaHRTcG90Q29sb3I6ICcjNWY1JyxcbiAgICAgICAgICAgICAgICBoaWdobGlnaHRMaW5lQ29sb3I6ICcjZjIyJyxcbiAgICAgICAgICAgICAgICBzcG90UmFkaXVzOiAxLjUsXG4gICAgICAgICAgICAgICAgbWluU3BvdENvbG9yOiAnI2Y4MCcsXG4gICAgICAgICAgICAgICAgbWF4U3BvdENvbG9yOiAnI2Y4MCcsXG4gICAgICAgICAgICAgICAgbGluZVdpZHRoOiAxLFxuICAgICAgICAgICAgICAgIG5vcm1hbFJhbmdlTWluOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgbm9ybWFsUmFuZ2VNYXg6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBub3JtYWxSYW5nZUNvbG9yOiAnI2NjYycsXG4gICAgICAgICAgICAgICAgZHJhd05vcm1hbE9uVG9wOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWluOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1heDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNaW5YOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1heFg6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0OiBuZXcgU1BGb3JtYXQoJzxzcGFuIHN0eWxlPVwiY29sb3I6IHt7Y29sb3J9fVwiPiYjOTY3OTs8L3NwYW4+IHt7cHJlZml4fX17e3l9fXt7c3VmZml4fX0nKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciBiYXIgY2hhcnRzXG4gICAgICAgICAgICBiYXI6IHtcbiAgICAgICAgICAgICAgICBiYXJDb2xvcjogJyMzMzY2Y2MnLFxuICAgICAgICAgICAgICAgIG5lZ0JhckNvbG9yOiAnI2Y0NCcsXG4gICAgICAgICAgICAgICAgc3RhY2tlZEJhckNvbG9yOiBbJyMzMzY2Y2MnLCAnI2RjMzkxMicsICcjZmY5OTAwJywgJyMxMDk2MTgnLCAnIzY2YWEwMCcsXG4gICAgICAgICAgICAgICAgICAgICcjZGQ0NDc3JywgJyMwMDk5YzYnLCAnIzk5MDA5OSddLFxuICAgICAgICAgICAgICAgIHplcm9Db2xvcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIG51bGxDb2xvcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHplcm9BeGlzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGJhcldpZHRoOiA0LFxuICAgICAgICAgICAgICAgIGJhclNwYWNpbmc6IDEsXG4gICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1heDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNaW46IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBjaGFydFJhbmdlQ2xpcDogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29sb3JNYXA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0OiBuZXcgU1BGb3JtYXQoJzxzcGFuIHN0eWxlPVwiY29sb3I6IHt7Y29sb3J9fVwiPiYjOTY3OTs8L3NwYW4+IHt7cHJlZml4fX17e3ZhbHVlfX17e3N1ZmZpeH19JylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBEZWZhdWx0cyBmb3IgdHJpc3RhdGUgY2hhcnRzXG4gICAgICAgICAgICB0cmlzdGF0ZToge1xuICAgICAgICAgICAgICAgIGJhcldpZHRoOiA0LFxuICAgICAgICAgICAgICAgIGJhclNwYWNpbmc6IDEsXG4gICAgICAgICAgICAgICAgcG9zQmFyQ29sb3I6ICcjNmY2JyxcbiAgICAgICAgICAgICAgICBuZWdCYXJDb2xvcjogJyNmNDQnLFxuICAgICAgICAgICAgICAgIHplcm9CYXJDb2xvcjogJyM5OTknLFxuICAgICAgICAgICAgICAgIGNvbG9yTWFwOiB7fSxcbiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0OiBuZXcgU1BGb3JtYXQoJzxzcGFuIHN0eWxlPVwiY29sb3I6IHt7Y29sb3J9fVwiPiYjOTY3OTs8L3NwYW4+IHt7dmFsdWU6bWFwfX0nKSxcbiAgICAgICAgICAgICAgICB0b29sdGlwVmFsdWVMb29rdXBzOiB7IG1hcDogeyAnLTEnOiAnTG9zcycsICcwJzogJ0RyYXcnLCAnMSc6ICdXaW4nIH0gfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciBkaXNjcmV0ZSBjaGFydHNcbiAgICAgICAgICAgIGRpc2NyZXRlOiB7XG4gICAgICAgICAgICAgICAgbGluZUhlaWdodDogJ2F1dG8nLFxuICAgICAgICAgICAgICAgIHRocmVzaG9sZENvbG9yOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdGhyZXNob2xkVmFsdWU6IDAsXG4gICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1heDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNaW46IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBjaGFydFJhbmdlQ2xpcDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdG9vbHRpcEZvcm1hdDogbmV3IFNQRm9ybWF0KCd7e3ByZWZpeH19e3t2YWx1ZX19e3tzdWZmaXh9fScpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gRGVmYXVsdHMgZm9yIGJ1bGxldCBjaGFydHNcbiAgICAgICAgICAgIGJ1bGxldDoge1xuICAgICAgICAgICAgICAgIHRhcmdldENvbG9yOiAnI2YzMycsXG4gICAgICAgICAgICAgICAgdGFyZ2V0V2lkdGg6IDMsIC8vIHdpZHRoIG9mIHRoZSB0YXJnZXQgYmFyIGluIHBpeGVsc1xuICAgICAgICAgICAgICAgIHBlcmZvcm1hbmNlQ29sb3I6ICcjMzNmJyxcbiAgICAgICAgICAgICAgICByYW5nZUNvbG9yczogWycjZDNkYWZlJywgJyNhOGI2ZmYnLCAnIzdmOTRmZiddLFxuICAgICAgICAgICAgICAgIGJhc2U6IHVuZGVmaW5lZCwgLy8gc2V0IHRoaXMgdG8gYSBudW1iZXIgdG8gY2hhbmdlIHRoZSBiYXNlIHN0YXJ0IG51bWJlclxuICAgICAgICAgICAgICAgIHRvb2x0aXBGb3JtYXQ6IG5ldyBTUEZvcm1hdCgne3tmaWVsZGtleTpmaWVsZHN9fSAtIHt7dmFsdWV9fScpLFxuICAgICAgICAgICAgICAgIHRvb2x0aXBWYWx1ZUxvb2t1cHM6IHsgZmllbGRzOiB7cjogJ1JhbmdlJywgcDogJ1BlcmZvcm1hbmNlJywgdDogJ1RhcmdldCd9IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBEZWZhdWx0cyBmb3IgcGllIGNoYXJ0c1xuICAgICAgICAgICAgcGllOiB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0OiAwLFxuICAgICAgICAgICAgICAgIHNsaWNlQ29sb3JzOiBbJyMzMzY2Y2MnLCAnI2RjMzkxMicsICcjZmY5OTAwJywgJyMxMDk2MTgnLCAnIzY2YWEwMCcsXG4gICAgICAgICAgICAgICAgICAgICcjZGQ0NDc3JywgJyMwMDk5YzYnLCAnIzk5MDA5OSddLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAwLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnIzAwMCcsXG4gICAgICAgICAgICAgICAgdG9vbHRpcEZvcm1hdDogbmV3IFNQRm9ybWF0KCc8c3BhbiBzdHlsZT1cImNvbG9yOiB7e2NvbG9yfX1cIj4mIzk2Nzk7PC9zcGFuPiB7e3ZhbHVlfX0gKHt7cGVyY2VudC4xfX0lKScpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gRGVmYXVsdHMgZm9yIGJveCBwbG90c1xuICAgICAgICAgICAgYm94OiB7XG4gICAgICAgICAgICAgICAgcmF3OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBib3hMaW5lQ29sb3I6ICcjMDAwJyxcbiAgICAgICAgICAgICAgICBib3hGaWxsQ29sb3I6ICcjY2RmJyxcbiAgICAgICAgICAgICAgICB3aGlza2VyQ29sb3I6ICcjMDAwJyxcbiAgICAgICAgICAgICAgICBvdXRsaWVyTGluZUNvbG9yOiAnIzMzMycsXG4gICAgICAgICAgICAgICAgb3V0bGllckZpbGxDb2xvcjogJyNmZmYnLFxuICAgICAgICAgICAgICAgIG1lZGlhbkNvbG9yOiAnI2YwMCcsXG4gICAgICAgICAgICAgICAgc2hvd091dGxpZXJzOiB0cnVlLFxuICAgICAgICAgICAgICAgIG91dGxpZXJJUVI6IDEuNSxcbiAgICAgICAgICAgICAgICBzcG90UmFkaXVzOiAxLjUsXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdGFyZ2V0Q29sb3I6ICcjNGEyJyxcbiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWF4OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1pbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHRvb2x0aXBGb3JtYXQ6IG5ldyBTUEZvcm1hdCgne3tmaWVsZDpmaWVsZHN9fToge3t2YWx1ZX19JyksXG4gICAgICAgICAgICAgICAgdG9vbHRpcEZvcm1hdEZpZWxkbGlzdEtleTogJ2ZpZWxkJyxcbiAgICAgICAgICAgICAgICB0b29sdGlwVmFsdWVMb29rdXBzOiB7IGZpZWxkczogeyBscTogJ0xvd2VyIFF1YXJ0aWxlJywgbWVkOiAnTWVkaWFuJyxcbiAgICAgICAgICAgICAgICAgICAgdXE6ICdVcHBlciBRdWFydGlsZScsIGxvOiAnTGVmdCBPdXRsaWVyJywgcm86ICdSaWdodCBPdXRsaWVyJyxcbiAgICAgICAgICAgICAgICAgICAgbHc6ICdMZWZ0IFdoaXNrZXInLCBydzogJ1JpZ2h0IFdoaXNrZXInfSB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIC8vIFlvdSBjYW4gaGF2ZSB0b29sdGlwcyB1c2UgYSBjc3MgY2xhc3Mgb3RoZXIgdGhhbiBqcXN0b29sdGlwIGJ5IHNwZWNpZnlpbmcgdG9vbHRpcENsYXNzbmFtZVxuICAgIGRlZmF1bHRTdHlsZXMgPSAnLmpxc3Rvb2x0aXAgeyAnICtcbiAgICAgICAgICAgICdwb3NpdGlvbjogYWJzb2x1dGU7JyArXG4gICAgICAgICAgICAnbGVmdDogMHB4OycgK1xuICAgICAgICAgICAgJ3RvcDogMHB4OycgK1xuICAgICAgICAgICAgJ3Zpc2liaWxpdHk6IGhpZGRlbjsnICtcbiAgICAgICAgICAgICdiYWNrZ3JvdW5kOiByZ2IoMCwgMCwgMCkgdHJhbnNwYXJlbnQ7JyArXG4gICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLDAsMCwwLjYpOycgK1xuICAgICAgICAgICAgJ2ZpbHRlcjpwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj0jOTkwMDAwMDAsIGVuZENvbG9yc3RyPSM5OTAwMDAwMCk7JyArXG4gICAgICAgICAgICAnLW1zLWZpbHRlcjogXCJwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj0jOTkwMDAwMDAsIGVuZENvbG9yc3RyPSM5OTAwMDAwMClcIjsnICtcbiAgICAgICAgICAgICdjb2xvcjogd2hpdGU7JyArXG4gICAgICAgICAgICAnZm9udDogMTBweCBhcmlhbCwgc2FuIHNlcmlmOycgK1xuICAgICAgICAgICAgJ3RleHQtYWxpZ246IGxlZnQ7JyArXG4gICAgICAgICAgICAnd2hpdGUtc3BhY2U6IG5vd3JhcDsnICtcbiAgICAgICAgICAgICdwYWRkaW5nOiA1cHg7JyArXG4gICAgICAgICAgICAnYm9yZGVyOiAxcHggc29saWQgd2hpdGU7JyArXG4gICAgICAgICAgICAnYm94LXNpemluZzogY29udGVudC1ib3g7JyArXG4gICAgICAgICAgICAnei1pbmRleDogMTAwMDA7JyArXG4gICAgICAgICAgICAnfScgK1xuICAgICAgICAgICAgJy5qcXNmaWVsZCB7ICcgK1xuICAgICAgICAgICAgJ2NvbG9yOiB3aGl0ZTsnICtcbiAgICAgICAgICAgICdmb250OiAxMHB4IGFyaWFsLCBzYW4gc2VyaWY7JyArXG4gICAgICAgICAgICAndGV4dC1hbGlnbjogbGVmdDsnICtcbiAgICAgICAgICAgICd9JztcblxuXG4gICAgLyoqXG4gICAgICogVXRpbGl0aWVzXG4gICAgICovXG5cbiAgICBjcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgvKiBbYmFzZWNsYXNzLCBbbWl4aW4sIC4uLl1dLCBkZWZpbml0aW9uICovKSB7XG4gICAgICAgIHZhciBDbGFzcywgYXJncztcbiAgICAgICAgQ2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmluaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzWzBdKSB7XG4gICAgICAgICAgICAgICAgQ2xhc3MucHJvdG90eXBlID0gJC5leHRlbmQobmV3IGFyZ3VtZW50c1swXSgpLCBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdKTtcbiAgICAgICAgICAgICAgICBDbGFzcy5fc3VwZXIgPSBhcmd1bWVudHNbMF0ucHJvdG90eXBlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBDbGFzcy5wcm90b3R5cGUgPSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSwgLTEpO1xuICAgICAgICAgICAgICAgIGFyZ3MudW5zaGlmdChDbGFzcy5wcm90b3R5cGUpO1xuICAgICAgICAgICAgICAgICQuZXh0ZW5kLmFwcGx5KCQsIGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgQ2xhc3MucHJvdG90eXBlID0gYXJndW1lbnRzWzBdO1xuICAgICAgICB9XG4gICAgICAgIENsYXNzLnByb3RvdHlwZS5jbHMgPSBDbGFzcztcbiAgICAgICAgcmV0dXJuIENsYXNzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBXcmFwcyBhIGZvcm1hdCBzdHJpbmcgZm9yIHRvb2x0aXBzXG4gICAgICoge3t4fX1cbiAgICAgKiB7e3guMn1cbiAgICAgKiB7e3g6bW9udGhzfX1cbiAgICAgKi9cbiAgICAkLlNQRm9ybWF0Q2xhc3MgPSBTUEZvcm1hdCA9IGNyZWF0ZUNsYXNzKHtcbiAgICAgICAgZnJlOiAvXFx7XFx7KFtcXHcuXSs/KSg6KC4rPykpP1xcfVxcfS9nLFxuICAgICAgICBwcmVjcmU6IC8oXFx3KylcXC4oXFxkKykvLFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uIChmb3JtYXQsIGZjbGFzcykge1xuICAgICAgICAgICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7XG4gICAgICAgICAgICB0aGlzLmZjbGFzcyA9IGZjbGFzcztcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChmaWVsZHNldCwgbG9va3Vwcywgb3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGZpZWxkcyA9IGZpZWxkc2V0LFxuICAgICAgICAgICAgICAgIG1hdGNoLCB0b2tlbiwgbG9va3Vwa2V5LCBmaWVsZHZhbHVlLCBwcmVjO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0LnJlcGxhY2UodGhpcy5mcmUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgbG9va3VwO1xuICAgICAgICAgICAgICAgIHRva2VuID0gYXJndW1lbnRzWzFdO1xuICAgICAgICAgICAgICAgIGxvb2t1cGtleSA9IGFyZ3VtZW50c1szXTtcbiAgICAgICAgICAgICAgICBtYXRjaCA9IHNlbGYucHJlY3JlLmV4ZWModG9rZW4pO1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICBwcmVjID0gbWF0Y2hbMl07XG4gICAgICAgICAgICAgICAgICAgIHRva2VuID0gbWF0Y2hbMV07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJlYyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWVsZHZhbHVlID0gZmllbGRzW3Rva2VuXTtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGR2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGxvb2t1cGtleSAmJiBsb29rdXBzICYmIGxvb2t1cHNbbG9va3Vwa2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBsb29rdXAgPSBsb29rdXBzW2xvb2t1cGtleV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChsb29rdXAuZ2V0KSB7IC8vIFJhbmdlTWFwXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9va3Vwc1tsb29rdXBrZXldLmdldChmaWVsZHZhbHVlKSB8fCBmaWVsZHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvb2t1cHNbbG9va3Vwa2V5XVtmaWVsZHZhbHVlXSB8fCBmaWVsZHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpc051bWJlcihmaWVsZHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ251bWJlckZvcm1hdHRlcicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHZhbHVlID0gb3B0aW9ucy5nZXQoJ251bWJlckZvcm1hdHRlcicpKGZpZWxkdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGR2YWx1ZSA9IGZvcm1hdE51bWJlcihmaWVsZHZhbHVlLCBwcmVjLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdudW1iZXJEaWdpdEdyb3VwQ291bnQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbnVtYmVyRGlnaXRHcm91cFNlcCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdudW1iZXJEZWNpbWFsTWFyaycpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGR2YWx1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBjb252aWVuY2UgbWV0aG9kIHRvIGF2b2lkIG5lZWRpbmcgdGhlIG5ldyBvcGVyYXRvclxuICAgICQuc3Bmb3JtYXQgPSBmdW5jdGlvbihmb3JtYXQsIGZjbGFzcykge1xuICAgICAgICByZXR1cm4gbmV3IFNQRm9ybWF0KGZvcm1hdCwgZmNsYXNzKTtcbiAgICB9O1xuXG4gICAgY2xpcHZhbCA9IGZ1bmN0aW9uICh2YWwsIG1pbiwgbWF4KSB7XG4gICAgICAgIGlmICh2YWwgPCBtaW4pIHtcbiAgICAgICAgICAgIHJldHVybiBtaW47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbCA+IG1heCkge1xuICAgICAgICAgICAgcmV0dXJuIG1heDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsO1xuICAgIH07XG5cbiAgICBxdWFydGlsZSA9IGZ1bmN0aW9uICh2YWx1ZXMsIHEpIHtcbiAgICAgICAgdmFyIHZsO1xuICAgICAgICBpZiAocSA9PT0gMikge1xuICAgICAgICAgICAgdmwgPSBNYXRoLmZsb29yKHZhbHVlcy5sZW5ndGggLyAyKTtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZXMubGVuZ3RoICUgMiA/IHZhbHVlc1t2bF0gOiAodmFsdWVzW3ZsLTFdICsgdmFsdWVzW3ZsXSkgLyAyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHZhbHVlcy5sZW5ndGggJSAyICkgeyAvLyBvZGRcbiAgICAgICAgICAgICAgICB2bCA9ICh2YWx1ZXMubGVuZ3RoICogcSArIHEpIC8gNDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmwgJSAxID8gKHZhbHVlc1tNYXRoLmZsb29yKHZsKV0gKyB2YWx1ZXNbTWF0aC5mbG9vcih2bCkgLSAxXSkgLyAyIDogdmFsdWVzW3ZsLTFdO1xuICAgICAgICAgICAgfSBlbHNlIHsgLy9ldmVuXG4gICAgICAgICAgICAgICAgdmwgPSAodmFsdWVzLmxlbmd0aCAqIHEgKyAyKSAvIDQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZsICUgMSA/ICh2YWx1ZXNbTWF0aC5mbG9vcih2bCldICsgdmFsdWVzW01hdGguZmxvb3IodmwpIC0gMV0pIC8gMiA6ICB2YWx1ZXNbdmwtMV07XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBub3JtYWxpemVWYWx1ZSA9IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgdmFyIG5mO1xuICAgICAgICBzd2l0Y2ggKHZhbCkge1xuICAgICAgICAgICAgY2FzZSAndW5kZWZpbmVkJzpcbiAgICAgICAgICAgICAgICB2YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdudWxsJzpcbiAgICAgICAgICAgICAgICB2YWwgPSBudWxsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndHJ1ZSc6XG4gICAgICAgICAgICAgICAgdmFsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2ZhbHNlJzpcbiAgICAgICAgICAgICAgICB2YWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgbmYgPSBwYXJzZUZsb2F0KHZhbCk7XG4gICAgICAgICAgICAgICAgaWYgKHZhbCA9PSBuZikge1xuICAgICAgICAgICAgICAgICAgICB2YWwgPSBuZjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbDtcbiAgICB9O1xuXG4gICAgbm9ybWFsaXplVmFsdWVzID0gZnVuY3Rpb24gKHZhbHMpIHtcbiAgICAgICAgdmFyIGksIHJlc3VsdCA9IFtdO1xuICAgICAgICBmb3IgKGkgPSB2YWxzLmxlbmd0aDsgaS0tOykge1xuICAgICAgICAgICAgcmVzdWx0W2ldID0gbm9ybWFsaXplVmFsdWUodmFsc1tpXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgcmVtb3ZlID0gZnVuY3Rpb24gKHZhbHMsIGZpbHRlcikge1xuICAgICAgICB2YXIgaSwgdmwsIHJlc3VsdCA9IFtdO1xuICAgICAgICBmb3IgKGkgPSAwLCB2bCA9IHZhbHMubGVuZ3RoOyBpIDwgdmw7IGkrKykge1xuICAgICAgICAgICAgaWYgKHZhbHNbaV0gIT09IGZpbHRlcikge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIGlzTnVtYmVyID0gZnVuY3Rpb24gKG51bSkge1xuICAgICAgICByZXR1cm4gIWlzTmFOKHBhcnNlRmxvYXQobnVtKSkgJiYgaXNGaW5pdGUobnVtKTtcbiAgICB9O1xuXG4gICAgZm9ybWF0TnVtYmVyID0gZnVuY3Rpb24gKG51bSwgcHJlYywgZ3JvdXBzaXplLCBncm91cHNlcCwgZGVjc2VwKSB7XG4gICAgICAgIHZhciBwLCBpO1xuICAgICAgICBudW0gPSAocHJlYyA9PT0gZmFsc2UgPyBwYXJzZUZsb2F0KG51bSkudG9TdHJpbmcoKSA6IG51bS50b0ZpeGVkKHByZWMpKS5zcGxpdCgnJyk7XG4gICAgICAgIHAgPSAocCA9ICQuaW5BcnJheSgnLicsIG51bSkpIDwgMCA/IG51bS5sZW5ndGggOiBwO1xuICAgICAgICBpZiAocCA8IG51bS5sZW5ndGgpIHtcbiAgICAgICAgICAgIG51bVtwXSA9IGRlY3NlcDtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGkgPSBwIC0gZ3JvdXBzaXplOyBpID4gMDsgaSAtPSBncm91cHNpemUpIHtcbiAgICAgICAgICAgIG51bS5zcGxpY2UoaSwgMCwgZ3JvdXBzZXApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudW0uam9pbignJyk7XG4gICAgfTtcblxuICAgIC8vIGRldGVybWluZSBpZiBhbGwgdmFsdWVzIG9mIGFuIGFycmF5IG1hdGNoIGEgdmFsdWVcbiAgICAvLyByZXR1cm5zIHRydWUgaWYgdGhlIGFycmF5IGlzIGVtcHR5XG4gICAgYWxsID0gZnVuY3Rpb24gKHZhbCwgYXJyLCBpZ25vcmVOdWxsKSB7XG4gICAgICAgIHZhciBpO1xuICAgICAgICBmb3IgKGkgPSBhcnIubGVuZ3RoOyBpLS07ICkge1xuICAgICAgICAgICAgaWYgKGlnbm9yZU51bGwgJiYgYXJyW2ldID09PSBudWxsKSBjb250aW51ZTtcbiAgICAgICAgICAgIGlmIChhcnJbaV0gIT09IHZhbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgLy8gc3VtcyB0aGUgbnVtZXJpYyB2YWx1ZXMgaW4gYW4gYXJyYXksIGlnbm9yaW5nIG90aGVyIHZhbHVlc1xuICAgIHN1bSA9IGZ1bmN0aW9uICh2YWxzKSB7XG4gICAgICAgIHZhciB0b3RhbCA9IDAsIGk7XG4gICAgICAgIGZvciAoaSA9IHZhbHMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgICAgICB0b3RhbCArPSB0eXBlb2YgdmFsc1tpXSA9PT0gJ251bWJlcicgPyB2YWxzW2ldIDogMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWw7XG4gICAgfTtcblxuICAgIGVuc3VyZUFycmF5ID0gZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICByZXR1cm4gJC5pc0FycmF5KHZhbCkgPyB2YWwgOiBbdmFsXTtcbiAgICB9O1xuXG4gICAgLy8gaHR0cDovL3BhdWxpcmlzaC5jb20vMjAwOC9ib29rbWFya2xldC1pbmplY3QtbmV3LWNzcy1ydWxlcy9cbiAgICBhZGRDU1MgPSBmdW5jdGlvbihjc3MpIHtcbiAgICAgICAgdmFyIHRhZywgaWVmYWlsO1xuICAgICAgICBpZiAoZG9jdW1lbnQuY3JlYXRlU3R5bGVTaGVldCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVTdHlsZVNoZWV0KCkuY3NzVGV4dCA9IGNzcztcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgLy8gSUUgPD0gOSBtYXhlcyBvdXQgYXQgMzEgc3R5bGVzaGVldHM7IGluamVjdCBpbnRvIHBhZ2UgaW5zdGVhZC5cbiAgICAgICAgICAgICAgICBpZWZhaWwgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XG4gICAgICAgIHRhZy50eXBlID0gJ3RleHQvY3NzJztcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZCh0YWcpO1xuICAgICAgICBpZiAoaWVmYWlsKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5zdHlsZVNoZWV0c1tkb2N1bWVudC5zdHlsZVNoZWV0cy5sZW5ndGggLSAxXS5jc3NUZXh0ID0gY3NzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFnWyh0eXBlb2YgZG9jdW1lbnQuYm9keS5zdHlsZS5XZWJraXRBcHBlYXJhbmNlID09ICdzdHJpbmcnKSAvKiB3ZWJraXQgb25seSAqLyA/ICdpbm5lclRleHQnIDogJ2lubmVySFRNTCddID0gY3NzO1xuICAgICAgICB9XG4gICAgfTtcblxuXG4gICAgLy8gUHJvdmlkZSBhIGNyb3NzLWJyb3dzZXIgaW50ZXJmYWNlIHRvIGEgZmV3IHNpbXBsZSBkcmF3aW5nIHByaW1pdGl2ZXNcbiAgICAkLmZuLnNpbXBsZWRyYXcgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgdXNlRXhpc3RpbmcsIGludGVyYWN0KSB7XG4gICAgICAgIHZhciB0YXJnZXQsIG1oYW5kbGVyO1xuICAgICAgICBpZiAodXNlRXhpc3RpbmcgJiYgKHRhcmdldCA9IHRoaXMuZGF0YSgnX2pxc192Y2FudmFzJykpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCQuZm4uc3BhcmtsaW5lLmNhbnZhcyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIC8vIFdlJ3ZlIGFscmVhZHkgZGV0ZXJtaW5lZCB0aGF0IG5laXRoZXIgQ2FudmFzIG5vciBWTUwgYXJlIGF2YWlsYWJsZVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoJC5mbi5zcGFya2xpbmUuY2FudmFzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vIE5vIGZ1bmN0aW9uIGRlZmluZWQgeWV0IC0tIG5lZWQgdG8gc2VlIGlmIHdlIHN1cHBvcnQgQ2FudmFzIG9yIFZNTFxuICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgICAgICBpZiAoISEoZWwuZ2V0Q29udGV4dCAmJiBlbC5nZXRDb250ZXh0KCcyZCcpKSkge1xuICAgICAgICAgICAgICAgIC8vIENhbnZhcyBpcyBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAkLmZuLnNwYXJrbGluZS5jYW52YXMgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0LCB0YXJnZXQsIGludGVyYWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVkNhbnZhc19jYW52YXMod2lkdGgsIGhlaWdodCwgdGFyZ2V0LCBpbnRlcmFjdCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubmFtZXNwYWNlcyAmJiAhZG9jdW1lbnQubmFtZXNwYWNlcy52KSB7XG4gICAgICAgICAgICAgICAgLy8gVk1MIGlzIGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgIGRvY3VtZW50Lm5hbWVzcGFjZXMuYWRkKCd2JywgJ3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206dm1sJywgJyNkZWZhdWx0I1ZNTCcpO1xuICAgICAgICAgICAgICAgICQuZm4uc3BhcmtsaW5lLmNhbnZhcyA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQsIHRhcmdldCwgaW50ZXJhY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBWQ2FudmFzX3ZtbCh3aWR0aCwgaGVpZ2h0LCB0YXJnZXQpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE5laXRoZXIgQ2FudmFzIG5vciBWTUwgYXJlIGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICQuZm4uc3BhcmtsaW5lLmNhbnZhcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh3aWR0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB3aWR0aCA9ICQodGhpcykuaW5uZXJXaWR0aCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoZWlnaHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVpZ2h0ID0gJCh0aGlzKS5pbm5lckhlaWdodCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGFyZ2V0ID0gJC5mbi5zcGFya2xpbmUuY2FudmFzKHdpZHRoLCBoZWlnaHQsIHRoaXMsIGludGVyYWN0KTtcblxuICAgICAgICBtaGFuZGxlciA9ICQodGhpcykuZGF0YSgnX2pxc19taGFuZGxlcicpO1xuICAgICAgICBpZiAobWhhbmRsZXIpIHtcbiAgICAgICAgICAgIG1oYW5kbGVyLnJlZ2lzdGVyQ2FudmFzKHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9O1xuXG4gICAgJC5mbi5jbGVhcmRyYXcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmRhdGEoJ19qcXNfdmNhbnZhcycpO1xuICAgICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgICAgICB0YXJnZXQucmVzZXQoKTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgICQuUmFuZ2VNYXBDbGFzcyA9IFJhbmdlTWFwID0gY3JlYXRlQ2xhc3Moe1xuICAgICAgICBpbml0OiBmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgICAgICB2YXIga2V5LCByYW5nZSwgcmFuZ2VsaXN0ID0gW107XG4gICAgICAgICAgICBmb3IgKGtleSBpbiBtYXApIHtcbiAgICAgICAgICAgICAgICBpZiAobWFwLmhhc093blByb3BlcnR5KGtleSkgJiYgdHlwZW9mIGtleSA9PT0gJ3N0cmluZycgJiYga2V5LmluZGV4T2YoJzonKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlID0ga2V5LnNwbGl0KCc6Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlWzBdID0gcmFuZ2VbMF0ubGVuZ3RoID09PSAwID8gLUluZmluaXR5IDogcGFyc2VGbG9hdChyYW5nZVswXSk7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlWzFdID0gcmFuZ2VbMV0ubGVuZ3RoID09PSAwID8gSW5maW5pdHkgOiBwYXJzZUZsb2F0KHJhbmdlWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VbMl0gPSBtYXBba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VsaXN0LnB1c2gocmFuZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubWFwID0gbWFwO1xuICAgICAgICAgICAgdGhpcy5yYW5nZWxpc3QgPSByYW5nZWxpc3QgfHwgZmFsc2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHZhciByYW5nZWxpc3QgPSB0aGlzLnJhbmdlbGlzdCxcbiAgICAgICAgICAgICAgICBpLCByYW5nZSwgcmVzdWx0O1xuICAgICAgICAgICAgaWYgKChyZXN1bHQgPSB0aGlzLm1hcFt2YWx1ZV0pICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJhbmdlbGlzdCkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IHJhbmdlbGlzdC5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSByYW5nZWxpc3RbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChyYW5nZVswXSA8PSB2YWx1ZSAmJiByYW5nZVsxXSA+PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJhbmdlWzJdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQ29udmVuaWVuY2UgZnVuY3Rpb25cbiAgICAkLnJhbmdlX21hcCA9IGZ1bmN0aW9uKG1hcCkge1xuICAgICAgICByZXR1cm4gbmV3IFJhbmdlTWFwKG1hcCk7XG4gICAgfTtcblxuXG4gICAgTW91c2VIYW5kbGVyID0gY3JlYXRlQ2xhc3Moe1xuICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWwsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciAkZWwgPSAkKGVsKTtcbiAgICAgICAgICAgIHRoaXMuJGVsID0gJGVsO1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VYID0gMDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VZID0gMDtcbiAgICAgICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgICAgIHRoaXMuc3BsaXN0ID0gW107XG4gICAgICAgICAgICB0aGlzLnRvb2x0aXAgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5vdmVyID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlUb29sdGlwcyA9ICFvcHRpb25zLmdldCgnZGlzYWJsZVRvb2x0aXBzJyk7XG4gICAgICAgICAgICB0aGlzLmhpZ2hsaWdodEVuYWJsZWQgPSAhb3B0aW9ucy5nZXQoJ2Rpc2FibGVIaWdobGlnaHQnKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZWdpc3RlclNwYXJrbGluZTogZnVuY3Rpb24gKHNwKSB7XG4gICAgICAgICAgICB0aGlzLnNwbGlzdC5wdXNoKHNwKTtcbiAgICAgICAgICAgIGlmICh0aGlzLm92ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURpc3BsYXkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZWdpc3RlckNhbnZhczogZnVuY3Rpb24gKGNhbnZhcykge1xuICAgICAgICAgICAgdmFyICRjYW52YXMgPSAkKGNhbnZhcy5jYW52YXMpO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgICAgICAgICB0aGlzLiRjYW52YXMgPSAkY2FudmFzO1xuICAgICAgICAgICAgJGNhbnZhcy5tb3VzZWVudGVyKCQucHJveHkodGhpcy5tb3VzZWVudGVyLCB0aGlzKSk7XG4gICAgICAgICAgICAkY2FudmFzLm1vdXNlbGVhdmUoJC5wcm94eSh0aGlzLm1vdXNlbGVhdmUsIHRoaXMpKTtcbiAgICAgICAgICAgICRjYW52YXMuY2xpY2soJC5wcm94eSh0aGlzLm1vdXNlY2xpY2ssIHRoaXMpKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZXNldDogZnVuY3Rpb24gKHJlbW92ZVRvb2x0aXApIHtcbiAgICAgICAgICAgIHRoaXMuc3BsaXN0ID0gW107XG4gICAgICAgICAgICBpZiAodGhpcy50b29sdGlwICYmIHJlbW92ZVRvb2x0aXApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvb2x0aXAucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy50b29sdGlwID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG1vdXNlY2xpY2s6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB2YXIgY2xpY2tFdmVudCA9ICQuRXZlbnQoJ3NwYXJrbGluZUNsaWNrJyk7XG4gICAgICAgICAgICBjbGlja0V2ZW50Lm9yaWdpbmFsRXZlbnQgPSBlO1xuICAgICAgICAgICAgY2xpY2tFdmVudC5zcGFya2xpbmVzID0gdGhpcy5zcGxpc3Q7XG4gICAgICAgICAgICB0aGlzLiRlbC50cmlnZ2VyKGNsaWNrRXZlbnQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1vdXNlZW50ZXI6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLnVuYmluZCgnbW91c2Vtb3ZlLmpxcycpO1xuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5iaW5kKCdtb3VzZW1vdmUuanFzJywgJC5wcm94eSh0aGlzLm1vdXNlbW92ZSwgdGhpcykpO1xuICAgICAgICAgICAgdGhpcy5vdmVyID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VYID0gZS5wYWdlWDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VZID0gZS5wYWdlWTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEVsID0gZS50YXJnZXQ7XG4gICAgICAgICAgICBpZiAoIXRoaXMudG9vbHRpcCAmJiB0aGlzLmRpc3BsYXlUb29sdGlwcykge1xuICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9IG5ldyBUb29sdGlwKHRoaXMub3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgdGhpcy50b29sdGlwLnVwZGF0ZVBvc2l0aW9uKGUucGFnZVgsIGUucGFnZVkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy51cGRhdGVEaXNwbGF5KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbW91c2VsZWF2ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS51bmJpbmQoJ21vdXNlbW92ZS5qcXMnKTtcbiAgICAgICAgICAgIHZhciBzcGxpc3QgPSB0aGlzLnNwbGlzdCxcbiAgICAgICAgICAgICAgICAgc3Bjb3VudCA9IHNwbGlzdC5sZW5ndGgsXG4gICAgICAgICAgICAgICAgIG5lZWRzUmVmcmVzaCA9IGZhbHNlLFxuICAgICAgICAgICAgICAgICBzcCwgaTtcbiAgICAgICAgICAgIHRoaXMub3ZlciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50RWwgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodGhpcy50b29sdGlwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b29sdGlwLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICBzcCA9IHNwbGlzdFtpXTtcbiAgICAgICAgICAgICAgICBpZiAoc3AuY2xlYXJSZWdpb25IaWdobGlnaHQoKSkge1xuICAgICAgICAgICAgICAgICAgICBuZWVkc1JlZnJlc2ggPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG5lZWRzUmVmcmVzaCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG1vdXNlbW92ZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VYID0gZS5wYWdlWDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VZID0gZS5wYWdlWTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEVsID0gZS50YXJnZXQ7XG4gICAgICAgICAgICBpZiAodGhpcy50b29sdGlwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b29sdGlwLnVwZGF0ZVBvc2l0aW9uKGUucGFnZVgsIGUucGFnZVkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy51cGRhdGVEaXNwbGF5KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXBkYXRlRGlzcGxheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHNwbGlzdCA9IHRoaXMuc3BsaXN0LFxuICAgICAgICAgICAgICAgICBzcGNvdW50ID0gc3BsaXN0Lmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgbmVlZHNSZWZyZXNoID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgIG9mZnNldCA9IHRoaXMuJGNhbnZhcy5vZmZzZXQoKSxcbiAgICAgICAgICAgICAgICAgbG9jYWxYID0gdGhpcy5jdXJyZW50UGFnZVggLSBvZmZzZXQubGVmdCxcbiAgICAgICAgICAgICAgICAgbG9jYWxZID0gdGhpcy5jdXJyZW50UGFnZVkgLSBvZmZzZXQudG9wLFxuICAgICAgICAgICAgICAgICB0b29sdGlwaHRtbCwgc3AsIGksIHJlc3VsdCwgY2hhbmdlRXZlbnQ7XG4gICAgICAgICAgICBpZiAoIXRoaXMub3Zlcikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICBzcCA9IHNwbGlzdFtpXTtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBzcC5zZXRSZWdpb25IaWdobGlnaHQodGhpcy5jdXJyZW50RWwsIGxvY2FsWCwgbG9jYWxZKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIG5lZWRzUmVmcmVzaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5lZWRzUmVmcmVzaCkge1xuICAgICAgICAgICAgICAgIGNoYW5nZUV2ZW50ID0gJC5FdmVudCgnc3BhcmtsaW5lUmVnaW9uQ2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgY2hhbmdlRXZlbnQuc3BhcmtsaW5lcyA9IHRoaXMuc3BsaXN0O1xuICAgICAgICAgICAgICAgIHRoaXMuJGVsLnRyaWdnZXIoY2hhbmdlRXZlbnQpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvb2x0aXApIHtcbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcGh0bWwgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNwY291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3AgPSBzcGxpc3RbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwaHRtbCArPSBzcC5nZXRDdXJyZW50UmVnaW9uVG9vbHRpcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC5zZXRDb250ZW50KHRvb2x0aXBodG1sKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVIaWdobGlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMubW91c2VsZWF2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cblxuICAgIFRvb2x0aXAgPSBjcmVhdGVDbGFzcyh7XG4gICAgICAgIHNpemVTdHlsZTogJ3Bvc2l0aW9uOiBzdGF0aWMgIWltcG9ydGFudDsnICtcbiAgICAgICAgICAgICdkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OycgK1xuICAgICAgICAgICAgJ3Zpc2liaWxpdHk6IGhpZGRlbiAhaW1wb3J0YW50OycgK1xuICAgICAgICAgICAgJ2Zsb2F0OiBsZWZ0ICFpbXBvcnRhbnQ7JyxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIHRvb2x0aXBDbGFzc25hbWUgPSBvcHRpb25zLmdldCgndG9vbHRpcENsYXNzbmFtZScsICdqcXN0b29sdGlwJyksXG4gICAgICAgICAgICAgICAgc2l6ZXRpcFN0eWxlID0gdGhpcy5zaXplU3R5bGUsXG4gICAgICAgICAgICAgICAgb2Zmc2V0O1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXIgPSBvcHRpb25zLmdldCgndG9vbHRpcENvbnRhaW5lcicpIHx8IGRvY3VtZW50LmJvZHk7XG4gICAgICAgICAgICB0aGlzLnRvb2x0aXBPZmZzZXRYID0gb3B0aW9ucy5nZXQoJ3Rvb2x0aXBPZmZzZXRYJywgMTApO1xuICAgICAgICAgICAgdGhpcy50b29sdGlwT2Zmc2V0WSA9IG9wdGlvbnMuZ2V0KCd0b29sdGlwT2Zmc2V0WScsIDEyKTtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBhbnkgcHJldmlvdXMgbGluZ2VyaW5nIHRvb2x0aXBcbiAgICAgICAgICAgICQoJyNqcXNzaXpldGlwJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKCcjanFzdG9vbHRpcCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy5zaXpldGlwID0gJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgICAgIGlkOiAnanFzc2l6ZXRpcCcsXG4gICAgICAgICAgICAgICAgc3R5bGU6IHNpemV0aXBTdHlsZSxcbiAgICAgICAgICAgICAgICAnY2xhc3MnOiB0b29sdGlwQ2xhc3NuYW1lXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9ICQoJzxkaXYvPicsIHtcbiAgICAgICAgICAgICAgICBpZDogJ2pxc3Rvb2x0aXAnLFxuICAgICAgICAgICAgICAgICdjbGFzcyc6IHRvb2x0aXBDbGFzc25hbWVcbiAgICAgICAgICAgIH0pLmFwcGVuZFRvKHRoaXMuY29udGFpbmVyKTtcbiAgICAgICAgICAgIC8vIGFjY291bnQgZm9yIHRoZSBjb250YWluZXIncyBsb2NhdGlvblxuICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy50b29sdGlwLm9mZnNldCgpO1xuICAgICAgICAgICAgdGhpcy5vZmZzZXRMZWZ0ID0gb2Zmc2V0LmxlZnQ7XG4gICAgICAgICAgICB0aGlzLm9mZnNldFRvcCA9IG9mZnNldC50b3A7XG4gICAgICAgICAgICB0aGlzLmhpZGRlbiA9IHRydWU7XG4gICAgICAgICAgICAkKHdpbmRvdykudW5iaW5kKCdyZXNpemUuanFzIHNjcm9sbC5qcXMnKTtcbiAgICAgICAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUuanFzIHNjcm9sbC5qcXMnLCAkLnByb3h5KHRoaXMudXBkYXRlV2luZG93RGltcywgdGhpcykpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVXaW5kb3dEaW1zKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXBkYXRlV2luZG93RGltczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxUb3AgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbExlZnQgPSAkKHdpbmRvdykuc2Nyb2xsTGVmdCgpO1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxSaWdodCA9IHRoaXMuc2Nyb2xsTGVmdCArICQod2luZG93KS53aWR0aCgpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldFNpemU6IGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLnNpemV0aXAuaHRtbChjb250ZW50KS5hcHBlbmRUbyh0aGlzLmNvbnRhaW5lcik7XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5zaXpldGlwLndpZHRoKCkgKyAxO1xuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnNpemV0aXAuaGVpZ2h0KCk7XG4gICAgICAgICAgICB0aGlzLnNpemV0aXAucmVtb3ZlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0Q29udGVudDogZnVuY3Rpb24gKGNvbnRlbnQpIHtcbiAgICAgICAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRkZW4gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZ2V0U2l6ZShjb250ZW50KTtcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcC5odG1sKGNvbnRlbnQpXG4gICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICd3aWR0aCc6IHRoaXMud2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiB0aGlzLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgJ3Zpc2liaWxpdHknOiAndmlzaWJsZSdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICh0aGlzLmhpZGRlbikge1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZGVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZVBvc2l0aW9uOiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAgICAgaWYgKHggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vdXNleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgeCA9IHRoaXMubW91c2V4IC0gdGhpcy5vZmZzZXRMZWZ0O1xuICAgICAgICAgICAgICAgIHkgPSB0aGlzLm1vdXNleSAtIHRoaXMub2Zmc2V0VG9wO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubW91c2V4ID0geCA9IHggLSB0aGlzLm9mZnNldExlZnQ7XG4gICAgICAgICAgICAgICAgdGhpcy5tb3VzZXkgPSB5ID0geSAtIHRoaXMub2Zmc2V0VG9wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLmhlaWdodCB8fCAhdGhpcy53aWR0aCB8fCB0aGlzLmhpZGRlbikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgeSAtPSB0aGlzLmhlaWdodCArIHRoaXMudG9vbHRpcE9mZnNldFk7XG4gICAgICAgICAgICB4ICs9IHRoaXMudG9vbHRpcE9mZnNldFg7XG5cbiAgICAgICAgICAgIGlmICh5IDwgdGhpcy5zY3JvbGxUb3ApIHtcbiAgICAgICAgICAgICAgICB5ID0gdGhpcy5zY3JvbGxUb3A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoeCA8IHRoaXMuc2Nyb2xsTGVmdCkge1xuICAgICAgICAgICAgICAgIHggPSB0aGlzLnNjcm9sbExlZnQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHggKyB0aGlzLndpZHRoID4gdGhpcy5zY3JvbGxSaWdodCkge1xuICAgICAgICAgICAgICAgIHggPSB0aGlzLnNjcm9sbFJpZ2h0IC0gdGhpcy53aWR0aDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy50b29sdGlwLmNzcyh7XG4gICAgICAgICAgICAgICAgJ2xlZnQnOiB4LFxuICAgICAgICAgICAgICAgICd0b3AnOiB5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcC5yZW1vdmUoKTtcbiAgICAgICAgICAgIHRoaXMuc2l6ZXRpcC5yZW1vdmUoKTtcbiAgICAgICAgICAgIHRoaXMuc2l6ZXRpcCA9IHRoaXMudG9vbHRpcCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICQod2luZG93KS51bmJpbmQoJ3Jlc2l6ZS5qcXMgc2Nyb2xsLmpxcycpO1xuICAgICAgICB9XG4gICAgfSk7XG5cblxuICAgIGluaXRTdHlsZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgYWRkQ1NTKGRlZmF1bHRTdHlsZXMpO1xuICAgIH07XG5cbiAgICAkKGluaXRTdHlsZXMpO1xuXG4gICAgcGVuZGluZyA9IFtdO1xuICAgICQuZm4uc3BhcmtsaW5lID0gZnVuY3Rpb24gKHVzZXJWYWx1ZXMsIHVzZXJPcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBuZXcgJC5mbi5zcGFya2xpbmUub3B0aW9ucyh0aGlzLCB1c2VyT3B0aW9ucyksXG4gICAgICAgICAgICAgICAgICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgcmVuZGVyLCBpO1xuICAgICAgICAgICAgcmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZXMsIHdpZHRoLCBoZWlnaHQsIHRtcCwgbWhhbmRsZXIsIHNwLCB2YWxzO1xuICAgICAgICAgICAgICAgIGlmICh1c2VyVmFsdWVzID09PSAnaHRtbCcgfHwgdXNlclZhbHVlcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHMgPSB0aGlzLmdldEF0dHJpYnV0ZShvcHRpb25zLmdldCgndGFnVmFsdWVzQXR0cmlidXRlJykpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFscyA9PT0gdW5kZWZpbmVkIHx8IHZhbHMgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHMgPSAkdGhpcy5odG1sKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gdmFscy5yZXBsYWNlKC8oXlxccyo8IS0tKXwoLS0+XFxzKiQpfFxccysvZywgJycpLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gdXNlclZhbHVlcztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3aWR0aCA9IG9wdGlvbnMuZ2V0KCd3aWR0aCcpID09PSAnYXV0bycgPyB2YWx1ZXMubGVuZ3RoICogb3B0aW9ucy5nZXQoJ2RlZmF1bHRQaXhlbHNQZXJWYWx1ZScpIDogb3B0aW9ucy5nZXQoJ3dpZHRoJyk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdoZWlnaHQnKSA9PT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5nZXQoJ2NvbXBvc2l0ZScpIHx8ICEkLmRhdGEodGhpcywgJ19qcXNfdmNhbnZhcycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBtdXN0IGJlIGEgYmV0dGVyIHdheSB0byBnZXQgdGhlIGxpbmUgaGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAuaW5uZXJIVE1MID0gJ2EnO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuaHRtbCh0bXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gJCh0bXApLmlubmVySGVpZ2h0KCkgfHwgJCh0bXApLmhlaWdodCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0bXApLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IG9wdGlvbnMuZ2V0KCdoZWlnaHQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuZ2V0KCdkaXNhYmxlSW50ZXJhY3Rpb24nKSkge1xuICAgICAgICAgICAgICAgICAgICBtaGFuZGxlciA9ICQuZGF0YSh0aGlzLCAnX2pxc19taGFuZGxlcicpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW1oYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtaGFuZGxlciA9IG5ldyBNb3VzZUhhbmRsZXIodGhpcywgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmRhdGEodGhpcywgJ19qcXNfbWhhbmRsZXInLCBtaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIW9wdGlvbnMuZ2V0KCdjb21wb3NpdGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWhhbmRsZXIucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1oYW5kbGVyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjb21wb3NpdGUnKSAmJiAhJC5kYXRhKHRoaXMsICdfanFzX3ZjYW52YXMnKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISQuZGF0YSh0aGlzLCAnX2pxc19lcnJub3RpZnknKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ0F0dGVtcHRlZCB0byBhdHRhY2ggYSBjb21wb3NpdGUgc3BhcmtsaW5lIHRvIGFuIGVsZW1lbnQgd2l0aCBubyBleGlzdGluZyBzcGFya2xpbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZGF0YSh0aGlzLCAnX2pxc19lcnJub3RpZnknLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc3AgPSBuZXcgJC5mbi5zcGFya2xpbmVbb3B0aW9ucy5nZXQoJ3R5cGUnKV0odGhpcywgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgICAgICAgICAgICAgIHNwLnJlbmRlcigpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG1oYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIG1oYW5kbGVyLnJlZ2lzdGVyU3BhcmtsaW5lKHNwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKCgkKHRoaXMpLmh0bWwoKSAmJiAhb3B0aW9ucy5nZXQoJ2Rpc2FibGVIaWRkZW5DaGVjaycpICYmICQodGhpcykuaXMoJzpoaWRkZW4nKSkgfHwgISQodGhpcykucGFyZW50cygnYm9keScpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5nZXQoJ2NvbXBvc2l0ZScpICYmICQuZGF0YSh0aGlzLCAnX2pxc19wZW5kaW5nJykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGFueSBleGlzdGluZyByZWZlcmVuY2VzIHRvIHRoZSBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IHBlbmRpbmcubGVuZ3RoOyBpOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nW2kgLSAxXVswXSA9PSB0aGlzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZy5zcGxpY2UoaSAtIDEsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBlbmRpbmcucHVzaChbdGhpcywgcmVuZGVyXSk7XG4gICAgICAgICAgICAgICAgJC5kYXRhKHRoaXMsICdfanFzX3BlbmRpbmcnLCB0cnVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyLmNhbGwodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkLmZuLnNwYXJrbGluZS5kZWZhdWx0cyA9IGdldERlZmF1bHRzKCk7XG5cblxuICAgICQuc3BhcmtsaW5lX2Rpc3BsYXlfdmlzaWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVsLCBpLCBwbDtcbiAgICAgICAgdmFyIGRvbmUgPSBbXTtcbiAgICAgICAgZm9yIChpID0gMCwgcGwgPSBwZW5kaW5nLmxlbmd0aDsgaSA8IHBsOyBpKyspIHtcbiAgICAgICAgICAgIGVsID0gcGVuZGluZ1tpXVswXTtcbiAgICAgICAgICAgIGlmICgkKGVsKS5pcygnOnZpc2libGUnKSAmJiAhJChlbCkucGFyZW50cygpLmlzKCc6aGlkZGVuJykpIHtcbiAgICAgICAgICAgICAgICBwZW5kaW5nW2ldWzFdLmNhbGwoZWwpO1xuICAgICAgICAgICAgICAgICQuZGF0YShwZW5kaW5nW2ldWzBdLCAnX2pxc19wZW5kaW5nJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGRvbmUucHVzaChpKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoISQoZWwpLmNsb3Nlc3QoJ2h0bWwnKS5sZW5ndGggJiYgISQuZGF0YShlbCwgJ19qcXNfcGVuZGluZycpKSB7XG4gICAgICAgICAgICAgICAgLy8gZWxlbWVudCBoYXMgYmVlbiBpbnNlcnRlZCBhbmQgcmVtb3ZlZCBmcm9tIHRoZSBET01cbiAgICAgICAgICAgICAgICAvLyBJZiBpdCB3YXMgbm90IHlldCBpbnNlcnRlZCBpbnRvIHRoZSBkb20gdGhlbiB0aGUgLmRhdGEgcmVxdWVzdFxuICAgICAgICAgICAgICAgIC8vIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZpbmcgZnJvbSB0aGUgZG9tIGNhdXNlcyB0aGUgZGF0YSB0byBiZSByZW1vdmVkLlxuICAgICAgICAgICAgICAgICQuZGF0YShwZW5kaW5nW2ldWzBdLCAnX2pxc19wZW5kaW5nJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGRvbmUucHVzaChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGkgPSBkb25lLmxlbmd0aDsgaTsgaS0tKSB7XG4gICAgICAgICAgICBwZW5kaW5nLnNwbGljZShkb25lW2kgLSAxXSwgMSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBVc2VyIG9wdGlvbiBoYW5kbGVyXG4gICAgICovXG4gICAgJC5mbi5zcGFya2xpbmUub3B0aW9ucyA9IGNyZWF0ZUNsYXNzKHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHRhZywgdXNlck9wdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciBleHRlbmRlZE9wdGlvbnMsIGRlZmF1bHRzLCBiYXNlLCB0YWdPcHRpb25UeXBlO1xuICAgICAgICAgICAgdGhpcy51c2VyT3B0aW9ucyA9IHVzZXJPcHRpb25zID0gdXNlck9wdGlvbnMgfHwge307XG4gICAgICAgICAgICB0aGlzLnRhZyA9IHRhZztcbiAgICAgICAgICAgIHRoaXMudGFnVmFsQ2FjaGUgPSB7fTtcbiAgICAgICAgICAgIGRlZmF1bHRzID0gJC5mbi5zcGFya2xpbmUuZGVmYXVsdHM7XG4gICAgICAgICAgICBiYXNlID0gZGVmYXVsdHMuY29tbW9uO1xuICAgICAgICAgICAgdGhpcy50YWdPcHRpb25zUHJlZml4ID0gdXNlck9wdGlvbnMuZW5hYmxlVGFnT3B0aW9ucyAmJiAodXNlck9wdGlvbnMudGFnT3B0aW9uc1ByZWZpeCB8fCBiYXNlLnRhZ09wdGlvbnNQcmVmaXgpO1xuXG4gICAgICAgICAgICB0YWdPcHRpb25UeXBlID0gdGhpcy5nZXRUYWdTZXR0aW5nKCd0eXBlJyk7XG4gICAgICAgICAgICBpZiAodGFnT3B0aW9uVHlwZSA9PT0gVU5TRVRfT1BUSU9OKSB7XG4gICAgICAgICAgICAgICAgZXh0ZW5kZWRPcHRpb25zID0gZGVmYXVsdHNbdXNlck9wdGlvbnMudHlwZSB8fCBiYXNlLnR5cGVdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBleHRlbmRlZE9wdGlvbnMgPSBkZWZhdWx0c1t0YWdPcHRpb25UeXBlXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubWVyZ2VkT3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBiYXNlLCBleHRlbmRlZE9wdGlvbnMsIHVzZXJPcHRpb25zKTtcbiAgICAgICAgfSxcblxuXG4gICAgICAgIGdldFRhZ1NldHRpbmc6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciBwcmVmaXggPSB0aGlzLnRhZ09wdGlvbnNQcmVmaXgsXG4gICAgICAgICAgICAgICAgdmFsLCBpLCBwYWlycywga2V5dmFsO1xuICAgICAgICAgICAgaWYgKHByZWZpeCA9PT0gZmFsc2UgfHwgcHJlZml4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVU5TRVRfT1BUSU9OO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMudGFnVmFsQ2FjaGUuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMudGFnVmFsQ2FjaGUua2V5O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWwgPSB0aGlzLnRhZy5nZXRBdHRyaWJ1dGUocHJlZml4ICsga2V5KTtcbiAgICAgICAgICAgICAgICBpZiAodmFsID09PSB1bmRlZmluZWQgfHwgdmFsID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IFVOU0VUX09QVElPTjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbC5zdWJzdHIoMCwgMSkgPT09ICdbJykge1xuICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWwuc3Vic3RyKDEsIHZhbC5sZW5ndGggLSAyKS5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSB2YWwubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxbaV0gPSBub3JtYWxpemVWYWx1ZSh2YWxbaV0ucmVwbGFjZSgvKF5cXHMqKXwoXFxzKiQpL2csICcnKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbC5zdWJzdHIoMCwgMSkgPT09ICd7Jykge1xuICAgICAgICAgICAgICAgICAgICBwYWlycyA9IHZhbC5zdWJzdHIoMSwgdmFsLmxlbmd0aCAtIDIpLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBwYWlycy5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXZhbCA9IHBhaXJzW2ldLnNwbGl0KCc6JywgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxba2V5dmFsWzBdLnJlcGxhY2UoLyheXFxzKil8KFxccyokKS9nLCAnJyldID0gbm9ybWFsaXplVmFsdWUoa2V5dmFsWzFdLnJlcGxhY2UoLyheXFxzKil8KFxccyokKS9nLCAnJykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gbm9ybWFsaXplVmFsdWUodmFsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy50YWdWYWxDYWNoZS5rZXkgPSB2YWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldDogZnVuY3Rpb24gKGtleSwgZGVmYXVsdHZhbCkge1xuICAgICAgICAgICAgdmFyIHRhZ09wdGlvbiA9IHRoaXMuZ2V0VGFnU2V0dGluZyhrZXkpLFxuICAgICAgICAgICAgICAgIHJlc3VsdDtcbiAgICAgICAgICAgIGlmICh0YWdPcHRpb24gIT09IFVOU0VUX09QVElPTikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0YWdPcHRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKHJlc3VsdCA9IHRoaXMubWVyZ2VkT3B0aW9uc1trZXldKSA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdHZhbCA6IHJlc3VsdDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICAkLmZuLnNwYXJrbGluZS5fYmFzZSA9IGNyZWF0ZUNsYXNzKHtcbiAgICAgICAgZGlzYWJsZWQ6IGZhbHNlLFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLmVsID0gZWw7XG4gICAgICAgICAgICB0aGlzLiRlbCA9ICQoZWwpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXM7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRSZWdpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHVwIHRoZSBjYW52YXNcbiAgICAgICAgICovXG4gICAgICAgIGluaXRUYXJnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBpbnRlcmFjdGl2ZSA9ICF0aGlzLm9wdGlvbnMuZ2V0KCdkaXNhYmxlSW50ZXJhY3Rpb24nKTtcbiAgICAgICAgICAgIGlmICghKHRoaXMudGFyZ2V0ID0gdGhpcy4kZWwuc2ltcGxlZHJhdyh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGhpcy5vcHRpb25zLmdldCgnY29tcG9zaXRlJyksIGludGVyYWN0aXZlKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW52YXNXaWR0aCA9IHRoaXMudGFyZ2V0LnBpeGVsV2lkdGg7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW52YXNIZWlnaHQgPSB0aGlzLnRhcmdldC5waXhlbEhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWN0dWFsbHkgcmVuZGVyIHRoZSBjaGFydCB0byB0aGUgY2FudmFzXG4gICAgICAgICAqL1xuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbC5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJuIGEgcmVnaW9uIGlkIGZvciBhIGdpdmVuIHgveSBjby1vcmRpbmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaWdobGlnaHQgYW4gaXRlbSBiYXNlZCBvbiB0aGUgbW91c2VkLW92ZXIgeCx5IGNvLW9yZGluYXRlXG4gICAgICAgICAqL1xuICAgICAgICBzZXRSZWdpb25IaWdobGlnaHQ6IGZ1bmN0aW9uIChlbCwgeCwgeSkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb24sXG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0RW5hYmxlZCA9ICF0aGlzLm9wdGlvbnMuZ2V0KCdkaXNhYmxlSGlnaGxpZ2h0JyksXG4gICAgICAgICAgICAgICAgbmV3UmVnaW9uO1xuICAgICAgICAgICAgaWYgKHggPiB0aGlzLmNhbnZhc1dpZHRoIHx8IHkgPiB0aGlzLmNhbnZhc0hlaWdodCB8fCB4IDwgMCB8fCB5IDwgMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3UmVnaW9uID0gdGhpcy5nZXRSZWdpb24oZWwsIHgsIHkpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRSZWdpb24gIT09IG5ld1JlZ2lvbikge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UmVnaW9uICE9PSB1bmRlZmluZWQgJiYgaGlnaGxpZ2h0RW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUhpZ2hsaWdodCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRSZWdpb24gPSBuZXdSZWdpb247XG4gICAgICAgICAgICAgICAgaWYgKG5ld1JlZ2lvbiAhPT0gdW5kZWZpbmVkICYmIGhpZ2hsaWdodEVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJIaWdobGlnaHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlc2V0IGFueSBjdXJyZW50bHkgaGlnaGxpZ2h0ZWQgaXRlbVxuICAgICAgICAgKi9cbiAgICAgICAgY2xlYXJSZWdpb25IaWdobGlnaHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRSZWdpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSGlnaGxpZ2h0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVnaW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbmRlckhpZ2hsaWdodDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VIaWdobGlnaHQodHJ1ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlSGlnaGxpZ2h0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZUhpZ2hsaWdodChmYWxzZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlSGlnaGxpZ2h0OiBmdW5jdGlvbiAoaGlnaGxpZ2h0KSAge30sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZldGNoIHRoZSBIVE1MIHRvIGRpc3BsYXkgYXMgYSB0b29sdGlwXG4gICAgICAgICAqL1xuICAgICAgICBnZXRDdXJyZW50UmVnaW9uVG9vbHRpcDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgICAgICAgaGVhZGVyID0gJycsXG4gICAgICAgICAgICAgICAgZW50cmllcyA9IFtdLFxuICAgICAgICAgICAgICAgIGZpZWxkcywgZm9ybWF0cywgZm9ybWF0bGVuLCBmY2xhc3MsIHRleHQsIGksXG4gICAgICAgICAgICAgICAgc2hvd0ZpZWxkcywgc2hvd0ZpZWxkc0tleSwgbmV3RmllbGRzLCBmdixcbiAgICAgICAgICAgICAgICBmb3JtYXR0ZXIsIGZvcm1hdCwgZmllbGRsZW4sIGo7XG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UmVnaW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaWVsZHMgPSB0aGlzLmdldEN1cnJlbnRSZWdpb25GaWVsZHMoKTtcbiAgICAgICAgICAgIGZvcm1hdHRlciA9IG9wdGlvbnMuZ2V0KCd0b29sdGlwRm9ybWF0dGVyJyk7XG4gICAgICAgICAgICBpZiAoZm9ybWF0dGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlcih0aGlzLCBvcHRpb25zLCBmaWVsZHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCd0b29sdGlwQ2hhcnRUaXRsZScpKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVyICs9ICc8ZGl2IGNsYXNzPVwianFzIGpxc3RpdGxlXCI+JyArIG9wdGlvbnMuZ2V0KCd0b29sdGlwQ2hhcnRUaXRsZScpICsgJzwvZGl2Plxcbic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3JtYXRzID0gdGhpcy5vcHRpb25zLmdldCgndG9vbHRpcEZvcm1hdCcpO1xuICAgICAgICAgICAgaWYgKCFmb3JtYXRzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEkLmlzQXJyYXkoZm9ybWF0cykpIHtcbiAgICAgICAgICAgICAgICBmb3JtYXRzID0gW2Zvcm1hdHNdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEkLmlzQXJyYXkoZmllbGRzKSkge1xuICAgICAgICAgICAgICAgIGZpZWxkcyA9IFtmaWVsZHNdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2hvd0ZpZWxkcyA9IHRoaXMub3B0aW9ucy5nZXQoJ3Rvb2x0aXBGb3JtYXRGaWVsZGxpc3QnKTtcbiAgICAgICAgICAgIHNob3dGaWVsZHNLZXkgPSB0aGlzLm9wdGlvbnMuZ2V0KCd0b29sdGlwRm9ybWF0RmllbGRsaXN0S2V5Jyk7XG4gICAgICAgICAgICBpZiAoc2hvd0ZpZWxkcyAmJiBzaG93RmllbGRzS2V5KSB7XG4gICAgICAgICAgICAgICAgLy8gdXNlci1zZWxlY3RlZCBvcmRlcmluZyBvZiBmaWVsZHNcbiAgICAgICAgICAgICAgICBuZXdGaWVsZHMgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSBmaWVsZHMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgICAgICAgICAgICAgIGZ2ID0gZmllbGRzW2ldW3Nob3dGaWVsZHNLZXldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoKGogPSAkLmluQXJyYXkoZnYsIHNob3dGaWVsZHMpKSAhPSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RmllbGRzW2pdID0gZmllbGRzW2ldO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpZWxkcyA9IG5ld0ZpZWxkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvcm1hdGxlbiA9IGZvcm1hdHMubGVuZ3RoO1xuICAgICAgICAgICAgZmllbGRsZW4gPSBmaWVsZHMubGVuZ3RoO1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGZvcm1hdGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0ID0gZm9ybWF0c1tpXTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZvcm1hdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0ID0gbmV3IFNQRm9ybWF0KGZvcm1hdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZjbGFzcyA9IGZvcm1hdC5mY2xhc3MgfHwgJ2pxc2ZpZWxkJztcbiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgZmllbGRsZW47IGorKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpZWxkc1tqXS5pc051bGwgfHwgIW9wdGlvbnMuZ2V0KCd0b29sdGlwU2tpcE51bGwnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5leHRlbmQoZmllbGRzW2pdLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZml4OiBvcHRpb25zLmdldCgndG9vbHRpcFByZWZpeCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1ZmZpeDogb3B0aW9ucy5nZXQoJ3Rvb2x0aXBTdWZmaXgnKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZm9ybWF0LnJlbmRlcihmaWVsZHNbal0sIG9wdGlvbnMuZ2V0KCd0b29sdGlwVmFsdWVMb29rdXBzJyksIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKCc8ZGl2IGNsYXNzPVwiJyArIGZjbGFzcyArICdcIj4nICsgdGV4dCArICc8L2Rpdj4nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbnRyaWVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoZWFkZXIgKyBlbnRyaWVzLmpvaW4oJ1xcbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHt9LFxuXG4gICAgICAgIGNhbGNIaWdobGlnaHRDb2xvcjogZnVuY3Rpb24gKGNvbG9yLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgaGlnaGxpZ2h0Q29sb3IgPSBvcHRpb25zLmdldCgnaGlnaGxpZ2h0Q29sb3InKSxcbiAgICAgICAgICAgICAgICBsaWdodGVuID0gb3B0aW9ucy5nZXQoJ2hpZ2hsaWdodExpZ2h0ZW4nKSxcbiAgICAgICAgICAgICAgICBwYXJzZSwgbXVsdCwgcmdibmV3LCBpO1xuICAgICAgICAgICAgaWYgKGhpZ2hsaWdodENvbG9yKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhpZ2hsaWdodENvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxpZ2h0ZW4pIHtcbiAgICAgICAgICAgICAgICAvLyBleHRyYWN0IFJHQiB2YWx1ZXNcbiAgICAgICAgICAgICAgICBwYXJzZSA9IC9eIyhbMC05YS1mXSkoWzAtOWEtZl0pKFswLTlhLWZdKSQvaS5leGVjKGNvbG9yKSB8fCAvXiMoWzAtOWEtZl17Mn0pKFswLTlhLWZdezJ9KShbMC05YS1mXXsyfSkkL2kuZXhlYyhjb2xvcik7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJnYm5ldyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBtdWx0ID0gY29sb3IubGVuZ3RoID09PSA0ID8gMTYgOiAxO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZ2JuZXdbaV0gPSBjbGlwdmFsKE1hdGgucm91bmQocGFyc2VJbnQocGFyc2VbaSArIDFdLCAxNikgKiBtdWx0ICogbGlnaHRlbiksIDAsIDI1NSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdyZ2IoJyArIHJnYm5ldy5qb2luKCcsJykgKyAnKSc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29sb3I7XG4gICAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgYmFySGlnaGxpZ2h0TWl4aW4gPSB7XG4gICAgICAgIGNoYW5nZUhpZ2hsaWdodDogZnVuY3Rpb24gKGhpZ2hsaWdodCkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb24sXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGhpcy50YXJnZXQsXG4gICAgICAgICAgICAgICAgc2hhcGVpZHMgPSB0aGlzLnJlZ2lvblNoYXBlc1tjdXJyZW50UmVnaW9uXSxcbiAgICAgICAgICAgICAgICBuZXdTaGFwZXM7XG4gICAgICAgICAgICAvLyB3aWxsIGJlIG51bGwgaWYgdGhlIHJlZ2lvbiB2YWx1ZSB3YXMgbnVsbFxuICAgICAgICAgICAgaWYgKHNoYXBlaWRzKSB7XG4gICAgICAgICAgICAgICAgbmV3U2hhcGVzID0gdGhpcy5yZW5kZXJSZWdpb24oY3VycmVudFJlZ2lvbiwgaGlnaGxpZ2h0KTtcbiAgICAgICAgICAgICAgICBpZiAoJC5pc0FycmF5KG5ld1NoYXBlcykgfHwgJC5pc0FycmF5KHNoYXBlaWRzKSkge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQucmVwbGFjZVdpdGhTaGFwZXMoc2hhcGVpZHMsIG5ld1NoYXBlcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaW9uU2hhcGVzW2N1cnJlbnRSZWdpb25dID0gJC5tYXAobmV3U2hhcGVzLCBmdW5jdGlvbiAobmV3U2hhcGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdTaGFwZS5pZDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnJlcGxhY2VXaXRoU2hhcGUoc2hhcGVpZHMsIG5ld1NoYXBlcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaW9uU2hhcGVzW2N1cnJlbnRSZWdpb25dID0gbmV3U2hhcGVzLmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcyxcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCxcbiAgICAgICAgICAgICAgICByZWdpb25TaGFwZXMgPSB0aGlzLnJlZ2lvblNoYXBlcyxcbiAgICAgICAgICAgICAgICBzaGFwZXMsIGlkcywgaSwgajtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmNscy5fc3VwZXIucmVuZGVyLmNhbGwodGhpcykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGkgPSB2YWx1ZXMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgICAgICAgICAgc2hhcGVzID0gdGhpcy5yZW5kZXJSZWdpb24oaSk7XG4gICAgICAgICAgICAgICAgaWYgKHNoYXBlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJC5pc0FycmF5KHNoYXBlcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gc2hhcGVzLmxlbmd0aDsgai0tOykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXBlc1tqXS5hcHBlbmQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHMucHVzaChzaGFwZXNbal0uaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uU2hhcGVzW2ldID0gaWRzO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGVzLmFwcGVuZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uU2hhcGVzW2ldID0gc2hhcGVzLmlkOyAvLyBzdG9yZSBqdXN0IHRoZSBzaGFwZWlkXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBudWxsIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvblNoYXBlc1tpXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGFyZ2V0LnJlbmRlcigpO1xuICAgICAgICB9XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogTGluZSBjaGFydHNcbiAgICAgKi9cbiAgICAkLmZuLnNwYXJrbGluZS5saW5lID0gbGluZSA9IGNyZWF0ZUNsYXNzKCQuZm4uc3BhcmtsaW5lLl9iYXNlLCB7XG4gICAgICAgIHR5cGU6ICdsaW5lJyxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICAgICAgbGluZS5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy52ZXJ0aWNlcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5yZWdpb25NYXAgPSBbXTtcbiAgICAgICAgICAgIHRoaXMueHZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy55dmFsdWVzID0gW107XG4gICAgICAgICAgICB0aGlzLnltaW5tYXggPSBbXTtcbiAgICAgICAgICAgIHRoaXMuaGlnaHRsaWdodFNwb3RJZCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmxhc3RTaGFwZUlkID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuaW5pdFRhcmdldCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKGVsLCB4LCB5KSB7XG4gICAgICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgICAgICByZWdpb25NYXAgPSB0aGlzLnJlZ2lvbk1hcDsgLy8gbWFwcyByZWdpb25zIHRvIHZhbHVlIHBvc2l0aW9uc1xuICAgICAgICAgICAgZm9yIChpID0gcmVnaW9uTWFwLmxlbmd0aDsgaS0tOykge1xuICAgICAgICAgICAgICAgIGlmIChyZWdpb25NYXBbaV0gIT09IG51bGwgJiYgeCA+PSByZWdpb25NYXBbaV1bMF0gJiYgeCA8PSByZWdpb25NYXBbaV1bMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbk1hcFtpXVsyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpc051bGw6IHRoaXMueXZhbHVlc1tjdXJyZW50UmVnaW9uXSA9PT0gbnVsbCxcbiAgICAgICAgICAgICAgICB4OiB0aGlzLnh2YWx1ZXNbY3VycmVudFJlZ2lvbl0sXG4gICAgICAgICAgICAgICAgeTogdGhpcy55dmFsdWVzW2N1cnJlbnRSZWdpb25dLFxuICAgICAgICAgICAgICAgIGNvbG9yOiB0aGlzLm9wdGlvbnMuZ2V0KCdsaW5lQ29sb3InKSxcbiAgICAgICAgICAgICAgICBmaWxsQ29sb3I6IHRoaXMub3B0aW9ucy5nZXQoJ2ZpbGxDb2xvcicpLFxuICAgICAgICAgICAgICAgIG9mZnNldDogY3VycmVudFJlZ2lvblxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXJIaWdobGlnaHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uLFxuICAgICAgICAgICAgICAgIHRhcmdldCA9IHRoaXMudGFyZ2V0LFxuICAgICAgICAgICAgICAgIHZlcnRleCA9IHRoaXMudmVydGljZXNbY3VycmVudFJlZ2lvbl0sXG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBzcG90UmFkaXVzID0gb3B0aW9ucy5nZXQoJ3Nwb3RSYWRpdXMnKSxcbiAgICAgICAgICAgICAgICBoaWdobGlnaHRTcG90Q29sb3IgPSBvcHRpb25zLmdldCgnaGlnaGxpZ2h0U3BvdENvbG9yJyksXG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0TGluZUNvbG9yID0gb3B0aW9ucy5nZXQoJ2hpZ2hsaWdodExpbmVDb2xvcicpLFxuICAgICAgICAgICAgICAgIGhpZ2hsaWdodFNwb3QsIGhpZ2hsaWdodExpbmU7XG5cbiAgICAgICAgICAgIGlmICghdmVydGV4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNwb3RSYWRpdXMgJiYgaGlnaGxpZ2h0U3BvdENvbG9yKSB7XG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0U3BvdCA9IHRhcmdldC5kcmF3Q2lyY2xlKHZlcnRleFswXSwgdmVydGV4WzFdLFxuICAgICAgICAgICAgICAgICAgICBzcG90UmFkaXVzLCB1bmRlZmluZWQsIGhpZ2hsaWdodFNwb3RDb2xvcik7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWdobGlnaHRTcG90SWQgPSBoaWdobGlnaHRTcG90LmlkO1xuICAgICAgICAgICAgICAgIHRhcmdldC5pbnNlcnRBZnRlclNoYXBlKHRoaXMubGFzdFNoYXBlSWQsIGhpZ2hsaWdodFNwb3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhpZ2hsaWdodExpbmVDb2xvcikge1xuICAgICAgICAgICAgICAgIGhpZ2hsaWdodExpbmUgPSB0YXJnZXQuZHJhd0xpbmUodmVydGV4WzBdLCB0aGlzLmNhbnZhc1RvcCwgdmVydGV4WzBdLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbnZhc1RvcCArIHRoaXMuY2FudmFzSGVpZ2h0LCBoaWdobGlnaHRMaW5lQ29sb3IpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0TGluZUlkID0gaGlnaGxpZ2h0TGluZS5pZDtcbiAgICAgICAgICAgICAgICB0YXJnZXQuaW5zZXJ0QWZ0ZXJTaGFwZSh0aGlzLmxhc3RTaGFwZUlkLCBoaWdobGlnaHRMaW5lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmVIaWdobGlnaHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldDtcbiAgICAgICAgICAgIGlmICh0aGlzLmhpZ2hsaWdodFNwb3RJZCkge1xuICAgICAgICAgICAgICAgIHRhcmdldC5yZW1vdmVTaGFwZUlkKHRoaXMuaGlnaGxpZ2h0U3BvdElkKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhpZ2hsaWdodFNwb3RJZCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5oaWdobGlnaHRMaW5lSWQpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQucmVtb3ZlU2hhcGVJZCh0aGlzLmhpZ2hsaWdodExpbmVJZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWdobGlnaHRMaW5lSWQgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNjYW5WYWx1ZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcyxcbiAgICAgICAgICAgICAgICB2YWxjb3VudCA9IHZhbHVlcy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgeHZhbHVlcyA9IHRoaXMueHZhbHVlcyxcbiAgICAgICAgICAgICAgICB5dmFsdWVzID0gdGhpcy55dmFsdWVzLFxuICAgICAgICAgICAgICAgIHltaW5tYXggPSB0aGlzLnltaW5tYXgsXG4gICAgICAgICAgICAgICAgaSwgdmFsLCBpc1N0ciwgaXNBcnJheSwgc3A7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmFsY291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhbCA9IHZhbHVlc1tpXTtcbiAgICAgICAgICAgICAgICBpc1N0ciA9IHR5cGVvZih2YWx1ZXNbaV0pID09PSAnc3RyaW5nJztcbiAgICAgICAgICAgICAgICBpc0FycmF5ID0gdHlwZW9mKHZhbHVlc1tpXSkgPT09ICdvYmplY3QnICYmIHZhbHVlc1tpXSBpbnN0YW5jZW9mIEFycmF5O1xuICAgICAgICAgICAgICAgIHNwID0gaXNTdHIgJiYgdmFsdWVzW2ldLnNwbGl0KCc6Jyk7XG4gICAgICAgICAgICAgICAgaWYgKGlzU3RyICYmIHNwLmxlbmd0aCA9PT0gMikgeyAvLyB4OnlcbiAgICAgICAgICAgICAgICAgICAgeHZhbHVlcy5wdXNoKE51bWJlcihzcFswXSkpO1xuICAgICAgICAgICAgICAgICAgICB5dmFsdWVzLnB1c2goTnVtYmVyKHNwWzFdKSk7XG4gICAgICAgICAgICAgICAgICAgIHltaW5tYXgucHVzaChOdW1iZXIoc3BbMV0pKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzQXJyYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgeHZhbHVlcy5wdXNoKHZhbFswXSk7XG4gICAgICAgICAgICAgICAgICAgIHl2YWx1ZXMucHVzaCh2YWxbMV0pO1xuICAgICAgICAgICAgICAgICAgICB5bWlubWF4LnB1c2godmFsWzFdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB4dmFsdWVzLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0gPT09IG51bGwgfHwgdmFsdWVzW2ldID09PSAnbnVsbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHl2YWx1ZXMucHVzaChudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHl2YWx1ZXMucHVzaChOdW1iZXIodmFsKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB5bWlubWF4LnB1c2goTnVtYmVyKHZhbCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5nZXQoJ3h2YWx1ZXMnKSkge1xuICAgICAgICAgICAgICAgIHh2YWx1ZXMgPSB0aGlzLm9wdGlvbnMuZ2V0KCd4dmFsdWVzJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMubWF4eSA9IHRoaXMubWF4eW9yZyA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIHltaW5tYXgpO1xuICAgICAgICAgICAgdGhpcy5taW55ID0gdGhpcy5taW55b3JnID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgeW1pbm1heCk7XG5cbiAgICAgICAgICAgIHRoaXMubWF4eCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIHh2YWx1ZXMpO1xuICAgICAgICAgICAgdGhpcy5taW54ID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgeHZhbHVlcyk7XG5cbiAgICAgICAgICAgIHRoaXMueHZhbHVlcyA9IHh2YWx1ZXM7XG4gICAgICAgICAgICB0aGlzLnl2YWx1ZXMgPSB5dmFsdWVzO1xuICAgICAgICAgICAgdGhpcy55bWlubWF4ID0geW1pbm1heDtcblxuICAgICAgICB9LFxuXG4gICAgICAgIHByb2Nlc3NSYW5nZU9wdGlvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIG5vcm1hbFJhbmdlTWluID0gb3B0aW9ucy5nZXQoJ25vcm1hbFJhbmdlTWluJyksXG4gICAgICAgICAgICAgICAgbm9ybWFsUmFuZ2VNYXggPSBvcHRpb25zLmdldCgnbm9ybWFsUmFuZ2VNYXgnKTtcblxuICAgICAgICAgICAgaWYgKG5vcm1hbFJhbmdlTWluICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAobm9ybWFsUmFuZ2VNaW4gPCB0aGlzLm1pbnkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5taW55ID0gbm9ybWFsUmFuZ2VNaW47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChub3JtYWxSYW5nZU1heCA+IHRoaXMubWF4eSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1heHkgPSBub3JtYWxSYW5nZU1heDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKSAhPT0gdW5kZWZpbmVkICYmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZUNsaXAnKSB8fCBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pbicpIDwgdGhpcy5taW55KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWlueSA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSAhPT0gdW5kZWZpbmVkICYmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZUNsaXAnKSB8fCBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heCcpID4gdGhpcy5tYXh5KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWF4eSA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW5YJykgIT09IHVuZGVmaW5lZCAmJiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwWCcpIHx8IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluWCcpIDwgdGhpcy5taW54KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWlueCA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluWCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4WCcpICE9PSB1bmRlZmluZWQgJiYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlQ2xpcFgnKSB8fCBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heFgnKSA+IHRoaXMubWF4eCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1heHggPSBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heFgnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXdOb3JtYWxSYW5nZTogZnVuY3Rpb24gKGNhbnZhc0xlZnQsIGNhbnZhc1RvcCwgY2FudmFzSGVpZ2h0LCBjYW52YXNXaWR0aCwgcmFuZ2V5KSB7XG4gICAgICAgICAgICB2YXIgbm9ybWFsUmFuZ2VNaW4gPSB0aGlzLm9wdGlvbnMuZ2V0KCdub3JtYWxSYW5nZU1pbicpLFxuICAgICAgICAgICAgICAgIG5vcm1hbFJhbmdlTWF4ID0gdGhpcy5vcHRpb25zLmdldCgnbm9ybWFsUmFuZ2VNYXgnKSxcbiAgICAgICAgICAgICAgICB5dG9wID0gY2FudmFzVG9wICsgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSAoY2FudmFzSGVpZ2h0ICogKChub3JtYWxSYW5nZU1heCAtIHRoaXMubWlueSkgLyByYW5nZXkpKSksXG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5yb3VuZCgoY2FudmFzSGVpZ2h0ICogKG5vcm1hbFJhbmdlTWF4IC0gbm9ybWFsUmFuZ2VNaW4pKSAvIHJhbmdleSk7XG4gICAgICAgICAgICB0aGlzLnRhcmdldC5kcmF3UmVjdChjYW52YXNMZWZ0LCB5dG9wLCBjYW52YXNXaWR0aCwgaGVpZ2h0LCB1bmRlZmluZWQsIHRoaXMub3B0aW9ucy5nZXQoJ25vcm1hbFJhbmdlQ29sb3InKSkuYXBwZW5kKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCxcbiAgICAgICAgICAgICAgICBjYW52YXNXaWR0aCA9IHRoaXMuY2FudmFzV2lkdGgsXG4gICAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0ID0gdGhpcy5jYW52YXNIZWlnaHQsXG4gICAgICAgICAgICAgICAgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzLFxuICAgICAgICAgICAgICAgIHNwb3RSYWRpdXMgPSBvcHRpb25zLmdldCgnc3BvdFJhZGl1cycpLFxuICAgICAgICAgICAgICAgIHJlZ2lvbk1hcCA9IHRoaXMucmVnaW9uTWFwLFxuICAgICAgICAgICAgICAgIHJhbmdleCwgcmFuZ2V5LCB5dmFsbGFzdCxcbiAgICAgICAgICAgICAgICBjYW52YXNUb3AsIGNhbnZhc0xlZnQsXG4gICAgICAgICAgICAgICAgdmVydGV4LCBwYXRoLCBwYXRocywgeCwgeSwgeG5leHQsIHhwb3MsIHhwb3NuZXh0LFxuICAgICAgICAgICAgICAgIGxhc3QsIG5leHQsIHl2YWxjb3VudCwgbGluZVNoYXBlcywgZmlsbFNoYXBlcywgcGxlbixcbiAgICAgICAgICAgICAgICB2YWx1ZVNwb3RzLCBobFNwb3RzRW5hYmxlZCwgY29sb3IsIHh2YWx1ZXMsIHl2YWx1ZXMsIGk7XG5cbiAgICAgICAgICAgIGlmICghbGluZS5fc3VwZXIucmVuZGVyLmNhbGwodGhpcykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2NhblZhbHVlcygpO1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzUmFuZ2VPcHRpb25zKCk7XG5cbiAgICAgICAgICAgIHh2YWx1ZXMgPSB0aGlzLnh2YWx1ZXM7XG4gICAgICAgICAgICB5dmFsdWVzID0gdGhpcy55dmFsdWVzO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMueW1pbm1heC5sZW5ndGggfHwgdGhpcy55dmFsdWVzLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgICAgICAvLyBlbXB0eSBvciBhbGwgbnVsbCB2YWx1ZXNzXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjYW52YXNUb3AgPSBjYW52YXNMZWZ0ID0gMDtcblxuICAgICAgICAgICAgcmFuZ2V4ID0gdGhpcy5tYXh4IC0gdGhpcy5taW54ID09PSAwID8gMSA6IHRoaXMubWF4eCAtIHRoaXMubWlueDtcbiAgICAgICAgICAgIHJhbmdleSA9IHRoaXMubWF4eSAtIHRoaXMubWlueSA9PT0gMCA/IDEgOiB0aGlzLm1heHkgLSB0aGlzLm1pbnk7XG4gICAgICAgICAgICB5dmFsbGFzdCA9IHRoaXMueXZhbHVlcy5sZW5ndGggLSAxO1xuXG4gICAgICAgICAgICBpZiAoc3BvdFJhZGl1cyAmJiAoY2FudmFzV2lkdGggPCAoc3BvdFJhZGl1cyAqIDQpIHx8IGNhbnZhc0hlaWdodCA8IChzcG90UmFkaXVzICogNCkpKSB7XG4gICAgICAgICAgICAgICAgc3BvdFJhZGl1cyA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3BvdFJhZGl1cykge1xuICAgICAgICAgICAgICAgIC8vIGFkanVzdCB0aGUgY2FudmFzIHNpemUgYXMgcmVxdWlyZWQgc28gdGhhdCBzcG90cyB3aWxsIGZpdFxuICAgICAgICAgICAgICAgIGhsU3BvdHNFbmFibGVkID0gb3B0aW9ucy5nZXQoJ2hpZ2hsaWdodFNwb3RDb2xvcicpICYmICAhb3B0aW9ucy5nZXQoJ2Rpc2FibGVJbnRlcmFjdGlvbicpO1xuICAgICAgICAgICAgICAgIGlmIChobFNwb3RzRW5hYmxlZCB8fCBvcHRpb25zLmdldCgnbWluU3BvdENvbG9yJykgfHwgKG9wdGlvbnMuZ2V0KCdzcG90Q29sb3InKSAmJiB5dmFsdWVzW3l2YWxsYXN0XSA9PT0gdGhpcy5taW55KSkge1xuICAgICAgICAgICAgICAgICAgICBjYW52YXNIZWlnaHQgLT0gTWF0aC5jZWlsKHNwb3RSYWRpdXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaGxTcG90c0VuYWJsZWQgfHwgb3B0aW9ucy5nZXQoJ21heFNwb3RDb2xvcicpIHx8IChvcHRpb25zLmdldCgnc3BvdENvbG9yJykgJiYgeXZhbHVlc1t5dmFsbGFzdF0gPT09IHRoaXMubWF4eSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0IC09IE1hdGguY2VpbChzcG90UmFkaXVzKTtcbiAgICAgICAgICAgICAgICAgICAgY2FudmFzVG9wICs9IE1hdGguY2VpbChzcG90UmFkaXVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGhsU3BvdHNFbmFibGVkIHx8XG4gICAgICAgICAgICAgICAgICAgICAoKG9wdGlvbnMuZ2V0KCdtaW5TcG90Q29sb3InKSB8fCBvcHRpb25zLmdldCgnbWF4U3BvdENvbG9yJykpICYmICh5dmFsdWVzWzBdID09PSB0aGlzLm1pbnkgfHwgeXZhbHVlc1swXSA9PT0gdGhpcy5tYXh5KSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FudmFzTGVmdCArPSBNYXRoLmNlaWwoc3BvdFJhZGl1cyk7XG4gICAgICAgICAgICAgICAgICAgIGNhbnZhc1dpZHRoIC09IE1hdGguY2VpbChzcG90UmFkaXVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGhsU3BvdHNFbmFibGVkIHx8IG9wdGlvbnMuZ2V0KCdzcG90Q29sb3InKSB8fFxuICAgICAgICAgICAgICAgICAgICAob3B0aW9ucy5nZXQoJ21pblNwb3RDb2xvcicpIHx8IG9wdGlvbnMuZ2V0KCdtYXhTcG90Q29sb3InKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgKHl2YWx1ZXNbeXZhbGxhc3RdID09PSB0aGlzLm1pbnkgfHwgeXZhbHVlc1t5dmFsbGFzdF0gPT09IHRoaXMubWF4eSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbnZhc1dpZHRoIC09IE1hdGguY2VpbChzcG90UmFkaXVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgY2FudmFzSGVpZ2h0LS07XG5cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnbm9ybWFsUmFuZ2VNaW4nKSAhPT0gdW5kZWZpbmVkICYmICFvcHRpb25zLmdldCgnZHJhd05vcm1hbE9uVG9wJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdOb3JtYWxSYW5nZShjYW52YXNMZWZ0LCBjYW52YXNUb3AsIGNhbnZhc0hlaWdodCwgY2FudmFzV2lkdGgsIHJhbmdleSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhdGggPSBbXTtcbiAgICAgICAgICAgIHBhdGhzID0gW3BhdGhdO1xuICAgICAgICAgICAgbGFzdCA9IG5leHQgPSBudWxsO1xuICAgICAgICAgICAgeXZhbGNvdW50ID0geXZhbHVlcy5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgeXZhbGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICB4ID0geHZhbHVlc1tpXTtcbiAgICAgICAgICAgICAgICB4bmV4dCA9IHh2YWx1ZXNbaSArIDFdO1xuICAgICAgICAgICAgICAgIHkgPSB5dmFsdWVzW2ldO1xuICAgICAgICAgICAgICAgIHhwb3MgPSBjYW52YXNMZWZ0ICsgTWF0aC5yb3VuZCgoeCAtIHRoaXMubWlueCkgKiAoY2FudmFzV2lkdGggLyByYW5nZXgpKTtcbiAgICAgICAgICAgICAgICB4cG9zbmV4dCA9IGkgPCB5dmFsY291bnQgLSAxID8gY2FudmFzTGVmdCArIE1hdGgucm91bmQoKHhuZXh0IC0gdGhpcy5taW54KSAqIChjYW52YXNXaWR0aCAvIHJhbmdleCkpIDogY2FudmFzV2lkdGg7XG4gICAgICAgICAgICAgICAgbmV4dCA9IHhwb3MgKyAoKHhwb3NuZXh0IC0geHBvcykgLyAyKTtcbiAgICAgICAgICAgICAgICByZWdpb25NYXBbaV0gPSBbbGFzdCB8fCAwLCBuZXh0LCBpXTtcbiAgICAgICAgICAgICAgICBsYXN0ID0gbmV4dDtcbiAgICAgICAgICAgICAgICBpZiAoeSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHl2YWx1ZXNbaSAtIDFdICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhzLnB1c2gocGF0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHkgPCB0aGlzLm1pbnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSB0aGlzLm1pbnk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHkgPiB0aGlzLm1heHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSB0aGlzLm1heHk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXRoLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJldmlvdXMgdmFsdWUgd2FzIG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGgucHVzaChbeHBvcywgY2FudmFzVG9wICsgY2FudmFzSGVpZ2h0XSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmVydGV4ID0gW3hwb3MsIGNhbnZhc1RvcCArIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC0gKGNhbnZhc0hlaWdodCAqICgoeSAtIHRoaXMubWlueSkgLyByYW5nZXkpKSldO1xuICAgICAgICAgICAgICAgICAgICBwYXRoLnB1c2godmVydGV4KTtcbiAgICAgICAgICAgICAgICAgICAgdmVydGljZXMucHVzaCh2ZXJ0ZXgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGluZVNoYXBlcyA9IFtdO1xuICAgICAgICAgICAgZmlsbFNoYXBlcyA9IFtdO1xuICAgICAgICAgICAgcGxlbiA9IHBhdGhzLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aHNbaV07XG4gICAgICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnZmlsbENvbG9yJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGgucHVzaChbcGF0aFtwYXRoLmxlbmd0aCAtIDFdWzBdLCAoY2FudmFzVG9wICsgY2FudmFzSGVpZ2h0KV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbFNoYXBlcy5wdXNoKHBhdGguc2xpY2UoMCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aC5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIG9ubHkgYSBzaW5nbGUgcG9pbnQgaW4gdGhpcyBwYXRoLCB0aGVuIHdlIHdhbnQgdG8gZGlzcGxheSBpdFxuICAgICAgICAgICAgICAgICAgICAvLyBhcyBhIHZlcnRpY2FsIGxpbmUgd2hpY2ggbWVhbnMgd2Uga2VlcCBwYXRoWzBdICBhcyBpc1xuICAgICAgICAgICAgICAgICAgICBpZiAocGF0aC5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIHdlIHdhbnQgdGhlIGZpcnN0IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoWzBdID0gW3BhdGhbMF1bMF0sIHBhdGhbMV1bMV1dO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGxpbmVTaGFwZXMucHVzaChwYXRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGRyYXcgdGhlIGZpbGwgZmlyc3QsIHRoZW4gb3B0aW9uYWxseSB0aGUgbm9ybWFsIHJhbmdlLCB0aGVuIHRoZSBsaW5lIG9uIHRvcCBvZiB0aGF0XG4gICAgICAgICAgICBwbGVuID0gZmlsbFNoYXBlcy5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LmRyYXdTaGFwZShmaWxsU2hhcGVzW2ldLFxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnZmlsbENvbG9yJyksIG9wdGlvbnMuZ2V0KCdmaWxsQ29sb3InKSkuYXBwZW5kKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnbm9ybWFsUmFuZ2VNaW4nKSAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMuZ2V0KCdkcmF3Tm9ybWFsT25Ub3AnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhd05vcm1hbFJhbmdlKGNhbnZhc0xlZnQsIGNhbnZhc1RvcCwgY2FudmFzSGVpZ2h0LCBjYW52YXNXaWR0aCwgcmFuZ2V5KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGxlbiA9IGxpbmVTaGFwZXMubGVuZ3RoO1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgIHRhcmdldC5kcmF3U2hhcGUobGluZVNoYXBlc1tpXSwgb3B0aW9ucy5nZXQoJ2xpbmVDb2xvcicpLCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdsaW5lV2lkdGgnKSkuYXBwZW5kKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzcG90UmFkaXVzICYmIG9wdGlvbnMuZ2V0KCd2YWx1ZVNwb3RzJykpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZVNwb3RzID0gb3B0aW9ucy5nZXQoJ3ZhbHVlU3BvdHMnKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVTcG90cy5nZXQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZVNwb3RzID0gbmV3IFJhbmdlTWFwKHZhbHVlU3BvdHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgeXZhbGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSB2YWx1ZVNwb3RzLmdldCh5dmFsdWVzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbG9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZShjYW52YXNMZWZ0ICsgTWF0aC5yb3VuZCgoeHZhbHVlc1tpXSAtIHRoaXMubWlueCkgKiAoY2FudmFzV2lkdGggLyByYW5nZXgpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXNUb3AgKyBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAtIChjYW52YXNIZWlnaHQgKiAoKHl2YWx1ZXNbaV0gLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwb3RSYWRpdXMsIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcikuYXBwZW5kKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzcG90UmFkaXVzICYmIG9wdGlvbnMuZ2V0KCdzcG90Q29sb3InKSAmJiB5dmFsdWVzW3l2YWxsYXN0XSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRhcmdldC5kcmF3Q2lyY2xlKGNhbnZhc0xlZnQgKyBNYXRoLnJvdW5kKCh4dmFsdWVzW3h2YWx1ZXMubGVuZ3RoIC0gMV0gLSB0aGlzLm1pbngpICogKGNhbnZhc1dpZHRoIC8gcmFuZ2V4KSksXG4gICAgICAgICAgICAgICAgICAgIGNhbnZhc1RvcCArIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC0gKGNhbnZhc0hlaWdodCAqICgoeXZhbHVlc1t5dmFsbGFzdF0gLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLFxuICAgICAgICAgICAgICAgICAgICBzcG90UmFkaXVzLCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdzcG90Q29sb3InKSkuYXBwZW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5tYXh5ICE9PSB0aGlzLm1pbnlvcmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3BvdFJhZGl1cyAmJiBvcHRpb25zLmdldCgnbWluU3BvdENvbG9yJykpIHtcbiAgICAgICAgICAgICAgICAgICAgeCA9IHh2YWx1ZXNbJC5pbkFycmF5KHRoaXMubWlueW9yZywgeXZhbHVlcyldO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZShjYW52YXNMZWZ0ICsgTWF0aC5yb3VuZCgoeCAtIHRoaXMubWlueCkgKiAoY2FudmFzV2lkdGggLyByYW5nZXgpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc1RvcCArIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC0gKGNhbnZhc0hlaWdodCAqICgodGhpcy5taW55b3JnIC0gdGhpcy5taW55KSAvIHJhbmdleSkpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwb3RSYWRpdXMsIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdtaW5TcG90Q29sb3InKSkuYXBwZW5kKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzcG90UmFkaXVzICYmIG9wdGlvbnMuZ2V0KCdtYXhTcG90Q29sb3InKSkge1xuICAgICAgICAgICAgICAgICAgICB4ID0geHZhbHVlc1skLmluQXJyYXkodGhpcy5tYXh5b3JnLCB5dmFsdWVzKV07XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5kcmF3Q2lyY2xlKGNhbnZhc0xlZnQgKyBNYXRoLnJvdW5kKCh4IC0gdGhpcy5taW54KSAqIChjYW52YXNXaWR0aCAvIHJhbmdleCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzVG9wICsgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSAoY2FudmFzSGVpZ2h0ICogKCh0aGlzLm1heHlvcmcgLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3BvdFJhZGl1cywgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ21heFNwb3RDb2xvcicpKS5hcHBlbmQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMubGFzdFNoYXBlSWQgPSB0YXJnZXQuZ2V0TGFzdFNoYXBlSWQoKTtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzVG9wID0gY2FudmFzVG9wO1xuICAgICAgICAgICAgdGFyZ2V0LnJlbmRlcigpO1xuICAgICAgICB9XG4gICAgfSk7XG5cblxuICAgIC8qKlxuICAgICAqIEJhciBjaGFydHNcbiAgICAgKi9cbiAgICAkLmZuLnNwYXJrbGluZS5iYXIgPSBiYXIgPSBjcmVhdGVDbGFzcygkLmZuLnNwYXJrbGluZS5fYmFzZSwgYmFySGlnaGxpZ2h0TWl4aW4sIHtcbiAgICAgICAgdHlwZTogJ2JhcicsXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgICAgIHZhciBiYXJXaWR0aCA9IHBhcnNlSW50KG9wdGlvbnMuZ2V0KCdiYXJXaWR0aCcpLCAxMCksXG4gICAgICAgICAgICAgICAgYmFyU3BhY2luZyA9IHBhcnNlSW50KG9wdGlvbnMuZ2V0KCdiYXJTcGFjaW5nJyksIDEwKSxcbiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWluID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKSxcbiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWF4ID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSxcbiAgICAgICAgICAgICAgICBjaGFydFJhbmdlQ2xpcCA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlQ2xpcCcpLFxuICAgICAgICAgICAgICAgIHN0YWNrTWluID0gSW5maW5pdHksXG4gICAgICAgICAgICAgICAgc3RhY2tNYXggPSAtSW5maW5pdHksXG4gICAgICAgICAgICAgICAgaXNTdGFja1N0cmluZywgZ3JvdXBNaW4sIGdyb3VwTWF4LCBzdGFja1JhbmdlcyxcbiAgICAgICAgICAgICAgICBudW1WYWx1ZXMsIGksIHZsZW4sIHJhbmdlLCB6ZXJvQXhpcywgeGF4aXNPZmZzZXQsIG1pbiwgbWF4LCBjbGlwTWluLCBjbGlwTWF4LFxuICAgICAgICAgICAgICAgIHN0YWNrZWQsIHZsaXN0LCBqLCBzbGVuLCBzdmFscywgdmFsLCB5b2Zmc2V0LCB5TWF4Q2FsYywgY2FudmFzSGVpZ2h0RWY7XG4gICAgICAgICAgICBiYXIuX3N1cGVyLmluaXQuY2FsbCh0aGlzLCBlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgICAgICAgICAgLy8gc2NhbiB2YWx1ZXMgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdG8gc3RhY2sgYmFyc1xuICAgICAgICAgICAgZm9yIChpID0gMCwgdmxlbiA9IHZhbHVlcy5sZW5ndGg7IGkgPCB2bGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YWwgPSB2YWx1ZXNbaV07XG4gICAgICAgICAgICAgICAgaXNTdGFja1N0cmluZyA9IHR5cGVvZih2YWwpID09PSAnc3RyaW5nJyAmJiB2YWwuaW5kZXhPZignOicpID4gLTE7XG4gICAgICAgICAgICAgICAgaWYgKGlzU3RhY2tTdHJpbmcgfHwgJC5pc0FycmF5KHZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1N0YWNrU3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWx1ZXNbaV0gPSBub3JtYWxpemVWYWx1ZXModmFsLnNwbGl0KCc6JykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IHJlbW92ZSh2YWwsIG51bGwpOyAvLyBtaW4vbWF4IHdpbGwgdHJlYXQgbnVsbCBhcyB6ZXJvXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwTWluID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgdmFsKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBNYXggPSBNYXRoLm1heC5hcHBseShNYXRoLCB2YWwpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBNaW4gPCBzdGFja01pbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tNaW4gPSBncm91cE1pbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBNYXggPiBzdGFja01heCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tNYXggPSBncm91cE1heDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zdGFja2VkID0gc3RhY2tlZDtcbiAgICAgICAgICAgIHRoaXMucmVnaW9uU2hhcGVzID0ge307XG4gICAgICAgICAgICB0aGlzLmJhcldpZHRoID0gYmFyV2lkdGg7XG4gICAgICAgICAgICB0aGlzLmJhclNwYWNpbmcgPSBiYXJTcGFjaW5nO1xuICAgICAgICAgICAgdGhpcy50b3RhbEJhcldpZHRoID0gYmFyV2lkdGggKyBiYXJTcGFjaW5nO1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoID0gKHZhbHVlcy5sZW5ndGggKiBiYXJXaWR0aCkgKyAoKHZhbHVlcy5sZW5ndGggLSAxKSAqIGJhclNwYWNpbmcpO1xuXG4gICAgICAgICAgICB0aGlzLmluaXRUYXJnZXQoKTtcblxuICAgICAgICAgICAgaWYgKGNoYXJ0UmFuZ2VDbGlwKSB7XG4gICAgICAgICAgICAgICAgY2xpcE1pbiA9IGNoYXJ0UmFuZ2VNaW4gPT09IHVuZGVmaW5lZCA/IC1JbmZpbml0eSA6IGNoYXJ0UmFuZ2VNaW47XG4gICAgICAgICAgICAgICAgY2xpcE1heCA9IGNoYXJ0UmFuZ2VNYXggPT09IHVuZGVmaW5lZCA/IEluZmluaXR5IDogY2hhcnRSYW5nZU1heDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbnVtVmFsdWVzID0gW107XG4gICAgICAgICAgICBzdGFja1JhbmdlcyA9IHN0YWNrZWQgPyBbXSA6IG51bVZhbHVlcztcbiAgICAgICAgICAgIHZhciBzdGFja1RvdGFscyA9IFtdO1xuICAgICAgICAgICAgdmFyIHN0YWNrUmFuZ2VzTmVnID0gW107XG4gICAgICAgICAgICBmb3IgKGkgPSAwLCB2bGVuID0gdmFsdWVzLmxlbmd0aDsgaSA8IHZsZW47IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChzdGFja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZsaXN0ID0gdmFsdWVzW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaV0gPSBzdmFscyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBzdGFja1RvdGFsc1tpXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHN0YWNrUmFuZ2VzW2ldID0gc3RhY2tSYW5nZXNOZWdbaV0gPSAwO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwLCBzbGVuID0gdmxpc3QubGVuZ3RoOyBqIDwgc2xlbjsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBzdmFsc1tqXSA9IGNoYXJ0UmFuZ2VDbGlwID8gY2xpcHZhbCh2bGlzdFtqXSwgY2xpcE1pbiwgY2xpcE1heCkgOiB2bGlzdFtqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja1RvdGFsc1tpXSArPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFja01pbiA8IDAgJiYgc3RhY2tNYXggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWwgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja1Jhbmdlc05lZ1tpXSArPSBNYXRoLmFicyh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tSYW5nZXNbaV0gKz0gdmFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tSYW5nZXNbaV0gKz0gTWF0aC5hYnModmFsIC0gKHZhbCA8IDAgPyBzdGFja01heCA6IHN0YWNrTWluKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bVZhbHVlcy5wdXNoKHZhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWwgPSBjaGFydFJhbmdlQ2xpcCA/IGNsaXB2YWwodmFsdWVzW2ldLCBjbGlwTWluLCBjbGlwTWF4KSA6IHZhbHVlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gdmFsdWVzW2ldID0gbm9ybWFsaXplVmFsdWUodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVtVmFsdWVzLnB1c2godmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubWF4ID0gbWF4ID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgbnVtVmFsdWVzKTtcbiAgICAgICAgICAgIHRoaXMubWluID0gbWluID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgbnVtVmFsdWVzKTtcbiAgICAgICAgICAgIHRoaXMuc3RhY2tNYXggPSBzdGFja01heCA9IHN0YWNrZWQgPyBNYXRoLm1heC5hcHBseShNYXRoLCBzdGFja1RvdGFscykgOiBtYXg7XG4gICAgICAgICAgICB0aGlzLnN0YWNrTWluID0gc3RhY2tNaW4gPSBzdGFja2VkID8gTWF0aC5taW4uYXBwbHkoTWF0aCwgbnVtVmFsdWVzKSA6IG1pbjtcblxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJykgIT09IHVuZGVmaW5lZCAmJiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKSA8IG1pbikpIHtcbiAgICAgICAgICAgICAgICBtaW4gPSBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4JykgIT09IHVuZGVmaW5lZCAmJiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSA+IG1heCkpIHtcbiAgICAgICAgICAgICAgICBtYXggPSBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnplcm9BeGlzID0gemVyb0F4aXMgPSBvcHRpb25zLmdldCgnemVyb0F4aXMnLCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChtaW4gPD0gMCAmJiBtYXggPj0gMCAmJiB6ZXJvQXhpcykge1xuICAgICAgICAgICAgICAgIHhheGlzT2Zmc2V0ID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoemVyb0F4aXMgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB4YXhpc09mZnNldCA9IG1pbjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWluID4gMCkge1xuICAgICAgICAgICAgICAgIHhheGlzT2Zmc2V0ID0gbWluO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB4YXhpc09mZnNldCA9IG1heDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMueGF4aXNPZmZzZXQgPSB4YXhpc09mZnNldDtcblxuICAgICAgICAgICAgcmFuZ2UgPSBzdGFja2VkID8gKE1hdGgubWF4LmFwcGx5KE1hdGgsIHN0YWNrUmFuZ2VzKSArIE1hdGgubWF4LmFwcGx5KE1hdGgsIHN0YWNrUmFuZ2VzTmVnKSkgOiBtYXggLSBtaW47XG5cbiAgICAgICAgICAgIC8vIGFzIHdlIHBsb3QgemVyby9taW4gdmFsdWVzIGEgc2luZ2xlIHBpeGVsIGxpbmUsIHdlIGFkZCBhIHBpeGVsIHRvIGFsbCBvdGhlclxuICAgICAgICAgICAgLy8gdmFsdWVzIC0gUmVkdWNlIHRoZSBlZmZlY3RpdmUgY2FudmFzIHNpemUgdG8gc3VpdFxuICAgICAgICAgICAgdGhpcy5jYW52YXNIZWlnaHRFZiA9ICh6ZXJvQXhpcyAmJiBtaW4gPCAwKSA/IHRoaXMuY2FudmFzSGVpZ2h0IC0gMiA6IHRoaXMuY2FudmFzSGVpZ2h0IC0gMTtcblxuICAgICAgICAgICAgaWYgKG1pbiA8IHhheGlzT2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgeU1heENhbGMgPSAoc3RhY2tlZCAmJiBtYXggPj0gMCkgPyBzdGFja01heCA6IG1heDtcbiAgICAgICAgICAgICAgICB5b2Zmc2V0ID0gKHlNYXhDYWxjIC0geGF4aXNPZmZzZXQpIC8gcmFuZ2UgKiB0aGlzLmNhbnZhc0hlaWdodDtcbiAgICAgICAgICAgICAgICBpZiAoeW9mZnNldCAhPT0gTWF0aC5jZWlsKHlvZmZzZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzSGVpZ2h0RWYgLT0gMjtcbiAgICAgICAgICAgICAgICAgICAgeW9mZnNldCA9IE1hdGguY2VpbCh5b2Zmc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHlvZmZzZXQgPSB0aGlzLmNhbnZhc0hlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMueW9mZnNldCA9IHlvZmZzZXQ7XG5cbiAgICAgICAgICAgIGlmICgkLmlzQXJyYXkob3B0aW9ucy5nZXQoJ2NvbG9yTWFwJykpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xvck1hcEJ5SW5kZXggPSBvcHRpb25zLmdldCgnY29sb3JNYXAnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yTWFwQnlWYWx1ZSA9IG51bGw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBCeUluZGV4ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yTWFwQnlWYWx1ZSA9IG9wdGlvbnMuZ2V0KCdjb2xvck1hcCcpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbG9yTWFwQnlWYWx1ZSAmJiB0aGlzLmNvbG9yTWFwQnlWYWx1ZS5nZXQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbG9yTWFwQnlWYWx1ZSA9IG5ldyBSYW5nZU1hcCh0aGlzLmNvbG9yTWFwQnlWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnJhbmdlID0gcmFuZ2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoZWwsIHgsIHkpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBNYXRoLmZsb29yKHggLyB0aGlzLnRvdGFsQmFyV2lkdGgpO1xuICAgICAgICAgICAgcmV0dXJuIChyZXN1bHQgPCAwIHx8IHJlc3VsdCA+PSB0aGlzLnZhbHVlcy5sZW5ndGgpID8gdW5kZWZpbmVkIDogcmVzdWx0O1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uLFxuICAgICAgICAgICAgICAgIHZhbHVlcyA9IGVuc3VyZUFycmF5KHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dKSxcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBbXSxcbiAgICAgICAgICAgICAgICB2YWx1ZSwgaTtcbiAgICAgICAgICAgIGZvciAoaSA9IHZhbHVlcy5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlc1tpXTtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGlzTnVsbDogdmFsdWUgPT09IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoaXMuY2FsY0NvbG9yKGksIHZhbHVlLCBjdXJyZW50UmVnaW9uKSxcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBjdXJyZW50UmVnaW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9LFxuXG4gICAgICAgIGNhbGNDb2xvcjogZnVuY3Rpb24gKHN0YWNrbnVtLCB2YWx1ZSwgdmFsdWVudW0pIHtcbiAgICAgICAgICAgIHZhciBjb2xvck1hcEJ5SW5kZXggPSB0aGlzLmNvbG9yTWFwQnlJbmRleCxcbiAgICAgICAgICAgICAgICBjb2xvck1hcEJ5VmFsdWUgPSB0aGlzLmNvbG9yTWFwQnlWYWx1ZSxcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIGNvbG9yLCBuZXdDb2xvcjtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrZWQpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IG9wdGlvbnMuZ2V0KCdzdGFja2VkQmFyQ29sb3InKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSAodmFsdWUgPCAwKSA/IG9wdGlvbnMuZ2V0KCduZWdCYXJDb2xvcicpIDogb3B0aW9ucy5nZXQoJ2JhckNvbG9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IDAgJiYgb3B0aW9ucy5nZXQoJ3plcm9Db2xvcicpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IG9wdGlvbnMuZ2V0KCd6ZXJvQ29sb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb2xvck1hcEJ5VmFsdWUgJiYgKG5ld0NvbG9yID0gY29sb3JNYXBCeVZhbHVlLmdldCh2YWx1ZSkpKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSBuZXdDb2xvcjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29sb3JNYXBCeUluZGV4ICYmIGNvbG9yTWFwQnlJbmRleC5sZW5ndGggPiB2YWx1ZW51bSkge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gY29sb3JNYXBCeUluZGV4W3ZhbHVlbnVtXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkLmlzQXJyYXkoY29sb3IpID8gY29sb3Jbc3RhY2tudW0gJSBjb2xvci5sZW5ndGhdIDogY29sb3I7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbmRlciBiYXIocykgZm9yIGEgcmVnaW9uXG4gICAgICAgICAqL1xuICAgICAgICByZW5kZXJSZWdpb246IGZ1bmN0aW9uICh2YWx1ZW51bSwgaGlnaGxpZ2h0KSB7XG4gICAgICAgICAgICB2YXIgdmFscyA9IHRoaXMudmFsdWVzW3ZhbHVlbnVtXSxcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIHhheGlzT2Zmc2V0ID0gdGhpcy54YXhpc09mZnNldCxcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBbXSxcbiAgICAgICAgICAgICAgICByYW5nZSA9IHRoaXMucmFuZ2UsXG4gICAgICAgICAgICAgICAgc3RhY2tlZCA9IHRoaXMuc3RhY2tlZCxcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCxcbiAgICAgICAgICAgICAgICB4ID0gdmFsdWVudW0gKiB0aGlzLnRvdGFsQmFyV2lkdGgsXG4gICAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0RWYgPSB0aGlzLmNhbnZhc0hlaWdodEVmLFxuICAgICAgICAgICAgICAgIHlvZmZzZXQgPSB0aGlzLnlvZmZzZXQsXG4gICAgICAgICAgICAgICAgeSwgaGVpZ2h0LCBjb2xvciwgaXNOdWxsLCB5b2Zmc2V0TmVnLCBpLCB2YWxjb3VudCwgdmFsLCBtaW5QbG90dGVkLCBhbGxNaW47XG5cbiAgICAgICAgICAgIHZhbHMgPSAkLmlzQXJyYXkodmFscykgPyB2YWxzIDogW3ZhbHNdO1xuICAgICAgICAgICAgdmFsY291bnQgPSB2YWxzLmxlbmd0aDtcbiAgICAgICAgICAgIHZhbCA9IHZhbHNbMF07XG4gICAgICAgICAgICBpc051bGwgPSBhbGwobnVsbCwgdmFscyk7XG4gICAgICAgICAgICBhbGxNaW4gPSBhbGwoeGF4aXNPZmZzZXQsIHZhbHMsIHRydWUpO1xuXG4gICAgICAgICAgICBpZiAoaXNOdWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdudWxsQ29sb3InKSkge1xuICAgICAgICAgICAgICAgICAgICBjb2xvciA9IGhpZ2hsaWdodCA/IG9wdGlvbnMuZ2V0KCdudWxsQ29sb3InKSA6IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKG9wdGlvbnMuZ2V0KCdudWxsQ29sb3InKSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIHkgPSAoeW9mZnNldCA+IDApID8geW9mZnNldCAtIDEgOiB5b2Zmc2V0O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmRyYXdSZWN0KHgsIHksIHRoaXMuYmFyV2lkdGggLSAxLCAwLCBjb2xvciwgY29sb3IpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeW9mZnNldE5lZyA9IHlvZmZzZXQ7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmFsY291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhbCA9IHZhbHNbaV07XG5cbiAgICAgICAgICAgICAgICBpZiAoc3RhY2tlZCAmJiB2YWwgPT09IHhheGlzT2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghYWxsTWluIHx8IG1pblBsb3R0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG1pblBsb3R0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChyYW5nZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5mbG9vcihjYW52YXNIZWlnaHRFZiAqICgoTWF0aC5hYnModmFsIC0geGF4aXNPZmZzZXQpIC8gcmFuZ2UpKSkgKyAxO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh2YWwgPCB4YXhpc09mZnNldCB8fCAodmFsID09PSB4YXhpc09mZnNldCAmJiB5b2Zmc2V0ID09PSAwKSkge1xuICAgICAgICAgICAgICAgICAgICB5ID0geW9mZnNldE5lZztcbiAgICAgICAgICAgICAgICAgICAgeW9mZnNldE5lZyArPSBoZWlnaHQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgeSA9IHlvZmZzZXQgLSBoZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIHlvZmZzZXQgLT0gaGVpZ2h0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0NvbG9yKGksIHZhbCwgdmFsdWVudW0pO1xuICAgICAgICAgICAgICAgIGlmIChoaWdobGlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSB0aGlzLmNhbGNIaWdobGlnaHRDb2xvcihjb2xvciwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRhcmdldC5kcmF3UmVjdCh4LCB5LCB0aGlzLmJhcldpZHRoIC0gMSwgaGVpZ2h0IC0gMSwgY29sb3IsIGNvbG9yKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgfSk7XG5cblxuICAgIC8qKlxuICAgICAqIFRyaXN0YXRlIGNoYXJ0c1xuICAgICAqL1xuICAgICQuZm4uc3BhcmtsaW5lLnRyaXN0YXRlID0gdHJpc3RhdGUgPSBjcmVhdGVDbGFzcygkLmZuLnNwYXJrbGluZS5fYmFzZSwgYmFySGlnaGxpZ2h0TWl4aW4sIHtcbiAgICAgICAgdHlwZTogJ3RyaXN0YXRlJyxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICAgICAgdmFyIGJhcldpZHRoID0gcGFyc2VJbnQob3B0aW9ucy5nZXQoJ2JhcldpZHRoJyksIDEwKSxcbiAgICAgICAgICAgICAgICBiYXJTcGFjaW5nID0gcGFyc2VJbnQob3B0aW9ucy5nZXQoJ2JhclNwYWNpbmcnKSwgMTApO1xuICAgICAgICAgICAgdHJpc3RhdGUuX3N1cGVyLmluaXQuY2FsbCh0aGlzLCBlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgICAgICAgICAgdGhpcy5yZWdpb25TaGFwZXMgPSB7fTtcbiAgICAgICAgICAgIHRoaXMuYmFyV2lkdGggPSBiYXJXaWR0aDtcbiAgICAgICAgICAgIHRoaXMuYmFyU3BhY2luZyA9IGJhclNwYWNpbmc7XG4gICAgICAgICAgICB0aGlzLnRvdGFsQmFyV2lkdGggPSBiYXJXaWR0aCArIGJhclNwYWNpbmc7XG4gICAgICAgICAgICB0aGlzLnZhbHVlcyA9ICQubWFwKHZhbHVlcywgTnVtYmVyKTtcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aCA9ICh2YWx1ZXMubGVuZ3RoICogYmFyV2lkdGgpICsgKCh2YWx1ZXMubGVuZ3RoIC0gMSkgKiBiYXJTcGFjaW5nKTtcblxuICAgICAgICAgICAgaWYgKCQuaXNBcnJheShvcHRpb25zLmdldCgnY29sb3JNYXAnKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yTWFwQnlJbmRleCA9IG9wdGlvbnMuZ2V0KCdjb2xvck1hcCcpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBCeVZhbHVlID0gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xvck1hcEJ5SW5kZXggPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBCeVZhbHVlID0gb3B0aW9ucy5nZXQoJ2NvbG9yTWFwJyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sb3JNYXBCeVZhbHVlICYmIHRoaXMuY29sb3JNYXBCeVZhbHVlLmdldCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBCeVZhbHVlID0gbmV3IFJhbmdlTWFwKHRoaXMuY29sb3JNYXBCeVZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmluaXRUYXJnZXQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRSZWdpb246IGZ1bmN0aW9uIChlbCwgeCwgeSkge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoeCAvIHRoaXMudG90YWxCYXJXaWR0aCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0Q3VycmVudFJlZ2lvbkZpZWxkczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb247XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlzTnVsbDogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0gPT09IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0sXG4gICAgICAgICAgICAgICAgY29sb3I6IHRoaXMuY2FsY0NvbG9yKHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dLCBjdXJyZW50UmVnaW9uKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQ6IGN1cnJlbnRSZWdpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FsY0NvbG9yOiBmdW5jdGlvbiAodmFsdWUsIHZhbHVlbnVtKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXMsXG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBjb2xvck1hcEJ5SW5kZXggPSB0aGlzLmNvbG9yTWFwQnlJbmRleCxcbiAgICAgICAgICAgICAgICBjb2xvck1hcEJ5VmFsdWUgPSB0aGlzLmNvbG9yTWFwQnlWYWx1ZSxcbiAgICAgICAgICAgICAgICBjb2xvciwgbmV3Q29sb3I7XG5cbiAgICAgICAgICAgIGlmIChjb2xvck1hcEJ5VmFsdWUgJiYgKG5ld0NvbG9yID0gY29sb3JNYXBCeVZhbHVlLmdldCh2YWx1ZSkpKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSBuZXdDb2xvcjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29sb3JNYXBCeUluZGV4ICYmIGNvbG9yTWFwQnlJbmRleC5sZW5ndGggPiB2YWx1ZW51bSkge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gY29sb3JNYXBCeUluZGV4W3ZhbHVlbnVtXTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWVzW3ZhbHVlbnVtXSA8IDApIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IG9wdGlvbnMuZ2V0KCduZWdCYXJDb2xvcicpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZXNbdmFsdWVudW1dID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3Bvc0JhckNvbG9yJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3plcm9CYXJDb2xvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvbG9yO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbmRlclJlZ2lvbjogZnVuY3Rpb24gKHZhbHVlbnVtLCBoaWdobGlnaHQpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcyxcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIHRhcmdldCA9IHRoaXMudGFyZ2V0LFxuICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCwgaGVpZ2h0LCBoYWxmSGVpZ2h0LFxuICAgICAgICAgICAgICAgIHgsIHksIGNvbG9yO1xuXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0YXJnZXQucGl4ZWxIZWlnaHQ7XG4gICAgICAgICAgICBoYWxmSGVpZ2h0ID0gTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyAyKTtcblxuICAgICAgICAgICAgeCA9IHZhbHVlbnVtICogdGhpcy50b3RhbEJhcldpZHRoO1xuICAgICAgICAgICAgaWYgKHZhbHVlc1t2YWx1ZW51bV0gPCAwKSB7XG4gICAgICAgICAgICAgICAgeSA9IGhhbGZIZWlnaHQ7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gaGFsZkhlaWdodCAtIDE7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlc1t2YWx1ZW51bV0gPiAwKSB7XG4gICAgICAgICAgICAgICAgeSA9IDA7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gaGFsZkhlaWdodCAtIDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHkgPSBoYWxmSGVpZ2h0IC0gMTtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29sb3IgPSB0aGlzLmNhbGNDb2xvcih2YWx1ZXNbdmFsdWVudW1dLCB2YWx1ZW51bSk7XG4gICAgICAgICAgICBpZiAoY29sb3IgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGlnaGxpZ2h0KSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGlzLmNhbGNIaWdobGlnaHRDb2xvcihjb2xvciwgb3B0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmRyYXdSZWN0KHgsIHksIHRoaXMuYmFyV2lkdGggLSAxLCBoZWlnaHQgLSAxLCBjb2xvciwgY29sb3IpO1xuICAgICAgICB9XG4gICAgfSk7XG5cblxuICAgIC8qKlxuICAgICAqIERpc2NyZXRlIGNoYXJ0c1xuICAgICAqL1xuICAgICQuZm4uc3BhcmtsaW5lLmRpc2NyZXRlID0gZGlzY3JldGUgPSBjcmVhdGVDbGFzcygkLmZuLnNwYXJrbGluZS5fYmFzZSwgYmFySGlnaGxpZ2h0TWl4aW4sIHtcbiAgICAgICAgdHlwZTogJ2Rpc2NyZXRlJyxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICAgICAgZGlzY3JldGUuX3N1cGVyLmluaXQuY2FsbCh0aGlzLCBlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgICAgICAgICAgdGhpcy5yZWdpb25TaGFwZXMgPSB7fTtcbiAgICAgICAgICAgIHRoaXMudmFsdWVzID0gdmFsdWVzID0gJC5tYXAodmFsdWVzLCBOdW1iZXIpO1xuICAgICAgICAgICAgdGhpcy5taW4gPSBNYXRoLm1pbi5hcHBseShNYXRoLCB2YWx1ZXMpO1xuICAgICAgICAgICAgdGhpcy5tYXggPSBNYXRoLm1heC5hcHBseShNYXRoLCB2YWx1ZXMpO1xuICAgICAgICAgICAgdGhpcy5yYW5nZSA9IHRoaXMubWF4IC0gdGhpcy5taW47XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGggPSBvcHRpb25zLmdldCgnd2lkdGgnKSA9PT0gJ2F1dG8nID8gdmFsdWVzLmxlbmd0aCAqIDIgOiB0aGlzLndpZHRoO1xuICAgICAgICAgICAgdGhpcy5pbnRlcnZhbCA9IE1hdGguZmxvb3Iod2lkdGggLyB2YWx1ZXMubGVuZ3RoKTtcbiAgICAgICAgICAgIHRoaXMuaXRlbVdpZHRoID0gd2lkdGggLyB2YWx1ZXMubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJykgIT09IHVuZGVmaW5lZCAmJiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKSA8IHRoaXMubWluKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWluID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heCcpICE9PSB1bmRlZmluZWQgJiYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlQ2xpcCcpIHx8IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4JykgPiB0aGlzLm1heCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1heCA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmluaXRUYXJnZXQoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldCkge1xuICAgICAgICAgICAgICAgIHRoaXMubGluZUhlaWdodCA9IG9wdGlvbnMuZ2V0KCdsaW5lSGVpZ2h0JykgPT09ICdhdXRvJyA/IE1hdGgucm91bmQodGhpcy5jYW52YXNIZWlnaHQgKiAwLjMpIDogb3B0aW9ucy5nZXQoJ2xpbmVIZWlnaHQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZXRSZWdpb246IGZ1bmN0aW9uIChlbCwgeCwgeSkge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoeCAvIHRoaXMuaXRlbVdpZHRoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudFJlZ2lvbiA9IHRoaXMuY3VycmVudFJlZ2lvbjtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaXNOdWxsOiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uXSA9PT0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uXSxcbiAgICAgICAgICAgICAgICBvZmZzZXQ6IGN1cnJlbnRSZWdpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVuZGVyUmVnaW9uOiBmdW5jdGlvbiAodmFsdWVudW0sIGhpZ2hsaWdodCkge1xuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IHRoaXMudmFsdWVzLFxuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgICAgICAgbWluID0gdGhpcy5taW4sXG4gICAgICAgICAgICAgICAgbWF4ID0gdGhpcy5tYXgsXG4gICAgICAgICAgICAgICAgcmFuZ2UgPSB0aGlzLnJhbmdlLFxuICAgICAgICAgICAgICAgIGludGVydmFsID0gdGhpcy5pbnRlcnZhbCxcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCxcbiAgICAgICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0aGlzLmNhbnZhc0hlaWdodCxcbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gdGhpcy5saW5lSGVpZ2h0LFxuICAgICAgICAgICAgICAgIHBoZWlnaHQgPSBjYW52YXNIZWlnaHQgLSBsaW5lSGVpZ2h0LFxuICAgICAgICAgICAgICAgIHl0b3AsIHZhbCwgY29sb3IsIHg7XG5cbiAgICAgICAgICAgIHZhbCA9IGNsaXB2YWwodmFsdWVzW3ZhbHVlbnVtXSwgbWluLCBtYXgpO1xuICAgICAgICAgICAgeCA9IHZhbHVlbnVtICogaW50ZXJ2YWw7XG4gICAgICAgICAgICB5dG9wID0gTWF0aC5yb3VuZChwaGVpZ2h0IC0gcGhlaWdodCAqICgodmFsIC0gbWluKSAvIHJhbmdlKSk7XG4gICAgICAgICAgICBjb2xvciA9IChvcHRpb25zLmdldCgndGhyZXNob2xkQ29sb3InKSAmJiB2YWwgPCBvcHRpb25zLmdldCgndGhyZXNob2xkVmFsdWUnKSkgPyBvcHRpb25zLmdldCgndGhyZXNob2xkQ29sb3InKSA6IG9wdGlvbnMuZ2V0KCdsaW5lQ29sb3InKTtcbiAgICAgICAgICAgIGlmIChoaWdobGlnaHQpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0YXJnZXQuZHJhd0xpbmUoeCwgeXRvcCwgeCwgeXRvcCArIGxpbmVIZWlnaHQsIGNvbG9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICAvKipcbiAgICAgKiBCdWxsZXQgY2hhcnRzXG4gICAgICovXG4gICAgJC5mbi5zcGFya2xpbmUuYnVsbGV0ID0gYnVsbGV0ID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIHtcbiAgICAgICAgdHlwZTogJ2J1bGxldCcsXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgICAgIHZhciBtaW4sIG1heCwgdmFscztcbiAgICAgICAgICAgIGJ1bGxldC5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgICAgICAgICAvLyB2YWx1ZXM6IHRhcmdldCwgcGVyZm9ybWFuY2UsIHJhbmdlMSwgcmFuZ2UyLCByYW5nZTNcbiAgICAgICAgICAgIHRoaXMudmFsdWVzID0gdmFsdWVzID0gbm9ybWFsaXplVmFsdWVzKHZhbHVlcyk7XG4gICAgICAgICAgICAvLyB0YXJnZXQgb3IgcGVyZm9ybWFuY2UgY291bGQgYmUgbnVsbFxuICAgICAgICAgICAgdmFscyA9IHZhbHVlcy5zbGljZSgpO1xuICAgICAgICAgICAgdmFsc1swXSA9IHZhbHNbMF0gPT09IG51bGwgPyB2YWxzWzJdIDogdmFsc1swXTtcbiAgICAgICAgICAgIHZhbHNbMV0gPSB2YWx1ZXNbMV0gPT09IG51bGwgPyB2YWxzWzJdIDogdmFsc1sxXTtcbiAgICAgICAgICAgIG1pbiA9IE1hdGgubWluLmFwcGx5KE1hdGgsIHZhbHVlcyk7XG4gICAgICAgICAgICBtYXggPSBNYXRoLm1heC5hcHBseShNYXRoLCB2YWx1ZXMpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdiYXNlJykgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG1pbiA9IG1pbiA8IDAgPyBtaW4gOiAwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtaW4gPSBvcHRpb25zLmdldCgnYmFzZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5taW4gPSBtaW47XG4gICAgICAgICAgICB0aGlzLm1heCA9IG1heDtcbiAgICAgICAgICAgIHRoaXMucmFuZ2UgPSBtYXggLSBtaW47XG4gICAgICAgICAgICB0aGlzLnNoYXBlcyA9IHt9O1xuICAgICAgICAgICAgdGhpcy52YWx1ZVNoYXBlcyA9IHt9O1xuICAgICAgICAgICAgdGhpcy5yZWdpb25kYXRhID0ge307XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGggPSBvcHRpb25zLmdldCgnd2lkdGgnKSA9PT0gJ2F1dG8nID8gJzQuMGVtJyA6IHdpZHRoO1xuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0aGlzLiRlbC5zaW1wbGVkcmF3KHdpZHRoLCBoZWlnaHQsIG9wdGlvbnMuZ2V0KCdjb21wb3NpdGUnKSk7XG4gICAgICAgICAgICBpZiAoIXZhbHVlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaW5pdFRhcmdldCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKGVsLCB4LCB5KSB7XG4gICAgICAgICAgICB2YXIgc2hhcGVpZCA9IHRoaXMudGFyZ2V0LmdldFNoYXBlQXQoZWwsIHgsIHkpO1xuICAgICAgICAgICAgcmV0dXJuIChzaGFwZWlkICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zaGFwZXNbc2hhcGVpZF0gIT09IHVuZGVmaW5lZCkgPyB0aGlzLnNoYXBlc1tzaGFwZWlkXSA6IHVuZGVmaW5lZDtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudFJlZ2lvbiA9IHRoaXMuY3VycmVudFJlZ2lvbjtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZmllbGRrZXk6IGN1cnJlbnRSZWdpb24uc3Vic3RyKDAsIDEpLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uLnN1YnN0cigxKV0sXG4gICAgICAgICAgICAgICAgcmVnaW9uOiBjdXJyZW50UmVnaW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUhpZ2hsaWdodDogZnVuY3Rpb24gKGhpZ2hsaWdodCkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb24sXG4gICAgICAgICAgICAgICAgc2hhcGVpZCA9IHRoaXMudmFsdWVTaGFwZXNbY3VycmVudFJlZ2lvbl0sXG4gICAgICAgICAgICAgICAgc2hhcGU7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5zaGFwZXNbc2hhcGVpZF07XG4gICAgICAgICAgICBzd2l0Y2ggKGN1cnJlbnRSZWdpb24uc3Vic3RyKDAsIDEpKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAncic6XG4gICAgICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5yZW5kZXJSYW5nZShjdXJyZW50UmVnaW9uLnN1YnN0cigxKSwgaGlnaGxpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAncCc6XG4gICAgICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5yZW5kZXJQZXJmb3JtYW5jZShoaWdobGlnaHQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICd0JzpcbiAgICAgICAgICAgICAgICAgICAgc2hhcGUgPSB0aGlzLnJlbmRlclRhcmdldChoaWdobGlnaHQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXNbY3VycmVudFJlZ2lvbl0gPSBzaGFwZS5pZDtcbiAgICAgICAgICAgIHRoaXMuc2hhcGVzW3NoYXBlLmlkXSA9IGN1cnJlbnRSZWdpb247XG4gICAgICAgICAgICB0aGlzLnRhcmdldC5yZXBsYWNlV2l0aFNoYXBlKHNoYXBlaWQsIHNoYXBlKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXJSYW5nZTogZnVuY3Rpb24gKHJuLCBoaWdobGlnaHQpIHtcbiAgICAgICAgICAgIHZhciByYW5nZXZhbCA9IHRoaXMudmFsdWVzW3JuXSxcbiAgICAgICAgICAgICAgICByYW5nZXdpZHRoID0gTWF0aC5yb3VuZCh0aGlzLmNhbnZhc1dpZHRoICogKChyYW5nZXZhbCAtIHRoaXMubWluKSAvIHRoaXMucmFuZ2UpKSxcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMub3B0aW9ucy5nZXQoJ3JhbmdlQ29sb3JzJylbcm4gLSAyXTtcbiAgICAgICAgICAgIGlmIChoaWdobGlnaHQpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFyZ2V0LmRyYXdSZWN0KDAsIDAsIHJhbmdld2lkdGggLSAxLCB0aGlzLmNhbnZhc0hlaWdodCAtIDEsIGNvbG9yLCBjb2xvcik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVuZGVyUGVyZm9ybWFuY2U6IGZ1bmN0aW9uIChoaWdobGlnaHQpIHtcbiAgICAgICAgICAgIHZhciBwZXJmdmFsID0gdGhpcy52YWx1ZXNbMV0sXG4gICAgICAgICAgICAgICAgcGVyZndpZHRoID0gTWF0aC5yb3VuZCh0aGlzLmNhbnZhc1dpZHRoICogKChwZXJmdmFsIC0gdGhpcy5taW4pIC8gdGhpcy5yYW5nZSkpLFxuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5vcHRpb25zLmdldCgncGVyZm9ybWFuY2VDb2xvcicpO1xuICAgICAgICAgICAgaWYgKGhpZ2hsaWdodCkge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5jYWxjSGlnaGxpZ2h0Q29sb3IoY29sb3IsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50YXJnZXQuZHJhd1JlY3QoMCwgTWF0aC5yb3VuZCh0aGlzLmNhbnZhc0hlaWdodCAqIDAuMyksIHBlcmZ3aWR0aCAtIDEsXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZCh0aGlzLmNhbnZhc0hlaWdodCAqIDAuNCkgLSAxLCBjb2xvciwgY29sb3IpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbmRlclRhcmdldDogZnVuY3Rpb24gKGhpZ2hsaWdodCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldHZhbCA9IHRoaXMudmFsdWVzWzBdLFxuICAgICAgICAgICAgICAgIHggPSBNYXRoLnJvdW5kKHRoaXMuY2FudmFzV2lkdGggKiAoKHRhcmdldHZhbCAtIHRoaXMubWluKSAvIHRoaXMucmFuZ2UpIC0gKHRoaXMub3B0aW9ucy5nZXQoJ3RhcmdldFdpZHRoJykgLyAyKSksXG4gICAgICAgICAgICAgICAgdGFyZ2V0dG9wID0gTWF0aC5yb3VuZCh0aGlzLmNhbnZhc0hlaWdodCAqIDAuMTApLFxuICAgICAgICAgICAgICAgIHRhcmdldGhlaWdodCA9IHRoaXMuY2FudmFzSGVpZ2h0IC0gKHRhcmdldHRvcCAqIDIpLFxuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5vcHRpb25zLmdldCgndGFyZ2V0Q29sb3InKTtcbiAgICAgICAgICAgIGlmIChoaWdobGlnaHQpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFyZ2V0LmRyYXdSZWN0KHgsIHRhcmdldHRvcCwgdGhpcy5vcHRpb25zLmdldCgndGFyZ2V0V2lkdGgnKSAtIDEsIHRhcmdldGhlaWdodCAtIDEsIGNvbG9yLCBjb2xvcik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdmxlbiA9IHRoaXMudmFsdWVzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCxcbiAgICAgICAgICAgICAgICBpLCBzaGFwZTtcbiAgICAgICAgICAgIGlmICghYnVsbGV0Ll9zdXBlci5yZW5kZXIuY2FsbCh0aGlzKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoaSA9IDI7IGkgPCB2bGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICBzaGFwZSA9IHRoaXMucmVuZGVyUmFuZ2UoaSkuYXBwZW5kKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zaGFwZXNbc2hhcGUuaWRdID0gJ3InICsgaTtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlU2hhcGVzWydyJyArIGldID0gc2hhcGUuaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy52YWx1ZXNbMV0gIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBzaGFwZSA9IHRoaXMucmVuZGVyUGVyZm9ybWFuY2UoKS5hcHBlbmQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSAncDEnO1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXMucDEgPSBzaGFwZS5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlc1swXSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5yZW5kZXJUYXJnZXQoKS5hcHBlbmQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSAndDAnO1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXMudDAgPSBzaGFwZS5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhcmdldC5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICAvKipcbiAgICAgKiBQaWUgY2hhcnRzXG4gICAgICovXG4gICAgJC5mbi5zcGFya2xpbmUucGllID0gcGllID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIHtcbiAgICAgICAgdHlwZTogJ3BpZScsXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgICAgIHZhciB0b3RhbCA9IDAsIGk7XG5cbiAgICAgICAgICAgIHBpZS5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgICAgICAgICB0aGlzLnNoYXBlcyA9IHt9OyAvLyBtYXAgc2hhcGUgaWRzIHRvIHZhbHVlIG9mZnNldHNcbiAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXMgPSB7fTsgLy8gbWFwcyB2YWx1ZSBvZmZzZXRzIHRvIHNoYXBlIGlkc1xuICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMgPSAkLm1hcCh2YWx1ZXMsIE51bWJlcik7XG5cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnd2lkdGgnKSA9PT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSB2YWx1ZXMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsICs9IHZhbHVlc1tpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnRvdGFsID0gdG90YWw7XG4gICAgICAgICAgICB0aGlzLmluaXRUYXJnZXQoKTtcbiAgICAgICAgICAgIHRoaXMucmFkaXVzID0gTWF0aC5mbG9vcihNYXRoLm1pbih0aGlzLmNhbnZhc1dpZHRoLCB0aGlzLmNhbnZhc0hlaWdodCkgLyAyKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRSZWdpb246IGZ1bmN0aW9uIChlbCwgeCwgeSkge1xuICAgICAgICAgICAgdmFyIHNoYXBlaWQgPSB0aGlzLnRhcmdldC5nZXRTaGFwZUF0KGVsLCB4LCB5KTtcbiAgICAgICAgICAgIHJldHVybiAoc2hhcGVpZCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuc2hhcGVzW3NoYXBlaWRdICE9PSB1bmRlZmluZWQpID8gdGhpcy5zaGFwZXNbc2hhcGVpZF0gOiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0Q3VycmVudFJlZ2lvbkZpZWxkczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb247XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlzTnVsbDogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0gPT09IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0sXG4gICAgICAgICAgICAgICAgcGVyY2VudDogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0gLyB0aGlzLnRvdGFsICogMTAwLFxuICAgICAgICAgICAgICAgIGNvbG9yOiB0aGlzLm9wdGlvbnMuZ2V0KCdzbGljZUNvbG9ycycpW2N1cnJlbnRSZWdpb24gJSB0aGlzLm9wdGlvbnMuZ2V0KCdzbGljZUNvbG9ycycpLmxlbmd0aF0sXG4gICAgICAgICAgICAgICAgb2Zmc2V0OiBjdXJyZW50UmVnaW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUhpZ2hsaWdodDogZnVuY3Rpb24gKGhpZ2hsaWdodCkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb24sXG4gICAgICAgICAgICAgICAgIG5ld3NsaWNlID0gdGhpcy5yZW5kZXJTbGljZShjdXJyZW50UmVnaW9uLCBoaWdobGlnaHQpLFxuICAgICAgICAgICAgICAgICBzaGFwZWlkID0gdGhpcy52YWx1ZVNoYXBlc1tjdXJyZW50UmVnaW9uXTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnNoYXBlc1tzaGFwZWlkXTtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0LnJlcGxhY2VXaXRoU2hhcGUoc2hhcGVpZCwgbmV3c2xpY2UpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZVNoYXBlc1tjdXJyZW50UmVnaW9uXSA9IG5ld3NsaWNlLmlkO1xuICAgICAgICAgICAgdGhpcy5zaGFwZXNbbmV3c2xpY2UuaWRdID0gY3VycmVudFJlZ2lvbjtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXJTbGljZTogZnVuY3Rpb24gKHZhbHVlbnVtLCBoaWdobGlnaHQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldCxcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIHJhZGl1cyA9IHRoaXMucmFkaXVzLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoID0gb3B0aW9ucy5nZXQoJ2JvcmRlcldpZHRoJyksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gb3B0aW9ucy5nZXQoJ29mZnNldCcpLFxuICAgICAgICAgICAgICAgIGNpcmNsZSA9IDIgKiBNYXRoLlBJLFxuICAgICAgICAgICAgICAgIHZhbHVlcyA9IHRoaXMudmFsdWVzLFxuICAgICAgICAgICAgICAgIHRvdGFsID0gdGhpcy50b3RhbCxcbiAgICAgICAgICAgICAgICBuZXh0ID0gb2Zmc2V0ID8gKDIqTWF0aC5QSSkqKG9mZnNldC8zNjApIDogMCxcbiAgICAgICAgICAgICAgICBzdGFydCwgZW5kLCBpLCB2bGVuLCBjb2xvcjtcblxuICAgICAgICAgICAgdmxlbiA9IHZhbHVlcy5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc3RhcnQgPSBuZXh0O1xuICAgICAgICAgICAgICAgIGVuZCA9IG5leHQ7XG4gICAgICAgICAgICAgICAgaWYgKHRvdGFsID4gMCkgeyAgLy8gYXZvaWQgZGl2aWRlIGJ5IHplcm9cbiAgICAgICAgICAgICAgICAgICAgZW5kID0gbmV4dCArIChjaXJjbGUgKiAodmFsdWVzW2ldIC8gdG90YWwpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlbnVtID09PSBpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3NsaWNlQ29sb3JzJylbaSAlIG9wdGlvbnMuZ2V0KCdzbGljZUNvbG9ycycpLmxlbmd0aF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChoaWdobGlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5jYWxjSGlnaGxpZ2h0Q29sb3IoY29sb3IsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5kcmF3UGllU2xpY2UocmFkaXVzLCByYWRpdXMsIHJhZGl1cyAtIGJvcmRlcldpZHRoLCBzdGFydCwgZW5kLCB1bmRlZmluZWQsIGNvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmV4dCA9IGVuZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldCxcbiAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLnZhbHVlcyxcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIHJhZGl1cyA9IHRoaXMucmFkaXVzLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoID0gb3B0aW9ucy5nZXQoJ2JvcmRlcldpZHRoJyksXG4gICAgICAgICAgICAgICAgc2hhcGUsIGk7XG5cbiAgICAgICAgICAgIGlmICghcGllLl9zdXBlci5yZW5kZXIuY2FsbCh0aGlzKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChib3JkZXJXaWR0aCkge1xuICAgICAgICAgICAgICAgIHRhcmdldC5kcmF3Q2lyY2xlKHJhZGl1cywgcmFkaXVzLCBNYXRoLmZsb29yKHJhZGl1cyAtIChib3JkZXJXaWR0aCAvIDIpKSxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2JvcmRlckNvbG9yJyksIHVuZGVmaW5lZCwgYm9yZGVyV2lkdGgpLmFwcGVuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChpID0gdmFsdWVzLmxlbmd0aDsgaS0tOykge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0pIHsgLy8gZG9uJ3QgcmVuZGVyIHplcm8gdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5yZW5kZXJTbGljZShpKS5hcHBlbmQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZVNoYXBlc1tpXSA9IHNoYXBlLmlkOyAvLyBzdG9yZSBqdXN0IHRoZSBzaGFwZWlkXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhcGVzW3NoYXBlLmlkXSA9IGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGFyZ2V0LnJlbmRlcigpO1xuICAgICAgICB9XG4gICAgfSk7XG5cblxuICAgIC8qKlxuICAgICAqIEJveCBwbG90c1xuICAgICAqL1xuICAgICQuZm4uc3BhcmtsaW5lLmJveCA9IGJveCA9IGNyZWF0ZUNsYXNzKCQuZm4uc3BhcmtsaW5lLl9iYXNlLCB7XG4gICAgICAgIHR5cGU6ICdib3gnLFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgICAgICBib3guX3N1cGVyLmluaXQuY2FsbCh0aGlzLCBlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMudmFsdWVzID0gJC5tYXAodmFsdWVzLCBOdW1iZXIpO1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IG9wdGlvbnMuZ2V0KCd3aWR0aCcpID09PSAnYXV0bycgPyAnNC4wZW0nIDogd2lkdGg7XG4gICAgICAgICAgICB0aGlzLmluaXRUYXJnZXQoKTtcbiAgICAgICAgICAgIGlmICghdGhpcy52YWx1ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlZCA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNpbXVsYXRlIGEgc2luZ2xlIHJlZ2lvblxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW1xuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdscScsIHZhbHVlOiB0aGlzLnF1YXJ0aWxlc1swXSB9LFxuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdtZWQnLCB2YWx1ZTogdGhpcy5xdWFydGlsZXNbMV0gfSxcbiAgICAgICAgICAgICAgICB7IGZpZWxkOiAndXEnLCB2YWx1ZTogdGhpcy5xdWFydGlsZXNbMl0gfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGlmICh0aGlzLmxvdXRsaWVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7IGZpZWxkOiAnbG8nLCB2YWx1ZTogdGhpcy5sb3V0bGllcn0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMucm91dGxpZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHsgZmllbGQ6ICdybycsIHZhbHVlOiB0aGlzLnJvdXRsaWVyfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5sd2hpc2tlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goeyBmaWVsZDogJ2x3JywgdmFsdWU6IHRoaXMubHdoaXNrZXJ9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnJ3aGlza2VyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7IGZpZWxkOiAncncnLCB2YWx1ZTogdGhpcy5yd2hpc2tlcn0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldCxcbiAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLnZhbHVlcyxcbiAgICAgICAgICAgICAgICB2bGVuID0gdmFsdWVzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIGNhbnZhc1dpZHRoID0gdGhpcy5jYW52YXNXaWR0aCxcbiAgICAgICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0aGlzLmNhbnZhc0hlaWdodCxcbiAgICAgICAgICAgICAgICBtaW5WYWx1ZSA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJykgPT09IHVuZGVmaW5lZCA/IE1hdGgubWluLmFwcGx5KE1hdGgsIHZhbHVlcykgOiBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pbicpLFxuICAgICAgICAgICAgICAgIG1heFZhbHVlID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSA9PT0gdW5kZWZpbmVkID8gTWF0aC5tYXguYXBwbHkoTWF0aCwgdmFsdWVzKSA6IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4JyksXG4gICAgICAgICAgICAgICAgY2FudmFzTGVmdCA9IDAsXG4gICAgICAgICAgICAgICAgbHdoaXNrZXIsIGxvdXRsaWVyLCBpcXIsIHExLCBxMiwgcTMsIHJ3aGlza2VyLCByb3V0bGllciwgaSxcbiAgICAgICAgICAgICAgICBzaXplLCB1bml0U2l6ZTtcblxuICAgICAgICAgICAgaWYgKCFib3guX3N1cGVyLnJlbmRlci5jYWxsKHRoaXMpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ3JhdycpKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdzaG93T3V0bGllcnMnKSAmJiB2YWx1ZXMubGVuZ3RoID4gNSkge1xuICAgICAgICAgICAgICAgICAgICBsb3V0bGllciA9IHZhbHVlc1swXTtcbiAgICAgICAgICAgICAgICAgICAgbHdoaXNrZXIgPSB2YWx1ZXNbMV07XG4gICAgICAgICAgICAgICAgICAgIHExID0gdmFsdWVzWzJdO1xuICAgICAgICAgICAgICAgICAgICBxMiA9IHZhbHVlc1szXTtcbiAgICAgICAgICAgICAgICAgICAgcTMgPSB2YWx1ZXNbNF07XG4gICAgICAgICAgICAgICAgICAgIHJ3aGlza2VyID0gdmFsdWVzWzVdO1xuICAgICAgICAgICAgICAgICAgICByb3V0bGllciA9IHZhbHVlc1s2XTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsd2hpc2tlciA9IHZhbHVlc1swXTtcbiAgICAgICAgICAgICAgICAgICAgcTEgPSB2YWx1ZXNbMV07XG4gICAgICAgICAgICAgICAgICAgIHEyID0gdmFsdWVzWzJdO1xuICAgICAgICAgICAgICAgICAgICBxMyA9IHZhbHVlc1szXTtcbiAgICAgICAgICAgICAgICAgICAgcndoaXNrZXIgPSB2YWx1ZXNbNF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWx1ZXMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYSAtIGI7IH0pO1xuICAgICAgICAgICAgICAgIHExID0gcXVhcnRpbGUodmFsdWVzLCAxKTtcbiAgICAgICAgICAgICAgICBxMiA9IHF1YXJ0aWxlKHZhbHVlcywgMik7XG4gICAgICAgICAgICAgICAgcTMgPSBxdWFydGlsZSh2YWx1ZXMsIDMpO1xuICAgICAgICAgICAgICAgIGlxciA9IHEzIC0gcTE7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdzaG93T3V0bGllcnMnKSkge1xuICAgICAgICAgICAgICAgICAgICBsd2hpc2tlciA9IHJ3aGlza2VyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobHdoaXNrZXIgPT09IHVuZGVmaW5lZCAmJiB2YWx1ZXNbaV0gPiBxMSAtIChpcXIgKiBvcHRpb25zLmdldCgnb3V0bGllcklRUicpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx3aGlza2VyID0gdmFsdWVzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpXSA8IHEzICsgKGlxciAqIG9wdGlvbnMuZ2V0KCdvdXRsaWVySVFSJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcndoaXNrZXIgPSB2YWx1ZXNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbG91dGxpZXIgPSB2YWx1ZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIHJvdXRsaWVyID0gdmFsdWVzW3ZsZW4gLSAxXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsd2hpc2tlciA9IHZhbHVlc1swXTtcbiAgICAgICAgICAgICAgICAgICAgcndoaXNrZXIgPSB2YWx1ZXNbdmxlbiAtIDFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucXVhcnRpbGVzID0gW3ExLCBxMiwgcTNdO1xuICAgICAgICAgICAgdGhpcy5sd2hpc2tlciA9IGx3aGlza2VyO1xuICAgICAgICAgICAgdGhpcy5yd2hpc2tlciA9IHJ3aGlza2VyO1xuICAgICAgICAgICAgdGhpcy5sb3V0bGllciA9IGxvdXRsaWVyO1xuICAgICAgICAgICAgdGhpcy5yb3V0bGllciA9IHJvdXRsaWVyO1xuXG4gICAgICAgICAgICB1bml0U2l6ZSA9IGNhbnZhc1dpZHRoIC8gKG1heFZhbHVlIC0gbWluVmFsdWUgKyAxKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnc2hvd091dGxpZXJzJykpIHtcbiAgICAgICAgICAgICAgICBjYW52YXNMZWZ0ID0gTWF0aC5jZWlsKG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJykpO1xuICAgICAgICAgICAgICAgIGNhbnZhc1dpZHRoIC09IDIgKiBNYXRoLmNlaWwob3B0aW9ucy5nZXQoJ3Nwb3RSYWRpdXMnKSk7XG4gICAgICAgICAgICAgICAgdW5pdFNpemUgPSBjYW52YXNXaWR0aCAvIChtYXhWYWx1ZSAtIG1pblZhbHVlICsgMSk7XG4gICAgICAgICAgICAgICAgaWYgKGxvdXRsaWVyIDwgbHdoaXNrZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmRyYXdDaXJjbGUoKGxvdXRsaWVyIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0IC8gMixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnb3V0bGllckxpbmVDb2xvcicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ291dGxpZXJGaWxsQ29sb3InKSkuYXBwZW5kKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyb3V0bGllciA+IHJ3aGlza2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5kcmF3Q2lyY2xlKChyb3V0bGllciAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCAvIDIsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnc3BvdFJhZGl1cycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ291dGxpZXJMaW5lQ29sb3InKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdvdXRsaWVyRmlsbENvbG9yJykpLmFwcGVuZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYm94XG4gICAgICAgICAgICB0YXJnZXQuZHJhd1JlY3QoXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgocTEgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLFxuICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0ICogMC4xKSxcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChxMyAtIHExKSAqIHVuaXRTaXplKSxcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAqIDAuOCksXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2JveExpbmVDb2xvcicpLFxuICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdib3hGaWxsQ29sb3InKSkuYXBwZW5kKCk7XG4gICAgICAgICAgICAvLyBsZWZ0IHdoaXNrZXJcbiAgICAgICAgICAgIHRhcmdldC5kcmF3TGluZShcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChsd2hpc2tlciAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyAyKSxcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChxMSAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyAyKSxcbiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbGluZUNvbG9yJykpLmFwcGVuZCgpO1xuICAgICAgICAgICAgdGFyZ2V0LmRyYXdMaW5lKFxuICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKGx3aGlza2VyIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSxcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDQpLFxuICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKGx3aGlza2VyIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSxcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAtIGNhbnZhc0hlaWdodCAvIDQpLFxuICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCd3aGlza2VyQ29sb3InKSkuYXBwZW5kKCk7XG4gICAgICAgICAgICAvLyByaWdodCB3aGlza2VyXG4gICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoTWF0aC5yb3VuZCgocndoaXNrZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLFxuICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC8gMiksXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgocTMgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLFxuICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC8gMiksXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2xpbmVDb2xvcicpKS5hcHBlbmQoKTtcbiAgICAgICAgICAgIHRhcmdldC5kcmF3TGluZShcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChyd2hpc2tlciAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyA0KSxcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChyd2hpc2tlciAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSBjYW52YXNIZWlnaHQgLyA0KSxcbiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnd2hpc2tlckNvbG9yJykpLmFwcGVuZCgpO1xuICAgICAgICAgICAgLy8gbWVkaWFuIGxpbmVcbiAgICAgICAgICAgIHRhcmdldC5kcmF3TGluZShcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChxMiAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgKiAwLjEpLFxuICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKHEyIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSxcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAqIDAuOSksXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ21lZGlhbkNvbG9yJykpLmFwcGVuZCgpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCd0YXJnZXQnKSkge1xuICAgICAgICAgICAgICAgIHNpemUgPSBNYXRoLmNlaWwob3B0aW9ucy5nZXQoJ3Nwb3RSYWRpdXMnKSk7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LmRyYXdMaW5lKFxuICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChvcHRpb25zLmdldCgndGFyZ2V0JykgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLFxuICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChjYW52YXNIZWlnaHQgLyAyKSAtIHNpemUpLFxuICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChvcHRpb25zLmdldCgndGFyZ2V0JykgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLFxuICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChjYW52YXNIZWlnaHQgLyAyKSArIHNpemUpLFxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgndGFyZ2V0Q29sb3InKSkuYXBwZW5kKCk7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LmRyYXdMaW5lKFxuICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChvcHRpb25zLmdldCgndGFyZ2V0JykgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQgLSBzaXplKSxcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyAyKSxcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgob3B0aW9ucy5nZXQoJ3RhcmdldCcpIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0ICsgc2l6ZSksXG4gICAgICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC8gMiksXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCd0YXJnZXRDb2xvcicpKS5hcHBlbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhcmdldC5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICAvLyBTZXR1cCBhIHZlcnkgc2ltcGxlIFwidmlydHVhbCBjYW52YXNcIiB0byBtYWtlIGRyYXdpbmcgdGhlIGZldyBzaGFwZXMgd2UgbmVlZCBlYXNpZXJcbiAgICAvLyBUaGlzIGlzIGFjY2Vzc2libGUgYXMgJChmb28pLnNpbXBsZWRyYXcoKVxuXG4gICAgVlNoYXBlID0gY3JlYXRlQ2xhc3Moe1xuICAgICAgICBpbml0OiBmdW5jdGlvbiAodGFyZ2V0LCBpZCwgdHlwZSwgYXJncykge1xuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgdGhpcy5hcmdzID0gYXJncztcbiAgICAgICAgfSxcbiAgICAgICAgYXBwZW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldC5hcHBlbmRTaGFwZSh0aGlzKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBWQ2FudmFzX2Jhc2UgPSBjcmVhdGVDbGFzcyh7XG4gICAgICAgIF9weHJlZ2V4OiAvKFxcZCspKHB4KT9cXHMqJC9pLFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCB0YXJnZXQpIHtcbiAgICAgICAgICAgIGlmICghd2lkdGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgICAgICAgICAgdGhpcy5sYXN0U2hhcGVJZCA9IG51bGw7XG4gICAgICAgICAgICBpZiAodGFyZ2V0WzBdKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0WzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5kYXRhKHRhcmdldCwgJ19qcXNfdmNhbnZhcycsIHRoaXMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXdMaW5lOiBmdW5jdGlvbiAoeDEsIHkxLCB4MiwgeTIsIGxpbmVDb2xvciwgbGluZVdpZHRoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kcmF3U2hhcGUoW1t4MSwgeTFdLCBbeDIsIHkyXV0sIGxpbmVDb2xvciwgbGluZVdpZHRoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkcmF3U2hhcGU6IGZ1bmN0aW9uIChwYXRoLCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2VuU2hhcGUoJ1NoYXBlJywgW3BhdGgsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGhdKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkcmF3Q2lyY2xlOiBmdW5jdGlvbiAoeCwgeSwgcmFkaXVzLCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2VuU2hhcGUoJ0NpcmNsZScsIFt4LCB5LCByYWRpdXMsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGhdKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkcmF3UGllU2xpY2U6IGZ1bmN0aW9uICh4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBsaW5lQ29sb3IsIGZpbGxDb2xvcikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dlblNoYXBlKCdQaWVTbGljZScsIFt4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBsaW5lQ29sb3IsIGZpbGxDb2xvcl0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXdSZWN0OiBmdW5jdGlvbiAoeCwgeSwgd2lkdGgsIGhlaWdodCwgbGluZUNvbG9yLCBmaWxsQ29sb3IpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZW5TaGFwZSgnUmVjdCcsIFt4LCB5LCB3aWR0aCwgaGVpZ2h0LCBsaW5lQ29sb3IsIGZpbGxDb2xvcl0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEVsZW1lbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhbnZhcztcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJuIHRoZSBtb3N0IHJlY2VudGx5IGluc2VydGVkIHNoYXBlIGlkXG4gICAgICAgICAqL1xuICAgICAgICBnZXRMYXN0U2hhcGVJZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdFNoYXBlSWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENsZWFyIGFuZCByZXNldCB0aGUgY2FudmFzXG4gICAgICAgICAqL1xuICAgICAgICByZXNldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgYWxlcnQoJ3Jlc2V0IG5vdCBpbXBsZW1lbnRlZCcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9pbnNlcnQ6IGZ1bmN0aW9uIChlbCwgdGFyZ2V0KSB7XG4gICAgICAgICAgICAkKHRhcmdldCkuaHRtbChlbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGN1bGF0ZSB0aGUgcGl4ZWwgZGltZW5zaW9ucyBvZiB0aGUgY2FudmFzXG4gICAgICAgICAqL1xuICAgICAgICBfY2FsY3VsYXRlUGl4ZWxEaW1zOiBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgY2FudmFzKSB7XG4gICAgICAgICAgICAvLyBYWFggVGhpcyBzaG91bGQgcHJvYmFibHkgYmUgYSBjb25maWd1cmFibGUgb3B0aW9uXG4gICAgICAgICAgICB2YXIgbWF0Y2g7XG4gICAgICAgICAgICBtYXRjaCA9IHRoaXMuX3B4cmVnZXguZXhlYyhoZWlnaHQpO1xuICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waXhlbEhlaWdodCA9IG1hdGNoWzFdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBpeGVsSGVpZ2h0ID0gJChjYW52YXMpLmhlaWdodCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbWF0Y2ggPSB0aGlzLl9weHJlZ2V4LmV4ZWMod2lkdGgpO1xuICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waXhlbFdpZHRoID0gbWF0Y2hbMV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucGl4ZWxXaWR0aCA9ICQoY2FudmFzKS53aWR0aCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZW5lcmF0ZSBhIHNoYXBlIG9iamVjdCBhbmQgaWQgZm9yIGxhdGVyIHJlbmRlcmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgX2dlblNoYXBlOiBmdW5jdGlvbiAoc2hhcGV0eXBlLCBzaGFwZWFyZ3MpIHtcbiAgICAgICAgICAgIHZhciBpZCA9IHNoYXBlQ291bnQrKztcbiAgICAgICAgICAgIHNoYXBlYXJncy51bnNoaWZ0KGlkKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVlNoYXBlKHRoaXMsIGlkLCBzaGFwZXR5cGUsIHNoYXBlYXJncyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBlbmQgb2YgdGhlIHJlbmRlciBxdWV1ZVxuICAgICAgICAgKi9cbiAgICAgICAgYXBwZW5kU2hhcGU6IGZ1bmN0aW9uIChzaGFwZSkge1xuICAgICAgICAgICAgYWxlcnQoJ2FwcGVuZFNoYXBlIG5vdCBpbXBsZW1lbnRlZCcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXBsYWNlIG9uZSBzaGFwZSB3aXRoIGFub3RoZXJcbiAgICAgICAgICovXG4gICAgICAgIHJlcGxhY2VXaXRoU2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBzaGFwZSkge1xuICAgICAgICAgICAgYWxlcnQoJ3JlcGxhY2VXaXRoU2hhcGUgbm90IGltcGxlbWVudGVkJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluc2VydCBvbmUgc2hhcGUgYWZ0ZXIgYW5vdGhlciBpbiB0aGUgcmVuZGVyIHF1ZXVlXG4gICAgICAgICAqL1xuICAgICAgICBpbnNlcnRBZnRlclNoYXBlOiBmdW5jdGlvbiAoc2hhcGVpZCwgc2hhcGUpIHtcbiAgICAgICAgICAgIGFsZXJ0KCdpbnNlcnRBZnRlclNoYXBlIG5vdCBpbXBsZW1lbnRlZCcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW1vdmUgYSBzaGFwZSBmcm9tIHRoZSBxdWV1ZVxuICAgICAgICAgKi9cbiAgICAgICAgcmVtb3ZlU2hhcGVJZDogZnVuY3Rpb24gKHNoYXBlaWQpIHtcbiAgICAgICAgICAgIGFsZXJ0KCdyZW1vdmVTaGFwZUlkIG5vdCBpbXBsZW1lbnRlZCcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaW5kIGEgc2hhcGUgYXQgdGhlIHNwZWNpZmllZCB4L3kgY28tb3JkaW5hdGVzXG4gICAgICAgICAqL1xuICAgICAgICBnZXRTaGFwZUF0OiBmdW5jdGlvbiAoZWwsIHgsIHkpIHtcbiAgICAgICAgICAgIGFsZXJ0KCdnZXRTaGFwZUF0IG5vdCBpbXBsZW1lbnRlZCcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXIgYWxsIHF1ZXVlZCBzaGFwZXMgb250byB0aGUgY2FudmFzXG4gICAgICAgICAqL1xuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGFsZXJ0KCdyZW5kZXIgbm90IGltcGxlbWVudGVkJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuXG4gICAgVkNhbnZhc19jYW52YXMgPSBjcmVhdGVDbGFzcyhWQ2FudmFzX2Jhc2UsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHRhcmdldCwgaW50ZXJhY3QpIHtcbiAgICAgICAgICAgIFZDYW52YXNfY2FudmFzLl9zdXBlci5pbml0LmNhbGwodGhpcywgd2lkdGgsIGhlaWdodCwgdGFyZ2V0KTtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgICAgICBpZiAodGFyZ2V0WzBdKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0WzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5kYXRhKHRhcmdldCwgJ19qcXNfdmNhbnZhcycsIHRoaXMpO1xuICAgICAgICAgICAgJCh0aGlzLmNhbnZhcykuY3NzKHsgZGlzcGxheTogJ2lubGluZS1ibG9jaycsIHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIHZlcnRpY2FsQWxpZ246ICd0b3AnIH0pO1xuICAgICAgICAgICAgdGhpcy5faW5zZXJ0KHRoaXMuY2FudmFzLCB0YXJnZXQpO1xuICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlUGl4ZWxEaW1zKHdpZHRoLCBoZWlnaHQsIHRoaXMuY2FudmFzKTtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy5waXhlbFdpZHRoO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5waXhlbEhlaWdodDtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJhY3QgPSBpbnRlcmFjdDtcbiAgICAgICAgICAgIHRoaXMuc2hhcGVzID0ge307XG4gICAgICAgICAgICB0aGlzLnNoYXBlc2VxID0gW107XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRUYXJnZXRTaGFwZUlkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgJCh0aGlzLmNhbnZhcykuY3NzKHt3aWR0aDogdGhpcy5waXhlbFdpZHRoLCBoZWlnaHQ6IHRoaXMucGl4ZWxIZWlnaHR9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZ2V0Q29udGV4dDogZnVuY3Rpb24gKGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGgpIHtcbiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgIGlmIChsaW5lQ29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBsaW5lQ29sb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IGxpbmVXaWR0aCA9PT0gdW5kZWZpbmVkID8gMSA6IGxpbmVXaWR0aDtcbiAgICAgICAgICAgIGlmIChmaWxsQ29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gZmlsbENvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5fZ2V0Q29udGV4dCgpO1xuICAgICAgICAgICAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5waXhlbFdpZHRoLCB0aGlzLnBpeGVsSGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMuc2hhcGVzID0ge307XG4gICAgICAgICAgICB0aGlzLnNoYXBlc2VxID0gW107XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRUYXJnZXRTaGFwZUlkID0gdW5kZWZpbmVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3U2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBwYXRoLCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoKSB7XG4gICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuX2dldENvbnRleHQobGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCksXG4gICAgICAgICAgICAgICAgaSwgcGxlbjtcbiAgICAgICAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBjb250ZXh0Lm1vdmVUbyhwYXRoWzBdWzBdICsgMC41LCBwYXRoWzBdWzFdICsgMC41KTtcbiAgICAgICAgICAgIGZvciAoaSA9IDEsIHBsZW4gPSBwYXRoLmxlbmd0aDsgaSA8IHBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnRleHQubGluZVRvKHBhdGhbaV1bMF0gKyAwLjUsIHBhdGhbaV1bMV0gKyAwLjUpOyAvLyB0aGUgMC41IG9mZnNldCBnaXZlcyB1cyBjcmlzcCBwaXhlbC13aWR0aCBsaW5lc1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxpbmVDb2xvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dC5zdHJva2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmaWxsQ29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbnRleHQuZmlsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0WCAhPT0gdW5kZWZpbmVkICYmIHRoaXMudGFyZ2V0WSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgY29udGV4dC5pc1BvaW50SW5QYXRoKHRoaXMudGFyZ2V0WCwgdGhpcy50YXJnZXRZKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFRhcmdldFNoYXBlSWQgPSBzaGFwZWlkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3Q2lyY2xlOiBmdW5jdGlvbiAoc2hhcGVpZCwgeCwgeSwgcmFkaXVzLCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoKSB7XG4gICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuX2dldENvbnRleHQobGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCk7XG4gICAgICAgICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgY29udGV4dC5hcmMoeCwgeSwgcmFkaXVzLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpO1xuICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0WCAhPT0gdW5kZWZpbmVkICYmIHRoaXMudGFyZ2V0WSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgY29udGV4dC5pc1BvaW50SW5QYXRoKHRoaXMudGFyZ2V0WCwgdGhpcy50YXJnZXRZKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFRhcmdldFNoYXBlSWQgPSBzaGFwZWlkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxpbmVDb2xvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dC5zdHJva2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmaWxsQ29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbnRleHQuZmlsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3UGllU2xpY2U6IGZ1bmN0aW9uIChzaGFwZWlkLCB4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBsaW5lQ29sb3IsIGZpbGxDb2xvcikge1xuICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLl9nZXRDb250ZXh0KGxpbmVDb2xvciwgZmlsbENvbG9yKTtcbiAgICAgICAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBjb250ZXh0Lm1vdmVUbyh4LCB5KTtcbiAgICAgICAgICAgIGNvbnRleHQuYXJjKHgsIHksIHJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUsIGZhbHNlKTtcbiAgICAgICAgICAgIGNvbnRleHQubGluZVRvKHgsIHkpO1xuICAgICAgICAgICAgY29udGV4dC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgIGlmIChsaW5lQ29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmlsbENvbG9yKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dC5maWxsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy50YXJnZXRYICE9PSB1bmRlZmluZWQgJiYgdGhpcy50YXJnZXRZICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICBjb250ZXh0LmlzUG9pbnRJblBhdGgodGhpcy50YXJnZXRYLCB0aGlzLnRhcmdldFkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VGFyZ2V0U2hhcGVJZCA9IHNoYXBlaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2RyYXdSZWN0OiBmdW5jdGlvbiAoc2hhcGVpZCwgeCwgeSwgd2lkdGgsIGhlaWdodCwgbGluZUNvbG9yLCBmaWxsQ29sb3IpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kcmF3U2hhcGUoc2hhcGVpZCwgW1t4LCB5XSwgW3ggKyB3aWR0aCwgeV0sIFt4ICsgd2lkdGgsIHkgKyBoZWlnaHRdLCBbeCwgeSArIGhlaWdodF0sIFt4LCB5XV0sIGxpbmVDb2xvciwgZmlsbENvbG9yKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhcHBlbmRTaGFwZTogZnVuY3Rpb24gKHNoYXBlKSB7XG4gICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSBzaGFwZTtcbiAgICAgICAgICAgIHRoaXMuc2hhcGVzZXEucHVzaChzaGFwZS5pZCk7XG4gICAgICAgICAgICB0aGlzLmxhc3RTaGFwZUlkID0gc2hhcGUuaWQ7XG4gICAgICAgICAgICByZXR1cm4gc2hhcGUuaWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVwbGFjZVdpdGhTaGFwZTogZnVuY3Rpb24gKHNoYXBlaWQsIHNoYXBlKSB7XG4gICAgICAgICAgICB2YXIgc2hhcGVzZXEgPSB0aGlzLnNoYXBlc2VxLFxuICAgICAgICAgICAgICAgIGk7XG4gICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSBzaGFwZTtcbiAgICAgICAgICAgIGZvciAoaSA9IHNoYXBlc2VxLmxlbmd0aDsgaS0tOykge1xuICAgICAgICAgICAgICAgIGlmIChzaGFwZXNlcVtpXSA9PSBzaGFwZWlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNoYXBlc2VxW2ldID0gc2hhcGUuaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuc2hhcGVzW3NoYXBlaWRdO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlcGxhY2VXaXRoU2hhcGVzOiBmdW5jdGlvbiAoc2hhcGVpZHMsIHNoYXBlcykge1xuICAgICAgICAgICAgdmFyIHNoYXBlc2VxID0gdGhpcy5zaGFwZXNlcSxcbiAgICAgICAgICAgICAgICBzaGFwZW1hcCA9IHt9LFxuICAgICAgICAgICAgICAgIHNpZCwgaSwgZmlyc3Q7XG5cbiAgICAgICAgICAgIGZvciAoaSA9IHNoYXBlaWRzLmxlbmd0aDsgaS0tOykge1xuICAgICAgICAgICAgICAgIHNoYXBlbWFwW3NoYXBlaWRzW2ldXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGkgPSBzaGFwZXNlcS5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgICAgICAgICBzaWQgPSBzaGFwZXNlcVtpXTtcbiAgICAgICAgICAgICAgICBpZiAoc2hhcGVtYXBbc2lkXSkge1xuICAgICAgICAgICAgICAgICAgICBzaGFwZXNlcS5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnNoYXBlc1tzaWRdO1xuICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChpID0gc2hhcGVzLmxlbmd0aDsgaS0tOykge1xuICAgICAgICAgICAgICAgIHNoYXBlc2VxLnNwbGljZShmaXJzdCwgMCwgc2hhcGVzW2ldLmlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZXNbaV0uaWRdID0gc2hhcGVzW2ldO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5zZXJ0QWZ0ZXJTaGFwZTogZnVuY3Rpb24gKHNoYXBlaWQsIHNoYXBlKSB7XG4gICAgICAgICAgICB2YXIgc2hhcGVzZXEgPSB0aGlzLnNoYXBlc2VxLFxuICAgICAgICAgICAgICAgIGk7XG4gICAgICAgICAgICBmb3IgKGkgPSBzaGFwZXNlcS5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgICAgICAgICBpZiAoc2hhcGVzZXFbaV0gPT09IHNoYXBlaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2hhcGVzZXEuc3BsaWNlKGkgKyAxLCAwLCBzaGFwZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhcGVzW3NoYXBlLmlkXSA9IHNoYXBlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZVNoYXBlSWQ6IGZ1bmN0aW9uIChzaGFwZWlkKSB7XG4gICAgICAgICAgICB2YXIgc2hhcGVzZXEgPSB0aGlzLnNoYXBlc2VxLFxuICAgICAgICAgICAgICAgIGk7XG4gICAgICAgICAgICBmb3IgKGkgPSBzaGFwZXNlcS5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgICAgICAgICBpZiAoc2hhcGVzZXFbaV0gPT09IHNoYXBlaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2hhcGVzZXEuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5zaGFwZXNbc2hhcGVpZF07XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0U2hhcGVBdDogZnVuY3Rpb24gKGVsLCB4LCB5KSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldFggPSB4O1xuICAgICAgICAgICAgdGhpcy50YXJnZXRZID0geTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VGFyZ2V0U2hhcGVJZDtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzaGFwZXNlcSA9IHRoaXMuc2hhcGVzZXEsXG4gICAgICAgICAgICAgICAgc2hhcGVzID0gdGhpcy5zaGFwZXMsXG4gICAgICAgICAgICAgICAgc2hhcGVDb3VudCA9IHNoYXBlc2VxLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBjb250ZXh0ID0gdGhpcy5fZ2V0Q29udGV4dCgpLFxuICAgICAgICAgICAgICAgIHNoYXBlaWQsIHNoYXBlLCBpO1xuICAgICAgICAgICAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5waXhlbFdpZHRoLCB0aGlzLnBpeGVsSGVpZ2h0KTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaGFwZUNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICBzaGFwZWlkID0gc2hhcGVzZXFbaV07XG4gICAgICAgICAgICAgICAgc2hhcGUgPSBzaGFwZXNbc2hhcGVpZF07XG4gICAgICAgICAgICAgICAgdGhpc1snX2RyYXcnICsgc2hhcGUudHlwZV0uYXBwbHkodGhpcywgc2hhcGUuYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuaW50ZXJhY3QpIHtcbiAgICAgICAgICAgICAgICAvLyBub3QgaW50ZXJhY3RpdmUgc28gbm8gbmVlZCB0byBrZWVwIHRoZSBzaGFwZXMgYXJyYXlcbiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlcyA9IHt9O1xuICAgICAgICAgICAgICAgIHRoaXMuc2hhcGVzZXEgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfSk7XG5cblxuICAgIFZDYW52YXNfdm1sID0gY3JlYXRlQ2xhc3MoVkNhbnZhc19iYXNlLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCB0YXJnZXQpIHtcbiAgICAgICAgICAgIHZhciBncm91cGVsO1xuICAgICAgICAgICAgVkNhbnZhc192bWwuX3N1cGVyLmluaXQuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0LCB0YXJnZXQpO1xuICAgICAgICAgICAgaWYgKHRhcmdldFswXSkge1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldFswXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuZGF0YSh0YXJnZXQsICdfanFzX3ZjYW52YXMnLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICAgICAgJCh0aGlzLmNhbnZhcykuY3NzKHsgZGlzcGxheTogJ2lubGluZS1ibG9jaycsIHBvc2l0aW9uOiAncmVsYXRpdmUnLCBvdmVyZmxvdzogJ2hpZGRlbicsIHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIG1hcmdpbjogJzBweCcsIHBhZGRpbmc6ICcwcHgnLCB2ZXJ0aWNhbEFsaWduOiAndG9wJ30pO1xuICAgICAgICAgICAgdGhpcy5faW5zZXJ0KHRoaXMuY2FudmFzLCB0YXJnZXQpO1xuICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlUGl4ZWxEaW1zKHdpZHRoLCBoZWlnaHQsIHRoaXMuY2FudmFzKTtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy5waXhlbFdpZHRoO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5waXhlbEhlaWdodDtcbiAgICAgICAgICAgIGdyb3VwZWwgPSAnPHY6Z3JvdXAgY29vcmRvcmlnaW49XCIwIDBcIiBjb29yZHNpemU9XCInICsgdGhpcy5waXhlbFdpZHRoICsgJyAnICsgdGhpcy5waXhlbEhlaWdodCArICdcIicgK1xuICAgICAgICAgICAgICAgICAgICAnIHN0eWxlPVwicG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3dpZHRoOicgKyB0aGlzLnBpeGVsV2lkdGggKyAncHg7aGVpZ2h0PScgKyB0aGlzLnBpeGVsSGVpZ2h0ICsgJ3B4O1wiPjwvdjpncm91cD4nO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVFbmQnLCBncm91cGVsKTtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXAgPSAkKHRoaXMuY2FudmFzKS5jaGlsZHJlbigpWzBdO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wcmVyZW5kZXIgPSAnJztcbiAgICAgICAgfSxcblxuICAgICAgICBfZHJhd1NoYXBlOiBmdW5jdGlvbiAoc2hhcGVpZCwgcGF0aCwgbGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCkge1xuICAgICAgICAgICAgdmFyIHZwYXRoID0gW10sXG4gICAgICAgICAgICAgICAgaW5pdGlhbCwgc3Ryb2tlLCBmaWxsLCBjbG9zZWQsIHZlbCwgcGxlbiwgaTtcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIHBsZW4gPSBwYXRoLmxlbmd0aDsgaSA8IHBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgIHZwYXRoW2ldID0gJycgKyAocGF0aFtpXVswXSkgKyAnLCcgKyAocGF0aFtpXVsxXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbml0aWFsID0gdnBhdGguc3BsaWNlKDAsIDEpO1xuICAgICAgICAgICAgbGluZVdpZHRoID0gbGluZVdpZHRoID09PSB1bmRlZmluZWQgPyAxIDogbGluZVdpZHRoO1xuICAgICAgICAgICAgc3Ryb2tlID0gbGluZUNvbG9yID09PSB1bmRlZmluZWQgPyAnIHN0cm9rZWQ9XCJmYWxzZVwiICcgOiAnIHN0cm9rZVdlaWdodD1cIicgKyBsaW5lV2lkdGggKyAncHhcIiBzdHJva2VDb2xvcj1cIicgKyBsaW5lQ29sb3IgKyAnXCIgJztcbiAgICAgICAgICAgIGZpbGwgPSBmaWxsQ29sb3IgPT09IHVuZGVmaW5lZCA/ICcgZmlsbGVkPVwiZmFsc2VcIicgOiAnIGZpbGxDb2xvcj1cIicgKyBmaWxsQ29sb3IgKyAnXCIgZmlsbGVkPVwidHJ1ZVwiICc7XG4gICAgICAgICAgICBjbG9zZWQgPSB2cGF0aFswXSA9PT0gdnBhdGhbdnBhdGgubGVuZ3RoIC0gMV0gPyAneCAnIDogJyc7XG4gICAgICAgICAgICB2ZWwgPSAnPHY6c2hhcGUgY29vcmRvcmlnaW49XCIwIDBcIiBjb29yZHNpemU9XCInICsgdGhpcy5waXhlbFdpZHRoICsgJyAnICsgdGhpcy5waXhlbEhlaWdodCArICdcIiAnICtcbiAgICAgICAgICAgICAgICAgJyBpZD1cImpxc3NoYXBlJyArIHNoYXBlaWQgKyAnXCIgJyArXG4gICAgICAgICAgICAgICAgIHN0cm9rZSArXG4gICAgICAgICAgICAgICAgIGZpbGwgK1xuICAgICAgICAgICAgICAgICcgc3R5bGU9XCJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjBweDt0b3A6MHB4O2hlaWdodDonICsgdGhpcy5waXhlbEhlaWdodCArICdweDt3aWR0aDonICsgdGhpcy5waXhlbFdpZHRoICsgJ3B4O3BhZGRpbmc6MHB4O21hcmdpbjowcHg7XCIgJyArXG4gICAgICAgICAgICAgICAgJyBwYXRoPVwibSAnICsgaW5pdGlhbCArICcgbCAnICsgdnBhdGguam9pbignLCAnKSArICcgJyArIGNsb3NlZCArICdlXCI+JyArXG4gICAgICAgICAgICAgICAgJyA8L3Y6c2hhcGU+JztcbiAgICAgICAgICAgIHJldHVybiB2ZWw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2RyYXdDaXJjbGU6IGZ1bmN0aW9uIChzaGFwZWlkLCB4LCB5LCByYWRpdXMsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGgpIHtcbiAgICAgICAgICAgIHZhciBzdHJva2UsIGZpbGwsIHZlbDtcbiAgICAgICAgICAgIHggLT0gcmFkaXVzO1xuICAgICAgICAgICAgeSAtPSByYWRpdXM7XG4gICAgICAgICAgICBzdHJva2UgPSBsaW5lQ29sb3IgPT09IHVuZGVmaW5lZCA/ICcgc3Ryb2tlZD1cImZhbHNlXCIgJyA6ICcgc3Ryb2tlV2VpZ2h0PVwiJyArIGxpbmVXaWR0aCArICdweFwiIHN0cm9rZUNvbG9yPVwiJyArIGxpbmVDb2xvciArICdcIiAnO1xuICAgICAgICAgICAgZmlsbCA9IGZpbGxDb2xvciA9PT0gdW5kZWZpbmVkID8gJyBmaWxsZWQ9XCJmYWxzZVwiJyA6ICcgZmlsbENvbG9yPVwiJyArIGZpbGxDb2xvciArICdcIiBmaWxsZWQ9XCJ0cnVlXCIgJztcbiAgICAgICAgICAgIHZlbCA9ICc8djpvdmFsICcgK1xuICAgICAgICAgICAgICAgICAnIGlkPVwianFzc2hhcGUnICsgc2hhcGVpZCArICdcIiAnICtcbiAgICAgICAgICAgICAgICBzdHJva2UgK1xuICAgICAgICAgICAgICAgIGZpbGwgK1xuICAgICAgICAgICAgICAgICcgc3R5bGU9XCJwb3NpdGlvbjphYnNvbHV0ZTt0b3A6JyArIHkgKyAncHg7IGxlZnQ6JyArIHggKyAncHg7IHdpZHRoOicgKyAocmFkaXVzICogMikgKyAncHg7IGhlaWdodDonICsgKHJhZGl1cyAqIDIpICsgJ3B4XCI+PC92Om92YWw+JztcbiAgICAgICAgICAgIHJldHVybiB2ZWw7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBfZHJhd1BpZVNsaWNlOiBmdW5jdGlvbiAoc2hhcGVpZCwgeCwgeSwgcmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSwgbGluZUNvbG9yLCBmaWxsQ29sb3IpIHtcbiAgICAgICAgICAgIHZhciB2cGF0aCwgc3RhcnR4LCBzdGFydHksIGVuZHgsIGVuZHksIHN0cm9rZSwgZmlsbCwgdmVsO1xuICAgICAgICAgICAgaWYgKHN0YXJ0QW5nbGUgPT09IGVuZEFuZ2xlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnOyAgLy8gVk1MIHNlZW1zIHRvIGhhdmUgcHJvYmxlbSB3aGVuIHN0YXJ0IGFuZ2xlIGVxdWFscyBlbmQgYW5nbGUuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKGVuZEFuZ2xlIC0gc3RhcnRBbmdsZSkgPT09ICgyICogTWF0aC5QSSkpIHtcbiAgICAgICAgICAgICAgICBzdGFydEFuZ2xlID0gMC4wOyAgLy8gVk1MIHNlZW1zIHRvIGhhdmUgYSBwcm9ibGVtIHdoZW4gZHJhd2luZyBhIGZ1bGwgY2lyY2xlIHRoYXQgZG9lc24ndCBzdGFydCAwXG4gICAgICAgICAgICAgICAgZW5kQW5nbGUgPSAoMiAqIE1hdGguUEkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdGFydHggPSB4ICsgTWF0aC5yb3VuZChNYXRoLmNvcyhzdGFydEFuZ2xlKSAqIHJhZGl1cyk7XG4gICAgICAgICAgICBzdGFydHkgPSB5ICsgTWF0aC5yb3VuZChNYXRoLnNpbihzdGFydEFuZ2xlKSAqIHJhZGl1cyk7XG4gICAgICAgICAgICBlbmR4ID0geCArIE1hdGgucm91bmQoTWF0aC5jb3MoZW5kQW5nbGUpICogcmFkaXVzKTtcbiAgICAgICAgICAgIGVuZHkgPSB5ICsgTWF0aC5yb3VuZChNYXRoLnNpbihlbmRBbmdsZSkgKiByYWRpdXMpO1xuXG4gICAgICAgICAgICBpZiAoc3RhcnR4ID09PSBlbmR4ICYmIHN0YXJ0eSA9PT0gZW5keSkge1xuICAgICAgICAgICAgICAgIGlmICgoZW5kQW5nbGUgLSBzdGFydEFuZ2xlKSA8IE1hdGguUEkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJldmVudCB2ZXJ5IHNtYWxsIHNsaWNlcyBmcm9tIGJlaW5nIG1pc3Rha2VuIGFzIGEgd2hvbGUgcGllXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gZXNzZW50aWFsbHkgZ29pbmcgdG8gYmUgdGhlIGVudGlyZSBjaXJjbGUsIHNvIGlnbm9yZSBzdGFydEFuZ2xlXG4gICAgICAgICAgICAgICAgc3RhcnR4ID0gZW5keCA9IHggKyByYWRpdXM7XG4gICAgICAgICAgICAgICAgc3RhcnR5ID0gZW5keSA9IHk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzdGFydHggPT09IGVuZHggJiYgc3RhcnR5ID09PSBlbmR5ICYmIChlbmRBbmdsZSAtIHN0YXJ0QW5nbGUpIDwgTWF0aC5QSSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdnBhdGggPSBbeCAtIHJhZGl1cywgeSAtIHJhZGl1cywgeCArIHJhZGl1cywgeSArIHJhZGl1cywgc3RhcnR4LCBzdGFydHksIGVuZHgsIGVuZHldO1xuICAgICAgICAgICAgc3Ryb2tlID0gbGluZUNvbG9yID09PSB1bmRlZmluZWQgPyAnIHN0cm9rZWQ9XCJmYWxzZVwiICcgOiAnIHN0cm9rZVdlaWdodD1cIjFweFwiIHN0cm9rZUNvbG9yPVwiJyArIGxpbmVDb2xvciArICdcIiAnO1xuICAgICAgICAgICAgZmlsbCA9IGZpbGxDb2xvciA9PT0gdW5kZWZpbmVkID8gJyBmaWxsZWQ9XCJmYWxzZVwiJyA6ICcgZmlsbENvbG9yPVwiJyArIGZpbGxDb2xvciArICdcIiBmaWxsZWQ9XCJ0cnVlXCIgJztcbiAgICAgICAgICAgIHZlbCA9ICc8djpzaGFwZSBjb29yZG9yaWdpbj1cIjAgMFwiIGNvb3Jkc2l6ZT1cIicgKyB0aGlzLnBpeGVsV2lkdGggKyAnICcgKyB0aGlzLnBpeGVsSGVpZ2h0ICsgJ1wiICcgK1xuICAgICAgICAgICAgICAgICAnIGlkPVwianFzc2hhcGUnICsgc2hhcGVpZCArICdcIiAnICtcbiAgICAgICAgICAgICAgICAgc3Ryb2tlICtcbiAgICAgICAgICAgICAgICAgZmlsbCArXG4gICAgICAgICAgICAgICAgJyBzdHlsZT1cInBvc2l0aW9uOmFic29sdXRlO2xlZnQ6MHB4O3RvcDowcHg7aGVpZ2h0OicgKyB0aGlzLnBpeGVsSGVpZ2h0ICsgJ3B4O3dpZHRoOicgKyB0aGlzLnBpeGVsV2lkdGggKyAncHg7cGFkZGluZzowcHg7bWFyZ2luOjBweDtcIiAnICtcbiAgICAgICAgICAgICAgICAnIHBhdGg9XCJtICcgKyB4ICsgJywnICsgeSArICcgd2EgJyArIHZwYXRoLmpvaW4oJywgJykgKyAnIHggZVwiPicgK1xuICAgICAgICAgICAgICAgICcgPC92OnNoYXBlPic7XG4gICAgICAgICAgICByZXR1cm4gdmVsO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3UmVjdDogZnVuY3Rpb24gKHNoYXBlaWQsIHgsIHksIHdpZHRoLCBoZWlnaHQsIGxpbmVDb2xvciwgZmlsbENvbG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZHJhd1NoYXBlKHNoYXBlaWQsIFtbeCwgeV0sIFt4LCB5ICsgaGVpZ2h0XSwgW3ggKyB3aWR0aCwgeSArIGhlaWdodF0sIFt4ICsgd2lkdGgsIHldLCBbeCwgeV1dLCBsaW5lQ29sb3IsIGZpbGxDb2xvcik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXAuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXBwZW5kU2hhcGU6IGZ1bmN0aW9uIChzaGFwZSkge1xuICAgICAgICAgICAgdmFyIHZlbCA9IHRoaXNbJ19kcmF3JyArIHNoYXBlLnR5cGVdLmFwcGx5KHRoaXMsIHNoYXBlLmFyZ3MpO1xuICAgICAgICAgICAgaWYgKHRoaXMucmVuZGVyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3VwLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlRW5kJywgdmVsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcmVyZW5kZXIgKz0gdmVsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5sYXN0U2hhcGVJZCA9IHNoYXBlLmlkO1xuICAgICAgICAgICAgcmV0dXJuIHNoYXBlLmlkO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlcGxhY2VXaXRoU2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBzaGFwZSkge1xuICAgICAgICAgICAgdmFyIGV4aXN0aW5nID0gJCgnI2pxc3NoYXBlJyArIHNoYXBlaWQpLFxuICAgICAgICAgICAgICAgIHZlbCA9IHRoaXNbJ19kcmF3JyArIHNoYXBlLnR5cGVdLmFwcGx5KHRoaXMsIHNoYXBlLmFyZ3MpO1xuICAgICAgICAgICAgZXhpc3RpbmdbMF0ub3V0ZXJIVE1MID0gdmVsO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlcGxhY2VXaXRoU2hhcGVzOiBmdW5jdGlvbiAoc2hhcGVpZHMsIHNoYXBlcykge1xuICAgICAgICAgICAgLy8gcmVwbGFjZSB0aGUgZmlyc3Qgc2hhcGVpZCB3aXRoIGFsbCB0aGUgbmV3IHNoYXBlcyB0aGVuIHRvYXN0IHRoZSByZW1haW5pbmcgb2xkIHNoYXBlc1xuICAgICAgICAgICAgdmFyIGV4aXN0aW5nID0gJCgnI2pxc3NoYXBlJyArIHNoYXBlaWRzWzBdKSxcbiAgICAgICAgICAgICAgICByZXBsYWNlID0gJycsXG4gICAgICAgICAgICAgICAgc2xlbiA9IHNoYXBlcy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgaTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICByZXBsYWNlICs9IHRoaXNbJ19kcmF3JyArIHNoYXBlc1tpXS50eXBlXS5hcHBseSh0aGlzLCBzaGFwZXNbaV0uYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBleGlzdGluZ1swXS5vdXRlckhUTUwgPSByZXBsYWNlO1xuICAgICAgICAgICAgZm9yIChpID0gMTsgaSA8IHNoYXBlaWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgJCgnI2pxc3NoYXBlJyArIHNoYXBlaWRzW2ldKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpbnNlcnRBZnRlclNoYXBlOiBmdW5jdGlvbiAoc2hhcGVpZCwgc2hhcGUpIHtcbiAgICAgICAgICAgIHZhciBleGlzdGluZyA9ICQoJyNqcXNzaGFwZScgKyBzaGFwZWlkKSxcbiAgICAgICAgICAgICAgICAgdmVsID0gdGhpc1snX2RyYXcnICsgc2hhcGUudHlwZV0uYXBwbHkodGhpcywgc2hhcGUuYXJncyk7XG4gICAgICAgICAgICBleGlzdGluZ1swXS5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyRW5kJywgdmVsKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmVTaGFwZUlkOiBmdW5jdGlvbiAoc2hhcGVpZCkge1xuICAgICAgICAgICAgdmFyIGV4aXN0aW5nID0gJCgnI2pxc3NoYXBlJyArIHNoYXBlaWQpO1xuICAgICAgICAgICAgdGhpcy5ncm91cC5yZW1vdmVDaGlsZChleGlzdGluZ1swXSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0U2hhcGVBdDogZnVuY3Rpb24gKGVsLCB4LCB5KSB7XG4gICAgICAgICAgICB2YXIgc2hhcGVpZCA9IGVsLmlkLnN1YnN0cig4KTtcbiAgICAgICAgICAgIHJldHVybiBzaGFwZWlkO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnJlbmRlcmVkKSB7XG4gICAgICAgICAgICAgICAgLy8gYmF0Y2ggdGhlIGludGlhbCByZW5kZXIgaW50byBhIHNpbmdsZSByZXBhaW50XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cC5pbm5lckhUTUwgPSB0aGlzLnByZXJlbmRlcjtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbn0pKX0oZG9jdW1lbnQsIE1hdGgpKTtcbiIsIi8qIVxuICogYW1hcmV0dGkgdjAuMC4xIChodHRwOi8vZm94eXRoZW1lcy5uZXQvdGhlbWVzL2FtYXJldHRpKVxuICogQ29weXJpZ2h0IDIwMTQtMjAxNSBGb3h5IFRoZW1lcyBhbGwgcmlnaHRzIHJlc2VydmVkIFxuICovXG52YXIgQXBwID0gKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8vQmFzaWMgQ29uZmlnXG4gIHZhciBjb25maWcgPSB7XG4gICAgYXNzZXRzUGF0aDogJ2Fzc2V0cycsXG4gICAgaW1nUGF0aDogJ2ltZycsXG4gICAganNQYXRoOiAnanMnLFxuICAgIGxpYnNQYXRoOiAnbGliJyxcbiAgICBsZWZ0U2lkZWJhclNsaWRlU3BlZWQ6IDIwMCxcbiAgICBzd2lwZVRyZXNob2xkOiAxMDAsXG4gICAgc2Nyb2xsVG9wOiB0cnVlLFxuICAgIG9wZW5MZWZ0U2lkZWJhckNsYXNzOiAnb3Blbi1sZWZ0LXNpZGViYXInLFxuICAgIG9wZW5SaWdodFNpZGViYXJDbGFzczogJ29wZW4tcmlnaHQtc2lkZWJhcicsXG4gICAgcmVtb3ZlTGVmdFNpZGViYXJDbGFzczogJ2FtLW5vc2lkZWJhci1sZWZ0JyxcbiAgICB0cmFuc2l0aW9uQ2xhc3M6ICdhbS1hbmltYXRlJyxcbiAgICBvcGVuU2lkZWJhckRlbGF5OiA0MDAsXG4gICAgc3luY1N1Yk1lbnVPbkhvdmVyOiBmYWxzZVxuICB9O1xuXG4gIHZhciBjb2xvcnMgPSB7fTtcbiAgdmFyIGJvZHkgPSAkKFwiYm9keVwiKTtcbiAgdmFyIHdyYXBwZXIgPSAkKFwiLmFtLXdyYXBwZXJcIik7XG4gIHZhciBsZWZ0U2lkZWJhciA9ICQoXCIuYW0tbGVmdC1zaWRlYmFyXCIpO1xuICB2YXIgcmlnaHRTaWRlYmFyID0gJChcIi5hbS1yaWdodC1zaWRlYmFyXCIpO1xuICB2YXIgb3BlblNpZGViYXIgPSBmYWxzZTtcblxuICAvL0dldCB0aGUgdGVtcGxhdGUgY3NzIGNvbG9ycyBpbnRvIGpzIHZhcnNcbiAgZnVuY3Rpb24gZ2V0Q29sb3IoIGMgKXtcbiAgICB2YXIgdG1wID0gJChcIjxkaXY+XCIsIHsgY2xhc3M6IGMgfSkuYXBwZW5kVG8oXCJib2R5XCIpO1xuICAgIHZhciBjb2xvciA9IHRtcC5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIpO1xuICAgIHRtcC5yZW1vdmUoKTtcblxuICAgIHJldHVybiBjb2xvcjtcbiAgfVxuXG4gIC8vQ29yZSBwcml2YXRlIGZ1bmN0aW9uc1xuICBmdW5jdGlvbiBsZWZ0U2lkZWJhckluaXQoKXtcblxuICAgIGZ1bmN0aW9uIG9TaWRlYmFyKCl7XG4gICAgICBib2R5LmFkZENsYXNzKCBjb25maWcub3BlbkxlZnRTaWRlYmFyQ2xhc3MgKyBcIiBcIiArIGNvbmZpZy50cmFuc2l0aW9uQ2xhc3MgKTtcbiAgICAgIG9wZW5TaWRlYmFyID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjU2lkZWJhcigpe1xuICAgICAgYm9keS5yZW1vdmVDbGFzcyggY29uZmlnLm9wZW5MZWZ0U2lkZWJhckNsYXNzICkuYWRkQ2xhc3MoIGNvbmZpZy50cmFuc2l0aW9uQ2xhc3MgKTtcbiAgICAgIHNpZGViYXJEZWxheSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN5bmNTdWJNZW51KCBpdGVtICl7XG4gICAgICB2YXIgZWxlbWVudHMgPSAkKFwiLnNpZGViYXItZWxlbWVudHMgPiBsaVwiLCBsZWZ0U2lkZWJhcik7XG5cbiAgICAgIGlmKCB0eXBlb2YgaXRlbSAhPT0gXCJ1bmRlZmluZWRcIiApIHtcbiAgICAgICAgZWxlbWVudHMgPSBpdGVtO1xuICAgICAgfVxuXG4gICAgICAkLmVhY2goIGVsZW1lbnRzLCBmdW5jdGlvbihpLCB2KXtcblxuICAgICAgICB2YXIgdGl0bGUgPSAkKHRoaXMpLmZpbmQoXCI+IGEgc3BhblwiKS5odG1sKCk7XG4gICAgICAgIHZhciB1bCA9ICQodGhpcykuZmluZChcIj4gdWxcIik7XG4gICAgICAgIHZhciBzdWJFbHMgPSAkKFwiPiBsaVwiLCB1bCk7XG4gICAgICAgIHZhciB0aXRsZSA9ICQoJzxsaSBjbGFzcz1cInRpdGxlXCI+JyArIHRpdGxlICsgJzwvbGk+Jyk7XG4gICAgICAgIHZhciBzdWJDb250YWluZXIgPSAkKCc8bGkgY2xhc3M9XCJuYXYtaXRlbXNcIj48ZGl2IGNsYXNzPVwiYW0tc2Nyb2xsZXIgbmFub1wiPjxkaXYgY2xhc3M9XCJjb250ZW50IG5hbm8tY29udGVudFwiPjx1bD48L3VsPjwvZGl2PjwvZGl2PjwvbGk+Jyk7XG5cbiAgICAgICAgaWYoICF1bC5maW5kKFwiPiBsaS50aXRsZVwiKS5sZW5ndGggPiAwICl7XG4gICAgICAgICB1bC5wcmVwZW5kKCB0aXRsZSApO1xuICAgICAgICAgIHN1YkVscy5hcHBlbmRUbyggc3ViQ29udGFpbmVyLmZpbmQoXCIuY29udGVudCB1bFwiKSApO1xuICAgICAgICAgIHN1YkNvbnRhaW5lci5hcHBlbmRUbyggdWwgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLypPcGVuLVNpZGViYXIgd2hlbiBjbGljayBvbiB0b3BiYXIgYnV0dG9uKi9cbiAgICAgICQoJy5hbS10b2dnbGUtbGVmdC1zaWRlYmFyJykub24oXCJjbGlja1wiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgaWYoIG9wZW5TaWRlYmFyICYmIGJvZHkuaGFzQ2xhc3MoIGNvbmZpZy5vcGVuTGVmdFNpZGViYXJDbGFzcyApICl7XG4gICAgICAgICAgY1NpZGViYXIoKTtcbiAgICAgICAgfWVsc2UgaWYoICFvcGVuU2lkZWJhciApe1xuICAgICAgICAgIG9TaWRlYmFyKCk7XG4gICAgICAgIH1cbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG5cbiAgICAvKkNsb3NlIHNpZGViYXIgb24gY2xpY2sgb3V0c2lkZSovXG4gICAgICAkKGRvY3VtZW50KS5vbihcInRvdWNoc3RhcnQgbW91c2Vkb3duXCIsZnVuY3Rpb24oZSl7XG4gICAgICAgIGlmICggISQoZS50YXJnZXQpLmNsb3Nlc3QobGVmdFNpZGViYXIpLmxlbmd0aCAmJiBib2R5Lmhhc0NsYXNzKCBjb25maWcub3BlbkxlZnRTaWRlYmFyQ2xhc3MgKSApIHtcbiAgICAgICAgICBjU2lkZWJhcigpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIHZhciBmaXJzdEFuY2hvciA9ICQoXCIuc2lkZWJhci1lbGVtZW50cyA+IGxpID4gYVwiLCBsZWZ0U2lkZWJhcik7XG5cbiAgICAvKlN1Yi1tZW51IHRpdGxlIGZ1bmMqL1xuICAgICAgZmlyc3RBbmNob3Iub24oJ21vdXNlb3ZlcicsZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGFtU2Nyb2xsZXIgPSAkKHRoaXMpLnBhcmVudCgpLmZpbmQoXCIuYW0tc2Nyb2xsZXJcIik7XG4gICAgICAgIHZhciBsaSA9ICQodGhpcykucGFyZW50KCk7XG4gICAgICAgIHZhciBzdWJNZW51ID0gbGkuZmluZChcIj4gdWxcIik7XG5cbiAgICAgICAgLy9EZWxheSBhZnRlciBtb3VzZSBsZWF2ZVxuICAgICAgICBpZiggISQuaXNYcygpICl7XG4gICAgICAgICAgc3ViTWVudS5hZGRDbGFzcyhcInZpc2libGVcIik7XG4gICAgICAgIH1cblxuICAgICAgICBhbVNjcm9sbGVyLm5hbm9TY3JvbGxlcih7IGRlc3Ryb3k6IHRydWUgfSk7XG4gICAgICAgIGFtU2Nyb2xsZXIubmFub1Njcm9sbGVyKCk7XG5cbiAgICAgICAgLy9DcmVhdGUgc3ViLW1lbnUgZWxlbWVudHNcbiAgICAgICAgaWYoIGNvbmZpZy5zeW5jU3ViTWVudU9uSG92ZXIgKXtcbiAgICAgICAgICBzeW5jU3ViTWVudSggbGkgKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgIH0pO1xuXG4gICAgLypTdWItbWVudSBkZWxheSBvbiBtb3VzZSBsZWF2ZSovXG4gICAgICBmaXJzdEFuY2hvci5vbignbW91c2VsZWF2ZScsZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHN1Yk1lbnUgPSAkKHRoaXMpLnBhcmVudCgpLmZpbmQoXCI+IHVsXCIpO1xuICAgICAgICBcbiAgICAgICAgaWYoICEkLmlzWHMoKSApe1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHN1Yk1lbnUucmVtb3ZlQ2xhc3MoXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgIH0sIDMwMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgLypPcGVuIHN1Yi1tZW51IG9uIHNtYWxsIGRldmljZXMqL1xuICAgICAgJChcIi5zaWRlYmFyLWVsZW1lbnRzIGxpIGFcIiwgbGVmdFNpZGViYXIpLm9uKFwiY2xpY2tcIixmdW5jdGlvbiggZSApe1xuICAgICAgICBpZiggJC5pc1hzKCkgKXtcbiAgICAgICAgICB2YXIgJGVsID0gJCh0aGlzKSwgJG9wZW4sICRzcGVlZCA9IGNvbmZpZy5sZWZ0U2lkZWJhclNsaWRlU3BlZWQ7XG5cbiAgICAgICAgICAkb3BlbiA9ICRlbC5wYXJlbnQoKS5zaWJsaW5ncyhcIi5vcGVuXCIpO1xuXG4gICAgICAgICAgaWYoICRvcGVuICl7XG4gICAgICAgICAgICAkb3Blbi50b2dnbGVDbGFzcygnb3BlbicpLmZpbmQoJz4gdWw6dmlzaWJsZScpLnNsaWRlVXAoeyBkdXJhdGlvbjogJHNwZWVkIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmKCAkZWwucGFyZW50KCkuaGFzQ2xhc3MoJ29wZW4nKSApe1xuICAgICAgICAgICAgJGVsLm5leHQoKS5zbGlkZVVwKHsgZHVyYXRpb246ICRzcGVlZCwgY29tcGxldGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICRlbC5wYXJlbnQoKS50b2dnbGVDbGFzcygnb3BlbicpO1xuICAgICAgICAgICAgfX0pO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgJGVsLm5leHQoKS5zbGlkZURvd24oeyBkdXJhdGlvbjogJHNwZWVkLCBjb21wbGV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgJGVsLnBhcmVudCgpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7XG4gICAgICAgICAgICB9fSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYoICRlbC5uZXh0KCkuaXMoJ3VsJykgKXtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1lbHNley8vQ2xvc2Ugc3ViLW1lbnUgb24gYW5jaG9yIGNsaWNrXG4gICAgICAgICAgdmFyIHN1Yk1lbnUgPSAkKFwiLnNpZGViYXItZWxlbWVudHMgPiBsaSA+IHVsOnZpc2libGVcIiwgbGVmdFNpZGViYXIpO1xuICAgICAgICAgIHN1Yk1lbnUuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBzdWJNZW51LnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgfSwgNTApO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIC8qQ2FsY3VsYXRlIHNpZGViYXIgdHJlZSBhY3RpdmUgJiBvcGVuIGNsYXNzZXMqL1xuICAgICAgJChcImxpLmFjdGl2ZVwiLCBsZWZ0U2lkZWJhcikucGFyZW50cyhcIi5wYXJlbnRcIikuYWRkQ2xhc3MoXCJhY3RpdmUgb3BlblwiKTtcblxuICAgIC8qQ3JlYXRlIHN1YiBtZW51IGVsZW1lbnRzKi9cbiAgICAgIHN5bmNTdWJNZW51KCk7XG5cbiAgICAvKk5hbm9zY3JvbGxlciB3aGVuIGxlZnQgc2lkZWJhciBpcyBmaXhlZCovXG4gICAgICBpZiggd3JhcHBlci5oYXNDbGFzcyhcImFtLWZpeGVkLXNpZGViYXJcIikgKXtcbiAgICAgICAgdmFyIGxzYyA9ICQoXCIuYW0tbGVmdC1zaWRlYmFyID4gLmNvbnRlbnRcIik7XG4gICAgICAgIGxzYy53cmFwKCc8ZGl2IGNsYXNzPVwiYW0tc2Nyb2xsZXIgbmFub1wiPjwvZGl2PicpO1xuICAgICAgICBsc2MuYWRkQ2xhc3MoXCJuYW5vLWNvbnRlbnRcIik7XG4gICAgICAgIGxzYy5wYXJlbnQoKS5uYW5vU2Nyb2xsZXIoKTtcbiAgICAgIH1cblxuICAgIC8qT24gd2luZG93IHJlc2l6ZSBjaGVjayBmb3Igc21hbGwgcmVzb2x1dGlvbiBjbGFzc2VzIHRvIHJlbW92ZSB0aGVtKi9cbiAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xuICAgICAgICB3YWl0Rm9yRmluYWxFdmVudChmdW5jdGlvbigpe1xuICAgICAgICAgIGlmKCAhJC5pc1hzKCkgKXtcbiAgICAgICAgICAgIHZhciBzY3JvbGxlciA9ICQoXCIuYW0tc2Nyb2xsZXJcIik7XG4gICAgICAgICAgICBzY3JvbGxlci5uYW5vU2Nyb2xsZXIoeyBkZXN0cm95OiB0cnVlIH0pO1xuICAgICAgICAgICAgc2Nyb2xsZXIubmFub1Njcm9sbGVyKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCA1MDAsIFwiYW1fY2hlY2tfcGhvbmVfY2xhc3Nlc1wiKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcmlnaHRTaWRlYmFySW5pdCgpe1xuXG4gICAgZnVuY3Rpb24gb1NpZGViYXIoKXtcbiAgICAgIGJvZHkuYWRkQ2xhc3MoIGNvbmZpZy5vcGVuUmlnaHRTaWRlYmFyQ2xhc3MgICsgXCIgXCIgKyBjb25maWcudHJhbnNpdGlvbkNsYXNzICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY1NpZGViYXIoKXtcbiAgICAgIGJvZHkucmVtb3ZlQ2xhc3MoIGNvbmZpZy5vcGVuUmlnaHRTaWRlYmFyQ2xhc3MgKS5hZGRDbGFzcyggY29uZmlnLnRyYW5zaXRpb25DbGFzcyApO1xuICAgICAgc2lkZWJhckRlbGF5KCk7XG4gICAgfVxuXG4gICAgaWYoIHJpZ2h0U2lkZWJhci5sZW5ndGggPiAwICl7XG4gICAgICAvKk9wZW4tU2lkZWJhciB3aGVuIGNsaWNrIG9uIHRvcGJhciBidXR0b24qL1xuICAgICAgJCgnLmFtLXRvZ2dsZS1yaWdodC1zaWRlYmFyJykub24oXCJjbGlja1wiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgaWYoIG9wZW5TaWRlYmFyICYmIGJvZHkuaGFzQ2xhc3MoIGNvbmZpZy5vcGVuUmlnaHRTaWRlYmFyQ2xhc3MgKSApe1xuICAgICAgICAgIGNTaWRlYmFyKCk7XG4gICAgICAgIH1lbHNlIGlmKCAhb3BlblNpZGViYXIgKXtcbiAgICAgICAgICBvU2lkZWJhcigpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9KTtcblxuICAgICAgLypDbG9zZSBzaWRlYmFyIG9uIGNsaWNrIG91dHNpZGUqL1xuICAgICAgJCggZG9jdW1lbnQgKS5vbihcIm1vdXNlZG93biB0b3VjaHN0YXJ0XCIsZnVuY3Rpb24oIGUgKXtcbiAgICAgICAgaWYgKCAhJCggZS50YXJnZXQgKS5jbG9zZXN0KCByaWdodFNpZGViYXIgKS5sZW5ndGggJiYgYm9keS5oYXNDbGFzcyggY29uZmlnLm9wZW5SaWdodFNpZGViYXJDbGFzcyApICkge1xuICAgICAgICAgIGNTaWRlYmFyKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNpZGViYXJEZWxheSgpe1xuICAgIG9wZW5TaWRlYmFyID0gdHJ1ZTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICBvcGVuU2lkZWJhciA9IGZhbHNlO1xuICAgIH0sIGNvbmZpZy5vcGVuU2lkZWJhckRlbGF5ICk7XG4gIH1cblxuICBmdW5jdGlvbiBzaWRlYmFyU3dpcGUoKXtcbiAgICAvKk9wZW4gc2lkZWRhciBvbiBzd2lwZSovXG4gICAgd3JhcHBlci5zd2lwZSgge1xuICAgICAgYWxsb3dQYWdlU2Nyb2xsOiBcInZlcnRpY2FsXCIsXG4gICAgICBwcmV2ZW50RGVmYXVsdEV2ZW50czogZmFsc2UsXG4gICAgICBmYWxsYmFja1RvTW91c2VFdmVudHM6IGZhbHNlLFxuICAgICAgc3dpcGVSaWdodDogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiggIW9wZW5TaWRlYmFyICYmICF3cmFwcGVyLmhhc0NsYXNzKCBjb25maWcucmVtb3ZlTGVmdFNpZGViYXJDbGFzcyApICl7XG4gICAgICAgICAgYm9keS5hZGRDbGFzcyggY29uZmlnLm9wZW5MZWZ0U2lkZWJhckNsYXNzICsgXCIgXCIgKyBjb25maWcudHJhbnNpdGlvbkNsYXNzICk7XG4gICAgICAgICAgb3BlblNpZGViYXIgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc3dpcGVMZWZ0OiBmdW5jdGlvbihlKXtcbiAgICAgICAgaWYoICFvcGVuU2lkZWJhciAmJiByaWdodFNpZGViYXIubGVuZ3RoID4gMCApe1xuICAgICAgICAgIGJvZHkuYWRkQ2xhc3MoIGNvbmZpZy5vcGVuUmlnaHRTaWRlYmFyQ2xhc3MgKyBcIiBcIiArIGNvbmZpZy50cmFuc2l0aW9uQ2xhc3MgKTtcbiAgICAgICAgICBvcGVuU2lkZWJhciA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0aHJlc2hvbGQ6IGNvbmZpZy5zd2lwZVRyZXNob2xkXG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGF0V2lkZ2V0KCl7XG4gICAgdmFyIGNoYXQgPSAkKFwiLmFtLXJpZ2h0LXNpZGViYXIgLnRhYi1wYW5lLmNoYXRcIik7XG4gICAgdmFyIGNvbnRhY3RzRWwgPSAkKFwiLmNoYXQtY29udGFjdHNcIiwgY2hhdCk7XG4gICAgdmFyIGNvbnZlcnNhdGlvbkVsID0gJChcIi5jaGF0LXdpbmRvd1wiLCBjaGF0KTtcbiAgICB2YXIgbWVzc2FnZXNDb250YWluZXIgPSAkKFwiLmNoYXQtbWVzc2FnZXNcIiwgY29udmVyc2F0aW9uRWwpO1xuICAgIHZhciBtZXNzYWdlc0xpc3QgPSAkKFwiLmNvbnRlbnQgPiB1bFwiLCBtZXNzYWdlc0NvbnRhaW5lcik7XG4gICAgdmFyIG1lc3NhZ2VzU2Nyb2xsQ29udGVudCA9ICQoXCIubmFuby1jb250ZW50XCIsIG1lc3NhZ2VzQ29udGFpbmVyKTtcbiAgICB2YXIgY2hhdElucHV0Q29udGFpbmVyID0gJChcIi5jaGF0LWlucHV0XCIsIGNvbnZlcnNhdGlvbkVsKTtcbiAgICB2YXIgY2hhdElucHV0ID0gJChcImlucHV0XCIsIGNoYXRJbnB1dENvbnRhaW5lcik7XG4gICAgdmFyIGNoYXRJbnB1dFNlbmRCdXR0b24gPSAkKFwiLnNlbmQtbXNnXCIsIGNoYXRJbnB1dENvbnRhaW5lcik7XG5cbiAgICBmdW5jdGlvbiBvcGVuQ2hhdFdpbmRvdygpe1xuICAgICAgaWYoICFjaGF0Lmhhc0NsYXNzKFwiY2hhdC1vcGVuZWRcIikgKXtcbiAgICAgICAgY2hhdC5hZGRDbGFzcyhcImNoYXQtb3BlbmVkXCIpO1xuICAgICAgICAkKFwiLmFtLXNjcm9sbGVyXCIsIG1lc3NhZ2VzQ29udGFpbmVyKS5uYW5vU2Nyb2xsZXIoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9zZUNoYXRXaW5kb3coKXtcbiAgICAgIGlmKCBjaGF0Lmhhc0NsYXNzKFwiY2hhdC1vcGVuZWRcIikgKXtcbiAgICAgICAgY2hhdC5yZW1vdmVDbGFzcyhcImNoYXQtb3BlbmVkXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qT3BlbiBDb252ZXJzYXRpb24gV2luZG93IHdoZW4gY2xpY2sgb24gY2hhdCB1c2VyKi9cbiAgICAkKFwiLnVzZXIgYVwiLCBjb250YWN0c0VsKS5vbignY2xpY2snLGZ1bmN0aW9uKCBlICl7XG4gICAgICAkKFwiLmFtLXNjcm9sbGVyXCIsIGNvbnRhY3RzRWwpLm5hbm9TY3JvbGxlcih7IHN0b3A6IHRydWUgfSk7XG4gICAgICBvcGVuQ2hhdFdpbmRvdygpO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuXG4gICAgLypDbG9zZSBjaGF0IGNvbnYgd2luZG93Ki9cbiAgICAkKFwiLnRpdGxlIC5yZXR1cm5cIiwgY29udmVyc2F0aW9uRWwpLm9uKCdjbGljaycsZnVuY3Rpb24oIGUgKXtcbiAgICAgIGNsb3NlQ2hhdFdpbmRvdygpO1xuICAgICAgc2Nyb2xsZXJJbml0KCk7XG4gICAgfSk7XG5cbiAgICAvKlNlbmQgbWVzc2FnZSovXG4gICAgZnVuY3Rpb24gc2VuZE1zZyhtc2csIHNlbGYpe1xuICAgICAgdmFyICRtZXNzYWdlID0gJCgnPGxpIGNsYXNzPVwiJyArICgoc2VsZik/J3NlbGYnOidmcmllbmQnKSArICdcIj48L2xpPicpO1xuXG4gICAgICBpZiggbXNnICE9ICcnICl7XG4gICAgICAgICQoJzxkaXYgY2xhc3M9XCJtc2dcIj4nICsgbXNnICsgJzwvZGl2PicpLmFwcGVuZFRvKCRtZXNzYWdlKTtcbiAgICAgICAgJG1lc3NhZ2UuYXBwZW5kVG8obWVzc2FnZXNMaXN0KTtcblxuICAgICAgICBtZXNzYWdlc1Njcm9sbENvbnRlbnQuc3RvcCgpLmFuaW1hdGUoe1xuICAgICAgICAgICdzY3JvbGxUb3AnOiBtZXNzYWdlc1Njcm9sbENvbnRlbnQucHJvcChcInNjcm9sbEhlaWdodFwiKVxuICAgICAgICB9LCA5MDAsICdzd2luZycpO1xuXG4gICAgICAgIHNjcm9sbGVySW5pdCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qU2VuZCBtc2cgd2hlbiBjbGljayBvbiAnc2VuZCcgYnV0dG9uIG9yIHByZXNzICdFbnRlcicqL1xuICAgICAgY2hhdElucHV0LmtleXByZXNzKGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgdmFyIGtleWNvZGUgPSAoZXZlbnQua2V5Q29kZSA/IGV2ZW50LmtleUNvZGUgOiBldmVudC53aGljaCk7XG4gICAgICAgIHZhciBtc2cgPSAkKHRoaXMpLnZhbCgpO1xuXG4gICAgICAgIGlmKGtleWNvZGUgPT0gJzEzJyl7XG4gICAgICAgICAgc2VuZE1zZyhtc2csIHRydWUpO1xuICAgICAgICAgICQodGhpcykudmFsKFwiXCIpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNoYXRJbnB1dFNlbmRCdXR0b24ub24oJ2NsaWNrJyxmdW5jdGlvbigpe1xuICAgICAgICB2YXIgbXNnID0gY2hhdElucHV0LnZhbCgpO1xuICAgICAgICBzZW5kTXNnKG1zZywgdHJ1ZSk7XG4gICAgICAgIGNoYXRJbnB1dC52YWwoXCJcIik7XG4gICAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNjcm9sbGVySW5pdCgpe1xuICAgICQoXCIuYW0tc2Nyb2xsZXJcIikubmFub1Njcm9sbGVyKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzY3JvbGxUb3BCdXR0b24oKXtcbiAgICB2YXIgb2Zmc2V0ID0gMjIwO1xuICAgIHZhciBkdXJhdGlvbiA9IDUwMDtcbiAgICB2YXIgYnV0dG9uID0gJCgnPGRpdiBjbGFzcz1cImFtLXNjcm9sbC10b3BcIj48L2Rpdj4nKTtcbiAgICBidXR0b24uYXBwZW5kVG8oXCJib2R5XCIpO1xuICAgIFxuICAgICQod2luZG93KS5vbignc2Nyb2xsJyxmdW5jdGlvbigpIHtcbiAgICAgIGlmICggJCh0aGlzKS5zY3JvbGxUb3AoKSA+IG9mZnNldCApIHtcbiAgICAgICAgYnV0dG9uLmZhZGVJbihkdXJhdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBidXR0b24uZmFkZU91dChkdXJhdGlvbik7XG4gICAgICB9XG4gICAgfSk7XG4gIFxuICAgIGJ1dHRvbi5vbigndG91Y2hzdGFydCBtb3VzZXVwJyxmdW5jdGlvbiggZSApIHtcbiAgICAgICQoICdodG1sLCBib2R5JyApLmFuaW1hdGUoeyBzY3JvbGxUb3A6IDAgfSwgZHVyYXRpb24pO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuICB9XG5cbiAgLy9XYWl0IGZvciBmaW5hbCBldmVudCBvbiB3aW5kb3cgcmVzaXplXG4gIHZhciB3YWl0Rm9yRmluYWxFdmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRpbWVycyA9IHt9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoY2FsbGJhY2ssIG1zLCB1bmlxdWVJZCkge1xuICAgICAgaWYgKCF1bmlxdWVJZCkge1xuICAgICAgICB1bmlxdWVJZCA9IFwieDF4MngzeDRcIjtcbiAgICAgIH1cbiAgICAgIGlmICh0aW1lcnNbdW5pcXVlSWRdKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCAodGltZXJzW3VuaXF1ZUlkXSk7XG4gICAgICB9XG4gICAgICB0aW1lcnNbdW5pcXVlSWRdID0gc2V0VGltZW91dChjYWxsYmFjaywgbXMpO1xuICAgIH07XG4gIH0pKCk7XG5cbiAgcmV0dXJuIHtcbiAgICAvL0dlbmVyYWwgZGF0YVxuICAgIGNvbmY6IGNvbmZpZyxcbiAgICBjb2xvcjogY29sb3JzLFxuXG4gICAgLy9Jbml0IGZ1bmN0aW9uXG4gICAgaW5pdDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgIFxuICAgICAgLy9FeHRlbmRzIGJhc2ljIGNvbmZpZyB3aXRoIG9wdGlvbnNcbiAgICAgICAgJC5leHRlbmQoIGNvbmZpZywgb3B0aW9ucyApO1xuXG4gICAgICAvKkZhc3RDbGljayBvbiBtb2JpbGUqL1xuICAgICAgICBGYXN0Q2xpY2suYXR0YWNoKGRvY3VtZW50LmJvZHkpO1xuXG4gICAgICAvKkxlZnQgU2lkZWJhciovXG4gICAgICAgIGxlZnRTaWRlYmFySW5pdCgpO1xuICAgICAgXG4gICAgICAvKlJpZ2h0IFNpZGViYXIqL1xuICAgICAgICByaWdodFNpZGViYXJJbml0KCk7XG4gICAgICAgIGNoYXRXaWRnZXQoKTtcblxuICAgICAgLypTaWRlYmFycyBTd2lwZSovXG4gICAgICAgIHNpZGViYXJTd2lwZSgpO1xuXG4gICAgICAvKkJvZHkgdHJhbnNpdGlvbiBlZmZlY3QqL1xuICAgICAgICBsZWZ0U2lkZWJhci5vbihcInRyYW5zaXRpb25lbmQgd2Via2l0VHJhbnNpdGlvbkVuZCBvVHJhbnNpdGlvbkVuZCBNU1RyYW5zaXRpb25FbmRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgYm9keS5yZW1vdmVDbGFzcyggY29uZmlnLnRyYW5zaXRpb25DbGFzcyApO1xuICAgICAgICB9KTtcblxuICAgICAgLypTY3JvbGwgVG9wIGJ1dHRvbiovXG4gICAgICAgIGlmKCBjb25maWcuc2Nyb2xsVG9wICl7XG4gICAgICAgICAgc2Nyb2xsVG9wQnV0dG9uKCk7XG4gICAgICAgIH1cblxuICAgICAgLypHZXQgY29sb3JzKi9cbiAgICAgICAgY29sb3JzLnByaW1hcnkgPSBnZXRDb2xvcignY2xyLXByaW1hcnknKTtcbiAgICAgICAgY29sb3JzLnN1Y2Nlc3MgPSBnZXRDb2xvcignY2xyLXN1Y2Nlc3MnKTtcbiAgICAgICAgY29sb3JzLmluZm8gICAgPSBnZXRDb2xvcignY2xyLWluZm8nKTtcbiAgICAgICAgY29sb3JzLndhcm5pbmcgPSBnZXRDb2xvcignY2xyLXdhcm5pbmcnKTtcbiAgICAgICAgY29sb3JzLmRhbmdlciAgPSBnZXRDb2xvcignY2xyLWRhbmdlcicpO1xuICAgICAgICBjb2xvcnMuYWx0MSAgICA9IGdldENvbG9yKCdjbHItYWx0MScpO1xuICAgICAgICBjb2xvcnMuYWx0MiAgICA9IGdldENvbG9yKCdjbHItYWx0MicpO1xuICAgICAgICBjb2xvcnMuYWx0MyAgICA9IGdldENvbG9yKCdjbHItYWx0MycpO1xuICAgICAgICBjb2xvcnMuYWx0NCAgICA9IGdldENvbG9yKCdjbHItYWx0NCcpO1xuXG4gICAgICAvL1ByZXZlbnQgQ29ubmVjdGlvbnMgRHJvcGRvd24gY2xvc2VzIG9uIGNsaWNrXG4gICAgICAgICQoXCIuYW0tY29ubmVjdGlvbnNcIikub24oXCJjbGlja1wiLGZ1bmN0aW9uKCBlICl7XG4gICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIC8vTmFub3Njcm9sbGVyIGluaXQgZnVuY3Rpb25cbiAgICAgICAgc2Nyb2xsZXJJbml0KCk7XG5cbiAgICAgIC8qQmluZCBwbHVnaW5zIG9uIGhpZGRlbiBlbGVtZW50cyovXG4gICAgICAvKkRyb3Bkb3duIHNob3duIGV2ZW50Ki9cbiAgICAgICAgJCgnLmRyb3Bkb3duJykub24oJ3Nob3duLmJzLmRyb3Bkb3duJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICQoXCIuYW0tc2Nyb2xsZXJcIikubmFub1Njcm9sbGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgIC8qVGFicyByZWZyZXNoIGhpZGRlbiBlbGVtZW50cyovXG4gICAgICAgICQoJy5uYXYtdGFicycpLm9uKCdzaG93bi5icy50YWInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICQoXCIuYW0tc2Nyb2xsZXJcIikubmFub1Njcm9sbGVyKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAvKlRvb2x0aXBzKi9cbiAgICAgICAgJCgnW2RhdGEtdG9nZ2xlPVwidG9vbHRpcFwiXScpLnRvb2x0aXAoKTtcbiAgICAgIFxuICAgICAgLypQb3BvdmVyKi9cbiAgICAgICAgJCgnW2RhdGEtdG9nZ2xlPVwicG9wb3ZlclwiXScpLnBvcG92ZXIoKTtcblxuICAgICAgLypCb290c3RyYXAgbW9kYWwgc2Nyb2xsIHRvcCBmaXgqL1xuICAgICAgICAkKCcubW9kYWwnKS5vbignc2hvdy5icy5tb2RhbCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgJChcImh0bWxcIikuYWRkQ2xhc3MoJ2FtLW1vZGFsLW9wZW4nKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLm1vZGFsJykub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgJChcImh0bWxcIikucmVtb3ZlQ2xhc3MoJ2FtLW1vZGFsLW9wZW4nKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8vTWV0aG9kc1xuICAgIGNsb3NlU3ViTWVudTogZnVuY3Rpb24oKXtcbiAgICAgIHZhciBzdWJNZW51ID0gJChcIi5zaWRlYmFyLWVsZW1lbnRzID4gbGkgPiB1bDp2aXNpYmxlXCIsIGxlZnRTaWRlYmFyKTtcbiAgICAgIHN1Yk1lbnUuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgc3ViTWVudS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgfSwgNTApO1xuICAgIH1cbiAgfTtcbiBcbn0pKCk7XG4vL0Zhc3RDbGlja1xuIWZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShiLGQpe2Z1bmN0aW9uIGUoYSxiKXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShiLGFyZ3VtZW50cyl9fXZhciBmO2lmKGQ9ZHx8e30sdGhpcy50cmFja2luZ0NsaWNrPSExLHRoaXMudHJhY2tpbmdDbGlja1N0YXJ0PTAsdGhpcy50YXJnZXRFbGVtZW50PW51bGwsdGhpcy50b3VjaFN0YXJ0WD0wLHRoaXMudG91Y2hTdGFydFk9MCx0aGlzLmxhc3RUb3VjaElkZW50aWZpZXI9MCx0aGlzLnRvdWNoQm91bmRhcnk9ZC50b3VjaEJvdW5kYXJ5fHwxMCx0aGlzLmxheWVyPWIsdGhpcy50YXBEZWxheT1kLnRhcERlbGF5fHwyMDAsdGhpcy50YXBUaW1lb3V0PWQudGFwVGltZW91dHx8NzAwLCFhLm5vdE5lZWRlZChiKSl7Zm9yKHZhciBnPVtcIm9uTW91c2VcIixcIm9uQ2xpY2tcIixcIm9uVG91Y2hTdGFydFwiLFwib25Ub3VjaE1vdmVcIixcIm9uVG91Y2hFbmRcIixcIm9uVG91Y2hDYW5jZWxcIl0saD10aGlzLGk9MCxqPWcubGVuZ3RoO2o+aTtpKyspaFtnW2ldXT1lKGhbZ1tpXV0saCk7YyYmKGIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLHRoaXMub25Nb3VzZSwhMCksYi5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsdGhpcy5vbk1vdXNlLCEwKSxiLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsdGhpcy5vbk1vdXNlLCEwKSksYi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIix0aGlzLm9uQ2xpY2ssITApLGIuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIix0aGlzLm9uVG91Y2hTdGFydCwhMSksYi5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsdGhpcy5vblRvdWNoTW92ZSwhMSksYi5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIix0aGlzLm9uVG91Y2hFbmQsITEpLGIuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoY2FuY2VsXCIsdGhpcy5vblRvdWNoQ2FuY2VsLCExKSxFdmVudC5wcm90b3R5cGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9ufHwoYi5yZW1vdmVFdmVudExpc3RlbmVyPWZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1Ob2RlLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyO1wiY2xpY2tcIj09PWE/ZS5jYWxsKGIsYSxjLmhpamFja2VkfHxjLGQpOmUuY2FsbChiLGEsYyxkKX0sYi5hZGRFdmVudExpc3RlbmVyPWZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1Ob2RlLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyO1wiY2xpY2tcIj09PWE/ZS5jYWxsKGIsYSxjLmhpamFja2VkfHwoYy5oaWphY2tlZD1mdW5jdGlvbihhKXthLnByb3BhZ2F0aW9uU3RvcHBlZHx8YyhhKX0pLGQpOmUuY2FsbChiLGEsYyxkKX0pLFwiZnVuY3Rpb25cIj09dHlwZW9mIGIub25jbGljayYmKGY9Yi5vbmNsaWNrLGIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsZnVuY3Rpb24oYSl7ZihhKX0sITEpLGIub25jbGljaz1udWxsKX19dmFyIGI9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiV2luZG93cyBQaG9uZVwiKT49MCxjPW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIkFuZHJvaWRcIik+MCYmIWIsZD0vaVAoYWR8aG9uZXxvZCkvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkmJiFiLGU9ZCYmL09TIDRfXFxkKF9cXGQpPy8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSxmPWQmJi9PUyBbNi03XV9cXGQvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCksZz1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJCQjEwXCIpPjA7YS5wcm90b3R5cGUubmVlZHNDbGljaz1mdW5jdGlvbihhKXtzd2l0Y2goYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKXtjYXNlXCJidXR0b25cIjpjYXNlXCJzZWxlY3RcIjpjYXNlXCJ0ZXh0YXJlYVwiOmlmKGEuZGlzYWJsZWQpcmV0dXJuITA7YnJlYWs7Y2FzZVwiaW5wdXRcIjppZihkJiZcImZpbGVcIj09PWEudHlwZXx8YS5kaXNhYmxlZClyZXR1cm4hMDticmVhaztjYXNlXCJsYWJlbFwiOmNhc2VcImlmcmFtZVwiOmNhc2VcInZpZGVvXCI6cmV0dXJuITB9cmV0dXJuL1xcYm5lZWRzY2xpY2tcXGIvLnRlc3QoYS5jbGFzc05hbWUpfSxhLnByb3RvdHlwZS5uZWVkc0ZvY3VzPWZ1bmN0aW9uKGEpe3N3aXRjaChhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpe2Nhc2VcInRleHRhcmVhXCI6cmV0dXJuITA7Y2FzZVwic2VsZWN0XCI6cmV0dXJuIWM7Y2FzZVwiaW5wdXRcIjpzd2l0Y2goYS50eXBlKXtjYXNlXCJidXR0b25cIjpjYXNlXCJjaGVja2JveFwiOmNhc2VcImZpbGVcIjpjYXNlXCJpbWFnZVwiOmNhc2VcInJhZGlvXCI6Y2FzZVwic3VibWl0XCI6cmV0dXJuITF9cmV0dXJuIWEuZGlzYWJsZWQmJiFhLnJlYWRPbmx5O2RlZmF1bHQ6cmV0dXJuL1xcYm5lZWRzZm9jdXNcXGIvLnRlc3QoYS5jbGFzc05hbWUpfX0sYS5wcm90b3R5cGUuc2VuZENsaWNrPWZ1bmN0aW9uKGEsYil7dmFyIGMsZDtkb2N1bWVudC5hY3RpdmVFbGVtZW50JiZkb2N1bWVudC5hY3RpdmVFbGVtZW50IT09YSYmZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCksZD1iLmNoYW5nZWRUb3VjaGVzWzBdLGM9ZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJNb3VzZUV2ZW50c1wiKSxjLmluaXRNb3VzZUV2ZW50KHRoaXMuZGV0ZXJtaW5lRXZlbnRUeXBlKGEpLCEwLCEwLHdpbmRvdywxLGQuc2NyZWVuWCxkLnNjcmVlblksZC5jbGllbnRYLGQuY2xpZW50WSwhMSwhMSwhMSwhMSwwLG51bGwpLGMuZm9yd2FyZGVkVG91Y2hFdmVudD0hMCxhLmRpc3BhdGNoRXZlbnQoYyl9LGEucHJvdG90eXBlLmRldGVybWluZUV2ZW50VHlwZT1mdW5jdGlvbihhKXtyZXR1cm4gYyYmXCJzZWxlY3RcIj09PWEudGFnTmFtZS50b0xvd2VyQ2FzZSgpP1wibW91c2Vkb3duXCI6XCJjbGlja1wifSxhLnByb3RvdHlwZS5mb2N1cz1mdW5jdGlvbihhKXt2YXIgYjtkJiZhLnNldFNlbGVjdGlvblJhbmdlJiYwIT09YS50eXBlLmluZGV4T2YoXCJkYXRlXCIpJiZcInRpbWVcIiE9PWEudHlwZSYmXCJtb250aFwiIT09YS50eXBlPyhiPWEudmFsdWUubGVuZ3RoLGEuc2V0U2VsZWN0aW9uUmFuZ2UoYixiKSk6YS5mb2N1cygpfSxhLnByb3RvdHlwZS51cGRhdGVTY3JvbGxQYXJlbnQ9ZnVuY3Rpb24oYSl7dmFyIGIsYztpZihiPWEuZmFzdENsaWNrU2Nyb2xsUGFyZW50LCFifHwhYi5jb250YWlucyhhKSl7Yz1hO2Rve2lmKGMuc2Nyb2xsSGVpZ2h0PmMub2Zmc2V0SGVpZ2h0KXtiPWMsYS5mYXN0Q2xpY2tTY3JvbGxQYXJlbnQ9YzticmVha31jPWMucGFyZW50RWxlbWVudH13aGlsZShjKX1iJiYoYi5mYXN0Q2xpY2tMYXN0U2Nyb2xsVG9wPWIuc2Nyb2xsVG9wKX0sYS5wcm90b3R5cGUuZ2V0VGFyZ2V0RWxlbWVudEZyb21FdmVudFRhcmdldD1mdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlVHlwZT09PU5vZGUuVEVYVF9OT0RFP2EucGFyZW50Tm9kZTphfSxhLnByb3RvdHlwZS5vblRvdWNoU3RhcnQ9ZnVuY3Rpb24oYSl7dmFyIGIsYyxmO2lmKGEudGFyZ2V0VG91Y2hlcy5sZW5ndGg+MSlyZXR1cm4hMDtpZihiPXRoaXMuZ2V0VGFyZ2V0RWxlbWVudEZyb21FdmVudFRhcmdldChhLnRhcmdldCksYz1hLnRhcmdldFRvdWNoZXNbMF0sZCl7aWYoZj13aW5kb3cuZ2V0U2VsZWN0aW9uKCksZi5yYW5nZUNvdW50JiYhZi5pc0NvbGxhcHNlZClyZXR1cm4hMDtpZighZSl7aWYoYy5pZGVudGlmaWVyJiZjLmlkZW50aWZpZXI9PT10aGlzLmxhc3RUb3VjaElkZW50aWZpZXIpcmV0dXJuIGEucHJldmVudERlZmF1bHQoKSwhMTt0aGlzLmxhc3RUb3VjaElkZW50aWZpZXI9Yy5pZGVudGlmaWVyLHRoaXMudXBkYXRlU2Nyb2xsUGFyZW50KGIpfX1yZXR1cm4gdGhpcy50cmFja2luZ0NsaWNrPSEwLHRoaXMudHJhY2tpbmdDbGlja1N0YXJ0PWEudGltZVN0YW1wLHRoaXMudGFyZ2V0RWxlbWVudD1iLHRoaXMudG91Y2hTdGFydFg9Yy5wYWdlWCx0aGlzLnRvdWNoU3RhcnRZPWMucGFnZVksYS50aW1lU3RhbXAtdGhpcy5sYXN0Q2xpY2tUaW1lPHRoaXMudGFwRGVsYXkmJmEucHJldmVudERlZmF1bHQoKSwhMH0sYS5wcm90b3R5cGUudG91Y2hIYXNNb3ZlZD1mdW5jdGlvbihhKXt2YXIgYj1hLmNoYW5nZWRUb3VjaGVzWzBdLGM9dGhpcy50b3VjaEJvdW5kYXJ5O3JldHVybiBNYXRoLmFicyhiLnBhZ2VYLXRoaXMudG91Y2hTdGFydFgpPmN8fE1hdGguYWJzKGIucGFnZVktdGhpcy50b3VjaFN0YXJ0WSk+Yz8hMDohMX0sYS5wcm90b3R5cGUub25Ub3VjaE1vdmU9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMudHJhY2tpbmdDbGljaz8oKHRoaXMudGFyZ2V0RWxlbWVudCE9PXRoaXMuZ2V0VGFyZ2V0RWxlbWVudEZyb21FdmVudFRhcmdldChhLnRhcmdldCl8fHRoaXMudG91Y2hIYXNNb3ZlZChhKSkmJih0aGlzLnRyYWNraW5nQ2xpY2s9ITEsdGhpcy50YXJnZXRFbGVtZW50PW51bGwpLCEwKTohMH0sYS5wcm90b3R5cGUuZmluZENvbnRyb2w9ZnVuY3Rpb24oYSl7cmV0dXJuIHZvaWQgMCE9PWEuY29udHJvbD9hLmNvbnRyb2w6YS5odG1sRm9yP2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKGEuaHRtbEZvcik6YS5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLCBpbnB1dDpub3QoW3R5cGU9aGlkZGVuXSksIGtleWdlbiwgbWV0ZXIsIG91dHB1dCwgcHJvZ3Jlc3MsIHNlbGVjdCwgdGV4dGFyZWFcIil9LGEucHJvdG90eXBlLm9uVG91Y2hFbmQ9ZnVuY3Rpb24oYSl7dmFyIGIsZyxoLGksaixrPXRoaXMudGFyZ2V0RWxlbWVudDtpZighdGhpcy50cmFja2luZ0NsaWNrKXJldHVybiEwO2lmKGEudGltZVN0YW1wLXRoaXMubGFzdENsaWNrVGltZTx0aGlzLnRhcERlbGF5KXJldHVybiB0aGlzLmNhbmNlbE5leHRDbGljaz0hMCwhMDtpZihhLnRpbWVTdGFtcC10aGlzLnRyYWNraW5nQ2xpY2tTdGFydD50aGlzLnRhcFRpbWVvdXQpcmV0dXJuITA7aWYodGhpcy5jYW5jZWxOZXh0Q2xpY2s9ITEsdGhpcy5sYXN0Q2xpY2tUaW1lPWEudGltZVN0YW1wLGc9dGhpcy50cmFja2luZ0NsaWNrU3RhcnQsdGhpcy50cmFja2luZ0NsaWNrPSExLHRoaXMudHJhY2tpbmdDbGlja1N0YXJ0PTAsZiYmKGo9YS5jaGFuZ2VkVG91Y2hlc1swXSxrPWRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoai5wYWdlWC13aW5kb3cucGFnZVhPZmZzZXQsai5wYWdlWS13aW5kb3cucGFnZVlPZmZzZXQpfHxrLGsuZmFzdENsaWNrU2Nyb2xsUGFyZW50PXRoaXMudGFyZ2V0RWxlbWVudC5mYXN0Q2xpY2tTY3JvbGxQYXJlbnQpLGg9ay50YWdOYW1lLnRvTG93ZXJDYXNlKCksXCJsYWJlbFwiPT09aCl7aWYoYj10aGlzLmZpbmRDb250cm9sKGspKXtpZih0aGlzLmZvY3VzKGspLGMpcmV0dXJuITE7az1ifX1lbHNlIGlmKHRoaXMubmVlZHNGb2N1cyhrKSlyZXR1cm4gYS50aW1lU3RhbXAtZz4xMDB8fGQmJndpbmRvdy50b3AhPT13aW5kb3cmJlwiaW5wdXRcIj09PWg/KHRoaXMudGFyZ2V0RWxlbWVudD1udWxsLCExKToodGhpcy5mb2N1cyhrKSx0aGlzLnNlbmRDbGljayhrLGEpLGQmJlwic2VsZWN0XCI9PT1ofHwodGhpcy50YXJnZXRFbGVtZW50PW51bGwsYS5wcmV2ZW50RGVmYXVsdCgpKSwhMSk7cmV0dXJuIGQmJiFlJiYoaT1rLmZhc3RDbGlja1Njcm9sbFBhcmVudCxpJiZpLmZhc3RDbGlja0xhc3RTY3JvbGxUb3AhPT1pLnNjcm9sbFRvcCk/ITA6KHRoaXMubmVlZHNDbGljayhrKXx8KGEucHJldmVudERlZmF1bHQoKSx0aGlzLnNlbmRDbGljayhrLGEpKSwhMSl9LGEucHJvdG90eXBlLm9uVG91Y2hDYW5jZWw9ZnVuY3Rpb24oKXt0aGlzLnRyYWNraW5nQ2xpY2s9ITEsdGhpcy50YXJnZXRFbGVtZW50PW51bGx9LGEucHJvdG90eXBlLm9uTW91c2U9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMudGFyZ2V0RWxlbWVudD9hLmZvcndhcmRlZFRvdWNoRXZlbnQ/ITA6YS5jYW5jZWxhYmxlJiYoIXRoaXMubmVlZHNDbGljayh0aGlzLnRhcmdldEVsZW1lbnQpfHx0aGlzLmNhbmNlbE5leHRDbGljayk/KGEuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uP2Euc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk6YS5wcm9wYWdhdGlvblN0b3BwZWQ9ITAsYS5zdG9wUHJvcGFnYXRpb24oKSxhLnByZXZlbnREZWZhdWx0KCksITEpOiEwOiEwfSxhLnByb3RvdHlwZS5vbkNsaWNrPWZ1bmN0aW9uKGEpe3ZhciBiO3JldHVybiB0aGlzLnRyYWNraW5nQ2xpY2s/KHRoaXMudGFyZ2V0RWxlbWVudD1udWxsLHRoaXMudHJhY2tpbmdDbGljaz0hMSwhMCk6XCJzdWJtaXRcIj09PWEudGFyZ2V0LnR5cGUmJjA9PT1hLmRldGFpbD8hMDooYj10aGlzLm9uTW91c2UoYSksYnx8KHRoaXMudGFyZ2V0RWxlbWVudD1udWxsKSxiKX0sYS5wcm90b3R5cGUuZGVzdHJveT1mdW5jdGlvbigpe3ZhciBhPXRoaXMubGF5ZXI7YyYmKGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLHRoaXMub25Nb3VzZSwhMCksYS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsdGhpcy5vbk1vdXNlLCEwKSxhLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsdGhpcy5vbk1vdXNlLCEwKSksYS5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIix0aGlzLm9uQ2xpY2ssITApLGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIix0aGlzLm9uVG91Y2hTdGFydCwhMSksYS5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsdGhpcy5vblRvdWNoTW92ZSwhMSksYS5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIix0aGlzLm9uVG91Y2hFbmQsITEpLGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoY2FuY2VsXCIsdGhpcy5vblRvdWNoQ2FuY2VsLCExKX0sYS5ub3ROZWVkZWQ9ZnVuY3Rpb24oYSl7dmFyIGIsZCxlLGY7aWYoXCJ1bmRlZmluZWRcIj09dHlwZW9mIHdpbmRvdy5vbnRvdWNoc3RhcnQpcmV0dXJuITA7aWYoZD0rKC9DaHJvbWVcXC8oWzAtOV0rKS8uZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50KXx8WywwXSlbMV0pe2lmKCFjKXJldHVybiEwO2lmKGI9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1ldGFbbmFtZT12aWV3cG9ydF1cIikpe2lmKC0xIT09Yi5jb250ZW50LmluZGV4T2YoXCJ1c2VyLXNjYWxhYmxlPW5vXCIpKXJldHVybiEwO2lmKGQ+MzEmJmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxXaWR0aDw9d2luZG93Lm91dGVyV2lkdGgpcmV0dXJuITB9fWlmKGcmJihlPW5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL1ZlcnNpb25cXC8oWzAtOV0qKVxcLihbMC05XSopLyksZVsxXT49MTAmJmVbMl0+PTMmJihiPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtZXRhW25hbWU9dmlld3BvcnRdXCIpKSkpe2lmKC0xIT09Yi5jb250ZW50LmluZGV4T2YoXCJ1c2VyLXNjYWxhYmxlPW5vXCIpKXJldHVybiEwO2lmKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxXaWR0aDw9d2luZG93Lm91dGVyV2lkdGgpcmV0dXJuITB9cmV0dXJuXCJub25lXCI9PT1hLnN0eWxlLm1zVG91Y2hBY3Rpb258fFwibWFuaXB1bGF0aW9uXCI9PT1hLnN0eWxlLnRvdWNoQWN0aW9uPyEwOihmPSsoL0ZpcmVmb3hcXC8oWzAtOV0rKS8uZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50KXx8WywwXSlbMV0sZj49MjcmJihiPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtZXRhW25hbWU9dmlld3BvcnRdXCIpLGImJigtMSE9PWIuY29udGVudC5pbmRleE9mKFwidXNlci1zY2FsYWJsZT1ub1wiKXx8ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFdpZHRoPD13aW5kb3cub3V0ZXJXaWR0aCkpPyEwOlwibm9uZVwiPT09YS5zdHlsZS50b3VjaEFjdGlvbnx8XCJtYW5pcHVsYXRpb25cIj09PWEuc3R5bGUudG91Y2hBY3Rpb24/ITA6ITEpfSxhLmF0dGFjaD1mdW5jdGlvbihiLGMpe3JldHVybiBuZXcgYShiLGMpfSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJlwib2JqZWN0XCI9PXR5cGVvZiBkZWZpbmUuYW1kJiZkZWZpbmUuYW1kP2RlZmluZShmdW5jdGlvbigpe3JldHVybiBhfSk6XCJ1bmRlZmluZWRcIiE9dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/KG1vZHVsZS5leHBvcnRzPWEuYXR0YWNoLG1vZHVsZS5leHBvcnRzLkZhc3RDbGljaz1hKTp3aW5kb3cuRmFzdENsaWNrPWF9KCk7XG4vLyBUaW55Q29sb3IgdjEuMi4xXG4vLyBodHRwczovL2dpdGh1Yi5jb20vYmdyaW5zL1RpbnlDb2xvclxuLy8gMjAxNS0wOC0xMywgQnJpYW4gR3JpbnN0ZWFkLCBNSVQgTGljZW5zZVxuIWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdGlueWNvbG9yKGNvbG9yLG9wdHMpe2lmKGNvbG9yPWNvbG9yP2NvbG9yOlwiXCIsb3B0cz1vcHRzfHx7fSxjb2xvciBpbnN0YW5jZW9mIHRpbnljb2xvcilyZXR1cm4gY29sb3I7aWYoISh0aGlzIGluc3RhbmNlb2YgdGlueWNvbG9yKSlyZXR1cm4gbmV3IHRpbnljb2xvcihjb2xvcixvcHRzKTt2YXIgcmdiPWlucHV0VG9SR0IoY29sb3IpO3RoaXMuX29yaWdpbmFsSW5wdXQ9Y29sb3IsdGhpcy5fcj1yZ2Iucix0aGlzLl9nPXJnYi5nLHRoaXMuX2I9cmdiLmIsdGhpcy5fYT1yZ2IuYSx0aGlzLl9yb3VuZEE9bWF0aFJvdW5kKDEwMCp0aGlzLl9hKS8xMDAsdGhpcy5fZm9ybWF0PW9wdHMuZm9ybWF0fHxyZ2IuZm9ybWF0LHRoaXMuX2dyYWRpZW50VHlwZT1vcHRzLmdyYWRpZW50VHlwZSx0aGlzLl9yPDEmJih0aGlzLl9yPW1hdGhSb3VuZCh0aGlzLl9yKSksdGhpcy5fZzwxJiYodGhpcy5fZz1tYXRoUm91bmQodGhpcy5fZykpLHRoaXMuX2I8MSYmKHRoaXMuX2I9bWF0aFJvdW5kKHRoaXMuX2IpKSx0aGlzLl9vaz1yZ2Iub2ssdGhpcy5fdGNfaWQ9dGlueUNvdW50ZXIrK31mdW5jdGlvbiBpbnB1dFRvUkdCKGNvbG9yKXt2YXIgcmdiPXtyOjAsZzowLGI6MH0sYT0xLG9rPSExLGZvcm1hdD0hMTtyZXR1cm5cInN0cmluZ1wiPT10eXBlb2YgY29sb3ImJihjb2xvcj1zdHJpbmdJbnB1dFRvT2JqZWN0KGNvbG9yKSksXCJvYmplY3RcIj09dHlwZW9mIGNvbG9yJiYoY29sb3IuaGFzT3duUHJvcGVydHkoXCJyXCIpJiZjb2xvci5oYXNPd25Qcm9wZXJ0eShcImdcIikmJmNvbG9yLmhhc093blByb3BlcnR5KFwiYlwiKT8ocmdiPXJnYlRvUmdiKGNvbG9yLnIsY29sb3IuZyxjb2xvci5iKSxvaz0hMCxmb3JtYXQ9XCIlXCI9PT1TdHJpbmcoY29sb3Iucikuc3Vic3RyKC0xKT9cInByZ2JcIjpcInJnYlwiKTpjb2xvci5oYXNPd25Qcm9wZXJ0eShcImhcIikmJmNvbG9yLmhhc093blByb3BlcnR5KFwic1wiKSYmY29sb3IuaGFzT3duUHJvcGVydHkoXCJ2XCIpPyhjb2xvci5zPWNvbnZlcnRUb1BlcmNlbnRhZ2UoY29sb3IucyksY29sb3Iudj1jb252ZXJ0VG9QZXJjZW50YWdlKGNvbG9yLnYpLHJnYj1oc3ZUb1JnYihjb2xvci5oLGNvbG9yLnMsY29sb3Iudiksb2s9ITAsZm9ybWF0PVwiaHN2XCIpOmNvbG9yLmhhc093blByb3BlcnR5KFwiaFwiKSYmY29sb3IuaGFzT3duUHJvcGVydHkoXCJzXCIpJiZjb2xvci5oYXNPd25Qcm9wZXJ0eShcImxcIikmJihjb2xvci5zPWNvbnZlcnRUb1BlcmNlbnRhZ2UoY29sb3IucyksY29sb3IubD1jb252ZXJ0VG9QZXJjZW50YWdlKGNvbG9yLmwpLHJnYj1oc2xUb1JnYihjb2xvci5oLGNvbG9yLnMsY29sb3IubCksb2s9ITAsZm9ybWF0PVwiaHNsXCIpLGNvbG9yLmhhc093blByb3BlcnR5KFwiYVwiKSYmKGE9Y29sb3IuYSkpLGE9Ym91bmRBbHBoYShhKSx7b2s6b2ssZm9ybWF0OmNvbG9yLmZvcm1hdHx8Zm9ybWF0LHI6bWF0aE1pbigyNTUsbWF0aE1heChyZ2IuciwwKSksZzptYXRoTWluKDI1NSxtYXRoTWF4KHJnYi5nLDApKSxiOm1hdGhNaW4oMjU1LG1hdGhNYXgocmdiLmIsMCkpLGE6YX19ZnVuY3Rpb24gcmdiVG9SZ2IocixnLGIpe3JldHVybntyOjI1NSpib3VuZDAxKHIsMjU1KSxnOjI1NSpib3VuZDAxKGcsMjU1KSxiOjI1NSpib3VuZDAxKGIsMjU1KX19ZnVuY3Rpb24gcmdiVG9Ic2wocixnLGIpe3I9Ym91bmQwMShyLDI1NSksZz1ib3VuZDAxKGcsMjU1KSxiPWJvdW5kMDEoYiwyNTUpO3ZhciBoLHMsbWF4PW1hdGhNYXgocixnLGIpLG1pbj1tYXRoTWluKHIsZyxiKSxsPShtYXgrbWluKS8yO2lmKG1heD09bWluKWg9cz0wO2Vsc2V7dmFyIGQ9bWF4LW1pbjtzd2l0Y2gocz1sPi41P2QvKDItbWF4LW1pbik6ZC8obWF4K21pbiksbWF4KXtjYXNlIHI6aD0oZy1iKS9kKyhiPmc/NjowKTticmVhaztjYXNlIGc6aD0oYi1yKS9kKzI7YnJlYWs7Y2FzZSBiOmg9KHItZykvZCs0fWgvPTZ9cmV0dXJue2g6aCxzOnMsbDpsfX1mdW5jdGlvbiBoc2xUb1JnYihoLHMsbCl7ZnVuY3Rpb24gaHVlMnJnYihwLHEsdCl7cmV0dXJuIDA+dCYmKHQrPTEpLHQ+MSYmKHQtPTEpLDEvNj50P3ArNioocS1wKSp0Oi41PnQ/cToyLzM+dD9wKzYqKHEtcCkqKDIvMy10KTpwfXZhciByLGcsYjtpZihoPWJvdW5kMDEoaCwzNjApLHM9Ym91bmQwMShzLDEwMCksbD1ib3VuZDAxKGwsMTAwKSwwPT09cylyPWc9Yj1sO2Vsc2V7dmFyIHE9LjU+bD9sKigxK3MpOmwrcy1sKnMscD0yKmwtcTtyPWh1ZTJyZ2IocCxxLGgrMS8zKSxnPWh1ZTJyZ2IocCxxLGgpLGI9aHVlMnJnYihwLHEsaC0xLzMpfXJldHVybntyOjI1NSpyLGc6MjU1KmcsYjoyNTUqYn19ZnVuY3Rpb24gcmdiVG9Ic3YocixnLGIpe3I9Ym91bmQwMShyLDI1NSksZz1ib3VuZDAxKGcsMjU1KSxiPWJvdW5kMDEoYiwyNTUpO3ZhciBoLHMsbWF4PW1hdGhNYXgocixnLGIpLG1pbj1tYXRoTWluKHIsZyxiKSx2PW1heCxkPW1heC1taW47aWYocz0wPT09bWF4PzA6ZC9tYXgsbWF4PT1taW4paD0wO2Vsc2V7c3dpdGNoKG1heCl7Y2FzZSByOmg9KGctYikvZCsoYj5nPzY6MCk7YnJlYWs7Y2FzZSBnOmg9KGItcikvZCsyO2JyZWFrO2Nhc2UgYjpoPShyLWcpL2QrNH1oLz02fXJldHVybntoOmgsczpzLHY6dn19ZnVuY3Rpb24gaHN2VG9SZ2IoaCxzLHYpe2g9Nipib3VuZDAxKGgsMzYwKSxzPWJvdW5kMDEocywxMDApLHY9Ym91bmQwMSh2LDEwMCk7dmFyIGk9bWF0aC5mbG9vcihoKSxmPWgtaSxwPXYqKDEtcykscT12KigxLWYqcyksdD12KigxLSgxLWYpKnMpLG1vZD1pJTYscj1bdixxLHAscCx0LHZdW21vZF0sZz1bdCx2LHYscSxwLHBdW21vZF0sYj1bcCxwLHQsdix2LHFdW21vZF07cmV0dXJue3I6MjU1KnIsZzoyNTUqZyxiOjI1NSpifX1mdW5jdGlvbiByZ2JUb0hleChyLGcsYixhbGxvdzNDaGFyKXt2YXIgaGV4PVtwYWQyKG1hdGhSb3VuZChyKS50b1N0cmluZygxNikpLHBhZDIobWF0aFJvdW5kKGcpLnRvU3RyaW5nKDE2KSkscGFkMihtYXRoUm91bmQoYikudG9TdHJpbmcoMTYpKV07cmV0dXJuIGFsbG93M0NoYXImJmhleFswXS5jaGFyQXQoMCk9PWhleFswXS5jaGFyQXQoMSkmJmhleFsxXS5jaGFyQXQoMCk9PWhleFsxXS5jaGFyQXQoMSkmJmhleFsyXS5jaGFyQXQoMCk9PWhleFsyXS5jaGFyQXQoMSk/aGV4WzBdLmNoYXJBdCgwKStoZXhbMV0uY2hhckF0KDApK2hleFsyXS5jaGFyQXQoMCk6aGV4LmpvaW4oXCJcIil9ZnVuY3Rpb24gcmdiYVRvSGV4KHIsZyxiLGEpe3ZhciBoZXg9W3BhZDIoY29udmVydERlY2ltYWxUb0hleChhKSkscGFkMihtYXRoUm91bmQocikudG9TdHJpbmcoMTYpKSxwYWQyKG1hdGhSb3VuZChnKS50b1N0cmluZygxNikpLHBhZDIobWF0aFJvdW5kKGIpLnRvU3RyaW5nKDE2KSldO3JldHVybiBoZXguam9pbihcIlwiKX1mdW5jdGlvbiBkZXNhdHVyYXRlKGNvbG9yLGFtb3VudCl7YW1vdW50PTA9PT1hbW91bnQ/MDphbW91bnR8fDEwO3ZhciBoc2w9dGlueWNvbG9yKGNvbG9yKS50b0hzbCgpO3JldHVybiBoc2wucy09YW1vdW50LzEwMCxoc2wucz1jbGFtcDAxKGhzbC5zKSx0aW55Y29sb3IoaHNsKX1mdW5jdGlvbiBzYXR1cmF0ZShjb2xvcixhbW91bnQpe2Ftb3VudD0wPT09YW1vdW50PzA6YW1vdW50fHwxMDt2YXIgaHNsPXRpbnljb2xvcihjb2xvcikudG9Ic2woKTtyZXR1cm4gaHNsLnMrPWFtb3VudC8xMDAsaHNsLnM9Y2xhbXAwMShoc2wucyksdGlueWNvbG9yKGhzbCl9ZnVuY3Rpb24gZ3JleXNjYWxlKGNvbG9yKXtyZXR1cm4gdGlueWNvbG9yKGNvbG9yKS5kZXNhdHVyYXRlKDEwMCl9ZnVuY3Rpb24gbGlnaHRlbihjb2xvcixhbW91bnQpe2Ftb3VudD0wPT09YW1vdW50PzA6YW1vdW50fHwxMDt2YXIgaHNsPXRpbnljb2xvcihjb2xvcikudG9Ic2woKTtyZXR1cm4gaHNsLmwrPWFtb3VudC8xMDAsaHNsLmw9Y2xhbXAwMShoc2wubCksdGlueWNvbG9yKGhzbCl9ZnVuY3Rpb24gYnJpZ2h0ZW4oY29sb3IsYW1vdW50KXthbW91bnQ9MD09PWFtb3VudD8wOmFtb3VudHx8MTA7dmFyIHJnYj10aW55Y29sb3IoY29sb3IpLnRvUmdiKCk7cmV0dXJuIHJnYi5yPW1hdGhNYXgoMCxtYXRoTWluKDI1NSxyZ2Iuci1tYXRoUm91bmQoMjU1Ki0oYW1vdW50LzEwMCkpKSkscmdiLmc9bWF0aE1heCgwLG1hdGhNaW4oMjU1LHJnYi5nLW1hdGhSb3VuZCgyNTUqLShhbW91bnQvMTAwKSkpKSxyZ2IuYj1tYXRoTWF4KDAsbWF0aE1pbigyNTUscmdiLmItbWF0aFJvdW5kKDI1NSotKGFtb3VudC8xMDApKSkpLHRpbnljb2xvcihyZ2IpfWZ1bmN0aW9uIGRhcmtlbihjb2xvcixhbW91bnQpe2Ftb3VudD0wPT09YW1vdW50PzA6YW1vdW50fHwxMDt2YXIgaHNsPXRpbnljb2xvcihjb2xvcikudG9Ic2woKTtyZXR1cm4gaHNsLmwtPWFtb3VudC8xMDAsaHNsLmw9Y2xhbXAwMShoc2wubCksdGlueWNvbG9yKGhzbCl9ZnVuY3Rpb24gc3Bpbihjb2xvcixhbW91bnQpe3ZhciBoc2w9dGlueWNvbG9yKGNvbG9yKS50b0hzbCgpLGh1ZT0obWF0aFJvdW5kKGhzbC5oKSthbW91bnQpJTM2MDtyZXR1cm4gaHNsLmg9MD5odWU/MzYwK2h1ZTpodWUsdGlueWNvbG9yKGhzbCl9ZnVuY3Rpb24gY29tcGxlbWVudChjb2xvcil7dmFyIGhzbD10aW55Y29sb3IoY29sb3IpLnRvSHNsKCk7cmV0dXJuIGhzbC5oPShoc2wuaCsxODApJTM2MCx0aW55Y29sb3IoaHNsKX1mdW5jdGlvbiB0cmlhZChjb2xvcil7dmFyIGhzbD10aW55Y29sb3IoY29sb3IpLnRvSHNsKCksaD1oc2wuaDtyZXR1cm5bdGlueWNvbG9yKGNvbG9yKSx0aW55Y29sb3Ioe2g6KGgrMTIwKSUzNjAsczpoc2wucyxsOmhzbC5sfSksdGlueWNvbG9yKHtoOihoKzI0MCklMzYwLHM6aHNsLnMsbDpoc2wubH0pXX1mdW5jdGlvbiB0ZXRyYWQoY29sb3Ipe3ZhciBoc2w9dGlueWNvbG9yKGNvbG9yKS50b0hzbCgpLGg9aHNsLmg7cmV0dXJuW3Rpbnljb2xvcihjb2xvciksdGlueWNvbG9yKHtoOihoKzkwKSUzNjAsczpoc2wucyxsOmhzbC5sfSksdGlueWNvbG9yKHtoOihoKzE4MCklMzYwLHM6aHNsLnMsbDpoc2wubH0pLHRpbnljb2xvcih7aDooaCsyNzApJTM2MCxzOmhzbC5zLGw6aHNsLmx9KV19ZnVuY3Rpb24gc3BsaXRjb21wbGVtZW50KGNvbG9yKXt2YXIgaHNsPXRpbnljb2xvcihjb2xvcikudG9Ic2woKSxoPWhzbC5oO3JldHVyblt0aW55Y29sb3IoY29sb3IpLHRpbnljb2xvcih7aDooaCs3MiklMzYwLHM6aHNsLnMsbDpoc2wubH0pLHRpbnljb2xvcih7aDooaCsyMTYpJTM2MCxzOmhzbC5zLGw6aHNsLmx9KV19ZnVuY3Rpb24gYW5hbG9nb3VzKGNvbG9yLHJlc3VsdHMsc2xpY2VzKXtyZXN1bHRzPXJlc3VsdHN8fDYsc2xpY2VzPXNsaWNlc3x8MzA7dmFyIGhzbD10aW55Y29sb3IoY29sb3IpLnRvSHNsKCkscGFydD0zNjAvc2xpY2VzLHJldD1bdGlueWNvbG9yKGNvbG9yKV07Zm9yKGhzbC5oPShoc2wuaC0ocGFydCpyZXN1bHRzPj4xKSs3MjApJTM2MDstLXJlc3VsdHM7KWhzbC5oPShoc2wuaCtwYXJ0KSUzNjAscmV0LnB1c2godGlueWNvbG9yKGhzbCkpO3JldHVybiByZXR9ZnVuY3Rpb24gbW9ub2Nocm9tYXRpYyhjb2xvcixyZXN1bHRzKXtyZXN1bHRzPXJlc3VsdHN8fDY7Zm9yKHZhciBoc3Y9dGlueWNvbG9yKGNvbG9yKS50b0hzdigpLGg9aHN2Lmgscz1oc3Yucyx2PWhzdi52LHJldD1bXSxtb2RpZmljYXRpb249MS9yZXN1bHRzO3Jlc3VsdHMtLTspcmV0LnB1c2godGlueWNvbG9yKHtoOmgsczpzLHY6dn0pKSx2PSh2K21vZGlmaWNhdGlvbiklMTtyZXR1cm4gcmV0fWZ1bmN0aW9uIGZsaXAobyl7dmFyIGZsaXBwZWQ9e307Zm9yKHZhciBpIGluIG8pby5oYXNPd25Qcm9wZXJ0eShpKSYmKGZsaXBwZWRbb1tpXV09aSk7cmV0dXJuIGZsaXBwZWR9ZnVuY3Rpb24gYm91bmRBbHBoYShhKXtyZXR1cm4gYT1wYXJzZUZsb2F0KGEpLChpc05hTihhKXx8MD5hfHxhPjEpJiYoYT0xKSxhfWZ1bmN0aW9uIGJvdW5kMDEobixtYXgpe2lzT25lUG9pbnRaZXJvKG4pJiYobj1cIjEwMCVcIik7dmFyIHByb2Nlc3NQZXJjZW50PWlzUGVyY2VudGFnZShuKTtyZXR1cm4gbj1tYXRoTWluKG1heCxtYXRoTWF4KDAscGFyc2VGbG9hdChuKSkpLHByb2Nlc3NQZXJjZW50JiYobj1wYXJzZUludChuKm1heCwxMCkvMTAwKSxtYXRoLmFicyhuLW1heCk8MWUtNj8xOm4lbWF4L3BhcnNlRmxvYXQobWF4KX1mdW5jdGlvbiBjbGFtcDAxKHZhbCl7cmV0dXJuIG1hdGhNaW4oMSxtYXRoTWF4KDAsdmFsKSl9ZnVuY3Rpb24gcGFyc2VJbnRGcm9tSGV4KHZhbCl7cmV0dXJuIHBhcnNlSW50KHZhbCwxNil9ZnVuY3Rpb24gaXNPbmVQb2ludFplcm8obil7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIG4mJi0xIT1uLmluZGV4T2YoXCIuXCIpJiYxPT09cGFyc2VGbG9hdChuKX1mdW5jdGlvbiBpc1BlcmNlbnRhZ2Uobil7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIG4mJi0xIT1uLmluZGV4T2YoXCIlXCIpfWZ1bmN0aW9uIHBhZDIoYyl7cmV0dXJuIDE9PWMubGVuZ3RoP1wiMFwiK2M6XCJcIitjfWZ1bmN0aW9uIGNvbnZlcnRUb1BlcmNlbnRhZ2Uobil7cmV0dXJuIDE+PW4mJihuPTEwMCpuK1wiJVwiKSxufWZ1bmN0aW9uIGNvbnZlcnREZWNpbWFsVG9IZXgoZCl7cmV0dXJuIE1hdGgucm91bmQoMjU1KnBhcnNlRmxvYXQoZCkpLnRvU3RyaW5nKDE2KX1mdW5jdGlvbiBjb252ZXJ0SGV4VG9EZWNpbWFsKGgpe3JldHVybiBwYXJzZUludEZyb21IZXgoaCkvMjU1fWZ1bmN0aW9uIHN0cmluZ0lucHV0VG9PYmplY3QoY29sb3Ipe2NvbG9yPWNvbG9yLnJlcGxhY2UodHJpbUxlZnQsXCJcIikucmVwbGFjZSh0cmltUmlnaHQsXCJcIikudG9Mb3dlckNhc2UoKTt2YXIgbmFtZWQ9ITE7aWYobmFtZXNbY29sb3JdKWNvbG9yPW5hbWVzW2NvbG9yXSxuYW1lZD0hMDtlbHNlIGlmKFwidHJhbnNwYXJlbnRcIj09Y29sb3IpcmV0dXJue3I6MCxnOjAsYjowLGE6MCxmb3JtYXQ6XCJuYW1lXCJ9O3ZhciBtYXRjaDtyZXR1cm4obWF0Y2g9bWF0Y2hlcnMucmdiLmV4ZWMoY29sb3IpKT97cjptYXRjaFsxXSxnOm1hdGNoWzJdLGI6bWF0Y2hbM119OihtYXRjaD1tYXRjaGVycy5yZ2JhLmV4ZWMoY29sb3IpKT97cjptYXRjaFsxXSxnOm1hdGNoWzJdLGI6bWF0Y2hbM10sYTptYXRjaFs0XX06KG1hdGNoPW1hdGNoZXJzLmhzbC5leGVjKGNvbG9yKSk/e2g6bWF0Y2hbMV0sczptYXRjaFsyXSxsOm1hdGNoWzNdfToobWF0Y2g9bWF0Y2hlcnMuaHNsYS5leGVjKGNvbG9yKSk/e2g6bWF0Y2hbMV0sczptYXRjaFsyXSxsOm1hdGNoWzNdLGE6bWF0Y2hbNF19OihtYXRjaD1tYXRjaGVycy5oc3YuZXhlYyhjb2xvcikpP3toOm1hdGNoWzFdLHM6bWF0Y2hbMl0sdjptYXRjaFszXX06KG1hdGNoPW1hdGNoZXJzLmhzdmEuZXhlYyhjb2xvcikpP3toOm1hdGNoWzFdLHM6bWF0Y2hbMl0sdjptYXRjaFszXSxhOm1hdGNoWzRdfToobWF0Y2g9bWF0Y2hlcnMuaGV4OC5leGVjKGNvbG9yKSk/e2E6Y29udmVydEhleFRvRGVjaW1hbChtYXRjaFsxXSkscjpwYXJzZUludEZyb21IZXgobWF0Y2hbMl0pLGc6cGFyc2VJbnRGcm9tSGV4KG1hdGNoWzNdKSxiOnBhcnNlSW50RnJvbUhleChtYXRjaFs0XSksZm9ybWF0Om5hbWVkP1wibmFtZVwiOlwiaGV4OFwifToobWF0Y2g9bWF0Y2hlcnMuaGV4Ni5leGVjKGNvbG9yKSk/e3I6cGFyc2VJbnRGcm9tSGV4KG1hdGNoWzFdKSxnOnBhcnNlSW50RnJvbUhleChtYXRjaFsyXSksYjpwYXJzZUludEZyb21IZXgobWF0Y2hbM10pLGZvcm1hdDpuYW1lZD9cIm5hbWVcIjpcImhleFwifToobWF0Y2g9bWF0Y2hlcnMuaGV4My5leGVjKGNvbG9yKSk/e3I6cGFyc2VJbnRGcm9tSGV4KG1hdGNoWzFdK1wiXCIrbWF0Y2hbMV0pLGc6cGFyc2VJbnRGcm9tSGV4KG1hdGNoWzJdK1wiXCIrbWF0Y2hbMl0pLGI6cGFyc2VJbnRGcm9tSGV4KG1hdGNoWzNdK1wiXCIrbWF0Y2hbM10pLGZvcm1hdDpuYW1lZD9cIm5hbWVcIjpcImhleFwifTohMX1mdW5jdGlvbiB2YWxpZGF0ZVdDQUcyUGFybXMocGFybXMpe3ZhciBsZXZlbCxzaXplO3JldHVybiBwYXJtcz1wYXJtc3x8e2xldmVsOlwiQUFcIixzaXplOlwic21hbGxcIn0sbGV2ZWw9KHBhcm1zLmxldmVsfHxcIkFBXCIpLnRvVXBwZXJDYXNlKCksc2l6ZT0ocGFybXMuc2l6ZXx8XCJzbWFsbFwiKS50b0xvd2VyQ2FzZSgpLFwiQUFcIiE9PWxldmVsJiZcIkFBQVwiIT09bGV2ZWwmJihsZXZlbD1cIkFBXCIpLFwic21hbGxcIiE9PXNpemUmJlwibGFyZ2VcIiE9PXNpemUmJihzaXplPVwic21hbGxcIikse2xldmVsOmxldmVsLHNpemU6c2l6ZX19dmFyIHRyaW1MZWZ0PS9eW1xccywjXSsvLHRyaW1SaWdodD0vXFxzKyQvLHRpbnlDb3VudGVyPTAsbWF0aD1NYXRoLG1hdGhSb3VuZD1tYXRoLnJvdW5kLG1hdGhNaW49bWF0aC5taW4sbWF0aE1heD1tYXRoLm1heCxtYXRoUmFuZG9tPW1hdGgucmFuZG9tO3Rpbnljb2xvci5wcm90b3R5cGU9e2lzRGFyazpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEJyaWdodG5lc3MoKTwxMjh9LGlzTGlnaHQ6ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5pc0RhcmsoKX0saXNWYWxpZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9va30sZ2V0T3JpZ2luYWxJbnB1dDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9vcmlnaW5hbElucHV0fSxnZXRGb3JtYXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZm9ybWF0fSxnZXRBbHBoYTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9hfSxnZXRCcmlnaHRuZXNzOmZ1bmN0aW9uKCl7dmFyIHJnYj10aGlzLnRvUmdiKCk7cmV0dXJuKDI5OSpyZ2Iucis1ODcqcmdiLmcrMTE0KnJnYi5iKS8xZTN9LGdldEx1bWluYW5jZTpmdW5jdGlvbigpe3ZhciBSc1JHQixHc1JHQixCc1JHQixSLEcsQixyZ2I9dGhpcy50b1JnYigpO3JldHVybiBSc1JHQj1yZ2Iuci8yNTUsR3NSR0I9cmdiLmcvMjU1LEJzUkdCPXJnYi5iLzI1NSxSPS4wMzkyOD49UnNSR0I/UnNSR0IvMTIuOTI6TWF0aC5wb3coKFJzUkdCKy4wNTUpLzEuMDU1LDIuNCksRz0uMDM5Mjg+PUdzUkdCP0dzUkdCLzEyLjkyOk1hdGgucG93KChHc1JHQisuMDU1KS8xLjA1NSwyLjQpLEI9LjAzOTI4Pj1Cc1JHQj9Cc1JHQi8xMi45MjpNYXRoLnBvdygoQnNSR0IrLjA1NSkvMS4wNTUsMi40KSwuMjEyNipSKy43MTUyKkcrLjA3MjIqQn0sc2V0QWxwaGE6ZnVuY3Rpb24odmFsdWUpe3JldHVybiB0aGlzLl9hPWJvdW5kQWxwaGEodmFsdWUpLHRoaXMuX3JvdW5kQT1tYXRoUm91bmQoMTAwKnRoaXMuX2EpLzEwMCx0aGlzfSx0b0hzdjpmdW5jdGlvbigpe3ZhciBoc3Y9cmdiVG9Ic3YodGhpcy5fcix0aGlzLl9nLHRoaXMuX2IpO3JldHVybntoOjM2MCpoc3YuaCxzOmhzdi5zLHY6aHN2LnYsYTp0aGlzLl9hfX0sdG9Ic3ZTdHJpbmc6ZnVuY3Rpb24oKXt2YXIgaHN2PXJnYlRvSHN2KHRoaXMuX3IsdGhpcy5fZyx0aGlzLl9iKSxoPW1hdGhSb3VuZCgzNjAqaHN2LmgpLHM9bWF0aFJvdW5kKDEwMCpoc3Yucyksdj1tYXRoUm91bmQoMTAwKmhzdi52KTtyZXR1cm4gMT09dGhpcy5fYT9cImhzdihcIitoK1wiLCBcIitzK1wiJSwgXCIrditcIiUpXCI6XCJoc3ZhKFwiK2grXCIsIFwiK3MrXCIlLCBcIit2K1wiJSwgXCIrdGhpcy5fcm91bmRBK1wiKVwifSx0b0hzbDpmdW5jdGlvbigpe3ZhciBoc2w9cmdiVG9Ic2wodGhpcy5fcix0aGlzLl9nLHRoaXMuX2IpO3JldHVybntoOjM2MCpoc2wuaCxzOmhzbC5zLGw6aHNsLmwsYTp0aGlzLl9hfX0sdG9Ic2xTdHJpbmc6ZnVuY3Rpb24oKXt2YXIgaHNsPXJnYlRvSHNsKHRoaXMuX3IsdGhpcy5fZyx0aGlzLl9iKSxoPW1hdGhSb3VuZCgzNjAqaHNsLmgpLHM9bWF0aFJvdW5kKDEwMCpoc2wucyksbD1tYXRoUm91bmQoMTAwKmhzbC5sKTtyZXR1cm4gMT09dGhpcy5fYT9cImhzbChcIitoK1wiLCBcIitzK1wiJSwgXCIrbCtcIiUpXCI6XCJoc2xhKFwiK2grXCIsIFwiK3MrXCIlLCBcIitsK1wiJSwgXCIrdGhpcy5fcm91bmRBK1wiKVwifSx0b0hleDpmdW5jdGlvbihhbGxvdzNDaGFyKXtyZXR1cm4gcmdiVG9IZXgodGhpcy5fcix0aGlzLl9nLHRoaXMuX2IsYWxsb3czQ2hhcil9LHRvSGV4U3RyaW5nOmZ1bmN0aW9uKGFsbG93M0NoYXIpe3JldHVyblwiI1wiK3RoaXMudG9IZXgoYWxsb3czQ2hhcil9LHRvSGV4ODpmdW5jdGlvbigpe3JldHVybiByZ2JhVG9IZXgodGhpcy5fcix0aGlzLl9nLHRoaXMuX2IsdGhpcy5fYSl9LHRvSGV4OFN0cmluZzpmdW5jdGlvbigpe3JldHVyblwiI1wiK3RoaXMudG9IZXg4KCl9LHRvUmdiOmZ1bmN0aW9uKCl7cmV0dXJue3I6bWF0aFJvdW5kKHRoaXMuX3IpLGc6bWF0aFJvdW5kKHRoaXMuX2cpLGI6bWF0aFJvdW5kKHRoaXMuX2IpLGE6dGhpcy5fYX19LHRvUmdiU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIDE9PXRoaXMuX2E/XCJyZ2IoXCIrbWF0aFJvdW5kKHRoaXMuX3IpK1wiLCBcIittYXRoUm91bmQodGhpcy5fZykrXCIsIFwiK21hdGhSb3VuZCh0aGlzLl9iKStcIilcIjpcInJnYmEoXCIrbWF0aFJvdW5kKHRoaXMuX3IpK1wiLCBcIittYXRoUm91bmQodGhpcy5fZykrXCIsIFwiK21hdGhSb3VuZCh0aGlzLl9iKStcIiwgXCIrdGhpcy5fcm91bmRBK1wiKVwifSx0b1BlcmNlbnRhZ2VSZ2I6ZnVuY3Rpb24oKXtyZXR1cm57cjptYXRoUm91bmQoMTAwKmJvdW5kMDEodGhpcy5fciwyNTUpKStcIiVcIixnOm1hdGhSb3VuZCgxMDAqYm91bmQwMSh0aGlzLl9nLDI1NSkpK1wiJVwiLGI6bWF0aFJvdW5kKDEwMCpib3VuZDAxKHRoaXMuX2IsMjU1KSkrXCIlXCIsYTp0aGlzLl9hfX0sdG9QZXJjZW50YWdlUmdiU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIDE9PXRoaXMuX2E/XCJyZ2IoXCIrbWF0aFJvdW5kKDEwMCpib3VuZDAxKHRoaXMuX3IsMjU1KSkrXCIlLCBcIittYXRoUm91bmQoMTAwKmJvdW5kMDEodGhpcy5fZywyNTUpKStcIiUsIFwiK21hdGhSb3VuZCgxMDAqYm91bmQwMSh0aGlzLl9iLDI1NSkpK1wiJSlcIjpcInJnYmEoXCIrbWF0aFJvdW5kKDEwMCpib3VuZDAxKHRoaXMuX3IsMjU1KSkrXCIlLCBcIittYXRoUm91bmQoMTAwKmJvdW5kMDEodGhpcy5fZywyNTUpKStcIiUsIFwiK21hdGhSb3VuZCgxMDAqYm91bmQwMSh0aGlzLl9iLDI1NSkpK1wiJSwgXCIrdGhpcy5fcm91bmRBK1wiKVwifSx0b05hbWU6ZnVuY3Rpb24oKXtyZXR1cm4gMD09PXRoaXMuX2E/XCJ0cmFuc3BhcmVudFwiOnRoaXMuX2E8MT8hMTpoZXhOYW1lc1tyZ2JUb0hleCh0aGlzLl9yLHRoaXMuX2csdGhpcy5fYiwhMCldfHwhMX0sdG9GaWx0ZXI6ZnVuY3Rpb24oc2Vjb25kQ29sb3Ipe3ZhciBoZXg4U3RyaW5nPVwiI1wiK3JnYmFUb0hleCh0aGlzLl9yLHRoaXMuX2csdGhpcy5fYix0aGlzLl9hKSxzZWNvbmRIZXg4U3RyaW5nPWhleDhTdHJpbmcsZ3JhZGllbnRUeXBlPXRoaXMuX2dyYWRpZW50VHlwZT9cIkdyYWRpZW50VHlwZSA9IDEsIFwiOlwiXCI7aWYoc2Vjb25kQ29sb3Ipe3ZhciBzPXRpbnljb2xvcihzZWNvbmRDb2xvcik7c2Vjb25kSGV4OFN0cmluZz1zLnRvSGV4OFN0cmluZygpfXJldHVyblwicHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LmdyYWRpZW50KFwiK2dyYWRpZW50VHlwZStcInN0YXJ0Q29sb3JzdHI9XCIraGV4OFN0cmluZytcIixlbmRDb2xvcnN0cj1cIitzZWNvbmRIZXg4U3RyaW5nK1wiKVwifSx0b1N0cmluZzpmdW5jdGlvbihmb3JtYXQpe3ZhciBmb3JtYXRTZXQ9ISFmb3JtYXQ7Zm9ybWF0PWZvcm1hdHx8dGhpcy5fZm9ybWF0O3ZhciBmb3JtYXR0ZWRTdHJpbmc9ITEsaGFzQWxwaGE9dGhpcy5fYTwxJiZ0aGlzLl9hPj0wLG5lZWRzQWxwaGFGb3JtYXQ9IWZvcm1hdFNldCYmaGFzQWxwaGEmJihcImhleFwiPT09Zm9ybWF0fHxcImhleDZcIj09PWZvcm1hdHx8XCJoZXgzXCI9PT1mb3JtYXR8fFwibmFtZVwiPT09Zm9ybWF0KTtyZXR1cm4gbmVlZHNBbHBoYUZvcm1hdD9cIm5hbWVcIj09PWZvcm1hdCYmMD09PXRoaXMuX2E/dGhpcy50b05hbWUoKTp0aGlzLnRvUmdiU3RyaW5nKCk6KFwicmdiXCI9PT1mb3JtYXQmJihmb3JtYXR0ZWRTdHJpbmc9dGhpcy50b1JnYlN0cmluZygpKSxcInByZ2JcIj09PWZvcm1hdCYmKGZvcm1hdHRlZFN0cmluZz10aGlzLnRvUGVyY2VudGFnZVJnYlN0cmluZygpKSwoXCJoZXhcIj09PWZvcm1hdHx8XCJoZXg2XCI9PT1mb3JtYXQpJiYoZm9ybWF0dGVkU3RyaW5nPXRoaXMudG9IZXhTdHJpbmcoKSksXCJoZXgzXCI9PT1mb3JtYXQmJihmb3JtYXR0ZWRTdHJpbmc9dGhpcy50b0hleFN0cmluZyghMCkpLFwiaGV4OFwiPT09Zm9ybWF0JiYoZm9ybWF0dGVkU3RyaW5nPXRoaXMudG9IZXg4U3RyaW5nKCkpLFwibmFtZVwiPT09Zm9ybWF0JiYoZm9ybWF0dGVkU3RyaW5nPXRoaXMudG9OYW1lKCkpLFwiaHNsXCI9PT1mb3JtYXQmJihmb3JtYXR0ZWRTdHJpbmc9dGhpcy50b0hzbFN0cmluZygpKSxcImhzdlwiPT09Zm9ybWF0JiYoZm9ybWF0dGVkU3RyaW5nPXRoaXMudG9Ic3ZTdHJpbmcoKSksZm9ybWF0dGVkU3RyaW5nfHx0aGlzLnRvSGV4U3RyaW5nKCkpfSxfYXBwbHlNb2RpZmljYXRpb246ZnVuY3Rpb24oZm4sYXJncyl7dmFyIGNvbG9yPWZuLmFwcGx5KG51bGwsW3RoaXNdLmNvbmNhdChbXS5zbGljZS5jYWxsKGFyZ3MpKSk7cmV0dXJuIHRoaXMuX3I9Y29sb3IuX3IsdGhpcy5fZz1jb2xvci5fZyx0aGlzLl9iPWNvbG9yLl9iLHRoaXMuc2V0QWxwaGEoY29sb3IuX2EpLHRoaXN9LGxpZ2h0ZW46ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYXBwbHlNb2RpZmljYXRpb24obGlnaHRlbixhcmd1bWVudHMpfSxicmlnaHRlbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9hcHBseU1vZGlmaWNhdGlvbihicmlnaHRlbixhcmd1bWVudHMpfSxkYXJrZW46ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYXBwbHlNb2RpZmljYXRpb24oZGFya2VuLGFyZ3VtZW50cyl9LGRlc2F0dXJhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYXBwbHlNb2RpZmljYXRpb24oZGVzYXR1cmF0ZSxhcmd1bWVudHMpfSxzYXR1cmF0ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9hcHBseU1vZGlmaWNhdGlvbihzYXR1cmF0ZSxhcmd1bWVudHMpfSxncmV5c2NhbGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYXBwbHlNb2RpZmljYXRpb24oZ3JleXNjYWxlLGFyZ3VtZW50cyl9LHNwaW46ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYXBwbHlNb2RpZmljYXRpb24oc3Bpbixhcmd1bWVudHMpfSxfYXBwbHlDb21iaW5hdGlvbjpmdW5jdGlvbihmbixhcmdzKXtyZXR1cm4gZm4uYXBwbHkobnVsbCxbdGhpc10uY29uY2F0KFtdLnNsaWNlLmNhbGwoYXJncykpKX0sYW5hbG9nb3VzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2FwcGx5Q29tYmluYXRpb24oYW5hbG9nb3VzLGFyZ3VtZW50cyl9LGNvbXBsZW1lbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYXBwbHlDb21iaW5hdGlvbihjb21wbGVtZW50LGFyZ3VtZW50cyl9LG1vbm9jaHJvbWF0aWM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYXBwbHlDb21iaW5hdGlvbihtb25vY2hyb21hdGljLGFyZ3VtZW50cyl9LHNwbGl0Y29tcGxlbWVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9hcHBseUNvbWJpbmF0aW9uKHNwbGl0Y29tcGxlbWVudCxhcmd1bWVudHMpfSx0cmlhZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9hcHBseUNvbWJpbmF0aW9uKHRyaWFkLGFyZ3VtZW50cyl9LHRldHJhZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9hcHBseUNvbWJpbmF0aW9uKHRldHJhZCxhcmd1bWVudHMpfX0sdGlueWNvbG9yLmZyb21SYXRpbz1mdW5jdGlvbihjb2xvcixvcHRzKXtpZihcIm9iamVjdFwiPT10eXBlb2YgY29sb3Ipe3ZhciBuZXdDb2xvcj17fTtmb3IodmFyIGkgaW4gY29sb3IpY29sb3IuaGFzT3duUHJvcGVydHkoaSkmJihuZXdDb2xvcltpXT1cImFcIj09PWk/Y29sb3JbaV06Y29udmVydFRvUGVyY2VudGFnZShjb2xvcltpXSkpO2NvbG9yPW5ld0NvbG9yfXJldHVybiB0aW55Y29sb3IoY29sb3Isb3B0cyl9LHRpbnljb2xvci5lcXVhbHM9ZnVuY3Rpb24oY29sb3IxLGNvbG9yMil7cmV0dXJuIGNvbG9yMSYmY29sb3IyP3Rpbnljb2xvcihjb2xvcjEpLnRvUmdiU3RyaW5nKCk9PXRpbnljb2xvcihjb2xvcjIpLnRvUmdiU3RyaW5nKCk6ITF9LHRpbnljb2xvci5yYW5kb209ZnVuY3Rpb24oKXtyZXR1cm4gdGlueWNvbG9yLmZyb21SYXRpbyh7cjptYXRoUmFuZG9tKCksZzptYXRoUmFuZG9tKCksYjptYXRoUmFuZG9tKCl9KX0sdGlueWNvbG9yLm1peD1mdW5jdGlvbihjb2xvcjEsY29sb3IyLGFtb3VudCl7YW1vdW50PTA9PT1hbW91bnQ/MDphbW91bnR8fDUwO3ZhciB3MSxyZ2IxPXRpbnljb2xvcihjb2xvcjEpLnRvUmdiKCkscmdiMj10aW55Y29sb3IoY29sb3IyKS50b1JnYigpLHA9YW1vdW50LzEwMCx3PTIqcC0xLGE9cmdiMi5hLXJnYjEuYTt3MT0tMT09dyphP3c6KHcrYSkvKDErdyphKSx3MT0odzErMSkvMjt2YXIgdzI9MS13MSxyZ2JhPXtyOnJnYjIucip3MStyZ2IxLnIqdzIsZzpyZ2IyLmcqdzErcmdiMS5nKncyLGI6cmdiMi5iKncxK3JnYjEuYip3MixhOnJnYjIuYSpwK3JnYjEuYSooMS1wKX07cmV0dXJuIHRpbnljb2xvcihyZ2JhKX0sdGlueWNvbG9yLnJlYWRhYmlsaXR5PWZ1bmN0aW9uKGNvbG9yMSxjb2xvcjIpe3ZhciBjMT10aW55Y29sb3IoY29sb3IxKSxjMj10aW55Y29sb3IoY29sb3IyKTtyZXR1cm4oTWF0aC5tYXgoYzEuZ2V0THVtaW5hbmNlKCksYzIuZ2V0THVtaW5hbmNlKCkpKy4wNSkvKE1hdGgubWluKGMxLmdldEx1bWluYW5jZSgpLGMyLmdldEx1bWluYW5jZSgpKSsuMDUpfSx0aW55Y29sb3IuaXNSZWFkYWJsZT1mdW5jdGlvbihjb2xvcjEsY29sb3IyLHdjYWcyKXt2YXIgd2NhZzJQYXJtcyxvdXQscmVhZGFiaWxpdHk9dGlueWNvbG9yLnJlYWRhYmlsaXR5KGNvbG9yMSxjb2xvcjIpO3N3aXRjaChvdXQ9ITEsd2NhZzJQYXJtcz12YWxpZGF0ZVdDQUcyUGFybXMod2NhZzIpLHdjYWcyUGFybXMubGV2ZWwrd2NhZzJQYXJtcy5zaXplKXtjYXNlXCJBQXNtYWxsXCI6Y2FzZVwiQUFBbGFyZ2VcIjpvdXQ9cmVhZGFiaWxpdHk+PTQuNTticmVhaztjYXNlXCJBQWxhcmdlXCI6b3V0PXJlYWRhYmlsaXR5Pj0zO2JyZWFrO2Nhc2VcIkFBQXNtYWxsXCI6b3V0PXJlYWRhYmlsaXR5Pj03fXJldHVybiBvdXR9LHRpbnljb2xvci5tb3N0UmVhZGFibGU9ZnVuY3Rpb24oYmFzZUNvbG9yLGNvbG9yTGlzdCxhcmdzKXt2YXIgcmVhZGFiaWxpdHksaW5jbHVkZUZhbGxiYWNrQ29sb3JzLGxldmVsLHNpemUsYmVzdENvbG9yPW51bGwsYmVzdFNjb3JlPTA7YXJncz1hcmdzfHx7fSxpbmNsdWRlRmFsbGJhY2tDb2xvcnM9YXJncy5pbmNsdWRlRmFsbGJhY2tDb2xvcnMsbGV2ZWw9YXJncy5sZXZlbCxzaXplPWFyZ3Muc2l6ZTtmb3IodmFyIGk9MDtpPGNvbG9yTGlzdC5sZW5ndGg7aSsrKXJlYWRhYmlsaXR5PXRpbnljb2xvci5yZWFkYWJpbGl0eShiYXNlQ29sb3IsY29sb3JMaXN0W2ldKSxyZWFkYWJpbGl0eT5iZXN0U2NvcmUmJihiZXN0U2NvcmU9cmVhZGFiaWxpdHksYmVzdENvbG9yPXRpbnljb2xvcihjb2xvckxpc3RbaV0pKTtyZXR1cm4gdGlueWNvbG9yLmlzUmVhZGFibGUoYmFzZUNvbG9yLGJlc3RDb2xvcix7bGV2ZWw6bGV2ZWwsc2l6ZTpzaXplfSl8fCFpbmNsdWRlRmFsbGJhY2tDb2xvcnM/YmVzdENvbG9yOihhcmdzLmluY2x1ZGVGYWxsYmFja0NvbG9ycz0hMSx0aW55Y29sb3IubW9zdFJlYWRhYmxlKGJhc2VDb2xvcixbXCIjZmZmXCIsXCIjMDAwXCJdLGFyZ3MpKX07dmFyIG5hbWVzPXRpbnljb2xvci5uYW1lcz17YWxpY2VibHVlOlwiZjBmOGZmXCIsYW50aXF1ZXdoaXRlOlwiZmFlYmQ3XCIsYXF1YTpcIjBmZlwiLGFxdWFtYXJpbmU6XCI3ZmZmZDRcIixhenVyZTpcImYwZmZmZlwiLGJlaWdlOlwiZjVmNWRjXCIsYmlzcXVlOlwiZmZlNGM0XCIsYmxhY2s6XCIwMDBcIixibGFuY2hlZGFsbW9uZDpcImZmZWJjZFwiLGJsdWU6XCIwMGZcIixibHVldmlvbGV0OlwiOGEyYmUyXCIsYnJvd246XCJhNTJhMmFcIixidXJseXdvb2Q6XCJkZWI4ODdcIixidXJudHNpZW5uYTpcImVhN2U1ZFwiLGNhZGV0Ymx1ZTpcIjVmOWVhMFwiLGNoYXJ0cmV1c2U6XCI3ZmZmMDBcIixjaG9jb2xhdGU6XCJkMjY5MWVcIixjb3JhbDpcImZmN2Y1MFwiLGNvcm5mbG93ZXJibHVlOlwiNjQ5NWVkXCIsY29ybnNpbGs6XCJmZmY4ZGNcIixjcmltc29uOlwiZGMxNDNjXCIsY3lhbjpcIjBmZlwiLGRhcmtibHVlOlwiMDAwMDhiXCIsZGFya2N5YW46XCIwMDhiOGJcIixkYXJrZ29sZGVucm9kOlwiYjg4NjBiXCIsZGFya2dyYXk6XCJhOWE5YTlcIixkYXJrZ3JlZW46XCIwMDY0MDBcIixkYXJrZ3JleTpcImE5YTlhOVwiLGRhcmtraGFraTpcImJkYjc2YlwiLGRhcmttYWdlbnRhOlwiOGIwMDhiXCIsZGFya29saXZlZ3JlZW46XCI1NTZiMmZcIixkYXJrb3JhbmdlOlwiZmY4YzAwXCIsZGFya29yY2hpZDpcIjk5MzJjY1wiLGRhcmtyZWQ6XCI4YjAwMDBcIixkYXJrc2FsbW9uOlwiZTk5NjdhXCIsZGFya3NlYWdyZWVuOlwiOGZiYzhmXCIsZGFya3NsYXRlYmx1ZTpcIjQ4M2Q4YlwiLGRhcmtzbGF0ZWdyYXk6XCIyZjRmNGZcIixkYXJrc2xhdGVncmV5OlwiMmY0ZjRmXCIsZGFya3R1cnF1b2lzZTpcIjAwY2VkMVwiLGRhcmt2aW9sZXQ6XCI5NDAwZDNcIixkZWVwcGluazpcImZmMTQ5M1wiLGRlZXBza3libHVlOlwiMDBiZmZmXCIsZGltZ3JheTpcIjY5Njk2OVwiLGRpbWdyZXk6XCI2OTY5NjlcIixkb2RnZXJibHVlOlwiMWU5MGZmXCIsZmlyZWJyaWNrOlwiYjIyMjIyXCIsZmxvcmFsd2hpdGU6XCJmZmZhZjBcIixmb3Jlc3RncmVlbjpcIjIyOGIyMlwiLGZ1Y2hzaWE6XCJmMGZcIixnYWluc2Jvcm86XCJkY2RjZGNcIixnaG9zdHdoaXRlOlwiZjhmOGZmXCIsZ29sZDpcImZmZDcwMFwiLGdvbGRlbnJvZDpcImRhYTUyMFwiLGdyYXk6XCI4MDgwODBcIixncmVlbjpcIjAwODAwMFwiLGdyZWVueWVsbG93OlwiYWRmZjJmXCIsZ3JleTpcIjgwODA4MFwiLGhvbmV5ZGV3OlwiZjBmZmYwXCIsaG90cGluazpcImZmNjliNFwiLGluZGlhbnJlZDpcImNkNWM1Y1wiLGluZGlnbzpcIjRiMDA4MlwiLGl2b3J5OlwiZmZmZmYwXCIsa2hha2k6XCJmMGU2OGNcIixsYXZlbmRlcjpcImU2ZTZmYVwiLGxhdmVuZGVyYmx1c2g6XCJmZmYwZjVcIixsYXduZ3JlZW46XCI3Y2ZjMDBcIixsZW1vbmNoaWZmb246XCJmZmZhY2RcIixsaWdodGJsdWU6XCJhZGQ4ZTZcIixsaWdodGNvcmFsOlwiZjA4MDgwXCIsbGlnaHRjeWFuOlwiZTBmZmZmXCIsbGlnaHRnb2xkZW5yb2R5ZWxsb3c6XCJmYWZhZDJcIixsaWdodGdyYXk6XCJkM2QzZDNcIixsaWdodGdyZWVuOlwiOTBlZTkwXCIsbGlnaHRncmV5OlwiZDNkM2QzXCIsbGlnaHRwaW5rOlwiZmZiNmMxXCIsbGlnaHRzYWxtb246XCJmZmEwN2FcIixsaWdodHNlYWdyZWVuOlwiMjBiMmFhXCIsbGlnaHRza3libHVlOlwiODdjZWZhXCIsbGlnaHRzbGF0ZWdyYXk6XCI3ODlcIixsaWdodHNsYXRlZ3JleTpcIjc4OVwiLGxpZ2h0c3RlZWxibHVlOlwiYjBjNGRlXCIsbGlnaHR5ZWxsb3c6XCJmZmZmZTBcIixsaW1lOlwiMGYwXCIsbGltZWdyZWVuOlwiMzJjZDMyXCIsbGluZW46XCJmYWYwZTZcIixtYWdlbnRhOlwiZjBmXCIsbWFyb29uOlwiODAwMDAwXCIsbWVkaXVtYXF1YW1hcmluZTpcIjY2Y2RhYVwiLG1lZGl1bWJsdWU6XCIwMDAwY2RcIixtZWRpdW1vcmNoaWQ6XCJiYTU1ZDNcIixtZWRpdW1wdXJwbGU6XCI5MzcwZGJcIixtZWRpdW1zZWFncmVlbjpcIjNjYjM3MVwiLG1lZGl1bXNsYXRlYmx1ZTpcIjdiNjhlZVwiLG1lZGl1bXNwcmluZ2dyZWVuOlwiMDBmYTlhXCIsbWVkaXVtdHVycXVvaXNlOlwiNDhkMWNjXCIsbWVkaXVtdmlvbGV0cmVkOlwiYzcxNTg1XCIsbWlkbmlnaHRibHVlOlwiMTkxOTcwXCIsbWludGNyZWFtOlwiZjVmZmZhXCIsbWlzdHlyb3NlOlwiZmZlNGUxXCIsbW9jY2FzaW46XCJmZmU0YjVcIixuYXZham93aGl0ZTpcImZmZGVhZFwiLG5hdnk6XCIwMDAwODBcIixvbGRsYWNlOlwiZmRmNWU2XCIsb2xpdmU6XCI4MDgwMDBcIixvbGl2ZWRyYWI6XCI2YjhlMjNcIixvcmFuZ2U6XCJmZmE1MDBcIixvcmFuZ2VyZWQ6XCJmZjQ1MDBcIixvcmNoaWQ6XCJkYTcwZDZcIixwYWxlZ29sZGVucm9kOlwiZWVlOGFhXCIscGFsZWdyZWVuOlwiOThmYjk4XCIscGFsZXR1cnF1b2lzZTpcImFmZWVlZVwiLHBhbGV2aW9sZXRyZWQ6XCJkYjcwOTNcIixwYXBheWF3aGlwOlwiZmZlZmQ1XCIscGVhY2hwdWZmOlwiZmZkYWI5XCIscGVydTpcImNkODUzZlwiLHBpbms6XCJmZmMwY2JcIixwbHVtOlwiZGRhMGRkXCIscG93ZGVyYmx1ZTpcImIwZTBlNlwiLHB1cnBsZTpcIjgwMDA4MFwiLHJlYmVjY2FwdXJwbGU6XCI2NjMzOTlcIixyZWQ6XCJmMDBcIixyb3N5YnJvd246XCJiYzhmOGZcIixyb3lhbGJsdWU6XCI0MTY5ZTFcIixzYWRkbGVicm93bjpcIjhiNDUxM1wiLHNhbG1vbjpcImZhODA3MlwiLHNhbmR5YnJvd246XCJmNGE0NjBcIixzZWFncmVlbjpcIjJlOGI1N1wiLHNlYXNoZWxsOlwiZmZmNWVlXCIsc2llbm5hOlwiYTA1MjJkXCIsc2lsdmVyOlwiYzBjMGMwXCIsc2t5Ymx1ZTpcIjg3Y2VlYlwiLHNsYXRlYmx1ZTpcIjZhNWFjZFwiLHNsYXRlZ3JheTpcIjcwODA5MFwiLHNsYXRlZ3JleTpcIjcwODA5MFwiLHNub3c6XCJmZmZhZmFcIixzcHJpbmdncmVlbjpcIjAwZmY3ZlwiLHN0ZWVsYmx1ZTpcIjQ2ODJiNFwiLHRhbjpcImQyYjQ4Y1wiLHRlYWw6XCIwMDgwODBcIix0aGlzdGxlOlwiZDhiZmQ4XCIsdG9tYXRvOlwiZmY2MzQ3XCIsdHVycXVvaXNlOlwiNDBlMGQwXCIsdmlvbGV0OlwiZWU4MmVlXCIsd2hlYXQ6XCJmNWRlYjNcIix3aGl0ZTpcImZmZlwiLHdoaXRlc21va2U6XCJmNWY1ZjVcIix5ZWxsb3c6XCJmZjBcIix5ZWxsb3dncmVlbjpcIjlhY2QzMlwifSxoZXhOYW1lcz10aW55Y29sb3IuaGV4TmFtZXM9ZmxpcChuYW1lcyksbWF0Y2hlcnM9ZnVuY3Rpb24oKXt2YXIgQ1NTX0lOVEVHRVI9XCJbLVxcXFwrXT9cXFxcZCslP1wiLENTU19OVU1CRVI9XCJbLVxcXFwrXT9cXFxcZCpcXFxcLlxcXFxkKyU/XCIsQ1NTX1VOSVQ9XCIoPzpcIitDU1NfTlVNQkVSK1wiKXwoPzpcIitDU1NfSU5URUdFUitcIilcIixQRVJNSVNTSVZFX01BVENIMz1cIltcXFxcc3xcXFxcKF0rKFwiK0NTU19VTklUK1wiKVssfFxcXFxzXSsoXCIrQ1NTX1VOSVQrXCIpWyx8XFxcXHNdKyhcIitDU1NfVU5JVCtcIilcXFxccypcXFxcKT9cIixQRVJNSVNTSVZFX01BVENIND1cIltcXFxcc3xcXFxcKF0rKFwiK0NTU19VTklUK1wiKVssfFxcXFxzXSsoXCIrQ1NTX1VOSVQrXCIpWyx8XFxcXHNdKyhcIitDU1NfVU5JVCtcIilbLHxcXFxcc10rKFwiK0NTU19VTklUK1wiKVxcXFxzKlxcXFwpP1wiO3JldHVybntyZ2I6bmV3IFJlZ0V4cChcInJnYlwiK1BFUk1JU1NJVkVfTUFUQ0gzKSxyZ2JhOm5ldyBSZWdFeHAoXCJyZ2JhXCIrUEVSTUlTU0lWRV9NQVRDSDQpLGhzbDpuZXcgUmVnRXhwKFwiaHNsXCIrUEVSTUlTU0lWRV9NQVRDSDMpLGhzbGE6bmV3IFJlZ0V4cChcImhzbGFcIitQRVJNSVNTSVZFX01BVENINCksaHN2Om5ldyBSZWdFeHAoXCJoc3ZcIitQRVJNSVNTSVZFX01BVENIMyksaHN2YTpuZXcgUmVnRXhwKFwiaHN2YVwiK1BFUk1JU1NJVkVfTUFUQ0g0KSxoZXgzOi9eKFswLTlhLWZBLUZdezF9KShbMC05YS1mQS1GXXsxfSkoWzAtOWEtZkEtRl17MX0pJC8saGV4NjovXihbMC05YS1mQS1GXXsyfSkoWzAtOWEtZkEtRl17Mn0pKFswLTlhLWZBLUZdezJ9KSQvLGhleDg6L14oWzAtOWEtZkEtRl17Mn0pKFswLTlhLWZBLUZdezJ9KShbMC05YS1mQS1GXXsyfSkoWzAtOWEtZkEtRl17Mn0pJC99fSgpO1widW5kZWZpbmVkXCIhPXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPXRpbnljb2xvcjpcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKGZ1bmN0aW9uKCl7cmV0dXJuIHRpbnljb2xvcn0pOndpbmRvdy50aW55Y29sb3I9dGlueWNvbG9yfSgpO1xuKGZ1bmN0aW9uKGEpe2lmKHR5cGVvZiBkZWZpbmU9PT1cImZ1bmN0aW9uXCImJmRlZmluZS5hbWQmJmRlZmluZS5hbWQualF1ZXJ5KXtkZWZpbmUoW1wianF1ZXJ5XCJdLGEpfWVsc2V7YShqUXVlcnkpfX0oZnVuY3Rpb24oZil7dmFyIHk9XCIxLjYuMTJcIixwPVwibGVmdFwiLG89XCJyaWdodFwiLGU9XCJ1cFwiLHg9XCJkb3duXCIsYz1cImluXCIsQT1cIm91dFwiLG09XCJub25lXCIscz1cImF1dG9cIixsPVwic3dpcGVcIix0PVwicGluY2hcIixCPVwidGFwXCIsaj1cImRvdWJsZXRhcFwiLGI9XCJsb25ndGFwXCIsej1cImhvbGRcIixFPVwiaG9yaXpvbnRhbFwiLHU9XCJ2ZXJ0aWNhbFwiLGk9XCJhbGxcIixyPTEwLGc9XCJzdGFydFwiLGs9XCJtb3ZlXCIsaD1cImVuZFwiLHE9XCJjYW5jZWxcIixhPVwib250b3VjaHN0YXJ0XCIgaW4gd2luZG93LHY9d2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkJiYhd2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZCxkPXdpbmRvdy5uYXZpZ2F0b3IucG9pbnRlckVuYWJsZWR8fHdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZCxDPVwiVG91Y2hTd2lwZVwiO3ZhciBuPXtmaW5nZXJzOjEsdGhyZXNob2xkOjc1LGNhbmNlbFRocmVzaG9sZDpudWxsLHBpbmNoVGhyZXNob2xkOjIwLG1heFRpbWVUaHJlc2hvbGQ6bnVsbCxmaW5nZXJSZWxlYXNlVGhyZXNob2xkOjI1MCxsb25nVGFwVGhyZXNob2xkOjUwMCxkb3VibGVUYXBUaHJlc2hvbGQ6MjAwLHN3aXBlOm51bGwsc3dpcGVMZWZ0Om51bGwsc3dpcGVSaWdodDpudWxsLHN3aXBlVXA6bnVsbCxzd2lwZURvd246bnVsbCxzd2lwZVN0YXR1czpudWxsLHBpbmNoSW46bnVsbCxwaW5jaE91dDpudWxsLHBpbmNoU3RhdHVzOm51bGwsY2xpY2s6bnVsbCx0YXA6bnVsbCxkb3VibGVUYXA6bnVsbCxsb25nVGFwOm51bGwsaG9sZDpudWxsLHRyaWdnZXJPblRvdWNoRW5kOnRydWUsdHJpZ2dlck9uVG91Y2hMZWF2ZTpmYWxzZSxhbGxvd1BhZ2VTY3JvbGw6XCJhdXRvXCIsZmFsbGJhY2tUb01vdXNlRXZlbnRzOnRydWUsZXhjbHVkZWRFbGVtZW50czpcImxhYmVsLCBidXR0b24sIGlucHV0LCBzZWxlY3QsIHRleHRhcmVhLCBhLCAubm9Td2lwZVwiLHByZXZlbnREZWZhdWx0RXZlbnRzOnRydWV9O2YuZm4uc3dpcGU9ZnVuY3Rpb24oSCl7dmFyIEc9Zih0aGlzKSxGPUcuZGF0YShDKTtpZihGJiZ0eXBlb2YgSD09PVwic3RyaW5nXCIpe2lmKEZbSF0pe3JldHVybiBGW0hdLmFwcGx5KHRoaXMsQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpKX1lbHNle2YuZXJyb3IoXCJNZXRob2QgXCIrSCtcIiBkb2VzIG5vdCBleGlzdCBvbiBqUXVlcnkuc3dpcGVcIil9fWVsc2V7aWYoRiYmdHlwZW9mIEg9PT1cIm9iamVjdFwiKXtGLm9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9ZWxzZXtpZighRiYmKHR5cGVvZiBIPT09XCJvYmplY3RcInx8IUgpKXtyZXR1cm4gdy5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fX1yZXR1cm4gR307Zi5mbi5zd2lwZS52ZXJzaW9uPXk7Zi5mbi5zd2lwZS5kZWZhdWx0cz1uO2YuZm4uc3dpcGUucGhhc2VzPXtQSEFTRV9TVEFSVDpnLFBIQVNFX01PVkU6ayxQSEFTRV9FTkQ6aCxQSEFTRV9DQU5DRUw6cX07Zi5mbi5zd2lwZS5kaXJlY3Rpb25zPXtMRUZUOnAsUklHSFQ6byxVUDplLERPV046eCxJTjpjLE9VVDpBfTtmLmZuLnN3aXBlLnBhZ2VTY3JvbGw9e05PTkU6bSxIT1JJWk9OVEFMOkUsVkVSVElDQUw6dSxBVVRPOnN9O2YuZm4uc3dpcGUuZmluZ2Vycz17T05FOjEsVFdPOjIsVEhSRUU6MyxGT1VSOjQsRklWRTo1LEFMTDppfTtmdW5jdGlvbiB3KEYpe2lmKEYmJihGLmFsbG93UGFnZVNjcm9sbD09PXVuZGVmaW5lZCYmKEYuc3dpcGUhPT11bmRlZmluZWR8fEYuc3dpcGVTdGF0dXMhPT11bmRlZmluZWQpKSl7Ri5hbGxvd1BhZ2VTY3JvbGw9bX1pZihGLmNsaWNrIT09dW5kZWZpbmVkJiZGLnRhcD09PXVuZGVmaW5lZCl7Ri50YXA9Ri5jbGlja31pZighRil7Rj17fX1GPWYuZXh0ZW5kKHt9LGYuZm4uc3dpcGUuZGVmYXVsdHMsRik7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBIPWYodGhpcyk7dmFyIEc9SC5kYXRhKEMpO2lmKCFHKXtHPW5ldyBEKHRoaXMsRik7SC5kYXRhKEMsRyl9fSl9ZnVuY3Rpb24gRChhNCxhdSl7dmFyIGF1PWYuZXh0ZW5kKHt9LGF1KTt2YXIgYXo9KGF8fGR8fCFhdS5mYWxsYmFja1RvTW91c2VFdmVudHMpLEs9YXo/KGQ/KHY/XCJNU1BvaW50ZXJEb3duXCI6XCJwb2ludGVyZG93blwiKTpcInRvdWNoc3RhcnRcIik6XCJtb3VzZWRvd25cIixheD1hej8oZD8odj9cIk1TUG9pbnRlck1vdmVcIjpcInBvaW50ZXJtb3ZlXCIpOlwidG91Y2htb3ZlXCIpOlwibW91c2Vtb3ZlXCIsVj1hej8oZD8odj9cIk1TUG9pbnRlclVwXCI6XCJwb2ludGVydXBcIik6XCJ0b3VjaGVuZFwiKTpcIm1vdXNldXBcIixUPWF6P251bGw6XCJtb3VzZWxlYXZlXCIsYUQ9KGQ/KHY/XCJNU1BvaW50ZXJDYW5jZWxcIjpcInBvaW50ZXJjYW5jZWxcIik6XCJ0b3VjaGNhbmNlbFwiKTt2YXIgYWc9MCxhUD1udWxsLGFjPTAsYTE9MCxhWj0wLEg9MSxhcD0wLGFKPTAsTj1udWxsO3ZhciBhUj1mKGE0KTt2YXIgYWE9XCJzdGFydFwiO3ZhciBYPTA7dmFyIGFRPXt9O3ZhciBVPTAsYTI9MCxhNT0wLGF5PTAsTz0wO3ZhciBhVz1udWxsLGFmPW51bGw7dHJ5e2FSLmJpbmQoSyxhTik7YVIuYmluZChhRCxhOSl9Y2F0Y2goYWope2YuZXJyb3IoXCJldmVudHMgbm90IHN1cHBvcnRlZCBcIitLK1wiLFwiK2FEK1wiIG9uIGpRdWVyeS5zd2lwZVwiKX10aGlzLmVuYWJsZT1mdW5jdGlvbigpe2FSLmJpbmQoSyxhTik7YVIuYmluZChhRCxhOSk7cmV0dXJuIGFSfTt0aGlzLmRpc2FibGU9ZnVuY3Rpb24oKXthSygpO3JldHVybiBhUn07dGhpcy5kZXN0cm95PWZ1bmN0aW9uKCl7YUsoKTthUi5kYXRhKEMsbnVsbCk7YVI9bnVsbH07dGhpcy5vcHRpb249ZnVuY3Rpb24oYmMsYmIpe2lmKHR5cGVvZiBiYz09PVwib2JqZWN0XCIpe2F1PWYuZXh0ZW5kKGF1LGJjKX1lbHNle2lmKGF1W2JjXSE9PXVuZGVmaW5lZCl7aWYoYmI9PT11bmRlZmluZWQpe3JldHVybiBhdVtiY119ZWxzZXthdVtiY109YmJ9fWVsc2V7aWYoIWJjKXtyZXR1cm4gYXV9ZWxzZXtmLmVycm9yKFwiT3B0aW9uIFwiK2JjK1wiIGRvZXMgbm90IGV4aXN0IG9uIGpRdWVyeS5zd2lwZS5vcHRpb25zXCIpfX19cmV0dXJuIG51bGx9O2Z1bmN0aW9uIGFOKGJkKXtpZihhQigpKXtyZXR1cm59aWYoZihiZC50YXJnZXQpLmNsb3Nlc3QoYXUuZXhjbHVkZWRFbGVtZW50cyxhUikubGVuZ3RoPjApe3JldHVybn12YXIgYmU9YmQub3JpZ2luYWxFdmVudD9iZC5vcmlnaW5hbEV2ZW50OmJkO3ZhciBiYyxiZj1iZS50b3VjaGVzLGJiPWJmP2JmWzBdOmJlO2FhPWc7aWYoYmYpe1g9YmYubGVuZ3RofWVsc2V7aWYoYXUucHJldmVudERlZmF1bHRFdmVudHMhPT1mYWxzZSl7YmQucHJldmVudERlZmF1bHQoKX19YWc9MDthUD1udWxsO2FKPW51bGw7YWM9MDthMT0wO2FaPTA7SD0xO2FwPTA7Tj1hYigpO1MoKTthaSgwLGJiKTtpZighYmZ8fChYPT09YXUuZmluZ2Vyc3x8YXUuZmluZ2Vycz09PWkpfHxhWCgpKXtVPWFyKCk7aWYoWD09Mil7YWkoMSxiZlsxXSk7YTE9YVo9YXQoYVFbMF0uc3RhcnQsYVFbMV0uc3RhcnQpfWlmKGF1LnN3aXBlU3RhdHVzfHxhdS5waW5jaFN0YXR1cyl7YmM9UChiZSxhYSl9fWVsc2V7YmM9ZmFsc2V9aWYoYmM9PT1mYWxzZSl7YWE9cTtQKGJlLGFhKTtyZXR1cm4gYmN9ZWxzZXtpZihhdS5ob2xkKXthZj1zZXRUaW1lb3V0KGYucHJveHkoZnVuY3Rpb24oKXthUi50cmlnZ2VyKFwiaG9sZFwiLFtiZS50YXJnZXRdKTtpZihhdS5ob2xkKXtiYz1hdS5ob2xkLmNhbGwoYVIsYmUsYmUudGFyZ2V0KX19LHRoaXMpLGF1LmxvbmdUYXBUaHJlc2hvbGQpfWFuKHRydWUpfXJldHVybiBudWxsfWZ1bmN0aW9uIGEzKGJlKXt2YXIgYmg9YmUub3JpZ2luYWxFdmVudD9iZS5vcmlnaW5hbEV2ZW50OmJlO2lmKGFhPT09aHx8YWE9PT1xfHxhbCgpKXtyZXR1cm59dmFyIGJkLGJpPWJoLnRvdWNoZXMsYmM9Ymk/YmlbMF06Ymg7dmFyIGJmPWFIKGJjKTthMj1hcigpO2lmKGJpKXtYPWJpLmxlbmd0aH1pZihhdS5ob2xkKXtjbGVhclRpbWVvdXQoYWYpfWFhPWs7aWYoWD09Mil7aWYoYTE9PTApe2FpKDEsYmlbMV0pO2ExPWFaPWF0KGFRWzBdLnN0YXJ0LGFRWzFdLnN0YXJ0KX1lbHNle2FIKGJpWzFdKTthWj1hdChhUVswXS5lbmQsYVFbMV0uZW5kKTthSj1hcShhUVswXS5lbmQsYVFbMV0uZW5kKX1IPWE3KGExLGFaKTthcD1NYXRoLmFicyhhMS1hWil9aWYoKFg9PT1hdS5maW5nZXJzfHxhdS5maW5nZXJzPT09aSl8fCFiaXx8YVgoKSl7YVA9YUwoYmYuc3RhcnQsYmYuZW5kKTthayhiZSxhUCk7YWc9YVMoYmYuc3RhcnQsYmYuZW5kKTthYz1hTSgpO2FJKGFQLGFnKTtpZihhdS5zd2lwZVN0YXR1c3x8YXUucGluY2hTdGF0dXMpe2JkPVAoYmgsYWEpfWlmKCFhdS50cmlnZ2VyT25Ub3VjaEVuZHx8YXUudHJpZ2dlck9uVG91Y2hMZWF2ZSl7dmFyIGJiPXRydWU7aWYoYXUudHJpZ2dlck9uVG91Y2hMZWF2ZSl7dmFyIGJnPWFZKHRoaXMpO2JiPUYoYmYuZW5kLGJnKX1pZighYXUudHJpZ2dlck9uVG91Y2hFbmQmJmJiKXthYT1hQyhrKX1lbHNle2lmKGF1LnRyaWdnZXJPblRvdWNoTGVhdmUmJiFiYil7YWE9YUMoaCl9fWlmKGFhPT1xfHxhYT09aCl7UChiaCxhYSl9fX1lbHNle2FhPXE7UChiaCxhYSl9aWYoYmQ9PT1mYWxzZSl7YWE9cTtQKGJoLGFhKX19ZnVuY3Rpb24gTShiYil7dmFyIGJjPWJiLm9yaWdpbmFsRXZlbnQ/YmIub3JpZ2luYWxFdmVudDpiYixiZD1iYy50b3VjaGVzO2lmKGJkKXtpZihiZC5sZW5ndGgmJiFhbCgpKXtHKCk7cmV0dXJuIHRydWV9ZWxzZXtpZihiZC5sZW5ndGgmJmFsKCkpe3JldHVybiB0cnVlfX19aWYoYWwoKSl7WD1heX1hMj1hcigpO2FjPWFNKCk7aWYoYmEoKXx8IWFtKCkpe2FhPXE7UChiYyxhYSl9ZWxzZXtpZihhdS50cmlnZ2VyT25Ub3VjaEVuZHx8KGF1LnRyaWdnZXJPblRvdWNoRW5kPT1mYWxzZSYmYWE9PT1rKSl7aWYoYXUucHJldmVudERlZmF1bHRFdmVudHMhPT1mYWxzZSl7YmIucHJldmVudERlZmF1bHQoKX1hYT1oO1AoYmMsYWEpfWVsc2V7aWYoIWF1LnRyaWdnZXJPblRvdWNoRW5kJiZhNigpKXthYT1oO2FGKGJjLGFhLEIpfWVsc2V7aWYoYWE9PT1rKXthYT1xO1AoYmMsYWEpfX19fWFuKGZhbHNlKTtyZXR1cm4gbnVsbH1mdW5jdGlvbiBhOSgpe1g9MDthMj0wO1U9MDthMT0wO2FaPTA7SD0xO1MoKTthbihmYWxzZSl9ZnVuY3Rpb24gTChiYil7dmFyIGJjPWJiLm9yaWdpbmFsRXZlbnQ/YmIub3JpZ2luYWxFdmVudDpiYjtpZihhdS50cmlnZ2VyT25Ub3VjaExlYXZlKXthYT1hQyhoKTtQKGJjLGFhKX19ZnVuY3Rpb24gYUsoKXthUi51bmJpbmQoSyxhTik7YVIudW5iaW5kKGFELGE5KTthUi51bmJpbmQoYXgsYTMpO2FSLnVuYmluZChWLE0pO2lmKFQpe2FSLnVuYmluZChULEwpfWFuKGZhbHNlKX1mdW5jdGlvbiBhQyhiZil7dmFyIGJlPWJmO3ZhciBiZD1hQSgpO3ZhciBiYz1hbSgpO3ZhciBiYj1iYSgpO2lmKCFiZHx8YmIpe2JlPXF9ZWxzZXtpZihiYyYmYmY9PWsmJighYXUudHJpZ2dlck9uVG91Y2hFbmR8fGF1LnRyaWdnZXJPblRvdWNoTGVhdmUpKXtiZT1ofWVsc2V7aWYoIWJjJiZiZj09aCYmYXUudHJpZ2dlck9uVG91Y2hMZWF2ZSl7YmU9cX19fXJldHVybiBiZX1mdW5jdGlvbiBQKGJkLGJiKXt2YXIgYmMsYmU9YmQudG91Y2hlcztpZigoSigpJiZXKCkpfHwoUSgpJiZhWCgpKSl7aWYoSigpJiZXKCkpe2JjPWFGKGJkLGJiLGwpfWlmKChRKCkmJmFYKCkpJiZiYyE9PWZhbHNlKXtiYz1hRihiZCxiYix0KX19ZWxzZXtpZihhRygpJiZiYyE9PWZhbHNlKXtiYz1hRihiZCxiYixqKX1lbHNle2lmKGFvKCkmJmJjIT09ZmFsc2Upe2JjPWFGKGJkLGJiLGIpfWVsc2V7aWYoYWgoKSYmYmMhPT1mYWxzZSl7YmM9YUYoYmQsYmIsQil9fX19aWYoYmI9PT1xKXtpZihXKCkpe2JjPWFGKGJkLGJiLGwpfWlmKGFYKCkpe2JjPWFGKGJkLGJiLHQpfWE5KGJkKX1pZihiYj09PWgpe2lmKGJlKXtpZighYmUubGVuZ3RoKXthOShiZCl9fWVsc2V7YTkoYmQpfX1yZXR1cm4gYmN9ZnVuY3Rpb24gYUYoYmUsYmIsYmQpe3ZhciBiYztpZihiZD09bCl7YVIudHJpZ2dlcihcInN3aXBlU3RhdHVzXCIsW2JiLGFQfHxudWxsLGFnfHwwLGFjfHwwLFgsYVFdKTtpZihhdS5zd2lwZVN0YXR1cyl7YmM9YXUuc3dpcGVTdGF0dXMuY2FsbChhUixiZSxiYixhUHx8bnVsbCxhZ3x8MCxhY3x8MCxYLGFRKTtpZihiYz09PWZhbHNlKXtyZXR1cm4gZmFsc2V9fWlmKGJiPT1oJiZhVigpKXthUi50cmlnZ2VyKFwic3dpcGVcIixbYVAsYWcsYWMsWCxhUV0pO2lmKGF1LnN3aXBlKXtiYz1hdS5zd2lwZS5jYWxsKGFSLGJlLGFQLGFnLGFjLFgsYVEpO2lmKGJjPT09ZmFsc2Upe3JldHVybiBmYWxzZX19c3dpdGNoKGFQKXtjYXNlIHA6YVIudHJpZ2dlcihcInN3aXBlTGVmdFwiLFthUCxhZyxhYyxYLGFRXSk7aWYoYXUuc3dpcGVMZWZ0KXtiYz1hdS5zd2lwZUxlZnQuY2FsbChhUixiZSxhUCxhZyxhYyxYLGFRKX1icmVhaztjYXNlIG86YVIudHJpZ2dlcihcInN3aXBlUmlnaHRcIixbYVAsYWcsYWMsWCxhUV0pO2lmKGF1LnN3aXBlUmlnaHQpe2JjPWF1LnN3aXBlUmlnaHQuY2FsbChhUixiZSxhUCxhZyxhYyxYLGFRKX1icmVhaztjYXNlIGU6YVIudHJpZ2dlcihcInN3aXBlVXBcIixbYVAsYWcsYWMsWCxhUV0pO2lmKGF1LnN3aXBlVXApe2JjPWF1LnN3aXBlVXAuY2FsbChhUixiZSxhUCxhZyxhYyxYLGFRKX1icmVhaztjYXNlIHg6YVIudHJpZ2dlcihcInN3aXBlRG93blwiLFthUCxhZyxhYyxYLGFRXSk7aWYoYXUuc3dpcGVEb3duKXtiYz1hdS5zd2lwZURvd24uY2FsbChhUixiZSxhUCxhZyxhYyxYLGFRKX1icmVha319fWlmKGJkPT10KXthUi50cmlnZ2VyKFwicGluY2hTdGF0dXNcIixbYmIsYUp8fG51bGwsYXB8fDAsYWN8fDAsWCxILGFRXSk7aWYoYXUucGluY2hTdGF0dXMpe2JjPWF1LnBpbmNoU3RhdHVzLmNhbGwoYVIsYmUsYmIsYUp8fG51bGwsYXB8fDAsYWN8fDAsWCxILGFRKTtpZihiYz09PWZhbHNlKXtyZXR1cm4gZmFsc2V9fWlmKGJiPT1oJiZhOCgpKXtzd2l0Y2goYUope2Nhc2UgYzphUi50cmlnZ2VyKFwicGluY2hJblwiLFthSnx8bnVsbCxhcHx8MCxhY3x8MCxYLEgsYVFdKTtpZihhdS5waW5jaEluKXtiYz1hdS5waW5jaEluLmNhbGwoYVIsYmUsYUp8fG51bGwsYXB8fDAsYWN8fDAsWCxILGFRKX1icmVhaztjYXNlIEE6YVIudHJpZ2dlcihcInBpbmNoT3V0XCIsW2FKfHxudWxsLGFwfHwwLGFjfHwwLFgsSCxhUV0pO2lmKGF1LnBpbmNoT3V0KXtiYz1hdS5waW5jaE91dC5jYWxsKGFSLGJlLGFKfHxudWxsLGFwfHwwLGFjfHwwLFgsSCxhUSl9YnJlYWt9fX1pZihiZD09Qil7aWYoYmI9PT1xfHxiYj09PWgpe2NsZWFyVGltZW91dChhVyk7Y2xlYXJUaW1lb3V0KGFmKTtpZihaKCkmJiFJKCkpe089YXIoKTthVz1zZXRUaW1lb3V0KGYucHJveHkoZnVuY3Rpb24oKXtPPW51bGw7YVIudHJpZ2dlcihcInRhcFwiLFtiZS50YXJnZXRdKTtpZihhdS50YXApe2JjPWF1LnRhcC5jYWxsKGFSLGJlLGJlLnRhcmdldCl9fSx0aGlzKSxhdS5kb3VibGVUYXBUaHJlc2hvbGQpfWVsc2V7Tz1udWxsO2FSLnRyaWdnZXIoXCJ0YXBcIixbYmUudGFyZ2V0XSk7aWYoYXUudGFwKXtiYz1hdS50YXAuY2FsbChhUixiZSxiZS50YXJnZXQpfX19fWVsc2V7aWYoYmQ9PWope2lmKGJiPT09cXx8YmI9PT1oKXtjbGVhclRpbWVvdXQoYVcpO089bnVsbDthUi50cmlnZ2VyKFwiZG91YmxldGFwXCIsW2JlLnRhcmdldF0pO2lmKGF1LmRvdWJsZVRhcCl7YmM9YXUuZG91YmxlVGFwLmNhbGwoYVIsYmUsYmUudGFyZ2V0KX19fWVsc2V7aWYoYmQ9PWIpe2lmKGJiPT09cXx8YmI9PT1oKXtjbGVhclRpbWVvdXQoYVcpO089bnVsbDthUi50cmlnZ2VyKFwibG9uZ3RhcFwiLFtiZS50YXJnZXRdKTtpZihhdS5sb25nVGFwKXtiYz1hdS5sb25nVGFwLmNhbGwoYVIsYmUsYmUudGFyZ2V0KX19fX19cmV0dXJuIGJjfWZ1bmN0aW9uIGFtKCl7dmFyIGJiPXRydWU7aWYoYXUudGhyZXNob2xkIT09bnVsbCl7YmI9YWc+PWF1LnRocmVzaG9sZH1yZXR1cm4gYmJ9ZnVuY3Rpb24gYmEoKXt2YXIgYmI9ZmFsc2U7aWYoYXUuY2FuY2VsVGhyZXNob2xkIT09bnVsbCYmYVAhPT1udWxsKXtiYj0oYVQoYVApLWFnKT49YXUuY2FuY2VsVGhyZXNob2xkfXJldHVybiBiYn1mdW5jdGlvbiBhZSgpe2lmKGF1LnBpbmNoVGhyZXNob2xkIT09bnVsbCl7cmV0dXJuIGFwPj1hdS5waW5jaFRocmVzaG9sZH1yZXR1cm4gdHJ1ZX1mdW5jdGlvbiBhQSgpe3ZhciBiYjtpZihhdS5tYXhUaW1lVGhyZXNob2xkKXtpZihhYz49YXUubWF4VGltZVRocmVzaG9sZCl7YmI9ZmFsc2V9ZWxzZXtiYj10cnVlfX1lbHNle2JiPXRydWV9cmV0dXJuIGJifWZ1bmN0aW9uIGFrKGJiLGJjKXtpZihhdS5wcmV2ZW50RGVmYXVsdEV2ZW50cz09PWZhbHNlKXtyZXR1cm59aWYoYXUuYWxsb3dQYWdlU2Nyb2xsPT09bSl7YmIucHJldmVudERlZmF1bHQoKX1lbHNle3ZhciBiZD1hdS5hbGxvd1BhZ2VTY3JvbGw9PT1zO3N3aXRjaChiYyl7Y2FzZSBwOmlmKChhdS5zd2lwZUxlZnQmJmJkKXx8KCFiZCYmYXUuYWxsb3dQYWdlU2Nyb2xsIT1FKSl7YmIucHJldmVudERlZmF1bHQoKX1icmVhaztjYXNlIG86aWYoKGF1LnN3aXBlUmlnaHQmJmJkKXx8KCFiZCYmYXUuYWxsb3dQYWdlU2Nyb2xsIT1FKSl7YmIucHJldmVudERlZmF1bHQoKX1icmVhaztjYXNlIGU6aWYoKGF1LnN3aXBlVXAmJmJkKXx8KCFiZCYmYXUuYWxsb3dQYWdlU2Nyb2xsIT11KSl7YmIucHJldmVudERlZmF1bHQoKX1icmVhaztjYXNlIHg6aWYoKGF1LnN3aXBlRG93biYmYmQpfHwoIWJkJiZhdS5hbGxvd1BhZ2VTY3JvbGwhPXUpKXtiYi5wcmV2ZW50RGVmYXVsdCgpfWJyZWFrfX19ZnVuY3Rpb24gYTgoKXt2YXIgYmM9YU8oKTt2YXIgYmI9WSgpO3ZhciBiZD1hZSgpO3JldHVybiBiYyYmYmImJmJkfWZ1bmN0aW9uIGFYKCl7cmV0dXJuICEhKGF1LnBpbmNoU3RhdHVzfHxhdS5waW5jaElufHxhdS5waW5jaE91dCl9ZnVuY3Rpb24gUSgpe3JldHVybiAhIShhOCgpJiZhWCgpKX1mdW5jdGlvbiBhVigpe3ZhciBiZT1hQSgpO3ZhciBiZz1hbSgpO3ZhciBiZD1hTygpO3ZhciBiYj1ZKCk7dmFyIGJjPWJhKCk7dmFyIGJmPSFiYyYmYmImJmJkJiZiZyYmYmU7cmV0dXJuIGJmfWZ1bmN0aW9uIFcoKXtyZXR1cm4gISEoYXUuc3dpcGV8fGF1LnN3aXBlU3RhdHVzfHxhdS5zd2lwZUxlZnR8fGF1LnN3aXBlUmlnaHR8fGF1LnN3aXBlVXB8fGF1LnN3aXBlRG93bil9ZnVuY3Rpb24gSigpe3JldHVybiAhIShhVigpJiZXKCkpfWZ1bmN0aW9uIGFPKCl7cmV0dXJuKChYPT09YXUuZmluZ2Vyc3x8YXUuZmluZ2Vycz09PWkpfHwhYSl9ZnVuY3Rpb24gWSgpe3JldHVybiBhUVswXS5lbmQueCE9PTB9ZnVuY3Rpb24gYTYoKXtyZXR1cm4gISEoYXUudGFwKX1mdW5jdGlvbiBaKCl7cmV0dXJuICEhKGF1LmRvdWJsZVRhcCl9ZnVuY3Rpb24gYVUoKXtyZXR1cm4gISEoYXUubG9uZ1RhcCl9ZnVuY3Rpb24gUigpe2lmKE89PW51bGwpe3JldHVybiBmYWxzZX12YXIgYmI9YXIoKTtyZXR1cm4oWigpJiYoKGJiLU8pPD1hdS5kb3VibGVUYXBUaHJlc2hvbGQpKX1mdW5jdGlvbiBJKCl7cmV0dXJuIFIoKX1mdW5jdGlvbiBhdygpe3JldHVybigoWD09PTF8fCFhKSYmKGlzTmFOKGFnKXx8YWc8YXUudGhyZXNob2xkKSl9ZnVuY3Rpb24gYTAoKXtyZXR1cm4oKGFjPmF1LmxvbmdUYXBUaHJlc2hvbGQpJiYoYWc8cikpfWZ1bmN0aW9uIGFoKCl7cmV0dXJuICEhKGF3KCkmJmE2KCkpfWZ1bmN0aW9uIGFHKCl7cmV0dXJuICEhKFIoKSYmWigpKX1mdW5jdGlvbiBhbygpe3JldHVybiAhIShhMCgpJiZhVSgpKX1mdW5jdGlvbiBHKCl7YTU9YXIoKTtheT1ldmVudC50b3VjaGVzLmxlbmd0aCsxfWZ1bmN0aW9uIFMoKXthNT0wO2F5PTB9ZnVuY3Rpb24gYWwoKXt2YXIgYmI9ZmFsc2U7aWYoYTUpe3ZhciBiYz1hcigpLWE1O2lmKGJjPD1hdS5maW5nZXJSZWxlYXNlVGhyZXNob2xkKXtiYj10cnVlfX1yZXR1cm4gYmJ9ZnVuY3Rpb24gYUIoKXtyZXR1cm4gISEoYVIuZGF0YShDK1wiX2ludG91Y2hcIik9PT10cnVlKX1mdW5jdGlvbiBhbihiYil7aWYoYmI9PT10cnVlKXthUi5iaW5kKGF4LGEzKTthUi5iaW5kKFYsTSk7aWYoVCl7YVIuYmluZChULEwpfX1lbHNle2FSLnVuYmluZChheCxhMyxmYWxzZSk7YVIudW5iaW5kKFYsTSxmYWxzZSk7aWYoVCl7YVIudW5iaW5kKFQsTCxmYWxzZSl9fWFSLmRhdGEoQytcIl9pbnRvdWNoXCIsYmI9PT10cnVlKX1mdW5jdGlvbiBhaShiZCxiYil7dmFyIGJjPXtzdGFydDp7eDowLHk6MH0sZW5kOnt4OjAseTowfX07YmMuc3RhcnQueD1iYy5lbmQueD1iYi5wYWdlWHx8YmIuY2xpZW50WDtiYy5zdGFydC55PWJjLmVuZC55PWJiLnBhZ2VZfHxiYi5jbGllbnRZO2FRW2JkXT1iYztyZXR1cm4gYmN9ZnVuY3Rpb24gYUgoYmIpe3ZhciBiZD1iYi5pZGVudGlmaWVyIT09dW5kZWZpbmVkP2JiLmlkZW50aWZpZXI6MDt2YXIgYmM9YWQoYmQpO2lmKGJjPT09bnVsbCl7YmM9YWkoYmQsYmIpfWJjLmVuZC54PWJiLnBhZ2VYfHxiYi5jbGllbnRYO2JjLmVuZC55PWJiLnBhZ2VZfHxiYi5jbGllbnRZO3JldHVybiBiY31mdW5jdGlvbiBhZChiYil7cmV0dXJuIGFRW2JiXXx8bnVsbH1mdW5jdGlvbiBhSShiYixiYyl7YmM9TWF0aC5tYXgoYmMsYVQoYmIpKTtOW2JiXS5kaXN0YW5jZT1iY31mdW5jdGlvbiBhVChiYil7aWYoTltiYl0pe3JldHVybiBOW2JiXS5kaXN0YW5jZX1yZXR1cm4gdW5kZWZpbmVkfWZ1bmN0aW9uIGFiKCl7dmFyIGJiPXt9O2JiW3BdPWF2KHApO2JiW29dPWF2KG8pO2JiW2VdPWF2KGUpO2JiW3hdPWF2KHgpO3JldHVybiBiYn1mdW5jdGlvbiBhdihiYil7cmV0dXJue2RpcmVjdGlvbjpiYixkaXN0YW5jZTowfX1mdW5jdGlvbiBhTSgpe3JldHVybiBhMi1VfWZ1bmN0aW9uIGF0KGJlLGJkKXt2YXIgYmM9TWF0aC5hYnMoYmUueC1iZC54KTt2YXIgYmI9TWF0aC5hYnMoYmUueS1iZC55KTtyZXR1cm4gTWF0aC5yb3VuZChNYXRoLnNxcnQoYmMqYmMrYmIqYmIpKX1mdW5jdGlvbiBhNyhiYixiYyl7dmFyIGJkPShiYy9iYikqMTtyZXR1cm4gYmQudG9GaXhlZCgyKX1mdW5jdGlvbiBhcSgpe2lmKEg8MSl7cmV0dXJuIEF9ZWxzZXtyZXR1cm4gY319ZnVuY3Rpb24gYVMoYmMsYmIpe3JldHVybiBNYXRoLnJvdW5kKE1hdGguc3FydChNYXRoLnBvdyhiYi54LWJjLngsMikrTWF0aC5wb3coYmIueS1iYy55LDIpKSl9ZnVuY3Rpb24gYUUoYmUsYmMpe3ZhciBiYj1iZS54LWJjLng7dmFyIGJnPWJjLnktYmUueTt2YXIgYmQ9TWF0aC5hdGFuMihiZyxiYik7dmFyIGJmPU1hdGgucm91bmQoYmQqMTgwL01hdGguUEkpO2lmKGJmPDApe2JmPTM2MC1NYXRoLmFicyhiZil9cmV0dXJuIGJmfWZ1bmN0aW9uIGFMKGJjLGJiKXt2YXIgYmQ9YUUoYmMsYmIpO2lmKChiZDw9NDUpJiYoYmQ+PTApKXtyZXR1cm4gcH1lbHNle2lmKChiZDw9MzYwKSYmKGJkPj0zMTUpKXtyZXR1cm4gcH1lbHNle2lmKChiZD49MTM1KSYmKGJkPD0yMjUpKXtyZXR1cm4gb31lbHNle2lmKChiZD40NSkmJihiZDwxMzUpKXtyZXR1cm4geH1lbHNle3JldHVybiBlfX19fX1mdW5jdGlvbiBhcigpe3ZhciBiYj1uZXcgRGF0ZSgpO3JldHVybiBiYi5nZXRUaW1lKCl9ZnVuY3Rpb24gYVkoYmIpe2JiPWYoYmIpO3ZhciBiZD1iYi5vZmZzZXQoKTt2YXIgYmM9e2xlZnQ6YmQubGVmdCxyaWdodDpiZC5sZWZ0K2JiLm91dGVyV2lkdGgoKSx0b3A6YmQudG9wLGJvdHRvbTpiZC50b3ArYmIub3V0ZXJIZWlnaHQoKX07cmV0dXJuIGJjfWZ1bmN0aW9uIEYoYmIsYmMpe3JldHVybihiYi54PmJjLmxlZnQmJmJiLng8YmMucmlnaHQmJmJiLnk+YmMudG9wJiZiYi55PGJjLmJvdHRvbSl9fX0pKTtcbi8qIVxuICogalF1ZXJ5IGJvb3RzdHJhcCAzIGJyZWFrcG9pbnQgY2hlY2tcbiAqIENoZWNrIHRoZSBjdXJyZW50IHZpc2liaWxpdHkgb2YgYm9vdHN0cmFwIDMgYnJlYWtwb2ludHNcbiAqXG4gKiBAZXhhbXBsZSBgJC5pc1hzKClgIGZ1bmN0aW9uIGFsaWFzIGZvciBgJC5pc0JyZWFrcG9pbnQoXCJ4c1wiKWBcbiAqIEBleGFtcGxlIGAkLmlzU20oKWAgZnVuY3Rpb24gYWxpYXMgZm9yIGAkLmlzQnJlYWtwb2ludChcInNtXCIpYFxuICogQGV4YW1wbGUgYCQuaXNNZCgpYCBmdW5jdGlvbiBhbGlhcyBmb3IgYCQuaXNCcmVha3BvaW50KFwibWRcIilgXG4gKiBAZXhhbXBsZSBgJC5pc0xnKClgIGZ1bmN0aW9uIGFsaWFzIGZvciBgJC5pc0JyZWFrcG9pbnQoXCJsZ1wiKWBcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKiBAY29weXJpZ2h0IEplbnMgQS4gKGNha2ViYWtlKSBhbmQgb3RoZXIgY29udHJpYnV0b3JzXG4gKiBAbGljZW5zZSBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqL1xuIWZ1bmN0aW9uKGEpe2EuaXNCcmVha3BvaW50PWZ1bmN0aW9uKGIpe3ZhciBjLGQ7cmV0dXJuIGM9YShcIjxkaXYvPlwiLHtcImNsYXNzXCI6XCJ2aXNpYmxlLVwiK2J9KS5hcHBlbmRUbyhcImJvZHlcIiksZD1jLmlzKFwiOnZpc2libGVcIiksYy5yZW1vdmUoKSxkfSxhLmV4dGVuZChhLHtpc1hzOmZ1bmN0aW9uKCl7cmV0dXJuIGEuaXNCcmVha3BvaW50KFwieHNcIil9LGlzU206ZnVuY3Rpb24oKXtyZXR1cm4gYS5pc0JyZWFrcG9pbnQoXCJzbVwiKX0saXNNZDpmdW5jdGlvbigpe3JldHVybiBhLmlzQnJlYWtwb2ludChcIm1kXCIpfSxpc0xnOmZ1bmN0aW9uKCl7cmV0dXJuIGEuaXNCcmVha3BvaW50KFwibGdcIil9fSl9KGpRdWVyeSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
